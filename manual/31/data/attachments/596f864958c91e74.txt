2025-02-06 15:52:49.054 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-06 15:52:49.055 DEBUG [tests.conftest] Running test: test_message_with_ephemeral_false with id: 2025-02-06_15-52-49__e4c54d7e-506b-4144-a70e-d798662c0909
2025-02-06 15:52:49.056 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-06 15:52:49.056 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-06 15:52:49.057 DEBUG [src.steps.store] Running fixture setup: node_setup
2025-02-06 15:52:49.065 DEBUG [src.node.docker_mananger] Docker client initialized with image quay.io/wakuorg/nwaku-pr:3281
2025-02-06 15:52:49.066 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/publishing_node1_2025-02-06_15-52-49__e4c54d7e-506b-4144-a70e-d798662c0909__quay.io_wakuorg_nwaku-pr:3281.log
2025-02-06 15:52:49.066 DEBUG [src.node.waku_node] Starting Node...
2025-02-06 15:52:49.066 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-06 15:52:49.067 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-06 15:52:49.067 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.18.97
2025-02-06 15:52:49.068 DEBUG [src.node.docker_mananger] Generated ports ['23426', '23427', '23428', '23429', '23430']
2025-02-06 15:52:49.068 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-06 15:52:49.068 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-06 15:52:49.068 DEBUG [src.node.waku_node] Using volumes []
2025-02-06 15:52:49.068 DEBUG [src.node.docker_mananger] docker run -i -t -p 23426:23426 -p 23427:23427 -p 23428:23428 -p 23429:23429 -p 23430:23430 quay.io/wakuorg/nwaku-pr:3281 --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=23428 --rest-port=23426 --tcp-port=23427 --discv5-udp-port=23429 --rest-address=0.0.0.0 --nat=extip:172.18.18.97 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=ec9be3a1eb2f7fb3aa55c8e08c42a35bde8b2391b661254d7cdcad9aec2eef33 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=23430 --metrics-logging=true --store=true --relay=true
2025-02-06 15:52:49.310 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.18.97 waku 5cb2411cff974d10307dc6773da169bcb10f8d147db1d60a9b2e6704bfae367d
2025-02-06 15:52:49.339 ERROR [src.node.docker_mananger] Max retries reached for container 9e2231636d13. Exiting log stream.
2025-02-06 15:52:49.366 DEBUG [src.node.docker_mananger] Container started with ID 5cb2411cff97. Setting up logs at ./log/docker/publishing_node1_2025-02-06_15-52-49__e4c54d7e-506b-4144-a70e-d798662c0909__quay.io_wakuorg_nwaku-pr:3281.log
2025-02-06 15:52:49.366 DEBUG [src.node.waku_node] Started container from image quay.io/wakuorg/nwaku-pr:3281. REST: 23426
2025-02-06 15:52:49.367 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-06 15:52:49.877 ERROR [src.node.docker_mananger] Max retries reached for container ecd3d2ba2ef0. Exiting log stream.
2025-02-06 15:52:50.368 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:23426/health" -H "Content-Type: application/json" -d 'None'
2025-02-06 15:52:50.371 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-06 15:52:50.371 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-06 15:52:50.371 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:23426/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-06 15:52:50.373 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.18.97/tcp/23427/p2p/16Uiu2HAky9aNgUtzYQqpQhyJzrx2WhyrWTuZnYzu7JJR8f4jDRLx","/ip4/172.18.18.97/tcp/23428/ws/p2p/16Uiu2HAky9aNgUtzYQqpQhyJzrx2WhyrWTuZnYzu7JJR8f4jDRLx"],"enrUri":"enr:-L24QGxGw5k6Hg95Pcr_5AoigDIxnyZA2uycwcaguShb3oSfVE2STpLSZRFEUzI2cItgfEsYMXEF9QpNZuNvYAi2RAoCgmlkgnY0gmlwhKwSEmGKbXVsdGlhZGRyc5YACASsEhJhBluDAAoErBISYQZbhN0DgnJzhQADAQAAiXNlY3AyNTZrMaECN08d4oYbXpMVVElUTNs02OPk6loo--BVPNok_jcffEWDdGNwgluDg3VkcIJbhYV3YWt1MgM"}'
2025-02-06 15:52:50.374 INFO [src.node.waku_node] REST service is ready !!
2025-02-06 15:52:50.380 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-06 15:52:50.381 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/store_node1_2025-02-06_15-52-49__e4c54d7e-506b-4144-a70e-d798662c0909__wakuorg_go-waku:latest.log
2025-02-06 15:52:50.381 DEBUG [src.node.waku_node] Starting Node...
2025-02-06 15:52:50.381 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-06 15:52:50.382 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-06 15:52:50.382 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.229.195
2025-02-06 15:52:50.383 DEBUG [src.node.docker_mananger] Generated ports ['1631', '1632', '1633', '1634', '1635']
2025-02-06 15:52:50.383 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-06 15:52:50.383 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-06 15:52:50.383 DEBUG [src.node.waku_node] Using volumes []
2025-02-06 15:52:50.383 DEBUG [src.node.docker_mananger] docker run -i -t -p 1631:1631 -p 1632:1632 -p 1633:1633 -p 1634:1634 -p 1635:1635 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=1633 --rest-port=1631 --tcp-port=1632 --discv5-udp-port=1634 --rest-address=0.0.0.0 --nat=extip:172.18.229.195 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=cd20af9a856cae1ebf2ea0dc2a6077fd13ab55077eb6dd19fefda050e75acee7 --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --discv5-bootstrap-node=enr:-L24QGxGw5k6Hg95Pcr_5AoigDIxnyZA2uycwcaguShb3oSfVE2STpLSZRFEUzI2cItgfEsYMXEF9QpNZuNvYAi2RAoCgmlkgnY0gmlwhKwSEmGKbXVsdGlhZGRyc5YACASsEhJhBluDAAoErBISYQZbhN0DgnJzhQADAQAAiXNlY3AyNTZrMaECN08d4oYbXpMVVElUTNs02OPk6loo--BVPNok_jcffEWDdGNwgluDg3VkcIJbhYV3YWt1MgM --storenode=/ip4/172.18.18.97/tcp/23427/p2p/16Uiu2HAky9aNgUtzYQqpQhyJzrx2WhyrWTuZnYzu7JJR8f4jDRLx --store=true --relay=true
2025-02-06 15:52:50.621 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.229.195 waku 75ad6abde788da3e0b4e4b0bb3082205f2a2ca1c26e88574bfc5e42e89862f97
2025-02-06 15:52:50.674 DEBUG [src.node.docker_mananger] Container started with ID 75ad6abde788. Setting up logs at ./log/docker/store_node1_2025-02-06_15-52-49__e4c54d7e-506b-4144-a70e-d798662c0909__wakuorg_go-waku:latest.log
2025-02-06 15:52:50.675 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 1631
2025-02-06 15:52:50.676 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-06 15:52:51.676 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:1631/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-06 15:52:51.679 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QNVTLRWs9aHwblteNnl_x25QMc0lXIQrBILB_lkUZeeySkt9evK_5LOLIKS0SNYFhZqT2qDCcsHnvMiMe5vtEA6GAZTb9sbygmlkgnY0gmlwhKwRAAOCcnODAAMAiXNlY3AyNTZrMaEDGRZOR8YlOUENj5WRqfWx7_LSyVUKG90NnEBjBC2X0V6DdGNwggZgg3VkcIIGYoV3YWt1MgM","listenAddresses":["/ip4/127.0.0.1/tcp/1632/p2p/16Uiu2HAmELvGdwijE6qiqMnvS9fsXqoRo4WGMLhycQtFpBer2sm7","/ip4/127.0.0.1/tcp/1633/ws/p2p/16Uiu2HAmELvGdwijE6qiqMnvS9fsXqoRo4WGMLhycQtFpBer2sm7","/ip4/172.17.0.3/tcp/1632/p2p/16Uiu2HAmELvGdwijE6qiqMnvS9fsXqoRo4WGMLhycQtFpBer2sm7","/ip4/172.17.0.3/tcp/1633/ws/p2p/16Uiu2HAmELvGdwijE6qiqMnvS9fsXqoRo4WGMLhycQtFpBer2sm7"]}'
2025-02-06 15:52:51.679 INFO [src.node.waku_node] REST service is ready !!
2025-02-06 15:52:51.680 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:1631/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.18.97/tcp/23427/p2p/16Uiu2HAky9aNgUtzYQqpQhyJzrx2WhyrWTuZnYzu7JJR8f4jDRLx", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
2025-02-06 15:52:51.696 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-06 15:52:51.697 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:23426/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2025-02-06 15:52:51.706 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 15:52:51.706 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:1631/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2025-02-06 15:52:51.708 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-06 15:52:51.710 DEBUG [src.steps.store] Relaying message
2025-02-06 15:52:51.711 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:23426/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d '{"payload": "U3RvcmUgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)', "ephemeral": false}'
2025-02-06 15:52:51.727 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 15:52:51.727 DEBUG [src.libs.common] Sleeping for 0.2 seconds
2025-02-06 15:52:51.928 DEBUG [src.steps.store] Checking that peer quay.io/wakuorg/nwaku-pr:3281 can find the stored messages
2025-02-06 15:52:51.928 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:23426/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F0&pageSize=5&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-06 15:52:51.931 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"","statusCode":200,"statusDesc":"OK","messages":[{"messageHash":"0x1168052b46a59d303e19c9bd4142f8a0f5c02459d32312f83bb1cd1923235877"}]}'
2025-02-06 15:52:51.932 DEBUG [src.steps.store] Checking that peer wakuorg/go-waku:latest can find the stored messages
2025-02-06 15:52:51.932 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:1631/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F0&contentTopics=%2Fmyapp%2F1%2Flatest%2Fproto&pageSize=5&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-06 15:52:51.937 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"request_id":"245533543fb589c19d0356daac002d1968ea4cb3146b649a71b8469acad52654","status_code":200,"status_desc":"OK","messages":[{"message_hash":"EWgFK0alnTA+Gcm9QUL4oPXAJFnTIxL4O7HNGSMjWHc="}]}'
2025-02-06 15:52:51.940 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-06 15:52:51.941 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-06 15:52:51.941 DEBUG [src.node.waku_node] Stopping container with id 5cb2411cff97
2025-02-06 15:52:52.508 DEBUG [src.node.waku_node] Container stopped.
2025-02-06 15:52:52.508 DEBUG [src.node.waku_node] Stopping container with id 75ad6abde788
2025-02-06 15:52:53.198 DEBUG [src.node.waku_node] Container stopped.
2025-02-06 15:52:53.200 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-06 15:52:53.206 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-06 15:52:53.209 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
