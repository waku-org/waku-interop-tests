2025-02-06 15:40:34.507 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-06 15:40:34.508 DEBUG [tests.conftest] Running test: test_store_lightpushed_message with id: 2025-02-06_15-40-34__1b2bb4e7-6eb5-41c6-b1b3-bed12c4cb635
2025-02-06 15:40:34.508 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-06 15:40:34.510 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-06 15:40:34.518 DEBUG [src.node.docker_mananger] Docker client initialized with image quay.io/wakuorg/nwaku-pr:3281
2025-02-06 15:40:34.518 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/publishing_node1_2025-02-06_15-40-34__1b2bb4e7-6eb5-41c6-b1b3-bed12c4cb635__quay.io_wakuorg_nwaku-pr:3281.log
2025-02-06 15:40:34.518 DEBUG [src.node.waku_node] Starting Node...
2025-02-06 15:40:34.518 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-06 15:40:34.519 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-06 15:40:34.520 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.118.142
2025-02-06 15:40:34.520 DEBUG [src.node.docker_mananger] Generated ports ['32318', '32319', '32320', '32321', '32322']
2025-02-06 15:40:34.520 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-06 15:40:34.520 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-06 15:40:34.520 DEBUG [src.node.waku_node] Using volumes []
2025-02-06 15:40:34.520 DEBUG [src.node.docker_mananger] docker run -i -t -p 32318:32318 -p 32319:32319 -p 32320:32320 -p 32321:32321 -p 32322:32322 quay.io/wakuorg/nwaku-pr:3281 --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=32320 --rest-port=32318 --tcp-port=32319 --discv5-udp-port=32321 --rest-address=0.0.0.0 --nat=extip:172.18.118.142 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=320cdacfb4da8f595f34cdcb68b862e27bff2782d8b00d854208b32df2f5e0fe --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=32322 --metrics-logging=true --store=true --relay=true --lightpush=true
2025-02-06 15:40:34.620 ERROR [src.node.docker_mananger] Max retries reached for container 244477c4ea0e. Exiting log stream.
2025-02-06 15:40:34.751 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.118.142 waku 22bfbb14259211c3b7c336f85c6e6aebdac74d5a5a82f37a4a47f94c4b887012
2025-02-06 15:40:34.804 DEBUG [src.node.docker_mananger] Container started with ID 22bfbb142592. Setting up logs at ./log/docker/publishing_node1_2025-02-06_15-40-34__1b2bb4e7-6eb5-41c6-b1b3-bed12c4cb635__quay.io_wakuorg_nwaku-pr:3281.log
2025-02-06 15:40:34.805 DEBUG [src.node.waku_node] Started container from image quay.io/wakuorg/nwaku-pr:3281. REST: 32318
2025-02-06 15:40:34.806 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-06 15:40:35.322 ERROR [src.node.docker_mananger] Max retries reached for container e5b81deb0d5f. Exiting log stream.
2025-02-06 15:40:35.806 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:32318/health" -H "Content-Type: application/json" -d 'None'
2025-02-06 15:40:35.809 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-06 15:40:35.809 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-06 15:40:35.810 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:32318/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-06 15:40:35.812 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.118.142/tcp/32319/p2p/16Uiu2HAm2Yj9hvLmKgDzYZhX5fdxPKW3AsaFoHr1h1ynZcHA81TZ","/ip4/172.18.118.142/tcp/32320/ws/p2p/16Uiu2HAm2Yj9hvLmKgDzYZhX5fdxPKW3AsaFoHr1h1ynZcHA81TZ"],"enrUri":"enr:-L24QHTC0wm2ig2VHkPa3wkHoI2IG2979WvZGDRB5OceSrxZFkPbOPUn7FtzgLTiHSHMrViUmTlX32cjG-440Zm4PcQCgmlkgnY0gmlwhKwSdo6KbXVsdGlhZGRyc5YACASsEnaOBn4_AAoErBJ2jgZ-QN0DgnJzhQADAQAAiXNlY3AyNTZrMaECadB1olBS_KPzltDVh4N_axZXKxNWRj2lQIY8hXXstGyDdGNwgn4_g3VkcIJ-QYV3YWt1Mgs"}'
2025-02-06 15:40:35.812 INFO [src.node.waku_node] REST service is ready !!
2025-02-06 15:40:35.820 DEBUG [src.node.docker_mananger] Docker client initialized with image quay.io/wakuorg/nwaku-pr:3281
2025-02-06 15:40:35.820 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/publishing_node2_2025-02-06_15-40-34__1b2bb4e7-6eb5-41c6-b1b3-bed12c4cb635__quay.io_wakuorg_nwaku-pr:3281.log
2025-02-06 15:40:35.820 DEBUG [src.node.waku_node] Starting Node...
2025-02-06 15:40:35.820 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-06 15:40:35.822 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-06 15:40:35.822 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.20.194
2025-02-06 15:40:35.822 DEBUG [src.node.docker_mananger] Generated ports ['8189', '8190', '8191', '8192', '8193']
2025-02-06 15:40:35.822 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-06 15:40:35.822 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-06 15:40:35.822 DEBUG [src.node.waku_node] Using volumes []
2025-02-06 15:40:35.823 DEBUG [src.node.docker_mananger] docker run -i -t -p 8189:8189 -p 8190:8190 -p 8191:8191 -p 8192:8192 -p 8193:8193 quay.io/wakuorg/nwaku-pr:3281 --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=8191 --rest-port=8189 --tcp-port=8190 --discv5-udp-port=8192 --rest-address=0.0.0.0 --nat=extip:172.18.20.194 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=67d8f84babda709af4f0ad4112bc4e84f70f25da846f3491ff58cedbd95ffefe --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=8193 --metrics-logging=true --store=false --relay=true
2025-02-06 15:40:36.077 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.20.194 waku daa5394c20090591c24f7e00aec37b6e130b065f63b0a26fac8cb0ad7daba962
2025-02-06 15:40:36.131 DEBUG [src.node.docker_mananger] Container started with ID daa5394c2009. Setting up logs at ./log/docker/publishing_node2_2025-02-06_15-40-34__1b2bb4e7-6eb5-41c6-b1b3-bed12c4cb635__quay.io_wakuorg_nwaku-pr:3281.log
2025-02-06 15:40:36.131 DEBUG [src.node.waku_node] Started container from image quay.io/wakuorg/nwaku-pr:3281. REST: 8189
2025-02-06 15:40:36.132 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-06 15:40:37.132 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:8189/health" -H "Content-Type: application/json" -d 'None'
2025-02-06 15:40:37.135 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-06 15:40:37.135 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-06 15:40:37.136 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:8189/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-06 15:40:37.138 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.20.194/tcp/8190/p2p/16Uiu2HAmDGmePq7zHV3Yv6wWnjaVzFgEQRfwFiX1nUipa5Bz5VAm","/ip4/172.18.20.194/tcp/8191/ws/p2p/16Uiu2HAmDGmePq7zHV3Yv6wWnjaVzFgEQRfwFiX1nUipa5Bz5VAm"],"enrUri":"enr:-L24QNunZpBmR8qGuzjjNiy4o2hBEcll_Jw18h0ybri8Cmnke5Mtg4SykQ2E14fj6GSO50_MyQmiYQ7VZkAA8-1sps0CgmlkgnY0gmlwhKwSFMKKbXVsdGlhZGRyc5YACASsEhTCBh_-AAoErBIUwgYf_90DgnJzhQADAQAAiXNlY3AyNTZrMaEDCSqLHk-aHWgdUaJAbCNXoZqtR-kMxuQ8WOjQKCcD_BaDdGNwgh_-g3VkcIIgAIV3YWt1MgE"}'
2025-02-06 15:40:37.138 INFO [src.node.waku_node] REST service is ready !!
2025-02-06 15:40:37.138 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:8189/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.118.142/tcp/32319/p2p/16Uiu2HAm2Yj9hvLmKgDzYZhX5fdxPKW3AsaFoHr1h1ynZcHA81TZ"]'
2025-02-06 15:40:37.164 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 15:40:37.175 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-06 15:40:37.176 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/store_node1_2025-02-06_15-40-34__1b2bb4e7-6eb5-41c6-b1b3-bed12c4cb635__wakuorg_go-waku:latest.log
2025-02-06 15:40:37.176 DEBUG [src.node.waku_node] Starting Node...
2025-02-06 15:40:37.176 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-06 15:40:37.177 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-06 15:40:37.178 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.99.142
2025-02-06 15:40:37.178 DEBUG [src.node.docker_mananger] Generated ports ['13038', '13039', '13040', '13041', '13042']
2025-02-06 15:40:37.178 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-06 15:40:37.178 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-06 15:40:37.178 DEBUG [src.node.waku_node] Using volumes []
2025-02-06 15:40:37.178 DEBUG [src.node.docker_mananger] docker run -i -t -p 13038:13038 -p 13039:13039 -p 13040:13040 -p 13041:13041 -p 13042:13042 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=13040 --rest-port=13038 --tcp-port=13039 --discv5-udp-port=13041 --rest-address=0.0.0.0 --nat=extip:172.18.99.142 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=cce3dacbf47da52ea0fabdc2ee02ed7a0b313ce4496e2b6daacc3c9c2aefd298 --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --discv5-bootstrap-node=enr:-L24QHTC0wm2ig2VHkPa3wkHoI2IG2979WvZGDRB5OceSrxZFkPbOPUn7FtzgLTiHSHMrViUmTlX32cjG-440Zm4PcQCgmlkgnY0gmlwhKwSdo6KbXVsdGlhZGRyc5YACASsEnaOBn4_AAoErBJ2jgZ-QN0DgnJzhQADAQAAiXNlY3AyNTZrMaECadB1olBS_KPzltDVh4N_axZXKxNWRj2lQIY8hXXstGyDdGNwgn4_g3VkcIJ-QYV3YWt1Mgs --storenode=/ip4/172.18.118.142/tcp/32319/p2p/16Uiu2HAm2Yj9hvLmKgDzYZhX5fdxPKW3AsaFoHr1h1ynZcHA81TZ --store=false --relay=false --lightpush=true --lightpushnode=/ip4/172.18.118.142/tcp/32319/p2p/16Uiu2HAm2Yj9hvLmKgDzYZhX5fdxPKW3AsaFoHr1h1ynZcHA81TZ --pubsub-topic=/waku/2/rs/3/1
2025-02-06 15:40:37.432 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.99.142 waku 8ddfb65a113663569770ab36a99062b8815fc6d9704aa8339516b26f9a394ee3
2025-02-06 15:40:37.495 DEBUG [src.node.docker_mananger] Container started with ID 8ddfb65a1136. Setting up logs at ./log/docker/store_node1_2025-02-06_15-40-34__1b2bb4e7-6eb5-41c6-b1b3-bed12c4cb635__wakuorg_go-waku:latest.log
2025-02-06 15:40:37.495 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 13038
2025-02-06 15:40:37.496 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-06 15:40:38.498 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:13038/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-06 15:40:38.500 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-KG4QCj58Tm2OX5W-IZ0paPn5Yff_n-ITqa1QRldtmgbWCnPceI_IPzZc23ReLAuZAUEfZmJx1OXfptWI12ghJy4EA-GAZTb65bmgmlkgnY0gmlwhKwRAASCcnOFAAMBAAGJc2VjcDI1NmsxoQLg_RWumED1ZX9AV2hBbDLyCdCqlnIzj2FXx5P0HIK2n4N0Y3CCMu-DdWRwgjLxhXdha3UyCA","listenAddresses":["/ip4/127.0.0.1/tcp/13039/p2p/16Uiu2HAmAZw8hyeEvnYuUbXz4K4dy67V4xFNc9j28jBT9irJrEUN","/ip4/127.0.0.1/tcp/13040/ws/p2p/16Uiu2HAmAZw8hyeEvnYuUbXz4K4dy67V4xFNc9j28jBT9irJrEUN","/ip4/172.17.0.4/tcp/13039/p2p/16Uiu2HAmAZw8hyeEvnYuUbXz4K4dy67V4xFNc9j28jBT9irJrEUN","/ip4/172.17.0.4/tcp/13040/ws/p2p/16Uiu2HAmAZw8hyeEvnYuUbXz4K4dy67V4xFNc9j28jBT9irJrEUN"]}'
2025-02-06 15:40:38.500 INFO [src.node.waku_node] REST service is ready !!
2025-02-06 15:40:38.501 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:13038/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.118.142/tcp/32319/p2p/16Uiu2HAm2Yj9hvLmKgDzYZhX5fdxPKW3AsaFoHr1h1ynZcHA81TZ", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
2025-02-06 15:40:38.502 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-06 15:40:38.503 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:13038/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.20.194/tcp/8190/p2p/16Uiu2HAmDGmePq7zHV3Yv6wWnjaVzFgEQRfwFiX1nUipa5Bz5VAm", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
2025-02-06 15:40:38.519 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-06 15:40:38.520 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:32318/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2025-02-06 15:40:38.525 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 15:40:38.526 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:8189/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2025-02-06 15:40:38.530 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 15:40:38.531 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:13038/lightpush/v1/message" -H "Content-Type: application/json" -d '{"pubsubTopic": "/waku/2/rs/3/0", "message": {"payload": "U3RvcmUgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": 1738856438531093760}}'
2025-02-06 15:40:38.538 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-06 15:40:38.539 DEBUG [src.libs.common] Sleeping for 0.2 seconds
2025-02-06 15:40:38.740 DEBUG [src.steps.store] Checking that peer quay.io/wakuorg/nwaku-pr:3281 can find the stored messages
2025-02-06 15:40:38.741 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:32318/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F0&pageSize=5&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-06 15:40:38.744 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"","statusCode":200,"statusDesc":"OK","messages":[{"messageHash":"0xc08b542c6557943a3c3eb265f273911fc4755227890b2bb2b8ce1a1425a1341f"}]}'
2025-02-06 15:40:38.745 DEBUG [src.steps.store] Checking that peer wakuorg/go-waku:latest can find the stored messages
2025-02-06 15:40:38.745 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:13038/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F0&contentTopics=%2Fmyapp%2F1%2Flatest%2Fproto&pageSize=5&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-06 15:40:38.750 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"request_id":"d11d3b6558468871db54bf1a499cba064239b6114bf63b7002cbafe31a430ad7","status_code":200,"status_desc":"OK","messages":[{"message_hash":"wItULGVXlDo8PrJl8nORH8R1UieJCyuyuM4aFCWhNB8="}]}'
2025-02-06 15:40:38.752 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-06 15:40:38.753 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-06 15:40:38.753 DEBUG [src.node.waku_node] Stopping container with id 22bfbb142592
2025-02-06 15:40:39.315 DEBUG [src.node.waku_node] Container stopped.
2025-02-06 15:40:39.317 DEBUG [src.node.waku_node] Stopping container with id daa5394c2009
2025-02-06 15:40:40.130 ERROR [src.node.docker_mananger] Max retries reached for container 22bfbb142592. Exiting log stream.
2025-02-06 15:40:40.850 DEBUG [src.node.waku_node] Container stopped.
2025-02-06 15:40:40.850 DEBUG [src.node.waku_node] Stopping container with id 8ddfb65a1136
2025-02-06 15:40:41.389 DEBUG [src.node.waku_node] Container stopped.
2025-02-06 15:40:41.391 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-06 15:40:41.398 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-06 15:40:41.404 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-06 15:40:41.406 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
