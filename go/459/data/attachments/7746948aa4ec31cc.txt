2025-02-09 03:07:04.730 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-09 03:07:04.731 DEBUG [tests.conftest] Running test: test_metrics_after_relay_publish with id: 2025-02-09_03-07-04__268042a5-2601-4f23-9e5f-cc9939235f51
2025-02-09 03:07:04.732 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-09 03:07:04.733 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-09 03:07:04.733 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-09 03:07:04.733 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-09 03:07:04.734 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-09 03:07:04.734 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-09 03:07:04.741 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-09 03:07:04.742 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-09_03-07-04__268042a5-2601-4f23-9e5f-cc9939235f51__wakuorg_nwaku:latest.log
2025-02-09 03:07:04.742 DEBUG [src.node.waku_node] Starting Node...
2025-02-09 03:07:04.742 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-09 03:07:04.743 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-09 03:07:04.744 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.204.13
2025-02-09 03:07:04.744 DEBUG [src.node.docker_mananger] Generated ports ['31391', '31392', '31393', '31394', '31395']
2025-02-09 03:07:04.744 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-09 03:07:04.744 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-09 03:07:04.744 DEBUG [src.node.waku_node] Using volumes []
2025-02-09 03:07:04.744 DEBUG [src.node.docker_mananger] docker run -i -t -p 31391:31391 -p 31392:31392 -p 31393:31393 -p 31394:31394 -p 31395:31395 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=31393 --rest-port=31391 --tcp-port=31392 --discv5-udp-port=31394 --rest-address=0.0.0.0 --nat=extip:172.18.204.13 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=b47b9afccfd5ee6fa1df39d1c46a6a6dbdddcdb7becbbf6eaabd8eb2b7aef2cb --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=31395 --metrics-logging=true --relay=true
2025-02-09 03:07:04.976 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.204.13 waku 094133d270a7e8195b3dd613f502337025e706da0541f97ba917d92e5ea91094
2025-02-09 03:07:05.001 ERROR [src.node.docker_mananger] Max retries reached for container bd3210954d14. Exiting log stream.
2025-02-09 03:07:05.022 DEBUG [src.node.docker_mananger] Container started with ID 094133d270a7. Setting up logs at ./log/docker/node1_2025-02-09_03-07-04__268042a5-2601-4f23-9e5f-cc9939235f51__wakuorg_nwaku:latest.log
2025-02-09 03:07:05.023 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 31391
2025-02-09 03:07:05.023 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-09 03:07:05.550 ERROR [src.node.docker_mananger] Max retries reached for container 76b54309356d. Exiting log stream.
2025-02-09 03:07:06.023 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31391/health" -H "Content-Type: application/json" -d 'None'
2025-02-09 03:07:06.026 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-09 03:07:06.027 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-09 03:07:06.027 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31391/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-09 03:07:06.029 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.204.13/tcp/31392/p2p/16Uiu2HAmQnx5Wo957k5kcVCp5nsfbMBGyxM3ywL5iC38HpAFMVWZ","/ip4/172.18.204.13/tcp/31393/ws/p2p/16Uiu2HAmQnx5Wo957k5kcVCp5nsfbMBGyxM3ywL5iC38HpAFMVWZ"],"enrUri":"enr:-L24QGiiJmnL4DqetQL71kHoPM5ZW_5ALvGF1f4VZTV3jZwCPstVrsv5_BjZubu9QRmd1rGUuQmxUP5dJN0B8h0fyLMCgmlkgnY0gmlwhKwSzA2KbXVsdGlhZGRyc5YACASsEswNBnqgAAoErBLMDQZ6od0DgnJzhQADAQAAiXNlY3AyNTZrMaEDtFZSFalOTmWEvPmQYFicRy7xr6i4EMA0Y-8e8v92eAKDdGNwgnqgg3VkcIJ6ooV3YWt1MgE"}'
2025-02-09 03:07:06.029 INFO [src.node.waku_node] REST service is ready !!
2025-02-09 03:07:06.035 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-09 03:07:06.035 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-09_03-07-04__268042a5-2601-4f23-9e5f-cc9939235f51__wakuorg_go-waku:latest.log
2025-02-09 03:07:06.035 DEBUG [src.node.waku_node] Starting Node...
2025-02-09 03:07:06.036 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-09 03:07:06.037 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-09 03:07:06.037 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.161.206
2025-02-09 03:07:06.037 DEBUG [src.node.docker_mananger] Generated ports ['36162', '36163', '36164', '36165', '36166']
2025-02-09 03:07:06.037 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-09 03:07:06.037 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-09 03:07:06.037 DEBUG [src.node.waku_node] Using volumes []
2025-02-09 03:07:06.038 DEBUG [src.node.docker_mananger] docker run -i -t -p 36162:36162 -p 36163:36163 -p 36164:36164 -p 36165:36165 -p 36166:36166 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=36164 --rest-port=36162 --tcp-port=36163 --discv5-udp-port=36165 --rest-address=0.0.0.0 --nat=extip:172.18.161.206 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=3e33f8fb6c70bf5a60b6f71f0a39421bbb3be2d7a12e93ac9f9be95e8cb4f515 --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=true --discv5-bootstrap-node=enr:-L24QGiiJmnL4DqetQL71kHoPM5ZW_5ALvGF1f4VZTV3jZwCPstVrsv5_BjZubu9QRmd1rGUuQmxUP5dJN0B8h0fyLMCgmlkgnY0gmlwhKwSzA2KbXVsdGlhZGRyc5YACASsEswNBnqgAAoErBLMDQZ6od0DgnJzhQADAQAAiXNlY3AyNTZrMaEDtFZSFalOTmWEvPmQYFicRy7xr6i4EMA0Y-8e8v92eAKDdGNwgnqgg3VkcIJ6ooV3YWt1MgE
2025-02-09 03:07:06.286 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.161.206 waku 5e1767b614d5413338acb87aa5eee58997559f5b61667dccbef30143cd43450a
2025-02-09 03:07:06.345 DEBUG [src.node.docker_mananger] Container started with ID 5e1767b614d5. Setting up logs at ./log/docker/node2_2025-02-09_03-07-04__268042a5-2601-4f23-9e5f-cc9939235f51__wakuorg_go-waku:latest.log
2025-02-09 03:07:06.345 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 36162
2025-02-09 03:07:06.346 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-09 03:07:07.347 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:36162/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-09 03:07:07.350 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QKkLc_XVCu-jqWQTlx2e1eJKTouvtqM6A9YQoWtvJ2oyMUSJu5U_I5KroHzDxelw3IhFZGSjiMcoFY2OxiAzZYKGAZTorMzegmlkgnY0gmlwhKwRAAOCcnODAAMAiXNlY3AyNTZrMaECli-ETLTweDdvnWmCyoUMlTT89j_Asyx13UhHbP0OPSqDdGNwgo1Dg3VkcIKNRYV3YWt1MgE","listenAddresses":["/ip4/127.0.0.1/tcp/36163/p2p/16Uiu2HAm5XwAAKfXuHTDVJpgKp3dBeFicPTKcbDZHGc7ayd6nejT","/ip4/127.0.0.1/tcp/36164/ws/p2p/16Uiu2HAm5XwAAKfXuHTDVJpgKp3dBeFicPTKcbDZHGc7ayd6nejT","/ip4/172.17.0.3/tcp/36163/p2p/16Uiu2HAm5XwAAKfXuHTDVJpgKp3dBeFicPTKcbDZHGc7ayd6nejT","/ip4/172.17.0.3/tcp/36164/ws/p2p/16Uiu2HAm5XwAAKfXuHTDVJpgKp3dBeFicPTKcbDZHGc7ayd6nejT"]}'
2025-02-09 03:07:07.350 INFO [src.node.waku_node] REST service is ready !!
2025-02-09 03:07:07.351 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:36162/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.204.13/tcp/31392/p2p/16Uiu2HAmQnx5Wo957k5kcVCp5nsfbMBGyxM3ywL5iC38HpAFMVWZ", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
2025-02-09 03:07:07.368 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-09 03:07:07.369 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-09 03:07:07.371 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31391/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-09 03:07:07.395 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 03:07:07.395 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:36162/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-09 03:07:07.397 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-09 03:07:07.398 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31391/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-09 03:07:07.403 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 03:07:07.405 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-09 03:07:07.506 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-09 03:07:07.507 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31391/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 03:07:07.509 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739070427398738432,"ephemeral":false}]'
2025-02-09 03:07:07.511 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-09 03:07:07.511 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:36162/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 03:07:07.513 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-09 03:07:08.515 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31391/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-09 03:07:08.520 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 03:07:08.520 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-09 03:07:08.620 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-09 03:07:08.620 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31391/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 03:07:08.623 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739070428514718720,"ephemeral":false}]'
2025-02-09 03:07:08.625 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-09 03:07:08.625 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:36162/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 03:07:08.627 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739070428514718720,"ephemeral":false}]'
2025-02-09 03:07:08.629 INFO [src.steps.relay] WARM UP successful!!
2025-02-09 03:07:08.630 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31391/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-09 03:07:08.634 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 03:07:08.634 DEBUG [src.libs.common] Sleeping for 0.5 seconds
2025-02-09 03:07:09.135 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:36162/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 03:07:09.137 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739070428629970944,"ephemeral":false}]'
2025-02-09 03:07:09.137 DEBUG [src.libs.common] Sleeping for 5 seconds
2025-02-09 03:07:14.138 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-09 03:07:14.142 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-09 03:07:14.142 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-09 03:07:14.145 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-09 03:07:14.146 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-09 03:07:14.149 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-09 03:07:14.149 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-09 03:07:14.152 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-09 03:07:14.152 DEBUG [src.steps.metrics] Checking metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} has 1
2025-02-09 03:07:14.155 DEBUG [src.steps.metrics] Found metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} with value 1.0
2025-02-09 03:07:14.155 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-09 03:07:14.158 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-09 03:07:14.159 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-09 03:07:14.162 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 3.0
2025-02-09 03:07:14.162 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-09 03:07:14.165 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 3.0
2025-02-09 03:07:14.168 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-09 03:07:14.169 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-09 03:07:14.169 DEBUG [src.node.waku_node] Stopping container with id 094133d270a7
2025-02-09 03:07:14.729 DEBUG [src.node.waku_node] Container stopped.
2025-02-09 03:07:14.730 DEBUG [src.node.waku_node] Stopping container with id 5e1767b614d5
2025-02-09 03:07:15.252 DEBUG [src.node.waku_node] Container stopped.
2025-02-09 03:07:15.253 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-09 03:07:15.261 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-09 03:07:15.264 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
