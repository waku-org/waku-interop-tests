2025-02-11 14:55:04.866 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-11 14:55:04.866 DEBUG [tests.conftest] Running test: test_metrics_after_relay_publish with id: 2025-02-11_14-55-04__babfc3b3-d2d2-46fa-921a-e75e6db432dd
2025-02-11 14:55:04.866 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-11 14:55:04.867 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-11 14:55:04.867 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-11 14:55:04.867 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-11 14:55:04.867 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-11 14:55:04.867 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-11 14:55:04.873 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-11 14:55:04.873 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-11_14-55-04__babfc3b3-d2d2-46fa-921a-e75e6db432dd__wakuorg_nwaku:latest.log
2025-02-11 14:55:04.873 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 14:55:04.874 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 14:55:04.875 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 14:55:04.875 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.69.0
2025-02-11 14:55:04.875 DEBUG [src.node.docker_mananger] Generated ports ['49282', '49283', '49284', '49285', '49286']
2025-02-11 14:55:04.875 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 14:55:04.875 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 14:55:04.876 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 14:55:04.876 DEBUG [src.node.docker_mananger] docker run -i -t -p 49282:49282 -p 49283:49283 -p 49284:49284 -p 49285:49285 -p 49286:49286 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=49284 --rest-port=49282 --tcp-port=49283 --discv5-udp-port=49285 --rest-address=0.0.0.0 --nat=extip:172.18.69.0 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=ecee85df9e72d59f303f7eb84eeda6771c11e8fafcd18c3dc9fe8dd39f7a87c2 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=49286 --metrics-logging=true --relay=true
2025-02-11 14:55:05.102 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.69.0 waku f18a262cf1145608b11ba69714ba4be551630568af5e8e41e7599a301a387834
2025-02-11 14:55:05.150 DEBUG [src.node.docker_mananger] Container started with ID f18a262cf114. Setting up logs at ./log/docker/node1_2025-02-11_14-55-04__babfc3b3-d2d2-46fa-921a-e75e6db432dd__wakuorg_nwaku:latest.log
2025-02-11 14:55:05.151 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 49282
2025-02-11 14:55:05.151 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 14:55:05.173 ERROR [src.node.docker_mananger] Max retries reached for container 3c784e9a8137. Exiting log stream.
2025-02-11 14:55:05.672 ERROR [src.node.docker_mananger] Max retries reached for container 5c84e5f0cdc5. Exiting log stream.
2025-02-11 14:55:06.152 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49282/health" -H "Content-Type: application/json" -d 'None'
2025-02-11 14:55:06.154 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-11 14:55:06.155 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-11 14:55:06.155 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49282/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 14:55:06.157 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.69.0/tcp/49283/p2p/16Uiu2HAmRa4PxscvVuaU7Bpg6HvL9aZLzvAEPrL5DyGoSErqRe78","/ip4/172.18.69.0/tcp/49284/ws/p2p/16Uiu2HAmRa4PxscvVuaU7Bpg6HvL9aZLzvAEPrL5DyGoSErqRe78"],"enrUri":"enr:-L24QMz0rfUnb68wnhNxePGQLa4HTaXmwH1H5tvbzwxqk1NFOC3Tdkf04wb3CUGpywDqjkLfL5b5lD8B4GP4QEz_XSYCgmlkgnY0gmlwhKwSRQCKbXVsdGlhZGRyc5YACASsEkUABsCDAAoErBJFAAbAhN0DgnJzhQADAQAAiXNlY3AyNTZrMaEDv-SZ15p_lr7LD81035Gwg5L1O3vkTn6jaq2odcFs3beDdGNwgsCDg3VkcILAhYV3YWt1MgE"}'
2025-02-11 14:55:06.157 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 14:55:06.163 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-11 14:55:06.163 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-11_14-55-04__babfc3b3-d2d2-46fa-921a-e75e6db432dd__wakuorg_go-waku:latest.log
2025-02-11 14:55:06.163 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 14:55:06.164 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 14:55:06.165 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 14:55:06.165 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.31.249
2025-02-11 14:55:06.165 DEBUG [src.node.docker_mananger] Generated ports ['7420', '7421', '7422', '7423', '7424']
2025-02-11 14:55:06.165 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 14:55:06.165 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 14:55:06.166 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 14:55:06.166 DEBUG [src.node.docker_mananger] docker run -i -t -p 7420:7420 -p 7421:7421 -p 7422:7422 -p 7423:7423 -p 7424:7424 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=7422 --rest-port=7420 --tcp-port=7421 --discv5-udp-port=7423 --rest-address=0.0.0.0 --nat=extip:172.18.31.249 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=4e36acb2c2fc9fcc973aa565380efacee2b29eb2dcf7fb1c3c8a0e9ccf4dfe26 --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=true --discv5-bootstrap-node=enr:-L24QMz0rfUnb68wnhNxePGQLa4HTaXmwH1H5tvbzwxqk1NFOC3Tdkf04wb3CUGpywDqjkLfL5b5lD8B4GP4QEz_XSYCgmlkgnY0gmlwhKwSRQCKbXVsdGlhZGRyc5YACASsEkUABsCDAAoErBJFAAbAhN0DgnJzhQADAQAAiXNlY3AyNTZrMaEDv-SZ15p_lr7LD81035Gwg5L1O3vkTn6jaq2odcFs3beDdGNwgsCDg3VkcILAhYV3YWt1MgE
2025-02-11 14:55:06.394 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.31.249 waku 3c48f3de002d4b28277e6b0f41be0cf99a8144320fa8193c9b2371e8f2fc4eac
2025-02-11 14:55:06.448 DEBUG [src.node.docker_mananger] Container started with ID 3c48f3de002d. Setting up logs at ./log/docker/node2_2025-02-11_14-55-04__babfc3b3-d2d2-46fa-921a-e75e6db432dd__wakuorg_go-waku:latest.log
2025-02-11 14:55:06.449 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 7420
2025-02-11 14:55:06.449 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 14:55:07.450 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:7420/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 14:55:07.452 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QDGPL7Y4-WkZMe9MKsLxo_T6NLPYFYnNF4-jx2B4wOldVKBvtWz0qp8Jxg4jbkBR6gXiLO_d0RBopmNcvELCE42GAZT1gbbKgmlkgnY0gmlwhKwRAAOCcnODAAMAiXNlY3AyNTZrMaECCKLX82fERUXmyCEUbLD9dG5OQLbw78HmXwWpvwClob2DdGNwghz9g3VkcIIc_4V3YWt1MgE","listenAddresses":["/ip4/127.0.0.1/tcp/7421/p2p/16Uiu2HAkv1PG76vX1AMxCC6AeB5rzHjV6td2Dexar3DJkNT9wQMA","/ip4/127.0.0.1/tcp/7422/ws/p2p/16Uiu2HAkv1PG76vX1AMxCC6AeB5rzHjV6td2Dexar3DJkNT9wQMA","/ip4/172.17.0.3/tcp/7421/p2p/16Uiu2HAkv1PG76vX1AMxCC6AeB5rzHjV6td2Dexar3DJkNT9wQMA","/ip4/172.17.0.3/tcp/7422/ws/p2p/16Uiu2HAkv1PG76vX1AMxCC6AeB5rzHjV6td2Dexar3DJkNT9wQMA"]}'
2025-02-11 14:55:07.453 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 14:55:07.453 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7420/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.69.0/tcp/49283/p2p/16Uiu2HAmRa4PxscvVuaU7Bpg6HvL9aZLzvAEPrL5DyGoSErqRe78", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
2025-02-11 14:55:07.471 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-11 14:55:07.472 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-11 14:55:07.473 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:49282/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 14:55:07.494 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 14:55:07.494 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7420/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 14:55:07.497 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-11 14:55:07.499 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:49282/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 14:55:07.503 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 14:55:07.505 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-11 14:55:07.606 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-11 14:55:07.606 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49282/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 14:55:07.609 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739285707499028736,"ephemeral":false}]'
2025-02-11 14:55:07.611 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-11 14:55:07.611 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:7420/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 14:55:07.612 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-11 14:55:08.614 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:49282/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 14:55:08.618 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 14:55:08.619 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-11 14:55:08.719 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-11 14:55:08.719 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49282/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 14:55:08.722 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739285708613783552,"ephemeral":false}]'
2025-02-11 14:55:08.724 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-11 14:55:08.724 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:7420/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 14:55:08.725 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739285708613783552,"ephemeral":false}]'
2025-02-11 14:55:08.727 INFO [src.steps.relay] WARM UP successful!!
2025-02-11 14:55:08.728 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:49282/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 14:55:08.732 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 14:55:08.733 DEBUG [src.libs.common] Sleeping for 0.5 seconds
2025-02-11 14:55:09.233 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:7420/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 14:55:09.235 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739285708728362496,"ephemeral":false}]'
2025-02-11 14:55:09.235 DEBUG [src.libs.common] Sleeping for 5 seconds
2025-02-11 14:55:14.236 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-11 14:55:14.240 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-11 14:55:14.240 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-11 14:55:14.243 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-11 14:55:14.243 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-11 14:55:14.246 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-11 14:55:14.246 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-11 14:55:14.249 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-11 14:55:14.250 DEBUG [src.steps.metrics] Checking metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} has 1
2025-02-11 14:55:14.252 DEBUG [src.steps.metrics] Found metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} with value 1.0
2025-02-11 14:55:14.253 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-11 14:55:14.256 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-11 14:55:14.256 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-11 14:55:14.259 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 3.0
2025-02-11 14:55:14.259 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-11 14:55:14.262 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 3.0
2025-02-11 14:55:14.265 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-11 14:55:14.265 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-11 14:55:14.266 DEBUG [src.node.waku_node] Stopping container with id f18a262cf114
2025-02-11 14:55:14.816 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 14:55:14.816 DEBUG [src.node.waku_node] Stopping container with id 3c48f3de002d
2025-02-11 14:55:15.317 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 14:55:15.319 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-11 14:55:15.331 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-11 14:55:15.334 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
