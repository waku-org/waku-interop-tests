2025-02-10 03:07:09.621 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-10 03:07:09.622 DEBUG [tests.conftest] Running test: test_msg_not_stored_when_ephemeral_true with id: 2025-02-10_03-07-09__96ef6d69-07fa-49b5-b7f0-f93f8178246f
2025-02-10 03:07:09.622 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-10 03:07:09.622 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-10 03:07:09.622 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-10 03:07:09.630 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-10 03:07:09.631 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-10_03-07-09__96ef6d69-07fa-49b5-b7f0-f93f8178246f__wakuorg_go-waku:latest.log
2025-02-10 03:07:09.636 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-10 03:07:09.636 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-10_03-07-09__96ef6d69-07fa-49b5-b7f0-f93f8178246f__wakuorg_nwaku:latest.log
2025-02-10 03:07:09.641 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-10 03:07:09.642 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node3_2025-02-10_03-07-09__96ef6d69-07fa-49b5-b7f0-f93f8178246f__wakuorg_go-waku:latest.log
2025-02-10 03:07:09.642 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-10 03:07:09.642 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-10 03:07:09.643 DEBUG [tests.e2e.test_e2e] Start 3 nodes 
2025-02-10 03:07:09.643 DEBUG [src.node.waku_node] Starting Node...
2025-02-10 03:07:09.643 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-10 03:07:09.706 DEBUG [src.node.docker_mananger] Network waku created
2025-02-10 03:07:09.706 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.16.71
2025-02-10 03:07:09.706 DEBUG [src.node.docker_mananger] Generated ports ['18133', '18134', '18135', '18136', '18137']
2025-02-10 03:07:09.706 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-10 03:07:09.706 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-10 03:07:09.707 DEBUG [src.node.waku_node] Using volumes []
2025-02-10 03:07:09.707 DEBUG [src.node.docker_mananger] docker run -i -t -p 18133:18133 -p 18134:18134 -p 18135:18135 -p 18136:18136 -p 18137:18137 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=18135 --rest-port=18133 --tcp-port=18134 --discv5-udp-port=18136 --rest-address=0.0.0.0 --nat=extip:172.18.16.71 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=74a80ec482fbcbdc2d3ac775e6dbd541e41cec27ffb326dca0b071a07afa76b5 --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=true --store=true
2025-02-10 03:07:12.582 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.16.71 waku 8937fb81dccdbab3b29b51b845f03bdf363c30e19d7cabbe577b996c407d79a2
2025-02-10 03:07:12.635 DEBUG [src.node.docker_mananger] Container started with ID 8937fb81dccd. Setting up logs at ./log/docker/node1_2025-02-10_03-07-09__96ef6d69-07fa-49b5-b7f0-f93f8178246f__wakuorg_go-waku:latest.log
2025-02-10 03:07:12.637 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 18133
2025-02-10 03:07:12.638 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-10 03:07:13.638 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:18133/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-10 03:07:13.641 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QMo8pZfEPvZC1zlE1hte15BndVLNs7P3CAv1m5psBPKxdJGWmDIl2bfluiz_wS3HN5TVXyhvhciR1M6BFQrrfdGGAZTt00GAgmlkgnY0gmlwhKwRAAKCcnODAAMAiXNlY3AyNTZrMaEDXVPFruNfSLz91OCbW4r0XzqBrWuyei6qxMk5cIxmaKqDdGNwgkbWg3VkcIJG2IV3YWt1MgM","listenAddresses":["/ip4/127.0.0.1/tcp/18134/p2p/16Uiu2HAmJwJMYjeR9CzN7Br44NEWTge539MxA6x45swKcVztxvBB","/ip4/127.0.0.1/tcp/18135/ws/p2p/16Uiu2HAmJwJMYjeR9CzN7Br44NEWTge539MxA6x45swKcVztxvBB","/ip4/172.17.0.2/tcp/18134/p2p/16Uiu2HAmJwJMYjeR9CzN7Br44NEWTge539MxA6x45swKcVztxvBB","/ip4/172.17.0.2/tcp/18135/ws/p2p/16Uiu2HAmJwJMYjeR9CzN7Br44NEWTge539MxA6x45swKcVztxvBB"]}'
2025-02-10 03:07:13.641 INFO [src.node.waku_node] REST service is ready !!
2025-02-10 03:07:13.642 DEBUG [src.node.waku_node] Starting Node...
2025-02-10 03:07:13.642 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-10 03:07:13.643 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-10 03:07:13.643 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.77.226
2025-02-10 03:07:13.644 DEBUG [src.node.docker_mananger] Generated ports ['47998', '47999', '48000', '48001', '48002']
2025-02-10 03:07:13.644 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-10 03:07:13.644 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-10 03:07:13.644 DEBUG [src.node.waku_node] Using volumes []
2025-02-10 03:07:13.644 DEBUG [src.node.docker_mananger] docker run -i -t -p 47998:47998 -p 47999:47999 -p 48000:48000 -p 48001:48001 -p 48002:48002 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=48000 --rest-port=47998 --tcp-port=47999 --discv5-udp-port=48001 --rest-address=0.0.0.0 --nat=extip:172.18.77.226 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=cc771b6164b005288fdbb6d66bd7bec8fbcebf107e3e89bcbf823ac9267acce6 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=48002 --metrics-logging=true --store=true --relay=true --discv5-bootstrap-node=enr:-J-4QMo8pZfEPvZC1zlE1hte15BndVLNs7P3CAv1m5psBPKxdJGWmDIl2bfluiz_wS3HN5TVXyhvhciR1M6BFQrrfdGGAZTt00GAgmlkgnY0gmlwhKwRAAKCcnODAAMAiXNlY3AyNTZrMaEDXVPFruNfSLz91OCbW4r0XzqBrWuyei6qxMk5cIxmaKqDdGNwgkbWg3VkcIJG2IV3YWt1MgM
2025-02-10 03:07:15.543 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.77.226 waku 943252a8d76e0800c8239dbf288edccb7ce2bcd684ee84e90f2d4d3d8f260c67
2025-02-10 03:07:15.590 DEBUG [src.node.docker_mananger] Container started with ID 943252a8d76e. Setting up logs at ./log/docker/node2_2025-02-10_03-07-09__96ef6d69-07fa-49b5-b7f0-f93f8178246f__wakuorg_nwaku:latest.log
2025-02-10 03:07:15.590 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 47998
2025-02-10 03:07:15.591 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-10 03:07:16.593 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:47998/health" -H "Content-Type: application/json" -d 'None'
2025-02-10 03:07:16.596 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-10 03:07:16.596 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-10 03:07:16.597 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:47998/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-10 03:07:16.599 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.77.226/tcp/47999/p2p/16Uiu2HAm2ixh9qvqYQREwSDhMPXdzmwbTkfdF2E9SsH5ZNzqooq8","/ip4/172.18.77.226/tcp/48000/ws/p2p/16Uiu2HAm2ixh9qvqYQREwSDhMPXdzmwbTkfdF2E9SsH5ZNzqooq8"],"enrUri":"enr:-L24QGRUijPWEEdemJ7Nax_6D76VOil2nVBHlnZ4PMcEvdygX-nGUOwIsS8fXGFBpgqBVwhATLrr0HlBOBzpg55HNBACgmlkgnY0gmlwhKwSTeKKbXVsdGlhZGRyc5YACASsEk3iBrt_AAoErBJN4ga7gN0DgnJzhQADAQAAiXNlY3AyNTZrMaECbG-UbdEe_opcynkorFRfoIs_765OxoM9VLmqt8BLJW-DdGNwgrt_g3VkcIK7gYV3YWt1MgM"}'
2025-02-10 03:07:16.599 INFO [src.node.waku_node] REST service is ready !!
2025-02-10 03:07:16.600 DEBUG [src.node.waku_node] Starting Node...
2025-02-10 03:07:16.600 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-10 03:07:16.602 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-10 03:07:16.603 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.99.100
2025-02-10 03:07:16.603 DEBUG [src.node.docker_mananger] Generated ports ['48131', '48132', '48133', '48134', '48135']
2025-02-10 03:07:16.604 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-10 03:07:16.605 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-10 03:07:16.605 DEBUG [src.node.waku_node] Using volumes []
2025-02-10 03:07:16.606 DEBUG [src.node.docker_mananger] docker run -i -t -p 48131:48131 -p 48132:48132 -p 48133:48133 -p 48134:48134 -p 48135:48135 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=48133 --rest-port=48131 --tcp-port=48132 --discv5-udp-port=48134 --rest-address=0.0.0.0 --nat=extip:172.18.99.100 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=32b9fe973f8b6b69eaba1cbfadecfdd89b53d6dceff1887d961f76b3f028fff4 --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=false --storenode=/ip4/172.18.77.226/tcp/47999/p2p/16Uiu2HAm2ixh9qvqYQREwSDhMPXdzmwbTkfdF2E9SsH5ZNzqooq8 --discv5-bootstrap-node=enr:-L24QGRUijPWEEdemJ7Nax_6D76VOil2nVBHlnZ4PMcEvdygX-nGUOwIsS8fXGFBpgqBVwhATLrr0HlBOBzpg55HNBACgmlkgnY0gmlwhKwSTeKKbXVsdGlhZGRyc5YACASsEk3iBrt_AAoErBJN4ga7gN0DgnJzhQADAQAAiXNlY3AyNTZrMaECbG-UbdEe_opcynkorFRfoIs_765OxoM9VLmqt8BLJW-DdGNwgrt_g3VkcIK7gYV3YWt1MgM --pubsub-topic=/waku/2/rs/3/1
2025-02-10 03:07:16.859 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.99.100 waku 6517a4b6cdc264c61835dd8e15fb51305af019116bc5f03959c6f191a4d68fed
2025-02-10 03:07:16.910 DEBUG [src.node.docker_mananger] Container started with ID 6517a4b6cdc2. Setting up logs at ./log/docker/node3_2025-02-10_03-07-09__96ef6d69-07fa-49b5-b7f0-f93f8178246f__wakuorg_go-waku:latest.log
2025-02-10 03:07:16.912 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 48131
2025-02-10 03:07:16.912 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-10 03:07:17.912 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48131/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-10 03:07:17.915 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-KG4QIkKgHuzf9l9_TOLT2h81_xKTgmIZaSf5xpy-LntJ3BebqkCbsl7QAFai0HZgPA79foyNWsd9JJj6HdaW9wGc2OGAZTt01IugmlkgnY0gmlwhKwRAASCcnOFAAMBAAGJc2VjcDI1NmsxoQJ7bbnjWQlW2SysdBBDxXY9TrMkdrfczBGicROCidqRMYN0Y3CCvASDdWRwgrwGhXdha3UygA","listenAddresses":["/ip4/127.0.0.1/tcp/48132/p2p/16Uiu2HAm3jVAmLDke1CTWrn7PtqakLSbvbPQxMts963Tkw8UWBdA","/ip4/127.0.0.1/tcp/48133/ws/p2p/16Uiu2HAm3jVAmLDke1CTWrn7PtqakLSbvbPQxMts963Tkw8UWBdA","/ip4/172.17.0.4/tcp/48132/p2p/16Uiu2HAm3jVAmLDke1CTWrn7PtqakLSbvbPQxMts963Tkw8UWBdA","/ip4/172.17.0.4/tcp/48133/ws/p2p/16Uiu2HAm3jVAmLDke1CTWrn7PtqakLSbvbPQxMts963Tkw8UWBdA"]}'
2025-02-10 03:07:17.916 INFO [src.node.waku_node] REST service is ready !!
2025-02-10 03:07:17.916 DEBUG [tests.e2e.test_e2e] Subscribe node1 ,2 to pubtopic /waku/2/rs/3/1
2025-02-10 03:07:17.916 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:18133/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-10 03:07:17.918 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-10 03:07:17.919 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:47998/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-10 03:07:17.921 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 03:07:17.922 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:18133/admin/v1/peers" -H "Content-Type: application/json" -d 'None'
2025-02-10 03:07:17.924 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"id":"16Uiu2HAm2ixh9qvqYQREwSDhMPXdzmwbTkfdF2E9SsH5ZNzqooq8","multiaddrs":["/ip4/172.18.77.226/tcp/47999/p2p/16Uiu2HAm2ixh9qvqYQREwSDhMPXdzmwbTkfdF2E9SsH5ZNzqooq8","/ip4/172.18.77.226/tcp/48000/ws/p2p/16Uiu2HAm2ixh9qvqYQREwSDhMPXdzmwbTkfdF2E9SsH5ZNzqooq8"],"protocols":null,"connected":false,"pubsubTopics":[]}]'
2025-02-10 03:07:17.924 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:47998/admin/v1/peers" -H "Content-Type: application/json" -d 'None'
2025-02-10 03:07:17.926 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"multiaddr":"/ip4/172.17.0.4/tcp/48132/p2p/16Uiu2HAm3jVAmLDke1CTWrn7PtqakLSbvbPQxMts963Tkw8UWBdA","protocols":[{"protocol":"/vac/waku/peer-exchange/2.0.0-alpha1","connected":true}],"origin":"UnknownOrigin"}]'
2025-02-10 03:07:17.926 DEBUG [src.libs.common] Sleeping for 30 seconds
2025-02-10 03:07:47.927 DEBUG [tests.e2e.test_e2e] Node1 publish message with flag ephemeral = True
2025-02-10 03:07:47.927 DEBUG [src.steps.store] Relaying message
2025-02-10 03:07:47.928 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:18133/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "RmlsdGVyIHdvcmtzISE=", "contentTopic": "/test/1/waku-filter/proto", "timestamp": '$(date +%s%N)', "ephemeral": true}'
2025-02-10 03:07:47.930 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-10 03:07:47.931 DEBUG [src.libs.common] Sleeping for 0.2 seconds
2025-02-10 03:07:48.132 DEBUG [src.libs.common] Sleeping for 3 seconds
2025-02-10 03:07:51.132 DEBUG [tests.e2e.test_e2e] Node3 makes store request to get messages
2025-02-10 03:07:51.133 DEBUG [src.steps.store] Checking that peer wakuorg/go-waku:latest can find the stored messages
2025-02-10 03:07:51.133 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48131/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F1&contentTopics=%2Ftest%2F1%2Fwaku-filter%2Fproto&pageSize=50&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-10 03:07:51.139 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"request_id":"5b2ed511edbc1e6a08e0c39209f1f464ec4399af3df485ded78f43a4ccd2b334","status_code":200,"status_desc":"OK"}'
2025-02-10 03:07:51.140 DEBUG [tests.e2e.test_e2e] Response for store when ephemeral = true is strPeer wakuorg/go-waku:latest couldn't find any messages. Actual response: {'request_id': '5b2ed511edbc1e6a08e0c39209f1f464ec4399af3df485ded78f43a4ccd2b334', 'status_code': 200, 'status_desc': 'OK'}
2025-02-10 03:07:51.141 DEBUG [tests.e2e.test_e2e] Message isn't stored as ephemeral = True
2025-02-10 03:07:51.143 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-10 03:07:51.144 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-10 03:07:51.144 DEBUG [src.node.waku_node] Stopping container with id 8937fb81dccd
2025-02-10 03:07:51.676 DEBUG [src.node.waku_node] Container stopped.
2025-02-10 03:07:51.677 DEBUG [src.node.waku_node] Stopping container with id 943252a8d76e
2025-02-10 03:07:52.491 ERROR [src.node.docker_mananger] Max retries reached for container 8937fb81dccd. Exiting log stream.
2025-02-10 03:07:52.514 DEBUG [src.node.waku_node] Container stopped.
2025-02-10 03:07:52.514 DEBUG [src.node.waku_node] Stopping container with id 6517a4b6cdc2
2025-02-10 03:07:53.029 DEBUG [src.node.waku_node] Container stopped.
2025-02-10 03:07:53.033 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-10 03:07:53.039 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-10 03:07:53.063 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-10 03:07:53.066 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
