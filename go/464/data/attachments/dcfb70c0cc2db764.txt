2025-02-12 03:08:30.916 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-12 03:08:30.917 DEBUG [tests.conftest] Running test: test_get_store_message_with_version with id: 2025-02-12_03-08-30__5f2f209c-a214-4475-a792-731fba4bf349
2025-02-12 03:08:30.917 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-12 03:08:30.917 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-12 03:08:30.918 DEBUG [src.steps.store] Running fixture setup: node_setup
2025-02-12 03:08:30.926 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-12 03:08:30.926 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/publishing_node1_2025-02-12_03-08-30__5f2f209c-a214-4475-a792-731fba4bf349__wakuorg_nwaku:latest.log
2025-02-12 03:08:30.927 DEBUG [src.node.waku_node] Starting Node...
2025-02-12 03:08:30.927 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-12 03:08:30.928 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-12 03:08:30.928 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.42.209
2025-02-12 03:08:30.928 DEBUG [src.node.docker_mananger] Generated ports ['28031', '28032', '28033', '28034', '28035']
2025-02-12 03:08:30.929 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-12 03:08:30.929 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-12 03:08:30.929 DEBUG [src.node.waku_node] Using volumes []
2025-02-12 03:08:30.929 DEBUG [src.node.docker_mananger] docker run -i -t -p 28031:28031 -p 28032:28032 -p 28033:28033 -p 28034:28034 -p 28035:28035 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=28033 --rest-port=28031 --tcp-port=28032 --discv5-udp-port=28034 --rest-address=0.0.0.0 --nat=extip:172.18.42.209 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=ff41ed6b9dae5bac32e370e9efe747aac19bad0cfaca539cf376b9c22ac493af --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=28035 --metrics-logging=true --store=true --relay=true
2025-02-12 03:08:31.164 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.42.209 waku a6bb13da1ad34eab914ed79469dab3849846ce70672c6ca5c06377577fa7195d
2025-02-12 03:08:31.216 ERROR [src.node.docker_mananger] Max retries reached for container 7863c23d6a8b. Exiting log stream.
2025-02-12 03:08:31.224 DEBUG [src.node.docker_mananger] Container started with ID a6bb13da1ad3. Setting up logs at ./log/docker/publishing_node1_2025-02-12_03-08-30__5f2f209c-a214-4475-a792-731fba4bf349__wakuorg_nwaku:latest.log
2025-02-12 03:08:31.224 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 28031
2025-02-12 03:08:31.225 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-12 03:08:31.735 ERROR [src.node.docker_mananger] Max retries reached for container bbe129156575. Exiting log stream.
2025-02-12 03:08:32.225 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:28031/health" -H "Content-Type: application/json" -d 'None'
2025-02-12 03:08:32.228 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-12 03:08:32.228 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-12 03:08:32.229 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:28031/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-12 03:08:32.231 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.42.209/tcp/28032/p2p/16Uiu2HAmDKhVQ6mkroEigP6GM35bBktj61Wsv9B8QKpVSrXjEt8B","/ip4/172.18.42.209/tcp/28033/ws/p2p/16Uiu2HAmDKhVQ6mkroEigP6GM35bBktj61Wsv9B8QKpVSrXjEt8B"],"enrUri":"enr:-L24QP4TogJo0bG1a2o99aHp3B-JqVkd0Z7WHeX7GpcLHHcVC-rlFlQm14Zw64oF17ZllFygkg_14EPBliDY3O_qHIACgmlkgnY0gmlwhKwSKtGKbXVsdGlhZGRyc5YACASsEirRBm2AAAoErBIq0QZtgd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDCeqWcj8DSiVM0srJ0X9WwvzDWjNKtrsSLJhuXpbCS_SDdGNwgm2Ag3VkcIJtgoV3YWt1MgM"}'
2025-02-12 03:08:32.231 INFO [src.node.waku_node] REST service is ready !!
2025-02-12 03:08:32.238 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-12 03:08:32.238 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/store_node1_2025-02-12_03-08-30__5f2f209c-a214-4475-a792-731fba4bf349__wakuorg_go-waku:latest.log
2025-02-12 03:08:32.238 DEBUG [src.node.waku_node] Starting Node...
2025-02-12 03:08:32.239 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-12 03:08:32.240 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-12 03:08:32.240 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.157.38
2025-02-12 03:08:32.240 DEBUG [src.node.docker_mananger] Generated ports ['5171', '5172', '5173', '5174', '5175']
2025-02-12 03:08:32.241 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-12 03:08:32.241 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-12 03:08:32.241 DEBUG [src.node.waku_node] Using volumes []
2025-02-12 03:08:32.241 DEBUG [src.node.docker_mananger] docker run -i -t -p 5171:5171 -p 5172:5172 -p 5173:5173 -p 5174:5174 -p 5175:5175 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=5173 --rest-port=5171 --tcp-port=5172 --discv5-udp-port=5174 --rest-address=0.0.0.0 --nat=extip:172.18.157.38 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=fa59c4b5fe625b009fdba720fdba7a0dced86fb0dea8ce2e7bafaecbb3ccea9b --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --discv5-bootstrap-node=enr:-L24QP4TogJo0bG1a2o99aHp3B-JqVkd0Z7WHeX7GpcLHHcVC-rlFlQm14Zw64oF17ZllFygkg_14EPBliDY3O_qHIACgmlkgnY0gmlwhKwSKtGKbXVsdGlhZGRyc5YACASsEirRBm2AAAoErBIq0QZtgd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDCeqWcj8DSiVM0srJ0X9WwvzDWjNKtrsSLJhuXpbCS_SDdGNwgm2Ag3VkcIJtgoV3YWt1MgM --storenode=/ip4/172.18.42.209/tcp/28032/p2p/16Uiu2HAmDKhVQ6mkroEigP6GM35bBktj61Wsv9B8QKpVSrXjEt8B --store=true --relay=true
2025-02-12 03:08:32.473 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.157.38 waku 983c4565c100c7d81f883129370f9e2be55dcea3913bd65bfdfef8e64a7ea1e9
2025-02-12 03:08:32.531 DEBUG [src.node.docker_mananger] Container started with ID 983c4565c100. Setting up logs at ./log/docker/store_node1_2025-02-12_03-08-30__5f2f209c-a214-4475-a792-731fba4bf349__wakuorg_go-waku:latest.log
2025-02-12 03:08:32.531 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 5171
2025-02-12 03:08:32.532 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-12 03:08:33.532 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:5171/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-12 03:08:33.535 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QO4Y5E4GPDz6DYeptRrR87GEw8Qr8ncMu0RrfplLhrH4KfpB8rwP52mS9A7JRNYHa2c8qNNGt_M9sG69ZkFKki-GAZT4ITGRgmlkgnY0gmlwhKwRAAOCcnODAAMAiXNlY3AyNTZrMaECR7QmXkKgYyalSAfvG8HtjRmt3A7w4285JEKCmaHI4yqDdGNwghQ0g3VkcIIUNoV3YWt1MgM","listenAddresses":["/ip4/127.0.0.1/tcp/5172/p2p/16Uiu2HAkzFaFZzyhVVbCDCcPKbrvfPXB2HHR8ingT7s3GQ5Kmixq","/ip4/127.0.0.1/tcp/5173/ws/p2p/16Uiu2HAkzFaFZzyhVVbCDCcPKbrvfPXB2HHR8ingT7s3GQ5Kmixq","/ip4/172.17.0.3/tcp/5172/p2p/16Uiu2HAkzFaFZzyhVVbCDCcPKbrvfPXB2HHR8ingT7s3GQ5Kmixq","/ip4/172.17.0.3/tcp/5173/ws/p2p/16Uiu2HAkzFaFZzyhVVbCDCcPKbrvfPXB2HHR8ingT7s3GQ5Kmixq"]}'
2025-02-12 03:08:33.536 INFO [src.node.waku_node] REST service is ready !!
2025-02-12 03:08:33.536 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:5171/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.42.209/tcp/28032/p2p/16Uiu2HAmDKhVQ6mkroEigP6GM35bBktj61Wsv9B8QKpVSrXjEt8B", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
2025-02-12 03:08:33.553 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-12 03:08:33.553 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:28031/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2025-02-12 03:08:33.577 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-12 03:08:33.577 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:5171/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2025-02-12 03:08:33.580 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-12 03:08:33.584 DEBUG [src.steps.store] Relaying message
2025-02-12 03:08:33.585 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:28031/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d '{"payload": "U3RvcmUgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)', "version": 10}'
2025-02-12 03:08:33.598 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-12 03:08:33.598 DEBUG [src.libs.common] Sleeping for 0.2 seconds
2025-02-12 03:08:33.801 DEBUG [src.steps.store] Checking that peer wakuorg/nwaku:latest can find the stored messages
2025-02-12 03:08:33.801 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:28031/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F0&pageSize=5&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-12 03:08:33.804 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"","statusCode":200,"statusDesc":"OK","messages":[{"messageHash":"0xf245aa4c2b6a0834a9b8798f90823d7cb7fd9492c92ca9510df86a82cfb89f18"}]}'
2025-02-12 03:08:33.805 DEBUG [src.steps.store] Checking that peer wakuorg/go-waku:latest can find the stored messages
2025-02-12 03:08:33.805 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:5171/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F0&contentTopics=%2Fmyapp%2F1%2Flatest%2Fproto&pageSize=5&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-12 03:08:33.810 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"request_id":"c96e5781142577bcf56e454e90d97663821774301edaa8395b2a6377f9d63203","status_code":200,"status_desc":"OK","messages":[{"message_hash":"8kWqTCtqCDSpuHmPkII9fLf9lJLJLKlRDfhqgs+4nxg="}]}'
2025-02-12 03:08:33.813 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-12 03:08:33.814 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-12 03:08:33.814 DEBUG [src.node.waku_node] Stopping container with id a6bb13da1ad3
2025-02-12 03:08:34.390 DEBUG [src.node.waku_node] Container stopped.
2025-02-12 03:08:34.390 DEBUG [src.node.waku_node] Stopping container with id 983c4565c100
2025-02-12 03:08:35.043 DEBUG [src.node.waku_node] Container stopped.
2025-02-12 03:08:35.045 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-12 03:08:35.052 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-12 03:08:35.055 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
