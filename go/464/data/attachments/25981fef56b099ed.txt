2025-02-12 03:05:25.817 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-12 03:05:25.817 DEBUG [tests.conftest] Running test: test_publish_with_invalid_payloads with id: 2025-02-12_03-05-25__7aa42928-d454-489d-bb02-f5c75d5ba7ef
2025-02-12 03:05:25.818 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-12 03:05:25.818 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-12 03:05:25.818 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-12 03:05:25.824 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-12 03:05:25.824 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-12_03-05-25__7aa42928-d454-489d-bb02-f5c75d5ba7ef__wakuorg_nwaku:latest.log
2025-02-12 03:05:25.824 DEBUG [src.node.waku_node] Starting Node...
2025-02-12 03:05:25.825 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-12 03:05:25.826 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-12 03:05:25.826 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.245.250
2025-02-12 03:05:25.826 DEBUG [src.node.docker_mananger] Generated ports ['2543', '2544', '2545', '2546', '2547']
2025-02-12 03:05:25.826 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-12 03:05:25.826 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-12 03:05:25.827 DEBUG [src.node.waku_node] Using volumes []
2025-02-12 03:05:25.827 DEBUG [src.node.docker_mananger] docker run -i -t -p 2543:2543 -p 2544:2544 -p 2545:2545 -p 2546:2546 -p 2547:2547 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=2545 --rest-port=2543 --tcp-port=2544 --discv5-udp-port=2546 --rest-address=0.0.0.0 --nat=extip:172.18.245.250 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=eeaf7bceaf4e6dabf770afab2dfbebcbcfbdfb888b176ae8b5fcfea6ddfcaaed --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=2547 --metrics-logging=true --relay=true
2025-02-12 03:05:26.050 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.245.250 waku 50b962101ae7d2f50f6072e6d04bd22930bad640fc3f34d09af30302262ee84a
2025-02-12 03:05:26.099 DEBUG [src.node.docker_mananger] Container started with ID 50b962101ae7. Setting up logs at ./log/docker/node1_2025-02-12_03-05-25__7aa42928-d454-489d-bb02-f5c75d5ba7ef__wakuorg_nwaku:latest.log
2025-02-12 03:05:26.101 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 2543
2025-02-12 03:05:26.101 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-12 03:05:26.117 ERROR [src.node.docker_mananger] Max retries reached for container ab2477f0a9be. Exiting log stream.
2025-02-12 03:05:26.626 ERROR [src.node.docker_mananger] Max retries reached for container d21434d242e2. Exiting log stream.
2025-02-12 03:05:27.103 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:2543/health" -H "Content-Type: application/json" -d 'None'
2025-02-12 03:05:27.106 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-12 03:05:27.106 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-12 03:05:27.106 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:2543/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-12 03:05:27.109 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.245.250/tcp/2544/p2p/16Uiu2HAmMyYvrCXq7hVXggVCH29PLmxAWEMWjrcZqG2QHvPRAoze","/ip4/172.18.245.250/tcp/2545/ws/p2p/16Uiu2HAmMyYvrCXq7hVXggVCH29PLmxAWEMWjrcZqG2QHvPRAoze"],"enrUri":"enr:-L24QE91o2ZCuNy5ClpV4JgrtSkFkagF2kf-nN92peiGUTALQ2KnQpH_caH4g9Wnc3WS4s2cATl5yYOBE-k2y342KqcCgmlkgnY0gmlwhKwS9fqKbXVsdGlhZGRyc5YACASsEvX6BgnwAAoErBL1-gYJ8d0DgnJzhQADAQAAiXNlY3AyNTZrMaEDinp5QQp_kAAb2EAWhgTJAhiXP7VsksBQcFHPoQT2ym-DdGNwggnwg3VkcIIJ8oV3YWt1MgE"}'
2025-02-12 03:05:27.109 INFO [src.node.waku_node] REST service is ready !!
2025-02-12 03:05:27.115 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-12 03:05:27.115 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-12_03-05-25__7aa42928-d454-489d-bb02-f5c75d5ba7ef__wakuorg_go-waku:latest.log
2025-02-12 03:05:27.115 DEBUG [src.node.waku_node] Starting Node...
2025-02-12 03:05:27.115 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-12 03:05:27.117 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-12 03:05:27.117 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.97.157
2025-02-12 03:05:27.117 DEBUG [src.node.docker_mananger] Generated ports ['15576', '15577', '15578', '15579', '15580']
2025-02-12 03:05:27.117 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-12 03:05:27.117 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-12 03:05:27.118 DEBUG [src.node.waku_node] Using volumes []
2025-02-12 03:05:27.118 DEBUG [src.node.docker_mananger] docker run -i -t -p 15576:15576 -p 15577:15577 -p 15578:15578 -p 15579:15579 -p 15580:15580 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=15578 --rest-port=15576 --tcp-port=15577 --discv5-udp-port=15579 --rest-address=0.0.0.0 --nat=extip:172.18.97.157 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=ffdeac206fa4f0fb2e07cad01721bf6ea8ecfdcbd9afcda5efe3c1dfcfe68dd5 --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=true --discv5-bootstrap-node=enr:-L24QE91o2ZCuNy5ClpV4JgrtSkFkagF2kf-nN92peiGUTALQ2KnQpH_caH4g9Wnc3WS4s2cATl5yYOBE-k2y342KqcCgmlkgnY0gmlwhKwS9fqKbXVsdGlhZGRyc5YACASsEvX6BgnwAAoErBL1-gYJ8d0DgnJzhQADAQAAiXNlY3AyNTZrMaEDinp5QQp_kAAb2EAWhgTJAhiXP7VsksBQcFHPoQT2ym-DdGNwggnwg3VkcIIJ8oV3YWt1MgE
2025-02-12 03:05:27.343 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.97.157 waku 0e89a52b682e8bb8ae3c1ac9acfcdd1ef4aa0764a9d4cbc179e2c8025f5ea3b2
2025-02-12 03:05:27.408 DEBUG [src.node.docker_mananger] Container started with ID 0e89a52b682e. Setting up logs at ./log/docker/node2_2025-02-12_03-05-25__7aa42928-d454-489d-bb02-f5c75d5ba7ef__wakuorg_go-waku:latest.log
2025-02-12 03:05:27.410 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 15576
2025-02-12 03:05:27.410 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-12 03:05:28.410 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15576/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-12 03:05:28.413 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QN-Rl1jffqQF8do0rqeo6h7oBAXct2L1QQrWS757zw42Gxa4pNyb4Y4S5dhxbGYokhCNDSP-BuTEmjejo-SzJiqGAZT4Hl5cgmlkgnY0gmlwhKwRAAOCcnODAAMAiXNlY3AyNTZrMaEC41eLD1bL1ZE-EhmAxRlbOy9XDNbCY3SRO2LYkjQC0S2DdGNwgjzZg3VkcII824V3YWt1MgE","listenAddresses":["/ip4/127.0.0.1/tcp/15577/p2p/16Uiu2HAmAj7x7a1h48LbMT6e4ZHSYYZ88dsMSB7DTttBmjMA8miC","/ip4/127.0.0.1/tcp/15578/ws/p2p/16Uiu2HAmAj7x7a1h48LbMT6e4ZHSYYZ88dsMSB7DTttBmjMA8miC","/ip4/172.17.0.3/tcp/15577/p2p/16Uiu2HAmAj7x7a1h48LbMT6e4ZHSYYZ88dsMSB7DTttBmjMA8miC","/ip4/172.17.0.3/tcp/15578/ws/p2p/16Uiu2HAmAj7x7a1h48LbMT6e4ZHSYYZ88dsMSB7DTttBmjMA8miC"]}'
2025-02-12 03:05:28.413 INFO [src.node.waku_node] REST service is ready !!
2025-02-12 03:05:28.414 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:15576/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.245.250/tcp/2544/p2p/16Uiu2HAmMyYvrCXq7hVXggVCH29PLmxAWEMWjrcZqG2QHvPRAoze", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
2025-02-12 03:05:28.431 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-12 03:05:28.432 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-12 03:05:28.432 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2543/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-12 03:05:28.457 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-12 03:05:28.457 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:15576/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-12 03:05:28.460 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-12 03:05:28.461 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-12 03:05:28.474 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-12 03:05:28.475 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-12 03:05:28.575 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-12 03:05:28.575 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-12 03:05:28.578 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739329528461018880,"ephemeral":false}]'
2025-02-12 03:05:28.580 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-12 03:05:28.580 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15576/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-12 03:05:28.582 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-12 03:05:29.583 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-12 03:05:29.588 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-12 03:05:29.589 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-12 03:05:29.689 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-12 03:05:29.689 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-12 03:05:29.691 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739329529583576064,"ephemeral":false}]'
2025-02-12 03:05:29.693 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-12 03:05:29.693 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15576/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-12 03:05:29.695 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739329529583576064,"ephemeral":false}]'
2025-02-12 03:05:29.696 INFO [src.steps.relay] WARM UP successful!!
2025-02-12 03:05:29.697 DEBUG [tests.relay.test_publish] Running test with payload Empty string
2025-02-12 03:05:29.697 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-12 03:05:29.700 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-12 03:05:29.700 DEBUG [tests.relay.test_publish] Running test with payload Unecoded text
2025-02-12 03:05:29.700 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "Hello World!", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-12 03:05:29.703 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Incorrect base64 string'
2025-02-12 03:05:29.703 DEBUG [tests.relay.test_publish] Running test with payload A dictionary
2025-02-12 03:05:29.703 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": {"key": "YWFh"}, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-12 03:05:29.705 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-12 03:05:29.706 DEBUG [tests.relay.test_publish] Running test with payload An integer
2025-02-12 03:05:29.706 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": 1234567890, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-12 03:05:29.708 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-12 03:05:29.708 DEBUG [tests.relay.test_publish] Running test with payload A list
2025-02-12 03:05:29.709 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": ["YWFh"], "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-12 03:05:29.711 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-12 03:05:29.711 DEBUG [tests.relay.test_publish] Running test with payload A bool
2025-02-12 03:05:29.711 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": true, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-12 03:05:29.713 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:2543/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-12 03:05:29.715 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-12 03:05:29.716 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-12 03:05:29.716 DEBUG [src.node.waku_node] Stopping container with id 50b962101ae7
2025-02-12 03:05:30.284 DEBUG [src.node.waku_node] Container stopped.
2025-02-12 03:05:30.284 DEBUG [src.node.waku_node] Stopping container with id 0e89a52b682e
2025-02-12 03:05:30.798 DEBUG [src.node.waku_node] Container stopped.
2025-02-12 03:05:30.799 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-12 03:05:30.806 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-12 03:05:30.809 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
