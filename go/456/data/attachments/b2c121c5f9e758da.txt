2025-02-06 03:08:38.857 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-06 03:08:38.858 DEBUG [tests.conftest] Running test: test_filter_static_sharding_multiple_shards with id: 2025-02-06_03-08-38__45ea046a-004c-4432-a30f-3255ad6e34a7
2025-02-06 03:08:38.858 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-06 03:08:38.858 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-06 03:08:38.859 DEBUG [src.steps.sharding] Running fixture setup: sharding_setup
2025-02-06 03:08:38.867 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-06 03:08:38.867 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-06_03-08-38__45ea046a-004c-4432-a30f-3255ad6e34a7__wakuorg_nwaku:latest.log
2025-02-06 03:08:38.867 DEBUG [src.node.waku_node] Starting Node...
2025-02-06 03:08:38.867 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-06 03:08:38.868 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-06 03:08:38.869 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.219.16
2025-02-06 03:08:38.869 DEBUG [src.node.docker_mananger] Generated ports ['37716', '37717', '37718', '37719', '37720']
2025-02-06 03:08:38.869 DEBUG [src.node.waku_node] Cluster id was resolved to: 2
2025-02-06 03:08:38.869 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-06 03:08:38.869 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-06 03:08:38.869 DEBUG [src.node.waku_node] Using volumes []
2025-02-06 03:08:38.870 DEBUG [src.node.docker_mananger] docker run -i -t -p 37716:37716 -p 37717:37717 -p 37718:37718 -p 37719:37719 -p 37720:37720 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=37718 --rest-port=37716 --tcp-port=37717 --discv5-udp-port=37719 --rest-address=0.0.0.0 --nat=extip:172.18.219.16 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=0ff53efb7c1bf6ebd245dfdaeca0fa51e36e81f50b485fdbebdadc53dbbce3c3 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=37720 --metrics-logging=true --relay=true --filter=true --pubsub-topic=/waku/2/rs/2/0 --pubsub-topic=/waku/2/rs/2/1 --pubsub-topic=/waku/2/rs/2/2 --pubsub-topic=/waku/2/rs/2/3 --pubsub-topic=/waku/2/rs/2/4 --pubsub-topic=/waku/2/rs/2/5 --pubsub-topic=/waku/2/rs/2/6 --pubsub-topic=/waku/2/rs/2/7
2025-02-06 03:08:39.096 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.219.16 waku bcb6d6a72e48c1fa95e49538598821d90dedc30cc35c7263ab331c2f85cb9968
2025-02-06 03:08:39.147 DEBUG [src.node.docker_mananger] Container started with ID bcb6d6a72e48. Setting up logs at ./log/docker/node1_2025-02-06_03-08-38__45ea046a-004c-4432-a30f-3255ad6e34a7__wakuorg_nwaku:latest.log
2025-02-06 03:08:39.149 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 37716
2025-02-06 03:08:39.149 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-06 03:08:39.162 ERROR [src.node.docker_mananger] Max retries reached for container 69cdd66c073a. Exiting log stream.
2025-02-06 03:08:39.659 ERROR [src.node.docker_mananger] Max retries reached for container 52153c7c037f. Exiting log stream.
2025-02-06 03:08:40.149 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:37716/health" -H "Content-Type: application/json" -d 'None'
2025-02-06 03:08:40.152 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-06 03:08:40.152 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-06 03:08:40.153 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:37716/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-06 03:08:40.154 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.219.16/tcp/37717/p2p/16Uiu2HAmU94PepdM1bxFpboFYrErVPBTaukG2vi9NxKKFzR1Hwrh","/ip4/172.18.219.16/tcp/37718/ws/p2p/16Uiu2HAmU94PepdM1bxFpboFYrErVPBTaukG2vi9NxKKFzR1Hwrh"],"enrUri":"enr:-Mu4QI_gKEUeOX48trJCON8-toutmk4MFxc5NlaSCsVs8KmqYruIYA_BuoshDTL-KrGG8KJVxutdTUSrmIxbZvn8IYgCgmlkgnY0gmlwhKwS2xCKbXVsdGlhZGRyc5YACASsEtsQBpNVAAoErBLbEAaTVt0DgnJzkwACCAAAAAEAAgADAAQABQAGAAeJc2VjcDI1NmsxoQPmECKrl8DvErEWUvfKrhbWsim_JTdMLsMmEXwYiSObmoN0Y3CCk1WDdWRwgpNXhXdha3UyBQ"}'
2025-02-06 03:08:40.155 INFO [src.node.waku_node] REST service is ready !!
2025-02-06 03:08:40.161 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-06 03:08:40.161 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-06_03-08-38__45ea046a-004c-4432-a30f-3255ad6e34a7__wakuorg_go-waku:latest.log
2025-02-06 03:08:40.161 DEBUG [src.node.waku_node] Starting Node...
2025-02-06 03:08:40.161 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-06 03:08:40.163 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-06 03:08:40.163 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.242.57
2025-02-06 03:08:40.163 DEBUG [src.node.docker_mananger] Generated ports ['37507', '37508', '37509', '37510', '37511']
2025-02-06 03:08:40.163 DEBUG [src.node.waku_node] Cluster id was resolved to: 2
2025-02-06 03:08:40.163 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-06 03:08:40.163 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-06 03:08:40.163 DEBUG [src.node.waku_node] Using volumes []
2025-02-06 03:08:40.164 DEBUG [src.node.docker_mananger] docker run -i -t -p 37507:37507 -p 37508:37508 -p 37509:37509 -p 37510:37510 -p 37511:37511 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=37509 --rest-port=37507 --tcp-port=37508 --discv5-udp-port=37510 --rest-address=0.0.0.0 --nat=extip:172.18.242.57 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=ad7cdaa5ce6a32dfac59cf2a85d2eb8a39c5e86f2a74ab40d87d5b226345339c --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=false --discv5-bootstrap-node=enr:-Mu4QI_gKEUeOX48trJCON8-toutmk4MFxc5NlaSCsVs8KmqYruIYA_BuoshDTL-KrGG8KJVxutdTUSrmIxbZvn8IYgCgmlkgnY0gmlwhKwS2xCKbXVsdGlhZGRyc5YACASsEtsQBpNVAAoErBLbEAaTVt0DgnJzkwACCAAAAAEAAgADAAQABQAGAAeJc2VjcDI1NmsxoQPmECKrl8DvErEWUvfKrhbWsim_JTdMLsMmEXwYiSObmoN0Y3CCk1WDdWRwgpNXhXdha3UyBQ --filternode=/ip4/172.18.219.16/tcp/37717/p2p/16Uiu2HAmU94PepdM1bxFpboFYrErVPBTaukG2vi9NxKKFzR1Hwrh --pubsub-topic=/waku/2/rs/3/1
2025-02-06 03:08:40.398 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.242.57 waku 9a9c5bfb20cb020804666d2a2eaa8240c147ebfd732aba8361f1c702472ed9ec
2025-02-06 03:08:40.456 DEBUG [src.node.docker_mananger] Container started with ID 9a9c5bfb20cb. Setting up logs at ./log/docker/node2_2025-02-06_03-08-38__45ea046a-004c-4432-a30f-3255ad6e34a7__wakuorg_go-waku:latest.log
2025-02-06 03:08:40.456 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 37507
2025-02-06 03:08:40.457 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-06 03:08:41.458 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:37507/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-06 03:08:41.460 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-KG4QMJC-_bXRnL4fgDyYj_zoNf6nlIqjOqKSyXmvphYClK0LJXVWHovjbpflvnLDcwIqE6LCYTK6EXSbplaIHwKexuGAZTZOyh7gmlkgnY0gmlwhKwRAAOCcnOFAAIBAAGJc2VjcDI1NmsxoQMFpn1Hgcqd8j5BD50Kl4_7A7aPlCrVAhwRgPLuV7e80YN0Y3CCkoSDdWRwgpKGhXdha3UygA","listenAddresses":["/ip4/127.0.0.1/tcp/37508/p2p/16Uiu2HAmD33dgD7iEzknxPUmRy7xqRRnewDrA3jD4Rjs1EP3bSSt","/ip4/127.0.0.1/tcp/37509/ws/p2p/16Uiu2HAmD33dgD7iEzknxPUmRy7xqRRnewDrA3jD4Rjs1EP3bSSt","/ip4/172.17.0.3/tcp/37508/p2p/16Uiu2HAmD33dgD7iEzknxPUmRy7xqRRnewDrA3jD4Rjs1EP3bSSt","/ip4/172.17.0.3/tcp/37509/ws/p2p/16Uiu2HAmD33dgD7iEzknxPUmRy7xqRRnewDrA3jD4Rjs1EP3bSSt"]}'
2025-02-06 03:08:41.460 INFO [src.node.waku_node] REST service is ready !!
2025-02-06 03:08:41.461 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37507/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.219.16/tcp/37717/p2p/16Uiu2HAmU94PepdM1bxFpboFYrErVPBTaukG2vi9NxKKFzR1Hwrh", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
2025-02-06 03:08:41.462 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-06 03:08:41.463 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37716/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0", "/waku/2/rs/2/1", "/waku/2/rs/2/2", "/waku/2/rs/2/3", "/waku/2/rs/2/4", "/waku/2/rs/2/5", "/waku/2/rs/2/6", "/waku/2/rs/2/7"]'
2025-02-06 03:08:41.466 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 03:08:41.466 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37507/filter/v2/subscriptions" -H "Content-Type: application/json" -d '{"requestId": "19bfa485-0c85-4d58-a90b-572789be7296", "contentFilters": ["/myapp/1/latest/proto"], "pubsubTopic": "/waku/2/rs/2/0"}'
2025-02-06 03:08:41.471 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"19bfa485-0c85-4d58-a90b-572789be7296","statusDesc":"OK"}'
2025-02-06 03:08:41.472 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37507/filter/v2/subscriptions" -H "Content-Type: application/json" -d '{"requestId": "6a299b1b-b5ab-48e7-bc49-6dba5528d3de", "contentFilters": ["/waku/2/content/test.js"], "pubsubTopic": "/waku/2/rs/2/1"}'
2025-02-06 03:08:41.477 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"6a299b1b-b5ab-48e7-bc49-6dba5528d3de","statusDesc":"OK"}'
2025-02-06 03:08:41.478 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37507/filter/v2/subscriptions" -H "Content-Type: application/json" -d '{"requestId": "ed516c8f-9fa5-4e6e-8191-aa8264c4421f", "contentFilters": ["/app/22/sometopic/someencoding"], "pubsubTopic": "/waku/2/rs/2/2"}'
2025-02-06 03:08:41.483 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"ed516c8f-9fa5-4e6e-8191-aa8264c4421f","statusDesc":"OK"}'
2025-02-06 03:08:41.484 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37507/filter/v2/subscriptions" -H "Content-Type: application/json" -d '{"requestId": "3458c4ab-d28a-444e-8c35-6ad075518cc8", "contentFilters": ["/toychat/2/huilong/proto"], "pubsubTopic": "/waku/2/rs/2/3"}'
2025-02-06 03:08:41.489 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"3458c4ab-d28a-444e-8c35-6ad075518cc8","statusDesc":"OK"}'
2025-02-06 03:08:41.490 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37507/filter/v2/subscriptions" -H "Content-Type: application/json" -d '{"requestId": "53239259-bc7c-4ea0-a8e7-e0b4f23506d7", "contentFilters": ["/statusim/1/community/cbor"], "pubsubTopic": "/waku/2/rs/2/4"}'
2025-02-06 03:08:41.496 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"53239259-bc7c-4ea0-a8e7-e0b4f23506d7","statusDesc":"OK"}'
2025-02-06 03:08:41.496 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37507/filter/v2/subscriptions" -H "Content-Type: application/json" -d '{"requestId": "16ee3f08-0fa0-4c83-bdce-3c2bef4bf7ca", "contentFilters": ["/app/27/sometopic/someencoding"], "pubsubTopic": "/waku/2/rs/2/5"}'
2025-02-06 03:08:41.501 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"16ee3f08-0fa0-4c83-bdce-3c2bef4bf7ca","statusDesc":"OK"}'
2025-02-06 03:08:41.502 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37507/filter/v2/subscriptions" -H "Content-Type: application/json" -d '{"requestId": "1ad5c823-3e60-46b8-a9c2-9fc758df8079", "contentFilters": ["/app/29/sometopic/someencoding"], "pubsubTopic": "/waku/2/rs/2/6"}'
2025-02-06 03:08:41.508 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"1ad5c823-3e60-46b8-a9c2-9fc758df8079","statusDesc":"OK"}'
2025-02-06 03:08:41.509 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37507/filter/v2/subscriptions" -H "Content-Type: application/json" -d '{"requestId": "2a26f75c-68d9-4295-aec7-51e9294a5cf8", "contentFilters": ["/app/20/sometopic/someencoding"], "pubsubTopic": "/waku/2/rs/2/7"}'
2025-02-06 03:08:41.514 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"2a26f75c-68d9-4295-aec7-51e9294a5cf8","statusDesc":"OK"}'
2025-02-06 03:08:41.515 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37716/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2025-02-06 03:08:41.524 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 03:08:41.524 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-06 03:08:41.624 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-06 03:08:41.625 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:37507/filter/v2/messages/%2Fwaku%2F2%2Frs%2F2%2F0/%2Fmyapp%2F1%2Flatest%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-06 03:08:41.626 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1738811321515604992,"ephemeral":false}]'
2025-02-06 03:08:41.628 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37716/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F1" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/waku/2/content/test.js", "timestamp": '$(date +%s%N)'}'
2025-02-06 03:08:41.633 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 03:08:41.633 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-06 03:08:41.734 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-06 03:08:41.734 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:37507/filter/v2/messages/%2Fwaku%2F2%2Frs%2F2%2F1/%2Fwaku%2F2%2Fcontent%2Ftest.js" -H "Content-Type: application/json" -d 'None'
2025-02-06 03:08:41.736 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[]'
2025-02-06 03:08:41.744 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-06 03:08:41.745 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-06 03:08:41.745 DEBUG [src.node.waku_node] Stopping container with id bcb6d6a72e48
2025-02-06 03:08:42.268 DEBUG [src.node.waku_node] Container stopped.
2025-02-06 03:08:42.268 DEBUG [src.node.waku_node] Stopping container with id 9a9c5bfb20cb
2025-02-06 03:08:42.940 DEBUG [src.node.waku_node] Container stopped.
2025-02-06 03:08:42.941 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-06 03:08:42.949 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-06 03:08:42.952 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-06 03:08:42.953 DEBUG [tests.conftest] Running fixture teardown: attach_logs_on_fail
2025-02-06 03:08:42.953 DEBUG [tests.conftest] Test failed, attempting to attach logs to the allure reports
2025-02-06 03:08:42.953 DEBUG [src.libs.common] Attaching file ./log/docker/node2_2025-02-06_03-08-38__45ea046a-004c-4432-a30f-3255ad6e34a7__wakuorg_go-waku:latest.log
2025-02-06 03:08:42.954 DEBUG [src.libs.common] Attaching file ./log/docker/node1_2025-02-06_03-08-38__45ea046a-004c-4432-a30f-3255ad6e34a7__wakuorg_nwaku:latest.log
