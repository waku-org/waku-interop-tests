[35mDEBUG   [0m src.postgres_setup:postgres_setup.py:36 Postgres container started
[35mDEBUG   [0m tests.conftest:conftest.py:51 Running fixture setup: test_id
[35mDEBUG   [0m tests.conftest:conftest.py:57 Running test: test_on_empty_postgress_db with id: 2024-10-17_03-23-22__16b2a98b-e18a-40e2-9ef2-67a00ac9eaa5
[35mDEBUG   [0m src.steps.common:common.py:17 Running fixture setup: common_setup
[35mDEBUG   [0m src.steps.store:store.py:31 Running fixture setup: store_setup
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:18 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:85 WakuNode instance initialized with log path ./log/docker/publishing_node1_2024-10-17_03-23-22__16b2a98b-e18a-40e2-9ef2-67a00ac9eaa5__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:21 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:24 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:81 Generated random external IP 172.18.109.230
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:74 Generated ports ['21625', '21626', '21627', '21628', '21629']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:434 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:163 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:165 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:48 docker run -i -t -p 21625:21625 -p 21626:21626 -p 21627:21627 -p 21628:21628 -p 21629:21629 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=21627 --rest-port=21625 --tcp-port=21626 --discv5-udp-port=21628 --rest-address=0.0.0.0 --nat=extip:172.18.109.230 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=3decda8e8c86a0aaaa6e6c81a3b87ddfd6f8b8b28c31ccfd05e69c0ef1fae487 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=21629 --metrics-logging=true --store=true --relay=true --store-message-db-url=postgres://postgres:test123@postgres:5432/postgres
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:54 docker network connect --ip 172.18.109.230 waku 6497cc5df70b53cb9afdfea65408fe7d7e0461056e57910b906a42674292b0eb
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:57 Container started with ID 6497cc5df70b. Setting up logs at ./log/docker/publishing_node1_2024-10-17_03-23-22__16b2a98b-e18a-40e2-9ef2-67a00ac9eaa5__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:177 Started container from image wakuorg/nwaku:latest. REST: 21625
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:21625/health" -H "Content-Type: application/json" -d 'None'
[31m[1mERROR   [0m src.node.waku_node:waku_node.py:183 REST service did not become ready in time: HTTPConnectionPool(host='127.0.0.1', port=21625): Read timed out. (read timeout=20)
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:21 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:24 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:81 Generated random external IP 172.18.137.208
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:74 Generated ports ['13501', '13502', '13503', '13504', '13505']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:434 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:163 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:165 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:48 docker run -i -t -p 13501:13501 -p 13502:13502 -p 13503:13503 -p 13504:13504 -p 13505:13505 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=13503 --rest-port=13501 --tcp-port=13502 --discv5-udp-port=13504 --rest-address=0.0.0.0 --nat=extip:172.18.137.208 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=a1aadc85ef42e2b692cd7ee0a43be5a91a95efe6ea4dcade3c54ab47dab85bbd --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=13505 --metrics-logging=true --store=true --relay=true --store-message-db-url=postgres://postgres:test123@postgres:5432/postgres
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:54 docker network connect --ip 172.18.137.208 waku 1b909f91714d666d5788e25b6b81186dac72dd5ca2b03f9b3012109c937a0899
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:57 Container started with ID 1b909f91714d. Setting up logs at ./log/docker/publishing_node1_2024-10-17_03-23-22__16b2a98b-e18a-40e2-9ef2-67a00ac9eaa5__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:177 Started container from image wakuorg/nwaku:latest. REST: 13501
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:13501/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Initializing","protocolsHealth":[]}'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:13501/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Initializing","protocolsHealth":[]}'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:13501/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:277 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:13501/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.137.208/tcp/13502/p2p/16Uiu2HAmCenpEwpaEowvNSeJMFQWkrFaj5Tc7maqMEorobq1NuMn","/ip4/172.18.137.208/tcp/13503/ws/p2p/16Uiu2HAmCenpEwpaEowvNSeJMFQWkrFaj5Tc7maqMEorobq1NuMn"],"enrUri":"enr:-LO4QDP9vsTrs4MwmFKgRu_OQpttAGAaVeRLypdGMrCpuArlB_DQQawl3PAxjV5uKSZgGbwpDKwrL1aPDKy-8X3HP5IBgmlkgnY0gmlwhKwSidCKbXVsdGlhZGRyc4wACgSsEonQBjS_3QOCcnOFAAMBAACJc2VjcDI1NmsxoQL_8vT8ChWY54Frids-xMMCObLq-VrKqlyMCim5au3LzYN0Y3CCNL6DdWRwgjTAhXdha3UyAw"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:282 REST service is ready !!
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:18 Docker client initialized with image wakuorg/go-waku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:85 WakuNode instance initialized with log path ./log/docker/store_node1_2024-10-17_03-23-22__16b2a98b-e18a-40e2-9ef2-67a00ac9eaa5__wakuorg_go-waku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:21 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:24 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:81 Generated random external IP 172.18.215.85
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:74 Generated ports ['16892', '16893', '16894', '16895', '16896']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:434 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:163 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:165 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:48 docker run -i -t -p 16892:16892 -p 16893:16893 -p 16894:16894 -p 16895:16895 -p 16896:16896 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=16894 --rest-port=16892 --tcp-port=16893 --discv5-udp-port=16895 --rest-address=0.0.0.0 --nat=extip:172.18.215.85 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=5f4bf994aeceaf79f14c1172c3ebfde207bb3bdfebc3351a0baa21aa6689fdae --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --discv5-bootstrap-node=enr:-LO4QDP9vsTrs4MwmFKgRu_OQpttAGAaVeRLypdGMrCpuArlB_DQQawl3PAxjV5uKSZgGbwpDKwrL1aPDKy-8X3HP5IBgmlkgnY0gmlwhKwSidCKbXVsdGlhZGRyc4wACgSsEonQBjS_3QOCcnOFAAMBAACJc2VjcDI1NmsxoQL_8vT8ChWY54Frids-xMMCObLq-VrKqlyMCim5au3LzYN0Y3CCNL6DdWRwgjTAhXdha3UyAw --storenode=/ip4/172.18.137.208/tcp/13502/p2p/16Uiu2HAmCenpEwpaEowvNSeJMFQWkrFaj5Tc7maqMEorobq1NuMn --store=false --relay=true
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:54 docker network connect --ip 172.18.215.85 waku c0ffa611331614cd56dd24a39091b49fefae3743c287819950313d0bcd1253b2
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:57 Container started with ID c0ffa6113316. Setting up logs at ./log/docker/store_node1_2024-10-17_03-23-22__16b2a98b-e18a-40e2-9ef2-67a00ac9eaa5__wakuorg_go-waku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:177 Started container from image wakuorg/go-waku:latest. REST: 16892
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:16892/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"enrUri":"enr:-Ji4QPfVnSL24tN4_miJseQh4-OFqbplGzLTyMxs8zjFqQRzBZfJ4osnsm_1LHvZK-qjZwAdObimzm6acqK7eNbaT7mGAZKYgMXtgmlkgnY0gmlwhKwRAAiJc2VjcDI1NmsxoQPafncHQG8DFWXJqxUuS5hZdJ7GRTWqv3168BMpxMxo5IN0Y3CCQf2DdWRwgkH_hXdha3UyAQ","listenAddresses":["/ip4/127.0.0.1/tcp/16893/p2p/16Uiu2HAmTMu5JWUcN6fr1GsVdr4hTicYjLyXPKh7na6BYJ6oFuCf","/ip4/127.0.0.1/tcp/16894/ws/p2p/16Uiu2HAmTMu5JWUcN6fr1GsVdr4hTicYjLyXPKh7na6BYJ6oFuCf","/ip4/172.17.0.8/tcp/16893/p2p/16Uiu2HAmTMu5JWUcN6fr1GsVdr4hTicYjLyXPKh7na6BYJ6oFuCf","/ip4/172.17.0.8/tcp/16894/ws/p2p/16Uiu2HAmTMu5JWUcN6fr1GsVdr4hTicYjLyXPKh7na6BYJ6oFuCf"]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:282 REST service is ready !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:16892/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.137.208/tcp/13502/p2p/16Uiu2HAmCenpEwpaEowvNSeJMFQWkrFaj5Tc7maqMEorobq1NuMn", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'null'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:13501/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:16892/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'true'
[35mDEBUG   [0m src.steps.store:store.py:132 Relaying message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:13501/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d '{"payload": "U3RvcmUgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 0.2 seconds
[35mDEBUG   [0m src.steps.store:store.py:218 Checking that peer wakuorg/nwaku:latest can find the stored messages
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:13501/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F0&pageSize=5&ascending=true" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"requestId":"","statusCode":200,"statusDesc":"OK","messages":[{"messageHash":"3budY1B/npOwbSbTyEn55Q+sS2x2WtU1Sx+SYCf+lHc="}]}'
[35mDEBUG   [0m src.steps.store:store.py:218 Checking that peer wakuorg/go-waku:latest can find the stored messages
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:16892/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F0&contentTopics=%2Fmyapp%2F1%2Flatest%2Fproto&pageSize=5&ascending=true" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"request_id":"d174b8c1a6c1373a1bc2ff16bf6d7922b93014acd2f8a79fa003c89702fafaa2","status_code":200,"status_desc":"OK","messages":[{"message_hash":"3budY1B/npOwbSbTyEn55Q+sS2x2WtU1Sx+SYCf+lHc="}]}'
[35mDEBUG   [0m tests.conftest:conftest.py:59 Running fixture teardown: test_setup
[35mDEBUG   [0m tests.conftest:conftest.py:83 Running fixture teardown: close_open_nodes
[35mDEBUG   [0m src.node.waku_node:waku_node.py:221 Stopping container with id 1b909f91714d
[35mDEBUG   [0m src.node.waku_node:waku_node.py:228 Container stopped.
[35mDEBUG   [0m src.node.waku_node:waku_node.py:221 Stopping container with id c0ffa6113316
[35mDEBUG   [0m src.node.waku_node:waku_node.py:228 Container stopped.
[35mDEBUG   [0m tests.conftest:conftest.py:98 Running fixture teardown: check_waku_log_errors
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:117 No errors found in the waku logs.
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:117 No errors found in the waku logs.
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:117 No errors found in the waku logs.
[35mDEBUG   [0m src.postgres_setup:postgres_setup.py:44 Postgres container stopped and removed.