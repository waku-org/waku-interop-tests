2025-02-04 17:26:47.059 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-04 17:26:47.059 DEBUG [tests.conftest] Running test: test_publish_with_invalid_payloads with id: 2025-02-04_17-26-47__a977238f-29fe-4ab1-8f39-fe345e767579
2025-02-04 17:26:47.060 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-04 17:26:47.060 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-04 17:26:47.060 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-04 17:26:47.066 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-04 17:26:47.066 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-04_17-26-47__a977238f-29fe-4ab1-8f39-fe345e767579__wakuorg_nwaku:latest.log
2025-02-04 17:26:47.067 DEBUG [src.node.waku_node] Starting Node...
2025-02-04 17:26:47.067 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-04 17:26:47.068 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-04 17:26:47.068 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.25.139
2025-02-04 17:26:47.068 DEBUG [src.node.docker_mananger] Generated ports ['31402', '31403', '31404', '31405', '31406']
2025-02-04 17:26:47.069 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-04 17:26:47.069 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-04 17:26:47.069 DEBUG [src.node.waku_node] Using volumes []
2025-02-04 17:26:47.069 DEBUG [src.node.docker_mananger] docker run -i -t -p 31402:31402 -p 31403:31403 -p 31404:31404 -p 31405:31405 -p 31406:31406 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=31404 --rest-port=31402 --tcp-port=31403 --discv5-udp-port=31405 --rest-address=0.0.0.0 --nat=extip:172.18.25.139 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=4d085fa0a45e443cadb4d4d55bbdaef83c3e629cbba33bcb208b1da0d8327af8 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=31406 --metrics-logging=true --relay=true
2025-02-04 17:26:47.303 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.25.139 waku 6087239c0722a2889384cf090d95408623c2df268ca461b034e5941b1cdbe261
2025-02-04 17:26:47.355 DEBUG [src.node.docker_mananger] Container started with ID 6087239c0722. Setting up logs at ./log/docker/node1_2025-02-04_17-26-47__a977238f-29fe-4ab1-8f39-fe345e767579__wakuorg_nwaku:latest.log
2025-02-04 17:26:47.355 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 31402
2025-02-04 17:26:47.356 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-04 17:26:47.367 ERROR [src.node.docker_mananger] Max retries reached for container ea5529131279. Exiting log stream.
2025-02-04 17:26:47.877 ERROR [src.node.docker_mananger] Max retries reached for container d5e4c87181c7. Exiting log stream.
2025-02-04 17:26:48.357 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31402/health" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:26:48.360 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-04 17:26:48.360 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-04 17:26:48.360 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31402/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:26:48.362 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.25.139/tcp/31403/p2p/16Uiu2HAmRWT2pmS5i1XLKuuS5PAcfZUJbUk6ze9tqhYiKu8uDoBw","/ip4/172.18.25.139/tcp/31404/ws/p2p/16Uiu2HAmRWT2pmS5i1XLKuuS5PAcfZUJbUk6ze9tqhYiKu8uDoBw"],"enrUri":"enr:-L24QLRO5RUfiIxXRgxh_OnxQn0ci9XVVpdsRwf62y4mM6NrfmOzpKuKPGgQXp4ff1n6MbHmeVd7avYOckgZWdViPZQCgmlkgnY0gmlwhKwSGYuKbXVsdGlhZGRyc5YACASsEhmLBnqrAAoErBIZiwZ6rN0DgnJzhQADAQAAiXNlY3AyNTZrMaEDvvffLKkkxJiILd1q514twShF9WUAyY3wLd0A_vfBGHKDdGNwgnqrg3VkcIJ6rYV3YWt1MgE"}'
2025-02-04 17:26:48.362 INFO [src.node.waku_node] REST service is ready !!
2025-02-04 17:26:48.369 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-04 17:26:48.369 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-04_17-26-47__a977238f-29fe-4ab1-8f39-fe345e767579__wakuorg_go-waku:latest.log
2025-02-04 17:26:48.369 DEBUG [src.node.waku_node] Starting Node...
2025-02-04 17:26:48.369 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-04 17:26:48.371 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-04 17:26:48.371 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.27.91
2025-02-04 17:26:48.371 DEBUG [src.node.docker_mananger] Generated ports ['15965', '15966', '15967', '15968', '15969']
2025-02-04 17:26:48.371 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-04 17:26:48.371 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-04 17:26:48.371 DEBUG [src.node.waku_node] Using volumes []
2025-02-04 17:26:48.371 DEBUG [src.node.docker_mananger] docker run -i -t -p 15965:15965 -p 15966:15966 -p 15967:15967 -p 15968:15968 -p 15969:15969 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=15967 --rest-port=15965 --tcp-port=15966 --discv5-udp-port=15968 --rest-address=0.0.0.0 --nat=extip:172.18.27.91 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=8d5e79abb9fc8925f0dc12279ac9de635f7753c331cb46dff04d98ddc75f3ea6 --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=true --discv5-bootstrap-node=enr:-L24QLRO5RUfiIxXRgxh_OnxQn0ci9XVVpdsRwf62y4mM6NrfmOzpKuKPGgQXp4ff1n6MbHmeVd7avYOckgZWdViPZQCgmlkgnY0gmlwhKwSGYuKbXVsdGlhZGRyc5YACASsEhmLBnqrAAoErBIZiwZ6rN0DgnJzhQADAQAAiXNlY3AyNTZrMaEDvvffLKkkxJiILd1q514twShF9WUAyY3wLd0A_vfBGHKDdGNwgnqrg3VkcIJ6rYV3YWt1MgE
2025-02-04 17:26:48.601 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.27.91 waku 47f71c2d2d7c312ce0dd0191d30647f515d09f753b1b42c4d851050aa5e95813
2025-02-04 17:26:48.648 DEBUG [src.node.docker_mananger] Container started with ID 47f71c2d2d7c. Setting up logs at ./log/docker/node2_2025-02-04_17-26-47__a977238f-29fe-4ab1-8f39-fe345e767579__wakuorg_go-waku:latest.log
2025-02-04 17:26:48.650 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 15965
2025-02-04 17:26:48.650 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-04 17:26:49.651 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15965/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:26:49.654 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QIqeF4moSKcUcW1_303QzrSWb2Weabxcz20eydZ6mB-RUFMajt2bN6lTtxIgXphIawiX5PLuDL2Mwyqkxz3vaH6GAZTSABZJgmlkgnY0gmlwhKwRAAOCcnODAAMAiXNlY3AyNTZrMaEDGBHcXKZg-xdST3NuOPNzC35bdKF7949creywtyGAGBCDdGNwgj5eg3VkcII-YIV3YWt1MgE","listenAddresses":["/ip4/127.0.0.1/tcp/15966/p2p/16Uiu2HAmEGwvyyYKoMYSsxqcqYYLvSa4ZFxFkhJCMPs9BLJwJ1WP","/ip4/127.0.0.1/tcp/15967/ws/p2p/16Uiu2HAmEGwvyyYKoMYSsxqcqYYLvSa4ZFxFkhJCMPs9BLJwJ1WP","/ip4/172.17.0.3/tcp/15966/p2p/16Uiu2HAmEGwvyyYKoMYSsxqcqYYLvSa4ZFxFkhJCMPs9BLJwJ1WP","/ip4/172.17.0.3/tcp/15967/ws/p2p/16Uiu2HAmEGwvyyYKoMYSsxqcqYYLvSa4ZFxFkhJCMPs9BLJwJ1WP"]}'
2025-02-04 17:26:49.654 INFO [src.node.waku_node] REST service is ready !!
2025-02-04 17:26:49.654 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:15965/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.25.139/tcp/31403/p2p/16Uiu2HAmRWT2pmS5i1XLKuuS5PAcfZUJbUk6ze9tqhYiKu8uDoBw", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
2025-02-04 17:26:49.671 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-04 17:26:49.673 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-04 17:26:49.673 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31402/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-04 17:26:49.697 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:26:49.697 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:15965/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-04 17:26:49.700 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-04 17:26:49.701 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-04 17:26:49.710 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:26:49.710 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-04 17:26:49.810 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-04 17:26:49.811 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:26:49.814 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738690009701496064,"ephemeral":false}]'
2025-02-04 17:26:49.816 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-04 17:26:49.816 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15965/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:26:49.818 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-04 17:26:50.819 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-04 17:26:50.824 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:26:50.824 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-04 17:26:50.925 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-04 17:26:50.925 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:26:50.927 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738690010818872576,"ephemeral":false}]'
2025-02-04 17:26:50.929 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-04 17:26:50.929 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15965/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:26:50.931 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738690010818872576,"ephemeral":false}]'
2025-02-04 17:26:50.932 INFO [src.steps.relay] WARM UP successful!!
2025-02-04 17:26:50.933 DEBUG [tests.relay.test_publish] Running test with payload Empty string
2025-02-04 17:26:50.933 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-04 17:26:50.936 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-04 17:26:50.936 DEBUG [tests.relay.test_publish] Running test with payload Unecoded text
2025-02-04 17:26:50.936 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "Hello World!", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-04 17:26:50.939 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Incorrect base64 string'
2025-02-04 17:26:50.939 DEBUG [tests.relay.test_publish] Running test with payload A dictionary
2025-02-04 17:26:50.939 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": {"key": "YWFh"}, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-04 17:26:50.941 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-04 17:26:50.942 DEBUG [tests.relay.test_publish] Running test with payload An integer
2025-02-04 17:26:50.942 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": 1234567890, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-04 17:26:50.944 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-04 17:26:50.944 DEBUG [tests.relay.test_publish] Running test with payload A list
2025-02-04 17:26:50.945 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": ["YWFh"], "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-04 17:26:50.947 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-04 17:26:50.947 DEBUG [tests.relay.test_publish] Running test with payload A bool
2025-02-04 17:26:50.947 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": true, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-04 17:26:50.949 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:31402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-04 17:26:50.951 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-04 17:26:50.952 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-04 17:26:50.952 DEBUG [src.node.waku_node] Stopping container with id 6087239c0722
2025-02-04 17:26:51.523 DEBUG [src.node.waku_node] Container stopped.
2025-02-04 17:26:51.524 DEBUG [src.node.waku_node] Stopping container with id 47f71c2d2d7c
2025-02-04 17:26:52.030 DEBUG [src.node.waku_node] Container stopped.
2025-02-04 17:26:52.033 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-04 17:26:52.038 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-04 17:26:52.041 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
