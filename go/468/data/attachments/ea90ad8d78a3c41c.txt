2025-02-16 03:09:14.992 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-16 03:09:14.993 DEBUG [tests.conftest] Running test: test_msg_not_stored_when_ephemeral_true with id: 2025-02-16_03-09-14__1c169a86-0ec4-46f8-890a-7f2b265bcbf9
2025-02-16 03:09:14.993 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-16 03:09:14.993 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-16 03:09:14.993 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-16 03:09:15.003 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-16 03:09:15.004 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-16_03-09-14__1c169a86-0ec4-46f8-890a-7f2b265bcbf9__wakuorg_go-waku:latest.log
2025-02-16 03:09:15.010 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-16 03:09:15.010 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-16_03-09-14__1c169a86-0ec4-46f8-890a-7f2b265bcbf9__wakuorg_nwaku:latest.log
2025-02-16 03:09:15.016 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-16 03:09:15.016 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node3_2025-02-16_03-09-14__1c169a86-0ec4-46f8-890a-7f2b265bcbf9__wakuorg_go-waku:latest.log
2025-02-16 03:09:15.017 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-16 03:09:15.017 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-16 03:09:15.018 DEBUG [tests.e2e.test_e2e] Start 3 nodes 
2025-02-16 03:09:15.018 DEBUG [src.node.waku_node] Starting Node...
2025-02-16 03:09:15.018 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-16 03:09:15.099 DEBUG [src.node.docker_mananger] Network waku created
2025-02-16 03:09:15.100 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.89.82
2025-02-16 03:09:15.100 DEBUG [src.node.docker_mananger] Generated ports ['6882', '6883', '6884', '6885', '6886']
2025-02-16 03:09:15.100 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-16 03:09:15.100 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-16 03:09:15.100 DEBUG [src.node.waku_node] Using volumes []
2025-02-16 03:09:15.101 DEBUG [src.node.docker_mananger] docker run -i -t -p 6882:6882 -p 6883:6883 -p 6884:6884 -p 6885:6885 -p 6886:6886 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=6884 --rest-port=6882 --tcp-port=6883 --discv5-udp-port=6885 --rest-address=0.0.0.0 --nat=extip:172.18.89.82 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=8e387c2acb9072080e3ec0012a0dcb93a7821b61bc316e5c779ffc7cf7aa6ff4 --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=true --store=true
2025-02-16 03:09:19.355 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.89.82 waku ae8a7511d3a9ad64ec2f9afd5aa665b006b3e898accb25e0bb93b7982c73e997
2025-02-16 03:09:19.415 DEBUG [src.node.docker_mananger] Container started with ID ae8a7511d3a9. Setting up logs at ./log/docker/node1_2025-02-16_03-09-14__1c169a86-0ec4-46f8-890a-7f2b265bcbf9__wakuorg_go-waku:latest.log
2025-02-16 03:09:19.416 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 6882
2025-02-16 03:09:19.419 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-16 03:09:20.419 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:6882/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-16 03:09:20.423 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QCgyYtIr_jfT7V0I2HuTxQros1ZeXGGfpncfiHjG4LIROxgi4ey_WtEq4gqBnPm80UtNNWS4G4oXjeYJNKqFiJSGAZUMu1i1gmlkgnY0gmlwhKwRAAKCcnODAAMAiXNlY3AyNTZrMaECt0Q6gCp7U17O_O3peRc6Jjje2bNW7OjBhcsY4qd_TEeDdGNwghrjg3VkcIIa5YV3YWt1MgM","listenAddresses":["/ip4/127.0.0.1/tcp/6883/p2p/16Uiu2HAm7m4vuuvYFf6NjVjHj7vVmpGfsa5ati98HWEPiZP8JfCS","/ip4/127.0.0.1/tcp/6884/ws/p2p/16Uiu2HAm7m4vuuvYFf6NjVjHj7vVmpGfsa5ati98HWEPiZP8JfCS","/ip4/172.17.0.2/tcp/6883/p2p/16Uiu2HAm7m4vuuvYFf6NjVjHj7vVmpGfsa5ati98HWEPiZP8JfCS","/ip4/172.17.0.2/tcp/6884/ws/p2p/16Uiu2HAm7m4vuuvYFf6NjVjHj7vVmpGfsa5ati98HWEPiZP8JfCS"]}'
2025-02-16 03:09:20.423 INFO [src.node.waku_node] REST service is ready !!
2025-02-16 03:09:20.423 DEBUG [src.node.waku_node] Starting Node...
2025-02-16 03:09:20.424 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-16 03:09:20.425 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-16 03:09:20.426 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.123.111
2025-02-16 03:09:20.426 DEBUG [src.node.docker_mananger] Generated ports ['6954', '6955', '6956', '6957', '6958']
2025-02-16 03:09:20.426 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-16 03:09:20.426 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-16 03:09:20.426 DEBUG [src.node.waku_node] Using volumes []
2025-02-16 03:09:20.426 DEBUG [src.node.docker_mananger] docker run -i -t -p 6954:6954 -p 6955:6955 -p 6956:6956 -p 6957:6957 -p 6958:6958 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=6956 --rest-port=6954 --tcp-port=6955 --discv5-udp-port=6957 --rest-address=0.0.0.0 --nat=extip:172.18.123.111 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=5e33cf62bcab2cd1cdedea89d3bfd1c33fc1c96dfe2abbfeace252b2fdaeaa15 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=6958 --metrics-logging=true --store=true --relay=true --discv5-bootstrap-node=enr:-J-4QCgyYtIr_jfT7V0I2HuTxQros1ZeXGGfpncfiHjG4LIROxgi4ey_WtEq4gqBnPm80UtNNWS4G4oXjeYJNKqFiJSGAZUMu1i1gmlkgnY0gmlwhKwRAAKCcnODAAMAiXNlY3AyNTZrMaECt0Q6gCp7U17O_O3peRc6Jjje2bNW7OjBhcsY4qd_TEeDdGNwghrjg3VkcIIa5YV3YWt1MgM
2025-02-16 03:09:23.994 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.123.111 waku 973ba39328d2ff1457f458ddcc46d4189234cfa0a0ffec17676be11278dd34f7
2025-02-16 03:09:24.071 DEBUG [src.node.docker_mananger] Container started with ID 973ba39328d2. Setting up logs at ./log/docker/node2_2025-02-16_03-09-14__1c169a86-0ec4-46f8-890a-7f2b265bcbf9__wakuorg_nwaku:latest.log
2025-02-16 03:09:24.071 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 6954
2025-02-16 03:09:24.073 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-16 03:09:25.073 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:6954/health" -H "Content-Type: application/json" -d 'None'
2025-02-16 03:09:25.080 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-16 03:09:25.080 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-16 03:09:25.080 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:6954/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-16 03:09:25.097 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.123.111/tcp/6955/p2p/16Uiu2HAm8AuxSX7CDP731wgVeN2K27dia9GqnN6wGd6yQ9vmuQek","/ip4/172.18.123.111/tcp/6956/ws/p2p/16Uiu2HAm8AuxSX7CDP731wgVeN2K27dia9GqnN6wGd6yQ9vmuQek"],"enrUri":"enr:-L24QHuZK7O0uNI6ZzpILJcbTP_vZiRp_YyuqeysL8jYToFQOkWZt77pciPnYOE7aD3XME4bvpmRRDpXpaZcUhvGU8oCgmlkgnY0gmlwhKwSe2-KbXVsdGlhZGRyc5YACASsEntvBhsrAAoErBJ7bwYbLN0DgnJzhQADAQAAiXNlY3AyNTZrMaECvWAFeYtBDvp-Vo-Bj6TAI5capHqfaRJabwxLWDL7pUmDdGNwghsrg3VkcIIbLYV3YWt1MgM"}'
2025-02-16 03:09:25.097 INFO [src.node.waku_node] REST service is ready !!
2025-02-16 03:09:25.098 DEBUG [src.node.waku_node] Starting Node...
2025-02-16 03:09:25.098 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-16 03:09:25.101 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-16 03:09:25.101 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.156.199
2025-02-16 03:09:25.101 DEBUG [src.node.docker_mananger] Generated ports ['31504', '31505', '31506', '31507', '31508']
2025-02-16 03:09:25.102 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-16 03:09:25.102 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-16 03:09:25.102 DEBUG [src.node.waku_node] Using volumes []
2025-02-16 03:09:25.102 DEBUG [src.node.docker_mananger] docker run -i -t -p 31504:31504 -p 31505:31505 -p 31506:31506 -p 31507:31507 -p 31508:31508 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=31506 --rest-port=31504 --tcp-port=31505 --discv5-udp-port=31507 --rest-address=0.0.0.0 --nat=extip:172.18.156.199 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=efec0b91bb0076caf2fc7e9e6c52cd2a32b6c96acc435bedc60ff4bc5eedfdde --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=false --storenode=/ip4/172.18.123.111/tcp/6955/p2p/16Uiu2HAm8AuxSX7CDP731wgVeN2K27dia9GqnN6wGd6yQ9vmuQek --discv5-bootstrap-node=enr:-L24QHuZK7O0uNI6ZzpILJcbTP_vZiRp_YyuqeysL8jYToFQOkWZt77pciPnYOE7aD3XME4bvpmRRDpXpaZcUhvGU8oCgmlkgnY0gmlwhKwSe2-KbXVsdGlhZGRyc5YACASsEntvBhsrAAoErBJ7bwYbLN0DgnJzhQADAQAAiXNlY3AyNTZrMaECvWAFeYtBDvp-Vo-Bj6TAI5capHqfaRJabwxLWDL7pUmDdGNwghsrg3VkcIIbLYV3YWt1MgM --pubsub-topic=/waku/2/rs/3/1
2025-02-16 03:09:25.376 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.156.199 waku 0170fbb02ea0f38e850a489ba128fb7f92e15e437729228e77880ce859d1aa1f
2025-02-16 03:09:25.428 DEBUG [src.node.docker_mananger] Container started with ID 0170fbb02ea0. Setting up logs at ./log/docker/node3_2025-02-16_03-09-14__1c169a86-0ec4-46f8-890a-7f2b265bcbf9__wakuorg_go-waku:latest.log
2025-02-16 03:09:25.430 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 31504
2025-02-16 03:09:25.431 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-16 03:09:26.431 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31504/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-16 03:09:26.434 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-KG4QIHMFsBc1Tt216A4teBkjiNLpRgYzpxPe9QvOnvxgtHWclD6vNnCvIPl3ok9fECC15T8qRQqFHZFgS5CzyGUMqSGAZUMu3A3gmlkgnY0gmlwhKwRAASCcnOFAAMBAAGJc2VjcDI1NmsxoQKLMjdrigJ_0QElKZQBj1TLaJgDMQKBa7rIdX7m_H0oPIN0Y3CCexGDdWRwgnsThXdha3UygA","listenAddresses":["/ip4/127.0.0.1/tcp/31505/p2p/16Uiu2HAm4o34XpmW8A9L1FtMgWAssUa2uqQUKm8vTN5mxo8sW6C3","/ip4/127.0.0.1/tcp/31506/ws/p2p/16Uiu2HAm4o34XpmW8A9L1FtMgWAssUa2uqQUKm8vTN5mxo8sW6C3","/ip4/172.17.0.4/tcp/31505/p2p/16Uiu2HAm4o34XpmW8A9L1FtMgWAssUa2uqQUKm8vTN5mxo8sW6C3","/ip4/172.17.0.4/tcp/31506/ws/p2p/16Uiu2HAm4o34XpmW8A9L1FtMgWAssUa2uqQUKm8vTN5mxo8sW6C3"]}'
2025-02-16 03:09:26.435 INFO [src.node.waku_node] REST service is ready !!
2025-02-16 03:09:26.435 DEBUG [tests.e2e.test_e2e] Subscribe node1 ,2 to pubtopic /waku/2/rs/3/1
2025-02-16 03:09:26.435 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:6882/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-16 03:09:26.438 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-16 03:09:26.439 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:6954/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-16 03:09:26.442 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 03:09:26.443 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:6882/admin/v1/peers" -H "Content-Type: application/json" -d 'None'
2025-02-16 03:09:26.445 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"id":"16Uiu2HAm8AuxSX7CDP731wgVeN2K27dia9GqnN6wGd6yQ9vmuQek","multiaddrs":["/ip4/172.18.123.111/tcp/6955/p2p/16Uiu2HAm8AuxSX7CDP731wgVeN2K27dia9GqnN6wGd6yQ9vmuQek","/ip4/172.18.123.111/tcp/6956/ws/p2p/16Uiu2HAm8AuxSX7CDP731wgVeN2K27dia9GqnN6wGd6yQ9vmuQek"],"protocols":null,"connected":false,"pubsubTopics":[]}]'
2025-02-16 03:09:26.445 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:6954/admin/v1/peers" -H "Content-Type: application/json" -d 'None'
2025-02-16 03:09:26.448 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"multiaddr":"/ip4/172.17.0.4/tcp/31505/p2p/16Uiu2HAm4o34XpmW8A9L1FtMgWAssUa2uqQUKm8vTN5mxo8sW6C3","protocols":[{"protocol":"/vac/waku/peer-exchange/2.0.0-alpha1","connected":true}],"origin":"UnknownOrigin"}]'
2025-02-16 03:09:26.448 DEBUG [src.libs.common] Sleeping for 30 seconds
2025-02-16 03:09:56.449 DEBUG [tests.e2e.test_e2e] Node1 publish message with flag ephemeral = True
2025-02-16 03:09:56.449 DEBUG [src.steps.store] Relaying message
2025-02-16 03:09:56.450 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:6882/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "RmlsdGVyIHdvcmtzISE=", "contentTopic": "/test/1/waku-filter/proto", "timestamp": '$(date +%s%N)', "ephemeral": true}'
2025-02-16 03:09:56.453 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-16 03:09:56.454 DEBUG [src.libs.common] Sleeping for 0.2 seconds
2025-02-16 03:09:56.655 DEBUG [src.libs.common] Sleeping for 3 seconds
2025-02-16 03:09:59.655 DEBUG [tests.e2e.test_e2e] Node3 makes store request to get messages
2025-02-16 03:09:59.656 DEBUG [src.steps.store] Checking that peer wakuorg/go-waku:latest can find the stored messages
2025-02-16 03:09:59.656 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31504/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F1&contentTopics=%2Ftest%2F1%2Fwaku-filter%2Fproto&pageSize=50&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-16 03:09:59.663 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"request_id":"64a427ee190b3958f5ea6966c070b3b791236a26c06be58b99507f98e92caa78","status_code":200,"status_desc":"OK"}'
2025-02-16 03:09:59.665 DEBUG [tests.e2e.test_e2e] Response for store when ephemeral = true is strPeer wakuorg/go-waku:latest couldn't find any messages. Actual response: {'request_id': '64a427ee190b3958f5ea6966c070b3b791236a26c06be58b99507f98e92caa78', 'status_code': 200, 'status_desc': 'OK'}
2025-02-16 03:09:59.665 DEBUG [tests.e2e.test_e2e] Message isn't stored as ephemeral = True
2025-02-16 03:09:59.667 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-16 03:09:59.668 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-16 03:09:59.668 DEBUG [src.node.waku_node] Stopping container with id ae8a7511d3a9
2025-02-16 03:10:00.236 DEBUG [src.node.waku_node] Container stopped.
2025-02-16 03:10:00.237 DEBUG [src.node.waku_node] Stopping container with id 973ba39328d2
2025-02-16 03:10:01.054 ERROR [src.node.docker_mananger] Max retries reached for container ae8a7511d3a9. Exiting log stream.
2025-02-16 03:10:01.149 DEBUG [src.node.waku_node] Container stopped.
2025-02-16 03:10:01.149 DEBUG [src.node.waku_node] Stopping container with id 0170fbb02ea0
2025-02-16 03:10:01.722 DEBUG [src.node.waku_node] Container stopped.
2025-02-16 03:10:01.723 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-16 03:10:01.731 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-16 03:10:01.748 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-16 03:10:01.753 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
