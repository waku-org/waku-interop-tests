2025-02-15 03:05:29.660 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-15 03:05:29.660 DEBUG [tests.conftest] Running test: test_msg_not_stored_when_ephemeral_true with id: 2025-02-15_03-05-29__a94ff136-6326-4962-bde6-d4d3a16a056f
2025-02-15 03:05:29.661 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-15 03:05:29.661 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-15 03:05:29.661 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-15 03:05:29.671 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-15 03:05:29.671 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-15_03-05-29__a94ff136-6326-4962-bde6-d4d3a16a056f__wakuorg_go-waku:latest.log
2025-02-15 03:05:29.678 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-15 03:05:29.678 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-15_03-05-29__a94ff136-6326-4962-bde6-d4d3a16a056f__wakuorg_nwaku:latest.log
2025-02-15 03:05:29.685 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-15 03:05:29.685 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node3_2025-02-15_03-05-29__a94ff136-6326-4962-bde6-d4d3a16a056f__wakuorg_go-waku:latest.log
2025-02-15 03:05:29.685 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-15 03:05:29.686 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-15 03:05:29.686 DEBUG [tests.e2e.test_e2e] Start 3 nodes 
2025-02-15 03:05:29.687 DEBUG [src.node.waku_node] Starting Node...
2025-02-15 03:05:29.687 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-15 03:05:29.760 DEBUG [src.node.docker_mananger] Network waku created
2025-02-15 03:05:29.761 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.154.249
2025-02-15 03:05:29.761 DEBUG [src.node.docker_mananger] Generated ports ['11458', '11459', '11460', '11461', '11462']
2025-02-15 03:05:29.761 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-15 03:05:29.761 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-15 03:05:29.761 DEBUG [src.node.waku_node] Using volumes []
2025-02-15 03:05:29.762 DEBUG [src.node.docker_mananger] docker run -i -t -p 11458:11458 -p 11459:11459 -p 11460:11460 -p 11461:11461 -p 11462:11462 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=11460 --rest-port=11458 --tcp-port=11459 --discv5-udp-port=11461 --rest-address=0.0.0.0 --nat=extip:172.18.154.249 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=b4d0aa06a14cc75ac8fcafc45d1e6e09ffb43aaafeaca3d904f5cb636acac2c7 --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=true --store=true
2025-02-15 03:05:32.630 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.154.249 waku d72c6c74d9d8fb40b40942c209778e52e78e55ed57a64e9538b0eea6b38f28c3
2025-02-15 03:05:32.691 DEBUG [src.node.docker_mananger] Container started with ID d72c6c74d9d8. Setting up logs at ./log/docker/node1_2025-02-15_03-05-29__a94ff136-6326-4962-bde6-d4d3a16a056f__wakuorg_go-waku:latest.log
2025-02-15 03:05:32.693 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 11458
2025-02-15 03:05:32.693 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-15 03:05:33.695 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:11458/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-15 03:05:33.697 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QGs3m0a28GwFX7IXQxLcQyRXXeUq47ADJioSmbZ9VfnmFcj5FES7ML6pdQsTj6mbbsz20U0FukwfaJeB09ToUAqGAZUHkYcOgmlkgnY0gmlwhKwRAAKCcnODAAMAiXNlY3AyNTZrMaECVQ7t8psHyl5PgmpfF0pZx4eP7m3lGkR78QVVBiS6VvGDdGNwgizDg3VkcIIsxYV3YWt1MgM","listenAddresses":["/ip4/127.0.0.1/tcp/11459/p2p/16Uiu2HAm19hqZMhEBYKWd6sq6fYXBWuXoKK6aYraD9DyLoEHxDj6","/ip4/127.0.0.1/tcp/11460/ws/p2p/16Uiu2HAm19hqZMhEBYKWd6sq6fYXBWuXoKK6aYraD9DyLoEHxDj6","/ip4/172.17.0.2/tcp/11459/p2p/16Uiu2HAm19hqZMhEBYKWd6sq6fYXBWuXoKK6aYraD9DyLoEHxDj6","/ip4/172.17.0.2/tcp/11460/ws/p2p/16Uiu2HAm19hqZMhEBYKWd6sq6fYXBWuXoKK6aYraD9DyLoEHxDj6"]}'
2025-02-15 03:05:33.698 INFO [src.node.waku_node] REST service is ready !!
2025-02-15 03:05:33.698 DEBUG [src.node.waku_node] Starting Node...
2025-02-15 03:05:33.698 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-15 03:05:33.699 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-15 03:05:33.700 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.89.191
2025-02-15 03:05:33.700 DEBUG [src.node.docker_mananger] Generated ports ['48748', '48749', '48750', '48751', '48752']
2025-02-15 03:05:33.700 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-15 03:05:33.700 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-15 03:05:33.700 DEBUG [src.node.waku_node] Using volumes []
2025-02-15 03:05:33.700 DEBUG [src.node.docker_mananger] docker run -i -t -p 48748:48748 -p 48749:48749 -p 48750:48750 -p 48751:48751 -p 48752:48752 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=48750 --rest-port=48748 --tcp-port=48749 --discv5-udp-port=48751 --rest-address=0.0.0.0 --nat=extip:172.18.89.191 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=c0073be9ccb51bfcabbfbe5bb38f390eec29f42edbf4fecdf2d16fab3ccff3d6 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=48752 --metrics-logging=true --store=true --relay=true --discv5-bootstrap-node=enr:-J-4QGs3m0a28GwFX7IXQxLcQyRXXeUq47ADJioSmbZ9VfnmFcj5FES7ML6pdQsTj6mbbsz20U0FukwfaJeB09ToUAqGAZUHkYcOgmlkgnY0gmlwhKwRAAKCcnODAAMAiXNlY3AyNTZrMaECVQ7t8psHyl5PgmpfF0pZx4eP7m3lGkR78QVVBiS6VvGDdGNwgizDg3VkcIIsxYV3YWt1MgM
2025-02-15 03:05:35.554 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.89.191 waku 14c6ccabb8aee4ddc0a5754ae6db4d5a7eae60a1c033f8bdd7906764a56ce930
2025-02-15 03:05:35.614 DEBUG [src.node.docker_mananger] Container started with ID 14c6ccabb8ae. Setting up logs at ./log/docker/node2_2025-02-15_03-05-29__a94ff136-6326-4962-bde6-d4d3a16a056f__wakuorg_nwaku:latest.log
2025-02-15 03:05:35.615 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 48748
2025-02-15 03:05:35.615 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-15 03:05:36.617 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48748/health" -H "Content-Type: application/json" -d 'None'
2025-02-15 03:05:36.627 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-15 03:05:36.628 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-15 03:05:36.628 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48748/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-15 03:05:36.650 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.89.191/tcp/48749/p2p/16Uiu2HAmEcNH7yBFvgLiWyYdu6EEb3ocNqcj8oz1Ym6S9VNXL53e","/ip4/172.18.89.191/tcp/48750/ws/p2p/16Uiu2HAmEcNH7yBFvgLiWyYdu6EEb3ocNqcj8oz1Ym6S9VNXL53e"],"enrUri":"enr:-L24QJvPJC3MljnQjftDaJD_ctBiL4ABzs0FYDUn5Yx-GmRbVlQZy87kBvhEbVJCMOk8lzl-TuuXY67PbMn9jdurqfwCgmlkgnY0gmlwhKwSWb-KbXVsdGlhZGRyc5YACASsElm_Br5tAAoErBJZvwa-bt0DgnJzhQADAQAAiXNlY3AyNTZrMaEDHQts9j0fOW-0U_Yz_gayRfNMoR1929uaxOBp3RsluiGDdGNwgr5tg3VkcIK-b4V3YWt1MgM"}'
2025-02-15 03:05:36.652 INFO [src.node.waku_node] REST service is ready !!
2025-02-15 03:05:36.652 DEBUG [src.node.waku_node] Starting Node...
2025-02-15 03:05:36.652 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-15 03:05:36.654 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-15 03:05:36.655 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.42.186
2025-02-15 03:05:36.655 DEBUG [src.node.docker_mananger] Generated ports ['63869', '63870', '63871', '63872', '63873']
2025-02-15 03:05:36.656 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-15 03:05:36.656 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-15 03:05:36.656 DEBUG [src.node.waku_node] Using volumes []
2025-02-15 03:05:36.656 DEBUG [src.node.docker_mananger] docker run -i -t -p 63869:63869 -p 63870:63870 -p 63871:63871 -p 63872:63872 -p 63873:63873 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=63871 --rest-port=63869 --tcp-port=63870 --discv5-udp-port=63872 --rest-address=0.0.0.0 --nat=extip:172.18.42.186 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=1f5e0c0161eed7216cceaccb6096aacefb6cfaae2ef50b29d7229387ca9ada23 --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=false --storenode=/ip4/172.18.89.191/tcp/48749/p2p/16Uiu2HAmEcNH7yBFvgLiWyYdu6EEb3ocNqcj8oz1Ym6S9VNXL53e --discv5-bootstrap-node=enr:-L24QJvPJC3MljnQjftDaJD_ctBiL4ABzs0FYDUn5Yx-GmRbVlQZy87kBvhEbVJCMOk8lzl-TuuXY67PbMn9jdurqfwCgmlkgnY0gmlwhKwSWb-KbXVsdGlhZGRyc5YACASsElm_Br5tAAoErBJZvwa-bt0DgnJzhQADAQAAiXNlY3AyNTZrMaEDHQts9j0fOW-0U_Yz_gayRfNMoR1929uaxOBp3RsluiGDdGNwgr5tg3VkcIK-b4V3YWt1MgM --pubsub-topic=/waku/2/rs/3/1
2025-02-15 03:05:36.893 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.42.186 waku c460601db8586f033614a557061ecd46cf75065a37891aece2eacff14aadc47e
2025-02-15 03:05:36.947 DEBUG [src.node.docker_mananger] Container started with ID c460601db858. Setting up logs at ./log/docker/node3_2025-02-15_03-05-29__a94ff136-6326-4962-bde6-d4d3a16a056f__wakuorg_go-waku:latest.log
2025-02-15 03:05:36.948 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 63869
2025-02-15 03:05:36.948 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-15 03:05:37.949 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:63869/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-15 03:05:37.952 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-KG4QHgFfeKSHOS_8u-sLKuTXoJ8zFltEa0dIOZ1pdmvT5A1McwypAQrk_I1x9HJxsewDpKDPn5wAjqzhCWHWyLmt9mGAZUHkZesgmlkgnY0gmlwhKwRAASCcnOFAAMBAAGJc2VjcDI1NmsxoQPQpw6D6s-bMGuCx1qsRZIINSAeXU8RxXkEU93Dv88BvYN0Y3CC-X6DdWRwgvmAhXdha3UygA","listenAddresses":["/ip4/127.0.0.1/tcp/63870/p2p/16Uiu2HAmShUu1dRiitSLH1QR5Md6iF5enQuUAQvb7rtRg4KtUadA","/ip4/127.0.0.1/tcp/63871/ws/p2p/16Uiu2HAmShUu1dRiitSLH1QR5Md6iF5enQuUAQvb7rtRg4KtUadA","/ip4/172.17.0.4/tcp/63870/p2p/16Uiu2HAmShUu1dRiitSLH1QR5Md6iF5enQuUAQvb7rtRg4KtUadA","/ip4/172.17.0.4/tcp/63871/ws/p2p/16Uiu2HAmShUu1dRiitSLH1QR5Md6iF5enQuUAQvb7rtRg4KtUadA"]}'
2025-02-15 03:05:37.952 INFO [src.node.waku_node] REST service is ready !!
2025-02-15 03:05:37.953 DEBUG [tests.e2e.test_e2e] Subscribe node1 ,2 to pubtopic /waku/2/rs/3/1
2025-02-15 03:05:37.953 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:11458/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 03:05:37.955 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-15 03:05:37.955 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48748/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 03:05:37.958 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 03:05:37.959 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:11458/admin/v1/peers" -H "Content-Type: application/json" -d 'None'
2025-02-15 03:05:37.960 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"id":"16Uiu2HAmEcNH7yBFvgLiWyYdu6EEb3ocNqcj8oz1Ym6S9VNXL53e","multiaddrs":["/ip4/172.18.89.191/tcp/48749/p2p/16Uiu2HAmEcNH7yBFvgLiWyYdu6EEb3ocNqcj8oz1Ym6S9VNXL53e","/ip4/172.18.89.191/tcp/48750/ws/p2p/16Uiu2HAmEcNH7yBFvgLiWyYdu6EEb3ocNqcj8oz1Ym6S9VNXL53e"],"protocols":null,"connected":false,"pubsubTopics":[]}]'
2025-02-15 03:05:37.961 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48748/admin/v1/peers" -H "Content-Type: application/json" -d 'None'
2025-02-15 03:05:37.964 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"multiaddr":"/ip4/172.17.0.4/tcp/63870/p2p/16Uiu2HAmShUu1dRiitSLH1QR5Md6iF5enQuUAQvb7rtRg4KtUadA","protocols":[{"protocol":"/vac/waku/peer-exchange/2.0.0-alpha1","connected":true}],"origin":"UnknownOrigin"}]'
2025-02-15 03:05:37.964 DEBUG [src.libs.common] Sleeping for 30 seconds
2025-02-15 03:06:07.964 DEBUG [tests.e2e.test_e2e] Node1 publish message with flag ephemeral = True
2025-02-15 03:06:07.965 DEBUG [src.steps.store] Relaying message
2025-02-15 03:06:07.965 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:11458/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "RmlsdGVyIHdvcmtzISE=", "contentTopic": "/test/1/waku-filter/proto", "timestamp": '$(date +%s%N)', "ephemeral": true}'
2025-02-15 03:06:07.967 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-15 03:06:07.968 DEBUG [src.libs.common] Sleeping for 0.2 seconds
2025-02-15 03:06:08.169 DEBUG [src.libs.common] Sleeping for 3 seconds
2025-02-15 03:06:11.169 DEBUG [tests.e2e.test_e2e] Node3 makes store request to get messages
2025-02-15 03:06:11.170 DEBUG [src.steps.store] Checking that peer wakuorg/go-waku:latest can find the stored messages
2025-02-15 03:06:11.170 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:63869/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F1&contentTopics=%2Ftest%2F1%2Fwaku-filter%2Fproto&pageSize=50&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-15 03:06:11.176 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"request_id":"343b43fb7c2a68d43bb556e777854f2d08f8deba1225b750c05f65e1531f1cf6","status_code":200,"status_desc":"OK"}'
2025-02-15 03:06:11.177 DEBUG [tests.e2e.test_e2e] Response for store when ephemeral = true is strPeer wakuorg/go-waku:latest couldn't find any messages. Actual response: {'request_id': '343b43fb7c2a68d43bb556e777854f2d08f8deba1225b750c05f65e1531f1cf6', 'status_code': 200, 'status_desc': 'OK'}
2025-02-15 03:06:11.178 DEBUG [tests.e2e.test_e2e] Message isn't stored as ephemeral = True
2025-02-15 03:06:11.180 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-15 03:06:11.180 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-15 03:06:11.181 DEBUG [src.node.waku_node] Stopping container with id d72c6c74d9d8
2025-02-15 03:06:11.740 DEBUG [src.node.waku_node] Container stopped.
2025-02-15 03:06:11.740 DEBUG [src.node.waku_node] Stopping container with id 14c6ccabb8ae
2025-02-15 03:06:12.540 DEBUG [src.node.waku_node] Container stopped.
2025-02-15 03:06:12.540 DEBUG [src.node.waku_node] Stopping container with id c460601db858
2025-02-15 03:06:12.560 ERROR [src.node.docker_mananger] Max retries reached for container d72c6c74d9d8. Exiting log stream.
2025-02-15 03:06:13.057 DEBUG [src.node.waku_node] Container stopped.
2025-02-15 03:06:13.058 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-15 03:06:13.064 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-15 03:06:13.092 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-15 03:06:13.097 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
