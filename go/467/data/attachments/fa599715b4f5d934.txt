2025-02-15 03:05:07.641 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-15 03:05:07.641 DEBUG [tests.conftest] Running test: test_publish_with_invalid_payloads with id: 2025-02-15_03-05-07__8c1a5685-0ab0-48df-92d4-3ce2b3da536f
2025-02-15 03:05:07.642 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-15 03:05:07.642 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-15 03:05:07.642 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-15 03:05:07.648 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-15 03:05:07.649 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-15_03-05-07__8c1a5685-0ab0-48df-92d4-3ce2b3da536f__wakuorg_nwaku:latest.log
2025-02-15 03:05:07.649 DEBUG [src.node.waku_node] Starting Node...
2025-02-15 03:05:07.649 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-15 03:05:07.650 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-15 03:05:07.650 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.72.143
2025-02-15 03:05:07.651 DEBUG [src.node.docker_mananger] Generated ports ['24107', '24108', '24109', '24110', '24111']
2025-02-15 03:05:07.651 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-15 03:05:07.651 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-15 03:05:07.651 DEBUG [src.node.waku_node] Using volumes []
2025-02-15 03:05:07.651 DEBUG [src.node.docker_mananger] docker run -i -t -p 24107:24107 -p 24108:24108 -p 24109:24109 -p 24110:24110 -p 24111:24111 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=24109 --rest-port=24107 --tcp-port=24108 --discv5-udp-port=24110 --rest-address=0.0.0.0 --nat=extip:172.18.72.143 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=bcead1791bc9994d449a0e84957b08fdac3ff1ee410611b45df44f4caef67fa8 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=24111 --metrics-logging=true --relay=true
2025-02-15 03:05:07.872 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.72.143 waku e9ea3a2c75e2df3d6f7aeec08da6ff5b8c095bc4844d167b5a78c42a6517bac8
2025-02-15 03:05:07.921 DEBUG [src.node.docker_mananger] Container started with ID e9ea3a2c75e2. Setting up logs at ./log/docker/node1_2025-02-15_03-05-07__8c1a5685-0ab0-48df-92d4-3ce2b3da536f__wakuorg_nwaku:latest.log
2025-02-15 03:05:07.922 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 24107
2025-02-15 03:05:07.923 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-15 03:05:07.928 ERROR [src.node.docker_mananger] Max retries reached for container 536a2f2fb667. Exiting log stream.
2025-02-15 03:05:08.431 ERROR [src.node.docker_mananger] Max retries reached for container 95761c274e61. Exiting log stream.
2025-02-15 03:05:08.924 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:24107/health" -H "Content-Type: application/json" -d 'None'
2025-02-15 03:05:08.927 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-15 03:05:08.927 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-15 03:05:08.927 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:24107/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-15 03:05:08.930 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.72.143/tcp/24108/p2p/16Uiu2HAmMvLK9aRi2MQovVzuZQmrv7Nqudqr8znfJ3hysKnP8BLN","/ip4/172.18.72.143/tcp/24109/ws/p2p/16Uiu2HAmMvLK9aRi2MQovVzuZQmrv7Nqudqr8znfJ3hysKnP8BLN"],"enrUri":"enr:-L24QKY0Y2RVQImzEI_Atiw7pk0kiot6pIsTJt6gQDFme8h2GrDfUITC6hGJArfReD3IR63Gi1OeIN7Jef4FSuH6r8sCgmlkgnY0gmlwhKwSSI-KbXVsdGlhZGRyc5YACASsEkiPBl4sAAoErBJIjwZeLd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDiad3gGgx5r_vv8oPnqr9Id85uyRvHSUTr22OXwowIOODdGNwgl4sg3VkcIJeLoV3YWt1MgE"}'
2025-02-15 03:05:08.930 INFO [src.node.waku_node] REST service is ready !!
2025-02-15 03:05:08.936 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-15 03:05:08.936 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-15_03-05-07__8c1a5685-0ab0-48df-92d4-3ce2b3da536f__wakuorg_go-waku:latest.log
2025-02-15 03:05:08.937 DEBUG [src.node.waku_node] Starting Node...
2025-02-15 03:05:08.937 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-15 03:05:08.938 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-15 03:05:08.938 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.81.137
2025-02-15 03:05:08.938 DEBUG [src.node.docker_mananger] Generated ports ['39299', '39300', '39301', '39302', '39303']
2025-02-15 03:05:08.939 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-15 03:05:08.939 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-15 03:05:08.939 DEBUG [src.node.waku_node] Using volumes []
2025-02-15 03:05:08.939 DEBUG [src.node.docker_mananger] docker run -i -t -p 39299:39299 -p 39300:39300 -p 39301:39301 -p 39302:39302 -p 39303:39303 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=39301 --rest-port=39299 --tcp-port=39300 --discv5-udp-port=39302 --rest-address=0.0.0.0 --nat=extip:172.18.81.137 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=ca1e244eddc367f3fe77052f0aa4bdcf5caf9b7a3d78bd7ef456868b1307eadb --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=true --discv5-bootstrap-node=enr:-L24QKY0Y2RVQImzEI_Atiw7pk0kiot6pIsTJt6gQDFme8h2GrDfUITC6hGJArfReD3IR63Gi1OeIN7Jef4FSuH6r8sCgmlkgnY0gmlwhKwSSI-KbXVsdGlhZGRyc5YACASsEkiPBl4sAAoErBJIjwZeLd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDiad3gGgx5r_vv8oPnqr9Id85uyRvHSUTr22OXwowIOODdGNwgl4sg3VkcIJeLoV3YWt1MgE
2025-02-15 03:05:09.168 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.81.137 waku beccce6712db78e96abae5dd08a679a982e41b0c2263bd4acc1d729bab5403d2
2025-02-15 03:05:09.228 DEBUG [src.node.docker_mananger] Container started with ID beccce6712db. Setting up logs at ./log/docker/node2_2025-02-15_03-05-07__8c1a5685-0ab0-48df-92d4-3ce2b3da536f__wakuorg_go-waku:latest.log
2025-02-15 03:05:09.228 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 39299
2025-02-15 03:05:09.229 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-15 03:05:10.229 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:39299/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-15 03:05:10.232 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QNbU9h-GoYbsLO1doCQJpnU_zVPwKcaBnE34ddAkN9KZLmrasRnwXXnfNhJJVctqYKWQ_Tcac3XxTajGAwkPxfeGAZUHkStggmlkgnY0gmlwhKwRAAOCcnODAAMAiXNlY3AyNTZrMaECx-3PwG3HV6a_GaoSx1jy-r0FYXufhOjj9j7FCac-8LKDdGNwgpmEg3VkcIKZhoV3YWt1MgE","listenAddresses":["/ip4/127.0.0.1/tcp/39300/p2p/16Uiu2HAm8t7S6ozXXxqLa76inDHFwRRHm23janTW5B4Z476a79Ld","/ip4/127.0.0.1/tcp/39301/ws/p2p/16Uiu2HAm8t7S6ozXXxqLa76inDHFwRRHm23janTW5B4Z476a79Ld","/ip4/172.17.0.3/tcp/39300/p2p/16Uiu2HAm8t7S6ozXXxqLa76inDHFwRRHm23janTW5B4Z476a79Ld","/ip4/172.17.0.3/tcp/39301/ws/p2p/16Uiu2HAm8t7S6ozXXxqLa76inDHFwRRHm23janTW5B4Z476a79Ld"]}'
2025-02-15 03:05:10.232 INFO [src.node.waku_node] REST service is ready !!
2025-02-15 03:05:10.233 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:39299/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.72.143/tcp/24108/p2p/16Uiu2HAmMvLK9aRi2MQovVzuZQmrv7Nqudqr8znfJ3hysKnP8BLN", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
2025-02-15 03:05:10.250 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-15 03:05:10.252 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-15 03:05:10.252 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:24107/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 03:05:10.277 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 03:05:10.278 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:39299/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 03:05:10.280 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-15 03:05:10.281 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 03:05:10.297 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 03:05:10.298 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-15 03:05:10.398 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-15 03:05:10.398 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 03:05:10.401 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739588710281726208,"ephemeral":false}]'
2025-02-15 03:05:10.402 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-15 03:05:10.403 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:39299/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 03:05:10.405 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-15 03:05:11.406 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 03:05:11.411 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 03:05:11.411 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-15 03:05:11.511 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-15 03:05:11.512 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 03:05:11.514 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739588711406062080,"ephemeral":false}]'
2025-02-15 03:05:11.516 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-15 03:05:11.516 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:39299/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 03:05:11.518 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739588711406062080,"ephemeral":false}]'
2025-02-15 03:05:11.519 INFO [src.steps.relay] WARM UP successful!!
2025-02-15 03:05:11.520 DEBUG [tests.relay.test_publish] Running test with payload Empty string
2025-02-15 03:05:11.521 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 03:05:11.523 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-15 03:05:11.523 DEBUG [tests.relay.test_publish] Running test with payload Unecoded text
2025-02-15 03:05:11.524 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "Hello World!", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 03:05:11.526 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Incorrect base64 string'
2025-02-15 03:05:11.526 DEBUG [tests.relay.test_publish] Running test with payload A dictionary
2025-02-15 03:05:11.527 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": {"key": "YWFh"}, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 03:05:11.529 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-15 03:05:11.529 DEBUG [tests.relay.test_publish] Running test with payload An integer
2025-02-15 03:05:11.529 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": 1234567890, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 03:05:11.532 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-15 03:05:11.532 DEBUG [tests.relay.test_publish] Running test with payload A list
2025-02-15 03:05:11.532 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": ["YWFh"], "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 03:05:11.534 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-15 03:05:11.535 DEBUG [tests.relay.test_publish] Running test with payload A bool
2025-02-15 03:05:11.535 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": true, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 03:05:11.537 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:24107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-15 03:05:11.539 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-15 03:05:11.540 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-15 03:05:11.540 DEBUG [src.node.waku_node] Stopping container with id e9ea3a2c75e2
2025-02-15 03:05:12.085 DEBUG [src.node.waku_node] Container stopped.
2025-02-15 03:05:12.087 DEBUG [src.node.waku_node] Stopping container with id beccce6712db
2025-02-15 03:05:12.605 DEBUG [src.node.waku_node] Container stopped.
2025-02-15 03:05:12.607 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-15 03:05:12.621 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-15 03:05:12.625 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
