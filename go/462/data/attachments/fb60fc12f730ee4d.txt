2025-02-11 09:58:15.648 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-11 09:58:15.648 DEBUG [tests.conftest] Running test: test_message_with_ephemeral_true with id: 2025-02-11_09-58-15__532b54c6-f527-45eb-bc05-d7828a198af6
2025-02-11 09:58:15.648 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-11 09:58:15.648 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-11 09:58:15.649 DEBUG [src.steps.store] Running fixture setup: node_setup
2025-02-11 09:58:15.655 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-11 09:58:15.655 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/publishing_node1_2025-02-11_09-58-15__532b54c6-f527-45eb-bc05-d7828a198af6__wakuorg_nwaku:latest.log
2025-02-11 09:58:15.655 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 09:58:15.655 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 09:58:15.657 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 09:58:15.657 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.159.57
2025-02-11 09:58:15.657 DEBUG [src.node.docker_mananger] Generated ports ['49913', '49914', '49915', '49916', '49917']
2025-02-11 09:58:15.657 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 09:58:15.657 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 09:58:15.657 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 09:58:15.658 DEBUG [src.node.docker_mananger] docker run -i -t -p 49913:49913 -p 49914:49914 -p 49915:49915 -p 49916:49916 -p 49917:49917 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=49915 --rest-port=49913 --tcp-port=49914 --discv5-udp-port=49916 --rest-address=0.0.0.0 --nat=extip:172.18.159.57 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=efafcda54bdcd65e64b7ccbf5c88eeeddc4dcd6dda86ea40492416127be6e7e8 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=49917 --metrics-logging=true --store=true --relay=true
2025-02-11 09:58:15.893 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.159.57 waku c0ecf1c955e548cb3c8f5f005fb99ab9b70a30b255087e1c09661b077a48efec
2025-02-11 09:58:15.943 DEBUG [src.node.docker_mananger] Container started with ID c0ecf1c955e5. Setting up logs at ./log/docker/publishing_node1_2025-02-11_09-58-15__532b54c6-f527-45eb-bc05-d7828a198af6__wakuorg_nwaku:latest.log
2025-02-11 09:58:15.944 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 49913
2025-02-11 09:58:15.944 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 09:58:15.967 ERROR [src.node.docker_mananger] Max retries reached for container ecf213b02508. Exiting log stream.
2025-02-11 09:58:16.453 ERROR [src.node.docker_mananger] Max retries reached for container 4c5d044a2fea. Exiting log stream.
2025-02-11 09:58:16.945 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49913/health" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:58:16.948 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-11 09:58:16.948 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-11 09:58:16.948 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49913/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:58:16.950 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.159.57/tcp/49914/p2p/16Uiu2HAmPb2y5To91424tfiuvdP1LWEzzRYWj9AaN1pzvF68SNdU","/ip4/172.18.159.57/tcp/49915/ws/p2p/16Uiu2HAmPb2y5To91424tfiuvdP1LWEzzRYWj9AaN1pzvF68SNdU"],"enrUri":"enr:-L24QEvlKHxDuJXQ-SU-FS2tiy763VC4bVVGwLGTb9lEqEz2Qy-5nGmPbOxS8l9DhMzJuIJ5SEfA0g9yNNpTVz2MGWsCgmlkgnY0gmlwhKwSnzmKbXVsdGlhZGRyc5YACASsEp85BsL6AAoErBKfOQbC-90DgnJzhQADAQAAiXNlY3AyNTZrMaEDom0xKZ_eAQsEFX6m-ChEvXpd25INX1-8tQibOj_t7K-DdGNwgsL6g3VkcILC_IV3YWt1MgM"}'
2025-02-11 09:58:16.951 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 09:58:16.957 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-11 09:58:16.957 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/store_node1_2025-02-11_09-58-15__532b54c6-f527-45eb-bc05-d7828a198af6__wakuorg_go-waku:latest.log
2025-02-11 09:58:16.958 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 09:58:16.958 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 09:58:16.959 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 09:58:16.959 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.55.10
2025-02-11 09:58:16.959 DEBUG [src.node.docker_mananger] Generated ports ['17142', '17143', '17144', '17145', '17146']
2025-02-11 09:58:16.959 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 09:58:16.960 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 09:58:16.960 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 09:58:16.960 DEBUG [src.node.docker_mananger] docker run -i -t -p 17142:17142 -p 17143:17143 -p 17144:17144 -p 17145:17145 -p 17146:17146 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=17144 --rest-port=17142 --tcp-port=17143 --discv5-udp-port=17145 --rest-address=0.0.0.0 --nat=extip:172.18.55.10 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=e12de7fdbe58deda9ca040ada829d80cceac3ea256de0bb31be95b6555610abd --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --discv5-bootstrap-node=enr:-L24QEvlKHxDuJXQ-SU-FS2tiy763VC4bVVGwLGTb9lEqEz2Qy-5nGmPbOxS8l9DhMzJuIJ5SEfA0g9yNNpTVz2MGWsCgmlkgnY0gmlwhKwSnzmKbXVsdGlhZGRyc5YACASsEp85BsL6AAoErBKfOQbC-90DgnJzhQADAQAAiXNlY3AyNTZrMaEDom0xKZ_eAQsEFX6m-ChEvXpd25INX1-8tQibOj_t7K-DdGNwgsL6g3VkcILC_IV3YWt1MgM --storenode=/ip4/172.18.159.57/tcp/49914/p2p/16Uiu2HAmPb2y5To91424tfiuvdP1LWEzzRYWj9AaN1pzvF68SNdU --store=true --relay=true
2025-02-11 09:58:17.190 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.55.10 waku 0654addb561c4a78f59251cf090e41ce45ab7a1cbf12746dccacfebd39865628
2025-02-11 09:58:17.244 DEBUG [src.node.docker_mananger] Container started with ID 0654addb561c. Setting up logs at ./log/docker/store_node1_2025-02-11_09-58-15__532b54c6-f527-45eb-bc05-d7828a198af6__wakuorg_go-waku:latest.log
2025-02-11 09:58:17.246 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 17142
2025-02-11 09:58:17.246 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 09:58:18.247 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:17142/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:58:18.249 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QPfJ4scYF-6tydCb_zApPxD15mvI5EvAFsM_VctBLMf3fgUA00bQXq-8xMjovhFmT3Xg3RPWV4ZjxETfSLMlPGCGAZT0cfebgmlkgnY0gmlwhKwRAAOCcnODAAMAiXNlY3AyNTZrMaEDpPPcgXSKS-iLSdJUci_pEoqitkTRODmWTas7Fok1OguDdGNwgkL3g3VkcIJC-YV3YWt1MgM","listenAddresses":["/ip4/127.0.0.1/tcp/17143/p2p/16Uiu2HAmPkttJKW4mFzo51fgG27oGm66dkUCpofKURjvjWsnyqUW","/ip4/127.0.0.1/tcp/17144/ws/p2p/16Uiu2HAmPkttJKW4mFzo51fgG27oGm66dkUCpofKURjvjWsnyqUW","/ip4/172.17.0.3/tcp/17143/p2p/16Uiu2HAmPkttJKW4mFzo51fgG27oGm66dkUCpofKURjvjWsnyqUW","/ip4/172.17.0.3/tcp/17144/ws/p2p/16Uiu2HAmPkttJKW4mFzo51fgG27oGm66dkUCpofKURjvjWsnyqUW"]}'
2025-02-11 09:58:18.250 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 09:58:18.250 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:17142/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.159.57/tcp/49914/p2p/16Uiu2HAmPb2y5To91424tfiuvdP1LWEzzRYWj9AaN1pzvF68SNdU", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
2025-02-11 09:58:18.266 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-11 09:58:18.268 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:49913/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2025-02-11 09:58:18.288 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 09:58:18.289 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:17142/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2025-02-11 09:58:18.291 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-11 09:58:18.294 DEBUG [src.steps.store] Relaying message
2025-02-11 09:58:18.295 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:49913/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d '{"payload": "U3RvcmUgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)', "ephemeral": true}'
2025-02-11 09:58:18.307 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 09:58:18.309 DEBUG [src.libs.common] Sleeping for 0.2 seconds
2025-02-11 09:58:18.510 DEBUG [src.steps.store] Checking that peer wakuorg/nwaku:latest can find the stored messages
2025-02-11 09:58:18.510 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49913/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F0&pageSize=5&ascending=true&pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:58:18.514 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"","statusCode":200,"statusDesc":"OK","messages":[]}'
2025-02-11 09:58:18.515 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-11 09:58:18.516 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-11 09:58:18.517 DEBUG [src.node.waku_node] Stopping container with id c0ecf1c955e5
2025-02-11 09:58:19.081 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 09:58:19.081 DEBUG [src.node.waku_node] Stopping container with id 0654addb561c
2025-02-11 09:58:19.739 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 09:58:19.740 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-11 09:58:19.747 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-11 09:58:19.750 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
