2025-02-11 09:55:51.224 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-11 09:55:51.224 DEBUG [tests.conftest] Running test: test_msg_not_stored_when_ephemeral_true with id: 2025-02-11_09-55-51__cfe52139-a6d0-45d1-8501-8242a49229d8
2025-02-11 09:55:51.224 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-11 09:55:51.225 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-11 09:55:51.225 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-11 09:55:51.233 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-11 09:55:51.233 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-11_09-55-51__cfe52139-a6d0-45d1-8501-8242a49229d8__wakuorg_go-waku:latest.log
2025-02-11 09:55:51.238 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-11 09:55:51.238 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-11_09-55-51__cfe52139-a6d0-45d1-8501-8242a49229d8__wakuorg_nwaku:latest.log
2025-02-11 09:55:51.244 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-11 09:55:51.244 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node3_2025-02-11_09-55-51__cfe52139-a6d0-45d1-8501-8242a49229d8__wakuorg_go-waku:latest.log
2025-02-11 09:55:51.244 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-11 09:55:51.245 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-11 09:55:51.245 DEBUG [tests.e2e.test_e2e] Start 3 nodes 
2025-02-11 09:55:51.246 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 09:55:51.246 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 09:55:51.314 DEBUG [src.node.docker_mananger] Network waku created
2025-02-11 09:55:51.314 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.71.101
2025-02-11 09:55:51.314 DEBUG [src.node.docker_mananger] Generated ports ['3749', '3750', '3751', '3752', '3753']
2025-02-11 09:55:51.315 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 09:55:51.315 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 09:55:51.315 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 09:55:51.315 DEBUG [src.node.docker_mananger] docker run -i -t -p 3749:3749 -p 3750:3750 -p 3751:3751 -p 3752:3752 -p 3753:3753 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=3751 --rest-port=3749 --tcp-port=3750 --discv5-udp-port=3752 --rest-address=0.0.0.0 --nat=extip:172.18.71.101 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=d3cafbc7f8540ae6ed3a6f25bc7dad3b0855b1bfedb2afc3adf19f19dedd6d28 --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=true --store=true
2025-02-11 09:55:54.412 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.71.101 waku ce373384f801796eeeb83f8d66083be6522c90f79e585933241026e13c3234d1
2025-02-11 09:55:54.463 DEBUG [src.node.docker_mananger] Container started with ID ce373384f801. Setting up logs at ./log/docker/node1_2025-02-11_09-55-51__cfe52139-a6d0-45d1-8501-8242a49229d8__wakuorg_go-waku:latest.log
2025-02-11 09:55:54.464 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 3749
2025-02-11 09:55:54.464 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 09:55:55.465 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:3749/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:55:55.467 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QKAWSJAbb2DrT5rFWNz-3ZjdL4hJbBJWeqDeAbnXgu3wbTocZp_1A801Bw_pm7NVmU0Z0EZn24okb-s3kyl-cIuGAZT0b8nlgmlkgnY0gmlwhKwRAAKCcnODAAMAiXNlY3AyNTZrMaEDr03-a2ewHhdl2NR9T2wo8ol5vMayDM3w_kOHyS7mIBODdGNwgg6mg3VkcIIOqIV3YWt1MgM","listenAddresses":["/ip4/127.0.0.1/tcp/3750/p2p/16Uiu2HAmQTJg9tLNKS6r6t92cVQGjsk4ZSDsV6nSnHfMz8YY3wez","/ip4/127.0.0.1/tcp/3751/ws/p2p/16Uiu2HAmQTJg9tLNKS6r6t92cVQGjsk4ZSDsV6nSnHfMz8YY3wez","/ip4/172.17.0.2/tcp/3750/p2p/16Uiu2HAmQTJg9tLNKS6r6t92cVQGjsk4ZSDsV6nSnHfMz8YY3wez","/ip4/172.17.0.2/tcp/3751/ws/p2p/16Uiu2HAmQTJg9tLNKS6r6t92cVQGjsk4ZSDsV6nSnHfMz8YY3wez"]}'
2025-02-11 09:55:55.468 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 09:55:55.468 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 09:55:55.468 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 09:55:55.470 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 09:55:55.470 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.24.41
2025-02-11 09:55:55.470 DEBUG [src.node.docker_mananger] Generated ports ['48812', '48813', '48814', '48815', '48816']
2025-02-11 09:55:55.470 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 09:55:55.470 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 09:55:55.471 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 09:55:55.471 DEBUG [src.node.docker_mananger] docker run -i -t -p 48812:48812 -p 48813:48813 -p 48814:48814 -p 48815:48815 -p 48816:48816 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=48814 --rest-port=48812 --tcp-port=48813 --discv5-udp-port=48815 --rest-address=0.0.0.0 --nat=extip:172.18.24.41 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=7f7ceaf7726fddc035bff68de8bb4ecbea1cb3dc108b9ee4dcb7fc06babdbe8a --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=48816 --metrics-logging=true --store=true --relay=true --discv5-bootstrap-node=enr:-J-4QKAWSJAbb2DrT5rFWNz-3ZjdL4hJbBJWeqDeAbnXgu3wbTocZp_1A801Bw_pm7NVmU0Z0EZn24okb-s3kyl-cIuGAZT0b8nlgmlkgnY0gmlwhKwRAAKCcnODAAMAiXNlY3AyNTZrMaEDr03-a2ewHhdl2NR9T2wo8ol5vMayDM3w_kOHyS7mIBODdGNwgg6mg3VkcIIOqIV3YWt1MgM
2025-02-11 09:55:57.536 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.24.41 waku 9b038554d5d6833a73ae6e83997867d387704aa0a4b906ee4f3fea7f1384dac3
2025-02-11 09:55:57.582 DEBUG [src.node.docker_mananger] Container started with ID 9b038554d5d6. Setting up logs at ./log/docker/node2_2025-02-11_09-55-51__cfe52139-a6d0-45d1-8501-8242a49229d8__wakuorg_nwaku:latest.log
2025-02-11 09:55:57.582 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 48812
2025-02-11 09:55:57.582 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 09:55:58.583 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48812/health" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:55:58.586 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-11 09:55:58.587 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-11 09:55:58.587 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48812/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:55:58.590 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.24.41/tcp/48813/p2p/16Uiu2HAkvb2zAKje7ABeCqi8Yn625wsBxEuqZteuqX9dtnvm9JSU","/ip4/172.18.24.41/tcp/48814/ws/p2p/16Uiu2HAkvb2zAKje7ABeCqi8Yn625wsBxEuqZteuqX9dtnvm9JSU"],"enrUri":"enr:-L24QOXNKfV7UAzKEGGvJDi0qwpytysVNszWl4gkH19wVfZpHXtQ4cRL-ClOdVcWy8ZkLMYX0-NkfOWA8sj8vvGDWqACgmlkgnY0gmlwhKwSGCmKbXVsdGlhZGRyc5YACASsEhgpBr6tAAoErBIYKQa-rt0DgnJzhQADAQAAiXNlY3AyNTZrMaECEUGqiV-G-0ZZXF5dwe4XabDexPetpOxGcHeuSG24jAmDdGNwgr6tg3VkcIK-r4V3YWt1MgM"}'
2025-02-11 09:55:58.591 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 09:55:58.591 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 09:55:58.591 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 09:55:58.594 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 09:55:58.594 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.150.175
2025-02-11 09:55:58.594 DEBUG [src.node.docker_mananger] Generated ports ['38294', '38295', '38296', '38297', '38298']
2025-02-11 09:55:58.595 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 09:55:58.595 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 09:55:58.596 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 09:55:58.596 DEBUG [src.node.docker_mananger] docker run -i -t -p 38294:38294 -p 38295:38295 -p 38296:38296 -p 38297:38297 -p 38298:38298 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=38296 --rest-port=38294 --tcp-port=38295 --discv5-udp-port=38297 --rest-address=0.0.0.0 --nat=extip:172.18.150.175 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=508bb48b500f0efbfff6470315aef5d6c7203ccadf059a986bc011c36aa5cd22 --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=false --storenode=/ip4/172.18.24.41/tcp/48813/p2p/16Uiu2HAkvb2zAKje7ABeCqi8Yn625wsBxEuqZteuqX9dtnvm9JSU --discv5-bootstrap-node=enr:-L24QOXNKfV7UAzKEGGvJDi0qwpytysVNszWl4gkH19wVfZpHXtQ4cRL-ClOdVcWy8ZkLMYX0-NkfOWA8sj8vvGDWqACgmlkgnY0gmlwhKwSGCmKbXVsdGlhZGRyc5YACASsEhgpBr6tAAoErBIYKQa-rt0DgnJzhQADAQAAiXNlY3AyNTZrMaECEUGqiV-G-0ZZXF5dwe4XabDexPetpOxGcHeuSG24jAmDdGNwgr6tg3VkcIK-r4V3YWt1MgM --pubsub-topic=/waku/2/rs/3/1
2025-02-11 09:55:58.838 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.150.175 waku ca75ce0b849223879df546fbd9127f034f91539c96755aeaa83b1bbe2deedac7
2025-02-11 09:55:58.890 DEBUG [src.node.docker_mananger] Container started with ID ca75ce0b8492. Setting up logs at ./log/docker/node3_2025-02-11_09-55-51__cfe52139-a6d0-45d1-8501-8242a49229d8__wakuorg_go-waku:latest.log
2025-02-11 09:55:58.892 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 38294
2025-02-11 09:55:58.892 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 09:55:59.892 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:38294/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:55:59.895 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-KG4QG7LzrfcvvJ_5nrMkKfL12TKCXJg5MEo9yfO7K10pg7rYbpBdBJa2exKYSo0o0awvhX1a7VG3loyby1g6eLvBTyGAZT0b9slgmlkgnY0gmlwhKwRAASCcnOFAAMBAAGJc2VjcDI1NmsxoQKMy1ixKJnw7HZYpFUsNZqIBXR-faRjz-xcc5pEGGtM8oN0Y3CClZeDdWRwgpWZhXdha3UygA","listenAddresses":["/ip4/127.0.0.1/tcp/38295/p2p/16Uiu2HAm4uGu4D2LyT8HXLF2VxXzz2VbFpJxL6T8uMfERLcsjtVX","/ip4/127.0.0.1/tcp/38296/ws/p2p/16Uiu2HAm4uGu4D2LyT8HXLF2VxXzz2VbFpJxL6T8uMfERLcsjtVX","/ip4/172.17.0.4/tcp/38295/p2p/16Uiu2HAm4uGu4D2LyT8HXLF2VxXzz2VbFpJxL6T8uMfERLcsjtVX","/ip4/172.17.0.4/tcp/38296/ws/p2p/16Uiu2HAm4uGu4D2LyT8HXLF2VxXzz2VbFpJxL6T8uMfERLcsjtVX"]}'
2025-02-11 09:55:59.895 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 09:55:59.895 DEBUG [tests.e2e.test_e2e] Subscribe node1 ,2 to pubtopic /waku/2/rs/3/1
2025-02-11 09:55:59.895 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3749/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 09:55:59.898 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-11 09:55:59.898 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48812/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 09:55:59.901 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 09:55:59.901 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:3749/admin/v1/peers" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:55:59.903 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"id":"16Uiu2HAkvb2zAKje7ABeCqi8Yn625wsBxEuqZteuqX9dtnvm9JSU","multiaddrs":["/ip4/172.18.24.41/tcp/48813/p2p/16Uiu2HAkvb2zAKje7ABeCqi8Yn625wsBxEuqZteuqX9dtnvm9JSU","/ip4/172.18.24.41/tcp/48814/ws/p2p/16Uiu2HAkvb2zAKje7ABeCqi8Yn625wsBxEuqZteuqX9dtnvm9JSU"],"protocols":null,"connected":false,"pubsubTopics":[]}]'
2025-02-11 09:55:59.903 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48812/admin/v1/peers" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:55:59.906 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"multiaddr":"/ip4/172.17.0.4/tcp/38295/p2p/16Uiu2HAm4uGu4D2LyT8HXLF2VxXzz2VbFpJxL6T8uMfERLcsjtVX","protocols":[{"protocol":"/vac/waku/peer-exchange/2.0.0-alpha1","connected":true}],"origin":"UnknownOrigin"}]'
2025-02-11 09:55:59.906 DEBUG [src.libs.common] Sleeping for 30 seconds
2025-02-11 09:56:29.907 DEBUG [tests.e2e.test_e2e] Node1 publish message with flag ephemeral = True
2025-02-11 09:56:29.907 DEBUG [src.steps.store] Relaying message
2025-02-11 09:56:29.908 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3749/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "RmlsdGVyIHdvcmtzISE=", "contentTopic": "/test/1/waku-filter/proto", "timestamp": '$(date +%s%N)', "ephemeral": true}'
2025-02-11 09:56:29.910 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-11 09:56:29.911 DEBUG [src.libs.common] Sleeping for 0.2 seconds
2025-02-11 09:56:30.112 DEBUG [src.libs.common] Sleeping for 3 seconds
2025-02-11 09:56:33.112 DEBUG [tests.e2e.test_e2e] Node3 makes store request to get messages
2025-02-11 09:56:33.113 DEBUG [src.steps.store] Checking that peer wakuorg/go-waku:latest can find the stored messages
2025-02-11 09:56:33.113 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:38294/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F1&contentTopics=%2Ftest%2F1%2Fwaku-filter%2Fproto&pageSize=50&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:56:33.119 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"request_id":"b5698131961956853c9c37c1e55703b14f826e84ded4f6dea5b3b6fb5d51ba03","status_code":200,"status_desc":"OK"}'
2025-02-11 09:56:33.120 DEBUG [tests.e2e.test_e2e] Response for store when ephemeral = true is strPeer wakuorg/go-waku:latest couldn't find any messages. Actual response: {'request_id': 'b5698131961956853c9c37c1e55703b14f826e84ded4f6dea5b3b6fb5d51ba03', 'status_code': 200, 'status_desc': 'OK'}
2025-02-11 09:56:33.120 DEBUG [tests.e2e.test_e2e] Message isn't stored as ephemeral = True
2025-02-11 09:56:33.122 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-11 09:56:33.123 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-11 09:56:33.124 DEBUG [src.node.waku_node] Stopping container with id ce373384f801
2025-02-11 09:56:33.620 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 09:56:33.621 DEBUG [src.node.waku_node] Stopping container with id 9b038554d5d6
2025-02-11 09:56:34.171 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 09:56:34.173 DEBUG [src.node.waku_node] Stopping container with id ca75ce0b8492
2025-02-11 09:56:34.433 ERROR [src.node.docker_mananger] Max retries reached for container ce373384f801. Exiting log stream.
2025-02-11 09:56:34.655 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 09:56:34.657 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-11 09:56:34.662 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-11 09:56:34.685 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-11 09:56:34.688 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
