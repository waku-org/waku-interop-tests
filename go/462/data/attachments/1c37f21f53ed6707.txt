2025-02-11 09:57:30.779 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-11 09:57:30.779 DEBUG [tests.conftest] Running test: test_publish_with_extra_field with id: 2025-02-11_09-57-30__a103261d-31d9-45e2-8155-0cf2130c78da
2025-02-11 09:57:30.779 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-11 09:57:30.780 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-11 09:57:30.780 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-11 09:57:30.786 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-11 09:57:30.786 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-11_09-57-30__a103261d-31d9-45e2-8155-0cf2130c78da__wakuorg_nwaku:latest.log
2025-02-11 09:57:30.786 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 09:57:30.786 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 09:57:30.788 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 09:57:30.788 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.61.56
2025-02-11 09:57:30.788 DEBUG [src.node.docker_mananger] Generated ports ['46838', '46839', '46840', '46841', '46842']
2025-02-11 09:57:30.788 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 09:57:30.788 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 09:57:30.788 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 09:57:30.788 DEBUG [src.node.docker_mananger] docker run -i -t -p 46838:46838 -p 46839:46839 -p 46840:46840 -p 46841:46841 -p 46842:46842 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=46840 --rest-port=46838 --tcp-port=46839 --discv5-udp-port=46841 --rest-address=0.0.0.0 --nat=extip:172.18.61.56 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=bdebc253e444a6ecdbeed9a28ebd4ab67891604da9ebb4c7e3f2f6dfafa5d1ad --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=46842 --metrics-logging=true --relay=true
2025-02-11 09:57:31.007 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.61.56 waku 64e2fc1ebfc646ebaddae4f39be38cbb945afc5156cda56a037c92d309ea4bbc
2025-02-11 09:57:31.057 DEBUG [src.node.docker_mananger] Container started with ID 64e2fc1ebfc6. Setting up logs at ./log/docker/node1_2025-02-11_09-57-30__a103261d-31d9-45e2-8155-0cf2130c78da__wakuorg_nwaku:latest.log
2025-02-11 09:57:31.058 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 46838
2025-02-11 09:57:31.058 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 09:57:31.065 ERROR [src.node.docker_mananger] Max retries reached for container c2d863d32397. Exiting log stream.
2025-02-11 09:57:31.583 ERROR [src.node.docker_mananger] Max retries reached for container b1e316a539c4. Exiting log stream.
2025-02-11 09:57:32.060 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46838/health" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:57:32.063 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-11 09:57:32.063 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-11 09:57:32.063 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46838/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:57:32.066 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.61.56/tcp/46839/p2p/16Uiu2HAmN52oi58JygWbyyYXJy94dwtA9Jvxnas37BjC8FV4oB85","/ip4/172.18.61.56/tcp/46840/ws/p2p/16Uiu2HAmN52oi58JygWbyyYXJy94dwtA9Jvxnas37BjC8FV4oB85"],"enrUri":"enr:-L24QPe-euJswWQJfPXJdo5Pr-n_34Qtz_PFtMdEAKXEhYIlUfp4R6DdY05SH_-GHcaC0ylaTNvTgxm01x1RPtBD2koCgmlkgnY0gmlwhKwSPTiKbXVsdGlhZGRyc5YACASsEj04Brb3AAoErBI9OAa2-N0DgnJzhQADAQAAiXNlY3AyNTZrMaEDi-Hl8F0h4RRe6wzEiEW4EVu6fPD6hbjH4lmIqAjnhOKDdGNwgrb3g3VkcIK2-YV3YWt1MgE"}'
2025-02-11 09:57:32.066 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 09:57:32.072 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-11 09:57:32.072 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-11_09-57-30__a103261d-31d9-45e2-8155-0cf2130c78da__wakuorg_go-waku:latest.log
2025-02-11 09:57:32.072 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 09:57:32.072 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 09:57:32.074 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 09:57:32.074 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.150.12
2025-02-11 09:57:32.074 DEBUG [src.node.docker_mananger] Generated ports ['44706', '44707', '44708', '44709', '44710']
2025-02-11 09:57:32.074 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 09:57:32.074 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 09:57:32.074 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 09:57:32.074 DEBUG [src.node.docker_mananger] docker run -i -t -p 44706:44706 -p 44707:44707 -p 44708:44708 -p 44709:44709 -p 44710:44710 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=44708 --rest-port=44706 --tcp-port=44707 --discv5-udp-port=44709 --rest-address=0.0.0.0 --nat=extip:172.18.150.12 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=3ebf1b15eef9563b7e8a0f7128ffdee7daaa9cb5fbae1dbcbf0af1d9db79ec03 --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=true --discv5-bootstrap-node=enr:-L24QPe-euJswWQJfPXJdo5Pr-n_34Qtz_PFtMdEAKXEhYIlUfp4R6DdY05SH_-GHcaC0ylaTNvTgxm01x1RPtBD2koCgmlkgnY0gmlwhKwSPTiKbXVsdGlhZGRyc5YACASsEj04Brb3AAoErBI9OAa2-N0DgnJzhQADAQAAiXNlY3AyNTZrMaEDi-Hl8F0h4RRe6wzEiEW4EVu6fPD6hbjH4lmIqAjnhOKDdGNwgrb3g3VkcIK2-YV3YWt1MgE
2025-02-11 09:57:32.306 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.150.12 waku e9235a0caa525d9d98d2403c0e87058e77b7ce58b8b9ef930ef6100665190f21
2025-02-11 09:57:32.368 DEBUG [src.node.docker_mananger] Container started with ID e9235a0caa52. Setting up logs at ./log/docker/node2_2025-02-11_09-57-30__a103261d-31d9-45e2-8155-0cf2130c78da__wakuorg_go-waku:latest.log
2025-02-11 09:57:32.369 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 44706
2025-02-11 09:57:32.369 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 09:57:33.370 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:44706/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:57:33.372 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QIWXRVfr8bjmlmHMQfxMAnALRCa6rAN4mkvJss8VM--bdmZZlFuYjKQgibcbhKKBI1JpRdW3tPcfnFUkO0G7UfmGAZT0cUhBgmlkgnY0gmlwhKwRAAOCcnODAAMAiXNlY3AyNTZrMaECzCbyqd9QiB7XB9X-u13uclB6Tec9kJKji5F5v0rSIPCDdGNwgq6jg3VkcIKupYV3YWt1MgE","listenAddresses":["/ip4/127.0.0.1/tcp/44707/p2p/16Uiu2HAm9AbbXRozg1og1wYWmR6J1TwvWDWRoYHsTo85T6rWx4nB","/ip4/127.0.0.1/tcp/44708/ws/p2p/16Uiu2HAm9AbbXRozg1og1wYWmR6J1TwvWDWRoYHsTo85T6rWx4nB","/ip4/172.17.0.3/tcp/44707/p2p/16Uiu2HAm9AbbXRozg1og1wYWmR6J1TwvWDWRoYHsTo85T6rWx4nB","/ip4/172.17.0.3/tcp/44708/ws/p2p/16Uiu2HAm9AbbXRozg1og1wYWmR6J1TwvWDWRoYHsTo85T6rWx4nB"]}'
2025-02-11 09:57:33.373 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 09:57:33.374 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:44706/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.61.56/tcp/46839/p2p/16Uiu2HAmN52oi58JygWbyyYXJy94dwtA9Jvxnas37BjC8FV4oB85", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
2025-02-11 09:57:33.390 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-11 09:57:33.391 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-11 09:57:33.392 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46838/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 09:57:33.417 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 09:57:33.418 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:44706/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 09:57:33.420 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-11 09:57:33.421 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46838/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 09:57:33.425 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 09:57:33.426 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-11 09:57:33.526 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-11 09:57:33.526 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46838/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:57:33.529 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739267853421411072,"ephemeral":false}]'
2025-02-11 09:57:33.530 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-11 09:57:33.530 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:44706/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:57:33.532 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-11 09:57:34.533 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46838/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 09:57:34.538 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 09:57:34.538 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-11 09:57:34.638 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-11 09:57:34.638 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46838/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:57:34.641 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739267854533311488,"ephemeral":false}]'
2025-02-11 09:57:34.642 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-11 09:57:34.643 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:44706/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 09:57:34.644 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739267854533311488,"ephemeral":false}]'
2025-02-11 09:57:34.646 INFO [src.steps.relay] WARM UP successful!!
2025-02-11 09:57:34.647 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46838/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)', "extraField": "extraValue"}'
2025-02-11 09:57:34.649 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:46838/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-11 09:57:34.651 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-11 09:57:34.652 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-11 09:57:34.653 DEBUG [src.node.waku_node] Stopping container with id 64e2fc1ebfc6
2025-02-11 09:57:35.264 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 09:57:35.265 DEBUG [src.node.waku_node] Stopping container with id e9235a0caa52
2025-02-11 09:57:35.746 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 09:57:35.748 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-11 09:57:35.754 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-11 09:57:35.757 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
