2025-02-17 03:09:34.264 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-17 03:09:34.265 DEBUG [tests.conftest] Running test: test_metrics_after_relay_publish with id: 2025-02-17_03-09-34__2b514db4-8583-4b64-a58c-7c647d57829a
2025-02-17 03:09:34.265 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-17 03:09:34.265 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-17 03:09:34.265 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-17 03:09:34.266 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-17 03:09:34.266 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-17 03:09:34.266 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-17 03:09:34.272 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-17 03:09:34.272 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-17_03-09-34__2b514db4-8583-4b64-a58c-7c647d57829a__wakuorg_nwaku:latest.log
2025-02-17 03:09:34.272 DEBUG [src.node.waku_node] Starting Node...
2025-02-17 03:09:34.273 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-17 03:09:34.274 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-17 03:09:34.274 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.27.175
2025-02-17 03:09:34.274 DEBUG [src.node.docker_mananger] Generated ports ['53833', '53834', '53835', '53836', '53837']
2025-02-17 03:09:34.274 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-17 03:09:34.275 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-17 03:09:34.275 DEBUG [src.node.waku_node] Using volumes []
2025-02-17 03:09:34.275 DEBUG [src.node.docker_mananger] docker run -i -t -p 53833:53833 -p 53834:53834 -p 53835:53835 -p 53836:53836 -p 53837:53837 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=53835 --rest-port=53833 --tcp-port=53834 --discv5-udp-port=53836 --rest-address=0.0.0.0 --nat=extip:172.18.27.175 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=ed0b8a03e62c1e948c2ecb04accfc5ae3fde401c0c490e3c2c82c0cbde8aaa07 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=53837 --metrics-logging=true --relay=true
2025-02-17 03:09:34.494 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.27.175 waku c1ac91a5918b05ebaf5aa22645ce37a4ff59899f8060298cb425ae5a988cc1cc
2025-02-17 03:09:34.537 DEBUG [src.node.docker_mananger] Container started with ID c1ac91a5918b. Setting up logs at ./log/docker/node1_2025-02-17_03-09-34__2b514db4-8583-4b64-a58c-7c647d57829a__wakuorg_nwaku:latest.log
2025-02-17 03:09:34.537 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 53833
2025-02-17 03:09:34.538 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-17 03:09:34.567 ERROR [src.node.docker_mananger] Max retries reached for container fea7a52c9feb. Exiting log stream.
2025-02-17 03:09:35.067 ERROR [src.node.docker_mananger] Max retries reached for container 8b942a5a735e. Exiting log stream.
2025-02-17 03:09:35.539 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:53833/health" -H "Content-Type: application/json" -d 'None'
2025-02-17 03:09:35.541 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-17 03:09:35.542 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-17 03:09:35.542 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:53833/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-17 03:09:35.544 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.27.175/tcp/53834/p2p/16Uiu2HAmAi5Q4AjaX2MMcAeoHC6AXYFGMDnsnzszeRQm98vgd4Qc","/ip4/172.18.27.175/tcp/53835/ws/p2p/16Uiu2HAmAi5Q4AjaX2MMcAeoHC6AXYFGMDnsnzszeRQm98vgd4Qc"],"enrUri":"enr:-L24QO8hqpykLFxRc6wNcOvUbdC_YoKHDZHzI0Rq9h-nb5hmQPGzm8NcQaAMUYAWZE6uhhGega2OEOc7qCjcg55gn4wCgmlkgnY0gmlwhKwSG6-KbXVsdGlhZGRyc5YACASsEhuvBtJKAAoErBIbrwbSS90DgnJzhQADAQAAiXNlY3AyNTZrMaEC4xMTdS5oSCCaHws6CLz9vTi2A9zig93JgzFKZAlbi7WDdGNwgtJKg3VkcILSTIV3YWt1MgE"}'
2025-02-17 03:09:35.544 INFO [src.node.waku_node] REST service is ready !!
2025-02-17 03:09:35.550 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-17 03:09:35.550 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-17_03-09-34__2b514db4-8583-4b64-a58c-7c647d57829a__wakuorg_go-waku:latest.log
2025-02-17 03:09:35.551 DEBUG [src.node.waku_node] Starting Node...
2025-02-17 03:09:35.551 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-17 03:09:35.552 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-17 03:09:35.552 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.22.167
2025-02-17 03:09:35.552 DEBUG [src.node.docker_mananger] Generated ports ['55453', '55454', '55455', '55456', '55457']
2025-02-17 03:09:35.553 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-17 03:09:35.553 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-17 03:09:35.553 DEBUG [src.node.waku_node] Using volumes []
2025-02-17 03:09:35.553 DEBUG [src.node.docker_mananger] docker run -i -t -p 55453:55453 -p 55454:55454 -p 55455:55455 -p 55456:55456 -p 55457:55457 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=55455 --rest-port=55453 --tcp-port=55454 --discv5-udp-port=55456 --rest-address=0.0.0.0 --nat=extip:172.18.22.167 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=84e5fb27cd7e5aba4fd26eff2c38aba7fda82fd4afb88ea1dbc0bec88d51dbeb --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=true --discv5-bootstrap-node=enr:-L24QO8hqpykLFxRc6wNcOvUbdC_YoKHDZHzI0Rq9h-nb5hmQPGzm8NcQaAMUYAWZE6uhhGega2OEOc7qCjcg55gn4wCgmlkgnY0gmlwhKwSG6-KbXVsdGlhZGRyc5YACASsEhuvBtJKAAoErBIbrwbSS90DgnJzhQADAQAAiXNlY3AyNTZrMaEC4xMTdS5oSCCaHws6CLz9vTi2A9zig93JgzFKZAlbi7WDdGNwgtJKg3VkcILSTIV3YWt1MgE
2025-02-17 03:09:35.792 DEBUG [src.node.waku_node] Starting Node...
2025-02-17 03:09:35.792 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-17 03:09:35.794 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-17 03:09:35.794 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.124.245
2025-02-17 03:09:35.794 DEBUG [src.node.docker_mananger] Generated ports ['49966', '49967', '49968', '49969', '49970']
2025-02-17 03:09:35.795 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-17 03:09:35.795 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-17 03:09:35.795 DEBUG [src.node.waku_node] Using volumes []
2025-02-17 03:09:35.795 DEBUG [src.node.docker_mananger] docker run -i -t -p 49966:49966 -p 49967:49967 -p 49968:49968 -p 49969:49969 -p 49970:49970 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=49968 --rest-port=49966 --tcp-port=49967 --discv5-udp-port=49969 --rest-address=0.0.0.0 --nat=extip:172.18.124.245 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=dada0abccf91c59180f4f3babe9c6bfd4ba1efc61c8a6b98e9efd4ea18c48bdc --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=true --discv5-bootstrap-node=enr:-L24QO8hqpykLFxRc6wNcOvUbdC_YoKHDZHzI0Rq9h-nb5hmQPGzm8NcQaAMUYAWZE6uhhGega2OEOc7qCjcg55gn4wCgmlkgnY0gmlwhKwSG6-KbXVsdGlhZGRyc5YACASsEhuvBtJKAAoErBIbrwbSS90DgnJzhQADAQAAiXNlY3AyNTZrMaEC4xMTdS5oSCCaHws6CLz9vTi2A9zig93JgzFKZAlbi7WDdGNwgtJKg3VkcILSTIV3YWt1MgE
2025-02-17 03:09:36.016 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.124.245 waku 4ca55a2d516cba4650e95878e3bfa02d156c9b6909bd8e8fe590f9ee461b375a
2025-02-17 03:09:36.069 DEBUG [src.node.docker_mananger] Container started with ID 4ca55a2d516c. Setting up logs at ./log/docker/node2_2025-02-17_03-09-34__2b514db4-8583-4b64-a58c-7c647d57829a__wakuorg_go-waku:latest.log
2025-02-17 03:09:36.069 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 49966
2025-02-17 03:09:36.069 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-17 03:09:37.071 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49966/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-17 03:09:37.073 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QKz_aXn9EVdwe5tMLa6MBFlYvS5T3dbNCObmBmrPPQEoG2C3VAgHqAJBHzhP-F0BzdOSU7KOhI2EE3Z_L_y3ObSGAZUR4fW-gmlkgnY0gmlwhKwRAAOCcnODAAMAiXNlY3AyNTZrMaEDQpXt7vbxv8988rKuaTwUnU0-4lPzCvpBtAlHl2gSMNGDdGNwgsMvg3VkcILDMYV3YWt1MgE","listenAddresses":["/ip4/127.0.0.1/tcp/49967/p2p/16Uiu2HAmH8urfHjFCy8rL2h8WUyftWnS3RkGPa4ZGVy42TTU8iJk","/ip4/127.0.0.1/tcp/49968/ws/p2p/16Uiu2HAmH8urfHjFCy8rL2h8WUyftWnS3RkGPa4ZGVy42TTU8iJk","/ip4/172.17.0.3/tcp/49967/p2p/16Uiu2HAmH8urfHjFCy8rL2h8WUyftWnS3RkGPa4ZGVy42TTU8iJk","/ip4/172.17.0.3/tcp/49968/ws/p2p/16Uiu2HAmH8urfHjFCy8rL2h8WUyftWnS3RkGPa4ZGVy42TTU8iJk"]}'
2025-02-17 03:09:37.074 INFO [src.node.waku_node] REST service is ready !!
2025-02-17 03:09:37.074 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:49966/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.27.175/tcp/53834/p2p/16Uiu2HAmAi5Q4AjaX2MMcAeoHC6AXYFGMDnsnzszeRQm98vgd4Qc", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
2025-02-17 03:09:37.093 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-17 03:09:37.094 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-17 03:09:37.094 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:53833/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-17 03:09:37.113 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-17 03:09:37.114 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:49966/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-17 03:09:37.116 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-17 03:09:37.117 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:53833/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-17 03:09:37.122 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-17 03:09:37.123 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-17 03:09:37.224 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-17 03:09:37.224 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:53833/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-17 03:09:37.227 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739761777117274880,"ephemeral":false,"proof":""}]'
2025-02-17 03:09:37.228 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-17 03:09:37.228 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49966/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-17 03:09:37.230 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-17 03:09:38.231 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:53833/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-17 03:09:38.236 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-17 03:09:38.236 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-17 03:09:38.336 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-17 03:09:38.336 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:53833/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-17 03:09:38.339 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739761778231047424,"ephemeral":false,"proof":""}]'
2025-02-17 03:09:38.341 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-17 03:09:38.341 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49966/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-17 03:09:38.342 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739761778231047424,"ephemeral":false}]'
2025-02-17 03:09:38.344 INFO [src.steps.relay] WARM UP successful!!
2025-02-17 03:09:38.345 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:53833/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-17 03:09:38.349 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-17 03:09:38.350 DEBUG [src.libs.common] Sleeping for 0.5 seconds
2025-02-17 03:09:38.850 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49966/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-17 03:09:38.852 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739761778345345792,"ephemeral":false}]'
2025-02-17 03:09:38.852 DEBUG [src.libs.common] Sleeping for 5 seconds
2025-02-17 03:09:43.853 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-17 03:09:43.857 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-17 03:09:43.857 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-17 03:09:43.860 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-17 03:09:43.860 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-17 03:09:43.863 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-17 03:09:43.864 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-17 03:09:43.866 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-17 03:09:43.867 DEBUG [src.steps.metrics] Checking metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} has 1
2025-02-17 03:09:43.869 DEBUG [src.steps.metrics] Found metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} with value 1.0
2025-02-17 03:09:43.870 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-17 03:09:43.873 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-17 03:09:43.873 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-17 03:09:43.876 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 3.0
2025-02-17 03:09:43.876 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-17 03:09:43.879 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 3.0
2025-02-17 03:09:43.882 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-17 03:09:43.882 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-17 03:09:43.883 DEBUG [src.node.waku_node] Stopping container with id c1ac91a5918b
2025-02-17 03:09:44.405 DEBUG [src.node.waku_node] Container stopped.
2025-02-17 03:09:44.406 DEBUG [src.node.waku_node] Stopping container with id 4ca55a2d516c
2025-02-17 03:09:44.913 DEBUG [src.node.waku_node] Container stopped.
2025-02-17 03:09:44.916 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-17 03:09:44.923 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-17 03:09:44.926 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
