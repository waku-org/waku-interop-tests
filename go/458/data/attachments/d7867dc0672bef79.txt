2025-02-08 03:05:20.250 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-08 03:05:20.250 DEBUG [tests.conftest] Running test: test_publish_with_ephemeral with id: 2025-02-08_03-05-20__c201393e-d3f6-4b20-88c2-9fdd3afe0dee
2025-02-08 03:05:20.251 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-08 03:05:20.251 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-08 03:05:20.251 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-08 03:05:20.257 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-08 03:05:20.257 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-08_03-05-20__c201393e-d3f6-4b20-88c2-9fdd3afe0dee__wakuorg_nwaku:latest.log
2025-02-08 03:05:20.258 DEBUG [src.node.waku_node] Starting Node...
2025-02-08 03:05:20.258 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-08 03:05:20.259 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-08 03:05:20.259 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.108.248
2025-02-08 03:05:20.259 DEBUG [src.node.docker_mananger] Generated ports ['27420', '27421', '27422', '27423', '27424']
2025-02-08 03:05:20.260 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-08 03:05:20.260 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-08 03:05:20.260 DEBUG [src.node.waku_node] Using volumes []
2025-02-08 03:05:20.260 DEBUG [src.node.docker_mananger] docker run -i -t -p 27420:27420 -p 27421:27421 -p 27422:27422 -p 27423:27423 -p 27424:27424 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=27422 --rest-port=27420 --tcp-port=27421 --discv5-udp-port=27423 --rest-address=0.0.0.0 --nat=extip:172.18.108.248 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=b94c5f4f0b9ab0b4d455baea8e8bac33bed3bbc7d3e651cd9bed5fc1fd4743fc --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=27424 --metrics-logging=true --relay=true
2025-02-08 03:05:20.502 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.108.248 waku f3de3b92eaf6efc0be935441d96eb1deedbd38b811cb30ea5f1a16e20c86a69f
2025-02-08 03:05:20.542 ERROR [src.node.docker_mananger] Max retries reached for container 9d563299242f. Exiting log stream.
2025-02-08 03:05:20.553 DEBUG [src.node.docker_mananger] Container started with ID f3de3b92eaf6. Setting up logs at ./log/docker/node1_2025-02-08_03-05-20__c201393e-d3f6-4b20-88c2-9fdd3afe0dee__wakuorg_nwaku:latest.log
2025-02-08 03:05:20.554 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 27420
2025-02-08 03:05:20.554 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-08 03:05:21.058 ERROR [src.node.docker_mananger] Max retries reached for container b16ed218714c. Exiting log stream.
2025-02-08 03:05:21.554 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:27420/health" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:05:21.557 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-08 03:05:21.557 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-08 03:05:21.557 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:27420/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:05:21.559 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.108.248/tcp/27421/p2p/16Uiu2HAmKBEUNJND7TkHnJe5ax6QxdX2fdLd1Zg8SR5kWkihBfRj","/ip4/172.18.108.248/tcp/27422/ws/p2p/16Uiu2HAmKBEUNJND7TkHnJe5ax6QxdX2fdLd1Zg8SR5kWkihBfRj"],"enrUri":"enr:-L24QNxKU-S_V8gPprPYF4OkwNs7e7hNH1-3BG_7hSYuVxjWbjxCtPt8KrxHCLjrHwthq9kfnytDSRW4dgw9J-UvMW0CgmlkgnY0gmlwhKwSbPiKbXVsdGlhZGRyc5YACASsEmz4BmsdAAoErBJs-AZrHt0DgnJzhQADAQAAiXNlY3AyNTZrMaEDYOWDf8_bVMzdOVrAAnlWTaA75G8nLTAl-JNx-sTmJ-KDdGNwgmsdg3VkcIJrH4V3YWt1MgE"}'
2025-02-08 03:05:21.560 INFO [src.node.waku_node] REST service is ready !!
2025-02-08 03:05:21.566 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-08 03:05:21.566 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-08_03-05-20__c201393e-d3f6-4b20-88c2-9fdd3afe0dee__wakuorg_go-waku:latest.log
2025-02-08 03:05:21.566 DEBUG [src.node.waku_node] Starting Node...
2025-02-08 03:05:21.566 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-08 03:05:21.568 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-08 03:05:21.568 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.137.71
2025-02-08 03:05:21.568 DEBUG [src.node.docker_mananger] Generated ports ['18636', '18637', '18638', '18639', '18640']
2025-02-08 03:05:21.568 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-08 03:05:21.568 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-08 03:05:21.568 DEBUG [src.node.waku_node] Using volumes []
2025-02-08 03:05:21.568 DEBUG [src.node.docker_mananger] docker run -i -t -p 18636:18636 -p 18637:18637 -p 18638:18638 -p 18639:18639 -p 18640:18640 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=18638 --rest-port=18636 --tcp-port=18637 --discv5-udp-port=18639 --rest-address=0.0.0.0 --nat=extip:172.18.137.71 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=8e01e199bc2d96addbb9ecb4d71b3ebaeb9ee5f3a30633ceba237fb2cc62db82 --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=true --discv5-bootstrap-node=enr:-L24QNxKU-S_V8gPprPYF4OkwNs7e7hNH1-3BG_7hSYuVxjWbjxCtPt8KrxHCLjrHwthq9kfnytDSRW4dgw9J-UvMW0CgmlkgnY0gmlwhKwSbPiKbXVsdGlhZGRyc5YACASsEmz4BmsdAAoErBJs-AZrHt0DgnJzhQADAQAAiXNlY3AyNTZrMaEDYOWDf8_bVMzdOVrAAnlWTaA75G8nLTAl-JNx-sTmJ-KDdGNwgmsdg3VkcIJrH4V3YWt1MgE
2025-02-08 03:05:21.805 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.137.71 waku ecd14709e1ae0c140985dc2cfb2095b8c7d0713853159f9d26d7d00bc9cf563b
2025-02-08 03:05:21.865 DEBUG [src.node.docker_mananger] Container started with ID ecd14709e1ae. Setting up logs at ./log/docker/node2_2025-02-08_03-05-20__c201393e-d3f6-4b20-88c2-9fdd3afe0dee__wakuorg_go-waku:latest.log
2025-02-08 03:05:21.865 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 18636
2025-02-08 03:05:21.865 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-08 03:05:22.866 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:18636/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:05:22.869 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QB5XcoTAUljnNHS3zDwfXr3O67t7emolax6Vpc41QzLPfRwqsBPKNodbA3OvXXJg0mMM6gXGW3Q-OvmCUtcPgw-GAZTjhNi-gmlkgnY0gmlwhKwRAAOCcnODAAMAiXNlY3AyNTZrMaECFEJKltqBsR3q7eEQBiMIdvLGThNhXz3gnFbZOzxyjaWDdGNwgkjNg3VkcIJIz4V3YWt1MgE","listenAddresses":["/ip4/127.0.0.1/tcp/18637/p2p/16Uiu2HAkvnkmAtBaSWevdHFudWU7YrZAMS2PKJySXgWZChAYoM3a","/ip4/127.0.0.1/tcp/18638/ws/p2p/16Uiu2HAkvnkmAtBaSWevdHFudWU7YrZAMS2PKJySXgWZChAYoM3a","/ip4/172.17.0.3/tcp/18637/p2p/16Uiu2HAkvnkmAtBaSWevdHFudWU7YrZAMS2PKJySXgWZChAYoM3a","/ip4/172.17.0.3/tcp/18638/ws/p2p/16Uiu2HAkvnkmAtBaSWevdHFudWU7YrZAMS2PKJySXgWZChAYoM3a"]}'
2025-02-08 03:05:22.869 INFO [src.node.waku_node] REST service is ready !!
2025-02-08 03:05:22.870 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:18636/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.108.248/tcp/27421/p2p/16Uiu2HAmKBEUNJND7TkHnJe5ax6QxdX2fdLd1Zg8SR5kWkihBfRj", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
2025-02-08 03:05:22.886 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-08 03:05:22.887 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-08 03:05:22.887 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:27420/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-08 03:05:22.912 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 03:05:22.912 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:18636/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-08 03:05:22.915 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-08 03:05:22.916 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:27420/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-08 03:05:22.921 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 03:05:22.923 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-08 03:05:23.024 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-08 03:05:23.024 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:27420/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:05:23.027 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738983922916760576,"ephemeral":false}]'
2025-02-08 03:05:23.028 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-08 03:05:23.028 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:18636/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:05:23.030 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-08 03:05:24.031 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:27420/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-08 03:05:24.036 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 03:05:24.036 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-08 03:05:24.136 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-08 03:05:24.137 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:27420/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:05:24.139 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738983924031281408,"ephemeral":false}]'
2025-02-08 03:05:24.141 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-08 03:05:24.141 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:18636/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:05:24.142 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738983924031281408,"ephemeral":false}]'
2025-02-08 03:05:24.144 INFO [src.steps.relay] WARM UP successful!!
2025-02-08 03:05:24.145 DEBUG [tests.relay.test_publish] Running test with Ephemeral True
2025-02-08 03:05:24.145 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:27420/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)', "ephemeral": true}'
2025-02-08 03:05:24.149 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 03:05:24.149 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-08 03:05:24.250 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-08 03:05:24.250 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:27420/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:05:24.253 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738983924145326848,"ephemeral":true}]'
2025-02-08 03:05:24.254 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-08 03:05:24.254 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:18636/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:05:24.256 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738983924145326848,"ephemeral":true}]'
2025-02-08 03:05:24.257 DEBUG [tests.relay.test_publish] Running test with Ephemeral False
2025-02-08 03:05:24.258 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:27420/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)', "ephemeral": false}'
2025-02-08 03:05:24.262 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 03:05:24.262 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-08 03:05:24.362 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-08 03:05:24.363 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:27420/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:05:24.365 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738983924258053376,"ephemeral":false}]'
2025-02-08 03:05:24.367 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-08 03:05:24.367 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:18636/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:05:24.369 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738983924258053376,"ephemeral":false}]'
2025-02-08 03:05:24.372 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-08 03:05:24.373 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-08 03:05:24.373 DEBUG [src.node.waku_node] Stopping container with id f3de3b92eaf6
2025-02-08 03:05:25.039 DEBUG [src.node.waku_node] Container stopped.
2025-02-08 03:05:25.040 DEBUG [src.node.waku_node] Stopping container with id ecd14709e1ae
2025-02-08 03:05:25.538 DEBUG [src.node.waku_node] Container stopped.
2025-02-08 03:05:25.539 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-08 03:05:25.546 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-08 03:05:25.549 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
