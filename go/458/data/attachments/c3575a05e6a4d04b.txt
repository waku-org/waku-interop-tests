2025-02-08 03:04:50.415 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-08 03:04:50.415 DEBUG [tests.conftest] Running test: test_metrics_after_relay_publish with id: 2025-02-08_03-04-50__d878c687-2f4f-4867-9a44-7f4ab88dd917
2025-02-08 03:04:50.415 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-08 03:04:50.415 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-08 03:04:50.416 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-08 03:04:50.416 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-08 03:04:50.416 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-08 03:04:50.416 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-08 03:04:50.422 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-08 03:04:50.422 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-08_03-04-50__d878c687-2f4f-4867-9a44-7f4ab88dd917__wakuorg_nwaku:latest.log
2025-02-08 03:04:50.422 DEBUG [src.node.waku_node] Starting Node...
2025-02-08 03:04:50.422 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-08 03:04:50.424 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-08 03:04:50.424 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.100.111
2025-02-08 03:04:50.424 DEBUG [src.node.docker_mananger] Generated ports ['48084', '48085', '48086', '48087', '48088']
2025-02-08 03:04:50.424 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-08 03:04:50.424 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-08 03:04:50.424 DEBUG [src.node.waku_node] Using volumes []
2025-02-08 03:04:50.425 DEBUG [src.node.docker_mananger] docker run -i -t -p 48084:48084 -p 48085:48085 -p 48086:48086 -p 48087:48087 -p 48088:48088 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=48086 --rest-port=48084 --tcp-port=48085 --discv5-udp-port=48087 --rest-address=0.0.0.0 --nat=extip:172.18.100.111 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=77d2ed019e1cdaca8b5e2ea26b0947a60aa3bb5f12e86bd94c3bdaee3b22caed --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=48088 --metrics-logging=true --relay=true
2025-02-08 03:04:50.660 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.100.111 waku 791d4c39a8e23b9984c9049e66038a844b82c534bf85fcb72229457efd34d95a
2025-02-08 03:04:50.706 DEBUG [src.node.docker_mananger] Container started with ID 791d4c39a8e2. Setting up logs at ./log/docker/node1_2025-02-08_03-04-50__d878c687-2f4f-4867-9a44-7f4ab88dd917__wakuorg_nwaku:latest.log
2025-02-08 03:04:50.707 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 48084
2025-02-08 03:04:50.707 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-08 03:04:50.716 ERROR [src.node.docker_mananger] Max retries reached for container 25ca5b325760. Exiting log stream.
2025-02-08 03:04:51.220 ERROR [src.node.docker_mananger] Max retries reached for container a866dd959f6d. Exiting log stream.
2025-02-08 03:04:51.707 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48084/health" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:04:51.710 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-08 03:04:51.710 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-08 03:04:51.711 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48084/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:04:51.713 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.100.111/tcp/48085/p2p/16Uiu2HAmMrfANeyZJDdVs7bmKh3f9Ea7FhS3gchr3ZzXQsevHPmX","/ip4/172.18.100.111/tcp/48086/ws/p2p/16Uiu2HAmMrfANeyZJDdVs7bmKh3f9Ea7FhS3gchr3ZzXQsevHPmX"],"enrUri":"enr:-L24QDBJ_mQPmQ_Rfowt2mcMHZ018Ie5bY4HuJVWl12AgDvcYWaKEx0KawxJpEr0u4YQGuh98tgIQp_78M-y650CF1UCgmlkgnY0gmlwhKwSZG-KbXVsdGlhZGRyc5YACASsEmRvBrvVAAoErBJkbwa71t0DgnJzhQADAQAAiXNlY3AyNTZrMaEDiLZ0tF3VbBUwQys_e6_Gn6vx7ovO08kMaFZOIR5SVB6DdGNwgrvVg3VkcIK714V3YWt1MgE"}'
2025-02-08 03:04:51.713 INFO [src.node.waku_node] REST service is ready !!
2025-02-08 03:04:51.719 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/go-waku:latest
2025-02-08 03:04:51.719 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-08_03-04-50__d878c687-2f4f-4867-9a44-7f4ab88dd917__wakuorg_go-waku:latest.log
2025-02-08 03:04:51.719 DEBUG [src.node.waku_node] Starting Node...
2025-02-08 03:04:51.719 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-08 03:04:51.720 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-08 03:04:51.720 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.154.142
2025-02-08 03:04:51.720 DEBUG [src.node.docker_mananger] Generated ports ['23260', '23261', '23262', '23263', '23264']
2025-02-08 03:04:51.721 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-08 03:04:51.721 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-08 03:04:51.721 DEBUG [src.node.waku_node] Using volumes []
2025-02-08 03:04:51.721 DEBUG [src.node.docker_mananger] docker run -i -t -p 23260:23260 -p 23261:23261 -p 23262:23262 -p 23263:23263 -p 23264:23264 wakuorg/go-waku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=DEBUG --rest-relay-cache-capacity=100 --websocket-port=23262 --rest-port=23260 --tcp-port=23261 --discv5-udp-port=23263 --rest-address=0.0.0.0 --nat=extip:172.18.154.142 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=9b82ed4e138d5bbeb36143a1e922ed43b3d4bcbfcb681edcb3fb018883a71daa --min-relay-peers-to-publish=1 --rest-filter-cache-capacity=50 --peer-store-capacity=10 --relay=true --discv5-bootstrap-node=enr:-L24QDBJ_mQPmQ_Rfowt2mcMHZ018Ie5bY4HuJVWl12AgDvcYWaKEx0KawxJpEr0u4YQGuh98tgIQp_78M-y650CF1UCgmlkgnY0gmlwhKwSZG-KbXVsdGlhZGRyc5YACASsEmRvBrvVAAoErBJkbwa71t0DgnJzhQADAQAAiXNlY3AyNTZrMaEDiLZ0tF3VbBUwQys_e6_Gn6vx7ovO08kMaFZOIR5SVB6DdGNwgrvVg3VkcIK714V3YWt1MgE
2025-02-08 03:04:51.950 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.154.142 waku dc0fb5a9785b190be95fe7b5011f60dc6c89167f1837bb60e3799ab417cc2731
2025-02-08 03:04:52.000 DEBUG [src.node.docker_mananger] Container started with ID dc0fb5a9785b. Setting up logs at ./log/docker/node2_2025-02-08_03-04-50__d878c687-2f4f-4867-9a44-7f4ab88dd917__wakuorg_go-waku:latest.log
2025-02-08 03:04:52.001 DEBUG [src.node.waku_node] Started container from image wakuorg/go-waku:latest. REST: 23260
2025-02-08 03:04:52.002 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-08 03:04:53.002 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:23260/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:04:53.005 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"enrUri":"enr:-J-4QA5UaBRXoAPvSlStrDLxrPVb8Y3V1JuYSxCKG4sdIV13ZdRcUjOYisptNUBT6MWcFcWLPLItRWW4xbncEyHofUiGAZTjhGQcgmlkgnY0gmlwhKwRAAOCcnODAAMAiXNlY3AyNTZrMaECCC6hpC0Uh8b-baqylRmqpolR3xOcg_p55G66vKm50mqDdGNwglrdg3VkcIJa34V3YWt1MgE","listenAddresses":["/ip4/127.0.0.1/tcp/23261/p2p/16Uiu2HAkuycUwrVJchB3g2zVd1skTy9CagJLcR1whPu5chFTVPPP","/ip4/127.0.0.1/tcp/23262/ws/p2p/16Uiu2HAkuycUwrVJchB3g2zVd1skTy9CagJLcR1whPu5chFTVPPP","/ip4/172.17.0.3/tcp/23261/p2p/16Uiu2HAkuycUwrVJchB3g2zVd1skTy9CagJLcR1whPu5chFTVPPP","/ip4/172.17.0.3/tcp/23262/ws/p2p/16Uiu2HAkuycUwrVJchB3g2zVd1skTy9CagJLcR1whPu5chFTVPPP"]}'
2025-02-08 03:04:53.005 INFO [src.node.waku_node] REST service is ready !!
2025-02-08 03:04:53.005 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:23260/admin/v1/peers" -H "Content-Type: application/json" -d '{"multiaddr": "/ip4/172.18.100.111/tcp/48085/p2p/16Uiu2HAmMrfANeyZJDdVs7bmKh3f9Ea7FhS3gchr3ZzXQsevHPmX", "protocols": ["/vac/waku/relay/2.0.0"], "shards": [0, 1, 2, 3, 4, 5, 6, 7, 8]}'
2025-02-08 03:04:53.022 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-08 03:04:53.023 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-08 03:04:53.024 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48084/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-08 03:04:53.047 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 03:04:53.047 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:23260/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-08 03:04:53.049 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'true'
2025-02-08 03:04:53.050 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48084/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-08 03:04:53.059 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 03:04:53.060 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-08 03:04:53.160 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-08 03:04:53.160 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48084/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:04:53.163 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738983893050372352,"ephemeral":false}]'
2025-02-08 03:04:53.164 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-08 03:04:53.164 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:23260/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:04:53.166 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'null'
2025-02-08 03:04:54.167 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48084/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-08 03:04:54.172 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 03:04:54.172 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-08 03:04:54.272 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-08 03:04:54.272 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48084/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:04:54.275 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738983894167368448,"ephemeral":false}]'
2025-02-08 03:04:54.276 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/go-waku:latest can find the published message
2025-02-08 03:04:54.276 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:23260/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:04:54.278 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738983894167368448,"ephemeral":false}]'
2025-02-08 03:04:54.279 INFO [src.steps.relay] WARM UP successful!!
2025-02-08 03:04:54.280 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48084/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-08 03:04:54.284 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 03:04:54.285 DEBUG [src.libs.common] Sleeping for 0.5 seconds
2025-02-08 03:04:54.785 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:23260/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 03:04:54.787 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738983894280726784,"ephemeral":false}]'
2025-02-08 03:04:54.787 DEBUG [src.libs.common] Sleeping for 5 seconds
2025-02-08 03:04:59.788 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-08 03:04:59.792 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-08 03:04:59.793 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-08 03:04:59.796 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-08 03:04:59.796 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-08 03:04:59.799 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-08 03:04:59.799 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-08 03:04:59.802 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-08 03:04:59.802 DEBUG [src.steps.metrics] Checking metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} has 1
2025-02-08 03:04:59.805 DEBUG [src.steps.metrics] Found metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} with value 1.0
2025-02-08 03:04:59.805 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-08 03:04:59.808 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-08 03:04:59.809 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-08 03:04:59.811 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 3.0
2025-02-08 03:04:59.812 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-08 03:04:59.815 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 3.0
2025-02-08 03:04:59.817 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-08 03:04:59.818 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-08 03:04:59.818 DEBUG [src.node.waku_node] Stopping container with id 791d4c39a8e2
2025-02-08 03:05:00.356 DEBUG [src.node.waku_node] Container stopped.
2025-02-08 03:05:00.356 DEBUG [src.node.waku_node] Stopping container with id dc0fb5a9785b
2025-02-08 03:05:00.838 DEBUG [src.node.waku_node] Container stopped.
2025-02-08 03:05:00.841 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-08 03:05:00.847 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-08 03:05:00.850 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
