2025-02-11 15:07:06.525 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-11 15:07:06.525 DEBUG [tests.conftest] Running test: test_publish_with_invalid_meta with id: 2025-02-11_15-07-06__65d99d55-7909-4e0f-bbe0-485a672d9372
2025-02-11 15:07:06.525 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-11 15:07:06.526 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-11 15:07:06.526 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-11 15:07:06.533 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-11 15:07:06.534 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-11_15-07-06__65d99d55-7909-4e0f-bbe0-485a672d9372__wakuorg_nwaku:latest.log
2025-02-11 15:07:06.534 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 15:07:06.534 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 15:07:06.535 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 15:07:06.536 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.220.190
2025-02-11 15:07:06.536 DEBUG [src.node.docker_mananger] Generated ports ['58156', '58157', '58158', '58159', '58160']
2025-02-11 15:07:06.536 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 15:07:06.536 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 15:07:06.536 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 15:07:06.536 DEBUG [src.node.docker_mananger] docker run -i -t -p 58156:58156 -p 58157:58157 -p 58158:58158 -p 58159:58159 -p 58160:58160 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=58158 --rest-port=58156 --tcp-port=58157 --discv5-udp-port=58159 --rest-address=0.0.0.0 --nat=extip:172.18.220.190 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=f3d2d0ce7e509fcb25e9d88ecefeeae2931bcff3f4df4545bcd0d3ed5cb3ef41 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=58160 --metrics-logging=true --relay=true
2025-02-11 15:07:06.787 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.220.190 waku f6377a45cb784e1a3e4e6f5fd8d0f6e9d8f6d14c2aceb724a388e7df9221922b
2025-02-11 15:07:06.837 DEBUG [src.node.docker_mananger] Container started with ID f6377a45cb78. Setting up logs at ./log/docker/node1_2025-02-11_15-07-06__65d99d55-7909-4e0f-bbe0-485a672d9372__wakuorg_nwaku:latest.log
2025-02-11 15:07:06.837 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 58156
2025-02-11 15:07:06.837 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 15:07:07.318 ERROR [src.node.docker_mananger] Max retries reached for container b19be9438947. Exiting log stream.
2025-02-11 15:07:07.838 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58156/health" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:07:07.841 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-11 15:07:07.841 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-11 15:07:07.841 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58156/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:07:07.844 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.220.190/tcp/58157/p2p/16Uiu2HAmUWVkXSQ7L9XB1Q4Ua7QYRhevrq7hrLBzegeDUfXFHyKN","/ip4/172.18.220.190/tcp/58158/ws/p2p/16Uiu2HAmUWVkXSQ7L9XB1Q4Ua7QYRhevrq7hrLBzegeDUfXFHyKN"],"enrUri":"enr:-L24QOeULHV8r-AvyruuxxKhJ1mculQhq6GOIUSgCpSIA4Q0EFuoDdDwQ7qAUiiw8qagIcNSb6MeaJBM1vhOf_l0C18CgmlkgnY0gmlwhKwS3L6KbXVsdGlhZGRyc5YACASsEty-BuMtAAoErBLcvgbjLt0DgnJzhQADAQAAiXNlY3AyNTZrMaED644BxazGsYd2fbt421zVHF2VsMjlSVlV_bKtGw_f8SmDdGNwguMtg3VkcILjL4V3YWt1MgE"}'
2025-02-11 15:07:07.844 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 15:07:07.850 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-11 15:07:07.851 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-11_15-07-06__65d99d55-7909-4e0f-bbe0-485a672d9372__wakuorg_nwaku:latest.log
2025-02-11 15:07:07.851 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 15:07:07.851 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 15:07:07.852 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 15:07:07.853 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.208.214
2025-02-11 15:07:07.853 DEBUG [src.node.docker_mananger] Generated ports ['13007', '13008', '13009', '13010', '13011']
2025-02-11 15:07:07.853 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 15:07:07.853 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 15:07:07.853 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 15:07:07.853 DEBUG [src.node.docker_mananger] docker run -i -t -p 13007:13007 -p 13008:13008 -p 13009:13009 -p 13010:13010 -p 13011:13011 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=13009 --rest-port=13007 --tcp-port=13008 --discv5-udp-port=13010 --rest-address=0.0.0.0 --nat=extip:172.18.208.214 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=ff2aa3eafde95070e93bf48ea4ac98d9c9d8723d6f0e8ec5edfd3fcb3976bee2 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=13011 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QOeULHV8r-AvyruuxxKhJ1mculQhq6GOIUSgCpSIA4Q0EFuoDdDwQ7qAUiiw8qagIcNSb6MeaJBM1vhOf_l0C18CgmlkgnY0gmlwhKwS3L6KbXVsdGlhZGRyc5YACASsEty-BuMtAAoErBLcvgbjLt0DgnJzhQADAQAAiXNlY3AyNTZrMaED644BxazGsYd2fbt421zVHF2VsMjlSVlV_bKtGw_f8SmDdGNwguMtg3VkcILjL4V3YWt1MgE
2025-02-11 15:07:08.090 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.208.214 waku 4751ae8f58d63e8d765e11c2c98c3f2dda9a90d5943815cef064b76e93e45a6d
2025-02-11 15:07:08.135 DEBUG [src.node.docker_mananger] Container started with ID 4751ae8f58d6. Setting up logs at ./log/docker/node2_2025-02-11_15-07-06__65d99d55-7909-4e0f-bbe0-485a672d9372__wakuorg_nwaku:latest.log
2025-02-11 15:07:08.136 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 13007
2025-02-11 15:07:08.136 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 15:07:09.136 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:13007/health" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:07:09.146 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-11 15:07:09.148 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-11 15:07:09.149 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:13007/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:07:09.153 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.208.214/tcp/13008/p2p/16Uiu2HAkzE4iU2XUPqP3JZUWeu1e1qgb9n9es98cgFZo3iXYt89J","/ip4/172.18.208.214/tcp/13009/ws/p2p/16Uiu2HAkzE4iU2XUPqP3JZUWeu1e1qgb9n9es98cgFZo3iXYt89J"],"enrUri":"enr:-L24QEf3gL6b3WFBan4VUTX2GMyEpjM3O-TKyPnqMj8lpsCIfEI63J02nBG2pF2-EOgKvM5PA0xJ12sJNJpD2bEndv4CgmlkgnY0gmlwhKwS0NaKbXVsdGlhZGRyc5YACASsEtDWBjLQAAoErBLQ1gYy0d0DgnJzhQADAQAAiXNlY3AyNTZrMaECR1EsHLITOhQ9hLUMGNFhi5HN4xACfXkaTZsVOBzbtMWDdGNwgjLQg3VkcIIy0oV3YWt1MgE"}'
2025-02-11 15:07:09.154 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 15:07:09.154 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:13007/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.220.190/tcp/58157/p2p/16Uiu2HAmUWVkXSQ7L9XB1Q4Ua7QYRhevrq7hrLBzegeDUfXFHyKN"]'
2025-02-11 15:07:09.157 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:07:09.158 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-11 15:07:09.158 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:58156/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 15:07:09.162 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:07:09.162 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:13007/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 15:07:09.167 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:07:09.168 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:58156/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 15:07:09.174 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:07:09.174 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-11 15:07:09.274 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-11 15:07:09.275 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58156/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:07:09.277 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739286429168690944,"ephemeral":false}]'
2025-02-11 15:07:09.279 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-11 15:07:09.279 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:13007/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:07:09.282 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739286429168690944,"ephemeral":false}]'
2025-02-11 15:07:09.283 INFO [src.steps.relay] WARM UP successful!!
2025-02-11 15:07:09.284 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:58156/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)', "meta": "Relay works!!"}'
2025-02-11 15:07:09.287 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:58156/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Incorrect base64 string'
2025-02-11 15:07:09.289 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-11 15:07:09.290 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-11 15:07:09.290 DEBUG [src.node.waku_node] Stopping container with id f6377a45cb78
2025-02-11 15:07:10.321 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 15:07:10.322 DEBUG [src.node.waku_node] Stopping container with id 4751ae8f58d6
2025-02-11 15:07:11.137 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 15:07:11.139 ERROR [src.node.docker_mananger] Max retries reached for container f6377a45cb78. Exiting log stream.
2025-02-11 15:07:11.140 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-11 15:07:11.145 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-11 15:07:11.150 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
