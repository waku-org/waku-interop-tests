2025-02-11 15:07:20.867 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-11 15:07:20.868 DEBUG [tests.conftest] Running test: test_publish_with_payload_equal_or_more_150_kb with id: 2025-02-11_15-07-20__f9fd3b13-cf5c-45b6-8b25-cf68382a0bf6
2025-02-11 15:07:20.868 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-11 15:07:20.868 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-11 15:07:20.869 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-11 15:07:20.875 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-11 15:07:20.875 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-11_15-07-20__f9fd3b13-cf5c-45b6-8b25-cf68382a0bf6__wakuorg_nwaku:latest.log
2025-02-11 15:07:20.875 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 15:07:20.875 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 15:07:20.876 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 15:07:20.877 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.147.177
2025-02-11 15:07:20.877 DEBUG [src.node.docker_mananger] Generated ports ['17791', '17792', '17793', '17794', '17795']
2025-02-11 15:07:20.877 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 15:07:20.877 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 15:07:20.877 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 15:07:20.877 DEBUG [src.node.docker_mananger] docker run -i -t -p 17791:17791 -p 17792:17792 -p 17793:17793 -p 17794:17794 -p 17795:17795 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=17793 --rest-port=17791 --tcp-port=17792 --discv5-udp-port=17794 --rest-address=0.0.0.0 --nat=extip:172.18.147.177 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=d5bfddb8de29ccdaa28c76fa0ae5feec4dd47bdc41a1b3fd0dcff9edadeacae3 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=17795 --metrics-logging=true --relay=true
2025-02-11 15:07:21.100 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.147.177 waku d3e37c064868bb82f3ce8903d5974c0a93d3777cf71eea846d3fc30240d86f4a
2025-02-11 15:07:21.149 DEBUG [src.node.docker_mananger] Container started with ID d3e37c064868. Setting up logs at ./log/docker/node1_2025-02-11_15-07-20__f9fd3b13-cf5c-45b6-8b25-cf68382a0bf6__wakuorg_nwaku:latest.log
2025-02-11 15:07:21.150 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 17791
2025-02-11 15:07:21.151 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 15:07:21.674 ERROR [src.node.docker_mananger] Max retries reached for container 45840fb10a26. Exiting log stream.
2025-02-11 15:07:22.151 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:17791/health" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:07:22.154 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-11 15:07:22.154 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-11 15:07:22.154 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:17791/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:07:22.156 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.147.177/tcp/17792/p2p/16Uiu2HAmDcyWBJbf5g2F2yBBamtYD5gmFM9FoaKuh3hKW7q3GX1A","/ip4/172.18.147.177/tcp/17793/ws/p2p/16Uiu2HAmDcyWBJbf5g2F2yBBamtYD5gmFM9FoaKuh3hKW7q3GX1A"],"enrUri":"enr:-L24QLjw6IlaWFk_fwrc2b2U8K4B0gcQNXtrmPnVQsf8JuFQHGs3UHlp5CcPno6jIcZEsrngHgpDzlfuNWhANgvDINYCgmlkgnY0gmlwhKwSk7GKbXVsdGlhZGRyc5YACASsEpOxBkWAAAoErBKTsQZFgd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDDleRYQPxcID2x-qlzjzqVFXOJqwXnoG2NylEDKgRermDdGNwgkWAg3VkcIJFgoV3YWt1MgE"}'
2025-02-11 15:07:22.156 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 15:07:22.162 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-11 15:07:22.162 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-11_15-07-20__f9fd3b13-cf5c-45b6-8b25-cf68382a0bf6__wakuorg_nwaku:latest.log
2025-02-11 15:07:22.163 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 15:07:22.163 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 15:07:22.164 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 15:07:22.164 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.18.221
2025-02-11 15:07:22.164 DEBUG [src.node.docker_mananger] Generated ports ['15445', '15446', '15447', '15448', '15449']
2025-02-11 15:07:22.164 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 15:07:22.165 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 15:07:22.165 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 15:07:22.165 DEBUG [src.node.docker_mananger] docker run -i -t -p 15445:15445 -p 15446:15446 -p 15447:15447 -p 15448:15448 -p 15449:15449 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=15447 --rest-port=15445 --tcp-port=15446 --discv5-udp-port=15448 --rest-address=0.0.0.0 --nat=extip:172.18.18.221 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=d9fcb312ff753ef2e4d6befb8e0c6a2f5ba563ca5250c63f18a9b40c875e0ff0 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=15449 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QLjw6IlaWFk_fwrc2b2U8K4B0gcQNXtrmPnVQsf8JuFQHGs3UHlp5CcPno6jIcZEsrngHgpDzlfuNWhANgvDINYCgmlkgnY0gmlwhKwSk7GKbXVsdGlhZGRyc5YACASsEpOxBkWAAAoErBKTsQZFgd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDDleRYQPxcID2x-qlzjzqVFXOJqwXnoG2NylEDKgRermDdGNwgkWAg3VkcIJFgoV3YWt1MgE
2025-02-11 15:07:22.396 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.18.221 waku 2a61eb4f7d35723dbb1a20915ef98475a6d4c72ba660f414cbf654fc73df62a7
2025-02-11 15:07:22.445 DEBUG [src.node.docker_mananger] Container started with ID 2a61eb4f7d35. Setting up logs at ./log/docker/node2_2025-02-11_15-07-20__f9fd3b13-cf5c-45b6-8b25-cf68382a0bf6__wakuorg_nwaku:latest.log
2025-02-11 15:07:22.445 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 15445
2025-02-11 15:07:22.445 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 15:07:23.445 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15445/health" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:07:23.451 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-11 15:07:23.451 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-11 15:07:23.452 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15445/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:07:23.458 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.18.221/tcp/15446/p2p/16Uiu2HAmLVLTyk6gSvfcaXgU3xYNMzekq8Cw2fVFYjNxqpG9VXji","/ip4/172.18.18.221/tcp/15447/ws/p2p/16Uiu2HAmLVLTyk6gSvfcaXgU3xYNMzekq8Cw2fVFYjNxqpG9VXji"],"enrUri":"enr:-L24QHDpFClPeI9Ux3oB9gdp-edXqYkTNVK-N-edPrkRgr26VrzsaYFi75bRt03UYuFBO9aCCr4vaRH5AKFCZx0Bw8cCgmlkgnY0gmlwhKwSEt2KbXVsdGlhZGRyc5YACASsEhLdBjxWAAoErBIS3QY8V90DgnJzhQADAQAAiXNlY3AyNTZrMaEDdGRuilyD7zlL-8UcZzNjTyyDuoeVL4TioV8PCDaFM-WDdGNwgjxWg3VkcII8WIV3YWt1MgE"}'
2025-02-11 15:07:23.458 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 15:07:23.459 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:15445/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.147.177/tcp/17792/p2p/16Uiu2HAmDcyWBJbf5g2F2yBBamtYD5gmFM9FoaKuh3hKW7q3GX1A"]'
2025-02-11 15:07:23.462 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:07:23.463 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-11 15:07:23.463 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:17791/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 15:07:23.467 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:07:23.468 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:15445/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 15:07:23.473 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:07:23.474 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:17791/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 15:07:23.480 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:07:23.481 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-11 15:07:23.581 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-11 15:07:23.582 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:17791/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:07:23.584 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739286443474013696,"ephemeral":false}]'
2025-02-11 15:07:23.586 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-11 15:07:23.586 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15445/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:07:23.588 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739286443474013696,"ephemeral":false}]'
2025-02-11 15:07:23.590 INFO [src.steps.relay] WARM UP successful!!
2025-02-11 15:07:23.590 DEBUG [tests.relay.test_publish] Running test with payload length of 204800 bytes
2025-02-11 15:07:23.594 INFO [src.node.api_clients.base_client] Log line was discarded because it's longer than max_log_line_length=5000
2025-02-11 15:07:23.612 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:17791/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Failed to publish: Message size exceeded maximum of 153600 bytes'
2025-02-11 15:07:23.613 DEBUG [tests.relay.test_publish] Running test with payload length of 1048576 bytes
2025-02-11 15:07:23.632 INFO [src.node.api_clients.base_client] Log line was discarded because it's longer than max_log_line_length=5000
2025-02-11 15:07:23.698 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:17791/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Failed to publish: Message size exceeded maximum of 153600 bytes'
2025-02-11 15:07:23.699 DEBUG [tests.relay.test_publish] Running test with payload length of 10485760 bytes
2025-02-11 15:07:23.838 INFO [src.node.api_clients.base_client] Log line was discarded because it's longer than max_log_line_length=5000
2025-02-11 15:07:24.411 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:17791/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Failed to publish: Message size exceeded maximum of 153600 bytes'
2025-02-11 15:07:24.414 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-11 15:07:24.415 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-11 15:07:24.415 DEBUG [src.node.waku_node] Stopping container with id d3e37c064868
2025-02-11 15:07:25.645 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 15:07:25.645 DEBUG [src.node.waku_node] Stopping container with id 2a61eb4f7d35
2025-02-11 15:07:26.458 ERROR [src.node.docker_mananger] Max retries reached for container d3e37c064868. Exiting log stream.
2025-02-11 15:07:27.145 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 15:07:27.147 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-11 15:07:27.152 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-11 15:07:27.157 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
