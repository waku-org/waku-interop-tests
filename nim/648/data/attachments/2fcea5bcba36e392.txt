2025-02-11 15:03:44.095 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-11 15:03:44.095 DEBUG [tests.conftest] Running test: test_relay_resubscribe_to_unsubscribed_pubsub_topic with id: 2025-02-11_15-03-44__fa68eef3-541b-4379-b6d0-26e1180e6f38
2025-02-11 15:03:44.096 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-11 15:03:44.096 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-11 15:03:44.096 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-11 15:03:44.102 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-11 15:03:44.102 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-11_15-03-44__fa68eef3-541b-4379-b6d0-26e1180e6f38__wakuorg_nwaku:latest.log
2025-02-11 15:03:44.103 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 15:03:44.103 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 15:03:44.104 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 15:03:44.104 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.212.152
2025-02-11 15:03:44.104 DEBUG [src.node.docker_mananger] Generated ports ['7499', '7500', '7501', '7502', '7503']
2025-02-11 15:03:44.104 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 15:03:44.105 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 15:03:44.105 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 15:03:44.105 DEBUG [src.node.docker_mananger] docker run -i -t -p 7499:7499 -p 7500:7500 -p 7501:7501 -p 7502:7502 -p 7503:7503 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=7501 --rest-port=7499 --tcp-port=7500 --discv5-udp-port=7502 --rest-address=0.0.0.0 --nat=extip:172.18.212.152 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=e231bf19bdca1cd9ffef4d48adaaf7f55ef9cb76cecd93e15ec82ae2ccfa0ce7 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=7503 --metrics-logging=true --relay=true
2025-02-11 15:03:44.329 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.212.152 waku cf3046b8b748e0267a7d9fb6878427678a7c482537db830ecb5932543755f31d
2025-02-11 15:03:44.379 DEBUG [src.node.docker_mananger] Container started with ID cf3046b8b748. Setting up logs at ./log/docker/node1_2025-02-11_15-03-44__fa68eef3-541b-4379-b6d0-26e1180e6f38__wakuorg_nwaku:latest.log
2025-02-11 15:03:44.380 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 7499
2025-02-11 15:03:44.380 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 15:03:44.901 ERROR [src.node.docker_mananger] Max retries reached for container a99c4e60ba68. Exiting log stream.
2025-02-11 15:03:45.381 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:7499/health" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:03:45.383 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-11 15:03:45.384 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-11 15:03:45.384 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:7499/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:03:45.386 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.212.152/tcp/7500/p2p/16Uiu2HAmUVaod8vdKGQwVwCTnDi65jrKXnntN8TNQzv7JSRnUFff","/ip4/172.18.212.152/tcp/7501/ws/p2p/16Uiu2HAmUVaod8vdKGQwVwCTnDi65jrKXnntN8TNQzv7JSRnUFff"],"enrUri":"enr:-L24QOSjajNJskUir7LCYBWGNwB4HUJsYGW8CQDGjYHJSwSaeeGDACB9vlCH7t5-x8iaXb8wzGa1SiHG8ueLWazxBS8CgmlkgnY0gmlwhKwS1JiKbXVsdGlhZGRyc5YACASsEtSYBh1MAAoErBLUmAYdTd0DgnJzhQADAQAAiXNlY3AyNTZrMaED61Ij2RxYZJ1GJnFobBC1Ist8DKxFC5W8A3UqbKkOmIKDdGNwgh1Mg3VkcIIdToV3YWt1MgE"}'
2025-02-11 15:03:45.386 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 15:03:45.392 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-11 15:03:45.392 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-11_15-03-44__fa68eef3-541b-4379-b6d0-26e1180e6f38__wakuorg_nwaku:latest.log
2025-02-11 15:03:45.392 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 15:03:45.393 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 15:03:45.394 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 15:03:45.394 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.50.85
2025-02-11 15:03:45.394 DEBUG [src.node.docker_mananger] Generated ports ['18109', '18110', '18111', '18112', '18113']
2025-02-11 15:03:45.394 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 15:03:45.395 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 15:03:45.395 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 15:03:45.395 DEBUG [src.node.docker_mananger] docker run -i -t -p 18109:18109 -p 18110:18110 -p 18111:18111 -p 18112:18112 -p 18113:18113 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=18111 --rest-port=18109 --tcp-port=18110 --discv5-udp-port=18112 --rest-address=0.0.0.0 --nat=extip:172.18.50.85 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=bfc8deedcd1347eec3f8c4ad73ffceca7fd6ff4e2a2f58a3b315d3660f6a0e66 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=18113 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QOSjajNJskUir7LCYBWGNwB4HUJsYGW8CQDGjYHJSwSaeeGDACB9vlCH7t5-x8iaXb8wzGa1SiHG8ueLWazxBS8CgmlkgnY0gmlwhKwS1JiKbXVsdGlhZGRyc5YACASsEtSYBh1MAAoErBLUmAYdTd0DgnJzhQADAQAAiXNlY3AyNTZrMaED61Ij2RxYZJ1GJnFobBC1Ist8DKxFC5W8A3UqbKkOmIKDdGNwgh1Mg3VkcIIdToV3YWt1MgE
2025-02-11 15:03:45.626 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.50.85 waku d249e2fb3adcb538ba731c97d9ef0bd71eef9d1d4876c5dddc6b26f02031635a
2025-02-11 15:03:45.675 DEBUG [src.node.docker_mananger] Container started with ID d249e2fb3adc. Setting up logs at ./log/docker/node2_2025-02-11_15-03-44__fa68eef3-541b-4379-b6d0-26e1180e6f38__wakuorg_nwaku:latest.log
2025-02-11 15:03:45.675 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 18109
2025-02-11 15:03:45.676 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 15:03:46.678 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:18109/health" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:03:46.682 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-11 15:03:46.683 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-11 15:03:46.684 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:18109/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:03:46.686 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.50.85/tcp/18110/p2p/16Uiu2HAmPvaAzPngj9KPAeARY5yyJ1SLcjTrt39BvNi5oWAdFmFZ","/ip4/172.18.50.85/tcp/18111/ws/p2p/16Uiu2HAmPvaAzPngj9KPAeARY5yyJ1SLcjTrt39BvNi5oWAdFmFZ"],"enrUri":"enr:-L24QOjtBn1CgKmwlrXdMw3RCi4LZrn19SO0NVcjScLtONigDrq5iiidVOPrEpbYGv_-fbZgOB-OuKTkH5_w7uD-nMQCgmlkgnY0gmlwhKwSMlWKbXVsdGlhZGRyc5YACASsEjJVBka-AAoErBIyVQZGv90DgnJzhQADAQAAiXNlY3AyNTZrMaEDp26C7xHsxx4_l3L2C2xda4SQvIHDYENDCDbHhLEIjsyDdGNwgka-g3VkcIJGwIV3YWt1MgE"}'
2025-02-11 15:03:46.686 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 15:03:46.687 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:18109/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.212.152/tcp/7500/p2p/16Uiu2HAmUVaod8vdKGQwVwCTnDi65jrKXnntN8TNQzv7JSRnUFff"]'
2025-02-11 15:03:46.689 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:03:46.691 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7499/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 15:03:46.695 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:03:46.695 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:18109/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 15:03:46.699 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:03:46.701 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7499/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 15:03:46.708 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:03:46.708 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-11 15:03:46.809 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-11 15:03:46.809 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:7499/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:03:46.811 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739286226700512000,"ephemeral":false}]'
2025-02-11 15:03:46.813 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-11 15:03:46.813 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:18109/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:03:46.815 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739286226700512000,"ephemeral":false}]'
2025-02-11 15:03:46.816 INFO [src.node.api_clients.base_client] curl -v -X DELETE "http://127.0.0.1:7499/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 15:03:46.820 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:03:46.821 INFO [src.node.api_clients.base_client] curl -v -X DELETE "http://127.0.0.1:18109/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 15:03:46.825 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:03:46.826 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7499/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 15:03:46.829 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:7499/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Failed to publish: Node not subscribed to topic: /waku/2/rs/3/1'
2025-02-11 15:03:46.829 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7499/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 15:03:46.833 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:03:46.833 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:18109/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 15:03:46.837 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:03:46.838 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7499/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 15:03:46.843 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 15:03:46.844 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-11 15:03:46.944 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-11 15:03:46.944 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:7499/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:03:46.946 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739286226838647552,"ephemeral":false}]'
2025-02-11 15:03:46.947 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-11 15:03:46.948 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:18109/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 15:03:46.950 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739286226838647552,"ephemeral":false}]'
2025-02-11 15:03:46.952 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-11 15:03:46.953 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-11 15:03:46.954 DEBUG [src.node.waku_node] Stopping container with id cf3046b8b748
2025-02-11 15:03:47.880 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 15:03:47.881 DEBUG [src.node.waku_node] Stopping container with id d249e2fb3adc
2025-02-11 15:03:48.709 ERROR [src.node.docker_mananger] Max retries reached for container cf3046b8b748. Exiting log stream.
2025-02-11 15:03:49.023 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 15:03:49.024 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-11 15:03:49.036 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-11 15:03:49.042 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
