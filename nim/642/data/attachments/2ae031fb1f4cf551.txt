2025-02-06 04:03:52.845 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-06 04:03:52.845 DEBUG [tests.conftest] Running test: test_metrics_after_store_get with id: 2025-02-06_04-03-52__b63f6940-c74d-4cc0-9288-f96fa4463ef9
2025-02-06 04:03:52.845 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-06 04:03:52.846 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-06 04:03:52.846 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-06 04:03:52.846 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-06 04:03:52.846 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-06 04:03:52.847 DEBUG [src.steps.store] Running fixture setup: node_setup
2025-02-06 04:03:52.853 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-06 04:03:52.853 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/publishing_node1_2025-02-06_04-03-52__b63f6940-c74d-4cc0-9288-f96fa4463ef9__wakuorg_nwaku:latest.log
2025-02-06 04:03:52.853 DEBUG [src.node.waku_node] Starting Node...
2025-02-06 04:03:52.854 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-06 04:03:52.855 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-06 04:03:52.855 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.144.43
2025-02-06 04:03:52.855 DEBUG [src.node.docker_mananger] Generated ports ['45681', '45682', '45683', '45684', '45685']
2025-02-06 04:03:52.855 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-06 04:03:52.855 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-06 04:03:52.856 DEBUG [src.node.waku_node] Using volumes []
2025-02-06 04:03:52.856 DEBUG [src.node.docker_mananger] docker run -i -t -p 45681:45681 -p 45682:45682 -p 45683:45683 -p 45684:45684 -p 45685:45685 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=45683 --rest-port=45681 --tcp-port=45682 --discv5-udp-port=45684 --rest-address=0.0.0.0 --nat=extip:172.18.144.43 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=fbbfcf9fd3f37e1c9f150ff97b5d71cf8ad7bc67ef9ddf31bc1c64705275fb0c --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=45685 --metrics-logging=true --store=true --relay=true
2025-02-06 04:03:53.089 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.144.43 waku f274ca0f24c197a907019a01daa677ea7894116fd2fd1977a3f8ae2e74c08fa2
2025-02-06 04:03:53.139 DEBUG [src.node.docker_mananger] Container started with ID f274ca0f24c1. Setting up logs at ./log/docker/publishing_node1_2025-02-06_04-03-52__b63f6940-c74d-4cc0-9288-f96fa4463ef9__wakuorg_nwaku:latest.log
2025-02-06 04:03:53.139 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 45681
2025-02-06 04:03:53.140 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-06 04:03:53.638 ERROR [src.node.docker_mananger] Max retries reached for container 5901942fcfca. Exiting log stream.
2025-02-06 04:03:54.141 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:45681/health" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:03:54.144 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-06 04:03:54.145 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-06 04:03:54.145 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:45681/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:03:54.147 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.144.43/tcp/45682/p2p/16Uiu2HAmApJfRsmwQzJ5bsPjERhwMoFtyYgrwcWQziHKBWydaE5q","/ip4/172.18.144.43/tcp/45683/ws/p2p/16Uiu2HAmApJfRsmwQzJ5bsPjERhwMoFtyYgrwcWQziHKBWydaE5q"],"enrUri":"enr:-L24QCs02JmVaCzjH2aM8CzqzavtBskbQ_kUcenRGBtVqgdSCHQll2cL3k67g8rhLpZw4w6_IXlxNye-sCoc8ebHDXgCgmlkgnY0gmlwhKwSkCuKbXVsdGlhZGRyc5YACASsEpArBrJyAAoErBKQKwayc90DgnJzhQADAQAAiXNlY3AyNTZrMaEC5KuPSlHuyTjUw5DoHIGzTlPopHFX42ZSj9SIM9vyaJSDdGNwgrJyg3VkcIKydIV3YWt1MgM"}'
2025-02-06 04:03:54.148 INFO [src.node.waku_node] REST service is ready !!
2025-02-06 04:03:54.154 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-06 04:03:54.154 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/store_node1_2025-02-06_04-03-52__b63f6940-c74d-4cc0-9288-f96fa4463ef9__wakuorg_nwaku:latest.log
2025-02-06 04:03:54.154 DEBUG [src.node.waku_node] Starting Node...
2025-02-06 04:03:54.155 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-06 04:03:54.156 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-06 04:03:54.156 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.231.209
2025-02-06 04:03:54.156 DEBUG [src.node.docker_mananger] Generated ports ['29571', '29572', '29573', '29574', '29575']
2025-02-06 04:03:54.156 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-06 04:03:54.156 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-06 04:03:54.157 DEBUG [src.node.waku_node] Using volumes []
2025-02-06 04:03:54.157 DEBUG [src.node.docker_mananger] docker run -i -t -p 29571:29571 -p 29572:29572 -p 29573:29573 -p 29574:29574 -p 29575:29575 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=29573 --rest-port=29571 --tcp-port=29572 --discv5-udp-port=29574 --rest-address=0.0.0.0 --nat=extip:172.18.231.209 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=bfadb6c02fe5aa8f00aedf15e0eb45a8edb4d3bb4778bdbeeae5fca0a4498ca4 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=29575 --metrics-logging=true --discv5-bootstrap-node=enr:-L24QCs02JmVaCzjH2aM8CzqzavtBskbQ_kUcenRGBtVqgdSCHQll2cL3k67g8rhLpZw4w6_IXlxNye-sCoc8ebHDXgCgmlkgnY0gmlwhKwSkCuKbXVsdGlhZGRyc5YACASsEpArBrJyAAoErBKQKwayc90DgnJzhQADAQAAiXNlY3AyNTZrMaEC5KuPSlHuyTjUw5DoHIGzTlPopHFX42ZSj9SIM9vyaJSDdGNwgrJyg3VkcIKydIV3YWt1MgM --storenode=/ip4/172.18.144.43/tcp/45682/p2p/16Uiu2HAmApJfRsmwQzJ5bsPjERhwMoFtyYgrwcWQziHKBWydaE5q --store=true --relay=true
2025-02-06 04:03:54.387 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.231.209 waku 559084dd5597741394bac9e05ec43d9a1c4160843d41dcc23fd7ed06a01410f0
2025-02-06 04:03:54.433 DEBUG [src.node.docker_mananger] Container started with ID 559084dd5597. Setting up logs at ./log/docker/store_node1_2025-02-06_04-03-52__b63f6940-c74d-4cc0-9288-f96fa4463ef9__wakuorg_nwaku:latest.log
2025-02-06 04:03:54.434 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 29571
2025-02-06 04:03:54.434 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-06 04:03:55.435 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:29571/health" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:03:55.439 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-06 04:03:55.439 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-06 04:03:55.439 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:29571/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:03:55.441 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.231.209/tcp/29572/p2p/16Uiu2HAmN32j5tchAB8agBSNLCSidaM8bPrmddqRRm9xu76ymZwb","/ip4/172.18.231.209/tcp/29573/ws/p2p/16Uiu2HAmN32j5tchAB8agBSNLCSidaM8bPrmddqRRm9xu76ymZwb"],"enrUri":"enr:-L24QMbpWNrdLYy0y3xEuuyBgDFcmdyggyMiDNLOj8lFKaN9G_Gs2y6gX7JpvTwGDqq-knkO00dVebYl2QTHpskAgpkCgmlkgnY0gmlwhKwS59GKbXVsdGlhZGRyc5YACASsEufRBnOEAAoErBLn0QZzhd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDi16lfRfAKSRL6a3k80zgGoLd4JdbV0PGOaQM7QL69d6DdGNwgnOEg3VkcIJzhoV3YWt1MgM"}'
2025-02-06 04:03:55.441 INFO [src.node.waku_node] REST service is ready !!
2025-02-06 04:03:55.442 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:29571/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.144.43/tcp/45682/p2p/16Uiu2HAmApJfRsmwQzJ5bsPjERhwMoFtyYgrwcWQziHKBWydaE5q"]'
2025-02-06 04:03:55.444 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 04:03:55.445 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:45681/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-06 04:03:55.449 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 04:03:55.449 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:29571/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-06 04:03:55.454 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 04:03:55.457 DEBUG [src.steps.store] Relaying message
2025-02-06 04:03:55.458 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:45681/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-06 04:03:55.463 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 04:03:55.464 DEBUG [src.libs.common] Sleeping for 0.2 seconds
2025-02-06 04:03:55.664 DEBUG [src.steps.store] Checking that peer wakuorg/nwaku:latest can find the stored messages
2025-02-06 04:03:55.665 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:45681/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F1&pageSize=50&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:03:55.668 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"","statusCode":200,"statusDesc":"OK","messages":[{"messageHash":"0x317f35bb621463bc18d7daecd2b51a70ad3642a24a96087c4bc11b64be72cfbf"}]}'
2025-02-06 04:03:55.669 DEBUG [src.steps.store] Checking that peer wakuorg/nwaku:latest can find the stored messages
2025-02-06 04:03:55.669 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:29571/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F1&pageSize=50&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:03:55.672 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"","statusCode":200,"statusDesc":"OK","messages":[{"messageHash":"0x317f35bb621463bc18d7daecd2b51a70ad3642a24a96087c4bc11b64be72cfbf"}]}'
2025-02-06 04:03:55.672 DEBUG [src.libs.common] Sleeping for 5 seconds
2025-02-06 04:04:00.673 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-06 04:04:00.677 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-06 04:04:00.677 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-06 04:04:00.680 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-06 04:04:00.681 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-06 04:04:00.683 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-06 04:04:00.684 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-06 04:04:00.686 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-06 04:04:00.687 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-06 04:04:00.690 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-06 04:04:00.690 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-06 04:04:00.693 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 1.0
2025-02-06 04:04:00.693 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-06 04:04:00.696 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 1.0
2025-02-06 04:04:00.696 DEBUG [src.steps.metrics] Checking metric: waku_service_peers{protocol="/vac/waku/store/2.0.0-beta4",peerId="/ip4/172.18.144.43/tcp/45682"} has 1
2025-02-06 04:04:00.700 DEBUG [src.steps.metrics] Found metric: waku_service_peers{protocol="/vac/waku/store/2.0.0-beta4",peerId="/ip4/172.18.144.43/tcp/45682"} with value 1.0
2025-02-06 04:04:00.700 DEBUG [src.steps.metrics] Checking metric: waku_service_peers{protocol="/vac/waku/store-query/3.0.0",peerId="/ip4/172.18.144.43/tcp/45682"} has 1
2025-02-06 04:04:00.703 DEBUG [src.steps.metrics] Found metric: waku_service_peers{protocol="/vac/waku/store-query/3.0.0",peerId="/ip4/172.18.144.43/tcp/45682"} with value 1.0
2025-02-06 04:04:00.703 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-06 04:04:00.706 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-06 04:04:00.706 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-06 04:04:00.709 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-06 04:04:00.709 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-06 04:04:00.712 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-06 04:04:00.713 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-06 04:04:00.716 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-06 04:04:00.716 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-06 04:04:00.719 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-06 04:04:00.719 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-06 04:04:00.722 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 1.0
2025-02-06 04:04:00.723 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-06 04:04:00.725 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 1.0
2025-02-06 04:04:00.728 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-06 04:04:00.728 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-06 04:04:00.729 DEBUG [src.node.waku_node] Stopping container with id f274ca0f24c1
2025-02-06 04:04:01.958 DEBUG [src.node.waku_node] Container stopped.
2025-02-06 04:04:01.958 DEBUG [src.node.waku_node] Stopping container with id 559084dd5597
2025-02-06 04:04:02.772 ERROR [src.node.docker_mananger] Max retries reached for container f274ca0f24c1. Exiting log stream.
2025-02-06 04:04:03.289 DEBUG [src.node.waku_node] Container stopped.
2025-02-06 04:04:03.290 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-06 04:04:03.296 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-06 04:04:03.302 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
