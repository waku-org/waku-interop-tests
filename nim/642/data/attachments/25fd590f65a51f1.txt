2025-02-06 04:05:40.782 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-06 04:05:40.782 DEBUG [tests.conftest] Running test: test_node_uses_both_auto_and_regular_apis with id: 2025-02-06_04-05-40__6370f23e-0e77-45ca-89d4-3641786aa12e
2025-02-06 04:05:40.782 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-06 04:05:40.783 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-06 04:05:40.783 DEBUG [src.steps.sharding] Running fixture setup: sharding_setup
2025-02-06 04:05:40.789 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-06 04:05:40.789 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-06_04-05-40__6370f23e-0e77-45ca-89d4-3641786aa12e__wakuorg_nwaku:latest.log
2025-02-06 04:05:40.789 DEBUG [src.node.waku_node] Starting Node...
2025-02-06 04:05:40.790 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-06 04:05:40.791 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-06 04:05:40.791 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.138.51
2025-02-06 04:05:40.791 DEBUG [src.node.docker_mananger] Generated ports ['15205', '15206', '15207', '15208', '15209']
2025-02-06 04:05:40.792 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-06 04:05:40.792 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-06 04:05:40.792 DEBUG [src.node.waku_node] Using volumes []
2025-02-06 04:05:40.792 DEBUG [src.node.docker_mananger] docker run -i -t -p 15205:15205 -p 15206:15206 -p 15207:15207 -p 15208:15208 -p 15209:15209 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=15207 --rest-port=15205 --tcp-port=15206 --discv5-udp-port=15208 --rest-address=0.0.0.0 --nat=extip:172.18.138.51 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=d0225eececc21e46ffd771b59b9ef4eb61bbe1e25e66ec37bce87463c8fb6beb --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=15209 --metrics-logging=true --relay=true --filter=true --pubsub-topic=/waku/2/rs/2/0
2025-02-06 04:05:41.013 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.138.51 waku e9e106ac30c8c943b3b936c3c5fdddbf7a83616c9cccef39b1d8e8706149fa0a
2025-02-06 04:05:41.058 DEBUG [src.node.docker_mananger] Container started with ID e9e106ac30c8. Setting up logs at ./log/docker/node1_2025-02-06_04-05-40__6370f23e-0e77-45ca-89d4-3641786aa12e__wakuorg_nwaku:latest.log
2025-02-06 04:05:41.059 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 15205
2025-02-06 04:05:41.060 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-06 04:05:41.588 ERROR [src.node.docker_mananger] Max retries reached for container 82e27215e8c6. Exiting log stream.
2025-02-06 04:05:42.060 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15205/health" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:05:42.063 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-06 04:05:42.063 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-06 04:05:42.063 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15205/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:05:42.066 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.138.51/tcp/15206/p2p/16Uiu2HAm5dwzi8zrYGz2rD766ixviMjHGjqtypzZcWht2wm4Vz9r","/ip4/172.18.138.51/tcp/15207/ws/p2p/16Uiu2HAm5dwzi8zrYGz2rD766ixviMjHGjqtypzZcWht2wm4Vz9r"],"enrUri":"enr:-L24QKKcWsp3WPLvC3LqWTTobR73skrUyTqgeQjwMk-Kmbk6MWzkHLH89RfYmMQU3kf6-_-OZ9sRfUaAGVR5w1QRTQUCgmlkgnY0gmlwhKwSijOKbXVsdGlhZGRyc5YACASsEoozBjtmAAoErBKKMwY7Z90DgnJzhQACAQAAiXNlY3AyNTZrMaECl7nytpbtDJJ3QVs8t3xUoOkf0TwN7H25WTibvH8a1RWDdGNwgjtmg3VkcII7aIV3YWt1MgU"}'
2025-02-06 04:05:42.066 INFO [src.node.waku_node] REST service is ready !!
2025-02-06 04:05:42.073 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-06 04:05:42.073 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-06_04-05-40__6370f23e-0e77-45ca-89d4-3641786aa12e__wakuorg_nwaku:latest.log
2025-02-06 04:05:42.073 DEBUG [src.node.waku_node] Starting Node...
2025-02-06 04:05:42.074 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-06 04:05:42.075 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-06 04:05:42.075 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.220.240
2025-02-06 04:05:42.075 DEBUG [src.node.docker_mananger] Generated ports ['20801', '20802', '20803', '20804', '20805']
2025-02-06 04:05:42.075 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-06 04:05:42.075 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-06 04:05:42.076 DEBUG [src.node.waku_node] Using volumes []
2025-02-06 04:05:42.076 DEBUG [src.node.docker_mananger] docker run -i -t -p 20801:20801 -p 20802:20802 -p 20803:20803 -p 20804:20804 -p 20805:20805 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=20803 --rest-port=20801 --tcp-port=20802 --discv5-udp-port=20804 --rest-address=0.0.0.0 --nat=extip:172.18.220.240 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=4bb6f5fc6a6442a7b74cbbc5f2ecfadfefd46eec0cc9cb9484dfd033bfbecb09 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=20805 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QKKcWsp3WPLvC3LqWTTobR73skrUyTqgeQjwMk-Kmbk6MWzkHLH89RfYmMQU3kf6-_-OZ9sRfUaAGVR5w1QRTQUCgmlkgnY0gmlwhKwSijOKbXVsdGlhZGRyc5YACASsEoozBjtmAAoErBKKMwY7Z90DgnJzhQACAQAAiXNlY3AyNTZrMaECl7nytpbtDJJ3QVs8t3xUoOkf0TwN7H25WTibvH8a1RWDdGNwgjtmg3VkcII7aIV3YWt1MgU --pubsub-topic=/waku/2/rs/2/0
2025-02-06 04:05:42.308 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.220.240 waku b50250d533ec2a57c07c686ef71a58083dc5d1a65ef5034a10086c3d60507fa6
2025-02-06 04:05:42.357 DEBUG [src.node.docker_mananger] Container started with ID b50250d533ec. Setting up logs at ./log/docker/node2_2025-02-06_04-05-40__6370f23e-0e77-45ca-89d4-3641786aa12e__wakuorg_nwaku:latest.log
2025-02-06 04:05:42.357 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 20801
2025-02-06 04:05:42.357 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-06 04:05:43.359 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:20801/health" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:05:43.366 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-06 04:05:43.366 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-06 04:05:43.366 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:20801/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:05:43.373 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.220.240/tcp/20802/p2p/16Uiu2HAkyEhV2w6ECweiRarhD3WcBv5p8AQTVxyZBXgJfN7R3Z5t","/ip4/172.18.220.240/tcp/20803/ws/p2p/16Uiu2HAkyEhV2w6ECweiRarhD3WcBv5p8AQTVxyZBXgJfN7R3Z5t"],"enrUri":"enr:-L24QEoOQzmwZtK9UIHUlZiruA43yiAEK8v8kMYak1HVLLUjWxquEIpuJ6DmkyLFDtamjylyQrBfRNP7Z3pVFOlJ5lcCgmlkgnY0gmlwhKwS3PCKbXVsdGlhZGRyc5YACASsEtzwBlFCAAoErBLc8AZRQ90DgnJzhQACAQAAiXNlY3AyNTZrMaECOJ8PPso7VZ98Xwxtsh0ktQIXDf8ULZey82rO2jVoVmuDdGNwglFCg3VkcIJRRIV3YWt1MgE"}'
2025-02-06 04:05:43.373 INFO [src.node.waku_node] REST service is ready !!
2025-02-06 04:05:43.374 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:20801/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.138.51/tcp/15206/p2p/16Uiu2HAm5dwzi8zrYGz2rD766ixviMjHGjqtypzZcWht2wm4Vz9r"]'
2025-02-06 04:05:43.376 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 04:05:43.377 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:15205/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2025-02-06 04:05:43.381 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 04:05:43.381 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:20801/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2025-02-06 04:05:43.387 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 04:05:43.388 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:15205/relay/v1/auto/messages" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/toychat/2/huilong/proto", "timestamp": '$(date +%s%N)'}'
2025-02-06 04:05:43.393 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 04:05:43.394 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-06 04:05:43.494 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-06 04:05:43.494 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15205/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:05:43.497 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1738814743387898112,"ephemeral":false}]'
2025-02-06 04:05:43.498 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-06 04:05:43.498 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:20801/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:05:43.500 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1738814743387898112,"ephemeral":false}]'
2025-02-06 04:05:43.502 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:15205/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2025-02-06 04:05:43.504 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 04:05:43.504 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:20801/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2025-02-06 04:05:43.506 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 04:05:43.507 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:15205/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2025-02-06 04:05:43.511 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 04:05:43.512 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-06 04:05:43.612 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-06 04:05:43.613 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15205/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:05:43.615 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1738814743506889984,"ephemeral":false}]'
2025-02-06 04:05:43.616 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-06 04:05:43.617 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:20801/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:05:43.619 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1738814743506889984,"ephemeral":false}]'
2025-02-06 04:05:43.621 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-06 04:05:43.622 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-06 04:05:43.622 DEBUG [src.node.waku_node] Stopping container with id e9e106ac30c8
2025-02-06 04:05:44.546 DEBUG [src.node.waku_node] Container stopped.
2025-02-06 04:05:44.548 DEBUG [src.node.waku_node] Stopping container with id b50250d533ec
2025-02-06 04:05:45.357 ERROR [src.node.docker_mananger] Max retries reached for container e9e106ac30c8. Exiting log stream.
2025-02-06 04:05:46.037 DEBUG [src.node.waku_node] Container stopped.
2025-02-06 04:05:46.038 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-06 04:05:46.043 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-06 04:05:46.048 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
