2025-02-06 04:06:34.242 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-06 04:06:34.242 DEBUG [tests.conftest] Running test: test_filter_get_message_with_ephemeral with id: 2025-02-06_04-06-34__bed857fd-4cf0-49f1-a51a-0682f4b6fc0b
2025-02-06 04:06:34.243 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-06 04:06:34.243 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-06 04:06:34.243 DEBUG [src.steps.filter] Running fixture setup: setup_main_relay_node
2025-02-06 04:06:34.250 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-06 04:06:34.251 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-06_04-06-34__bed857fd-4cf0-49f1-a51a-0682f4b6fc0b__wakuorg_nwaku:latest.log
2025-02-06 04:06:34.251 DEBUG [src.node.waku_node] Starting Node...
2025-02-06 04:06:34.251 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-06 04:06:34.252 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-06 04:06:34.253 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.31.5
2025-02-06 04:06:34.253 DEBUG [src.node.docker_mananger] Generated ports ['61482', '61483', '61484', '61485', '61486']
2025-02-06 04:06:34.253 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-06 04:06:34.253 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-06 04:06:34.253 DEBUG [src.node.waku_node] Using volumes []
2025-02-06 04:06:34.253 DEBUG [src.node.docker_mananger] docker run -i -t -p 61482:61482 -p 61483:61483 -p 61484:61484 -p 61485:61485 -p 61486:61486 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=61484 --rest-port=61482 --tcp-port=61483 --discv5-udp-port=61485 --rest-address=0.0.0.0 --nat=extip:172.18.31.5 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=a86be1fb3aad13d7d79fe1cbd55df7cc0ef24d27fda702c83a02c8ebc2e2d49e --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=61486 --metrics-logging=true --relay=true --filter=true
2025-02-06 04:06:34.496 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.31.5 waku c28cb3392dfd4397c631222fe430a0695a3ae579bfb37de6554f4917f42799cf
2025-02-06 04:06:34.546 DEBUG [src.node.docker_mananger] Container started with ID c28cb3392dfd. Setting up logs at ./log/docker/node1_2025-02-06_04-06-34__bed857fd-4cf0-49f1-a51a-0682f4b6fc0b__wakuorg_nwaku:latest.log
2025-02-06 04:06:34.546 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 61482
2025-02-06 04:06:34.546 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-06 04:06:34.655 ERROR [src.node.docker_mananger] Max retries reached for container 9c860dd9d081. Exiting log stream.
2025-02-06 04:06:35.547 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:61482/health" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:06:35.550 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-06 04:06:35.551 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-06 04:06:35.551 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:61482/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:06:35.553 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.31.5/tcp/61483/p2p/16Uiu2HAkxwZyCwYLEqBLfwTWjkyhwHhMjXicvptaHhBTcb72UFK3","/ip4/172.18.31.5/tcp/61484/ws/p2p/16Uiu2HAkxwZyCwYLEqBLfwTWjkyhwHhMjXicvptaHhBTcb72UFK3"],"enrUri":"enr:-L24QJONxKBSe8B4MrLgDw9EU2U12UNK_XHInSz6D4cF8s82dCSdhzA4SSmi2KDCDDtcmYNwQAkRsQ2tCMXRxhaKoFECgmlkgnY0gmlwhKwSHwWKbXVsdGlhZGRyc5YACASsEh8FBvArAAoErBIfBQbwLN0DgnJzhQADAQAAiXNlY3AyNTZrMaECNDuwe9OcGp5tyWQ6f3yoY3_u_SBoy5fVXffpLQMV3xaDdGNwgvArg3VkcILwLYV3YWt1MgU"}'
2025-02-06 04:06:35.553 INFO [src.node.waku_node] REST service is ready !!
2025-02-06 04:06:35.554 DEBUG [src.steps.filter] Running fixture setup: setup_main_filter_node
2025-02-06 04:06:35.560 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-06 04:06:35.560 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-06_04-06-34__bed857fd-4cf0-49f1-a51a-0682f4b6fc0b__wakuorg_nwaku:latest.log
2025-02-06 04:06:35.560 DEBUG [src.node.waku_node] Starting Node...
2025-02-06 04:06:35.561 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-06 04:06:35.562 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-06 04:06:35.562 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.117.208
2025-02-06 04:06:35.562 DEBUG [src.node.docker_mananger] Generated ports ['8122', '8123', '8124', '8125', '8126']
2025-02-06 04:06:35.563 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-06 04:06:35.563 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-06 04:06:35.563 DEBUG [src.node.waku_node] Using volumes []
2025-02-06 04:06:35.563 DEBUG [src.node.docker_mananger] docker run -i -t -p 8122:8122 -p 8123:8123 -p 8124:8124 -p 8125:8125 -p 8126:8126 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=8124 --rest-port=8122 --tcp-port=8123 --discv5-udp-port=8125 --rest-address=0.0.0.0 --nat=extip:172.18.117.208 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=8b17b516d72f81f9e12eceb1fb1c5e3f56cbe09856d2b1f26018140bee2aca3c --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=8126 --metrics-logging=true --relay=false --discv5-bootstrap-node=enr:-L24QJONxKBSe8B4MrLgDw9EU2U12UNK_XHInSz6D4cF8s82dCSdhzA4SSmi2KDCDDtcmYNwQAkRsQ2tCMXRxhaKoFECgmlkgnY0gmlwhKwSHwWKbXVsdGlhZGRyc5YACASsEh8FBvArAAoErBIfBQbwLN0DgnJzhQADAQAAiXNlY3AyNTZrMaECNDuwe9OcGp5tyWQ6f3yoY3_u_SBoy5fVXffpLQMV3xaDdGNwgvArg3VkcILwLYV3YWt1MgU --filternode=/ip4/172.18.31.5/tcp/61483/p2p/16Uiu2HAkxwZyCwYLEqBLfwTWjkyhwHhMjXicvptaHhBTcb72UFK3
2025-02-06 04:06:35.797 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.117.208 waku 72fecd27573ea9ee48d7bdbbe5d06fbd935ee9e385c51b31a0266b7673977380
2025-02-06 04:06:35.848 DEBUG [src.node.docker_mananger] Container started with ID 72fecd27573e. Setting up logs at ./log/docker/node2_2025-02-06_04-06-34__bed857fd-4cf0-49f1-a51a-0682f4b6fc0b__wakuorg_nwaku:latest.log
2025-02-06 04:06:35.849 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 8122
2025-02-06 04:06:35.849 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-06 04:06:36.849 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:8122/health" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:06:36.852 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-06 04:06:36.853 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-06 04:06:36.853 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:8122/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:06:36.855 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.117.208/tcp/8123/p2p/16Uiu2HAmJ2Jve3HNvFakKXjiGSS5Qphzy8nFMsRntUWZ4WFNTBUX","/ip4/172.18.117.208/tcp/8124/ws/p2p/16Uiu2HAmJ2Jve3HNvFakKXjiGSS5Qphzy8nFMsRntUWZ4WFNTBUX"],"enrUri":"enr:-L24QIn8Spx1Aw3Q26WtTJ5sOagm2-IgC0qwlT99ZqMq60qKZw2w-3StPnzBOfVi6oYuNQRLByRbrawPAPLMCl_aZQ8CgmlkgnY0gmlwhKwSddCKbXVsdGlhZGRyc5YACASsEnXQBh-7AAoErBJ10AYfvN0DgnJzhQADAQAAiXNlY3AyNTZrMaEDT8CiajPSdln-GzBKNQaal7QsxoE7JeAlU3OVEUVJ7YSDdGNwgh-7g3VkcIIfvYV3YWt1MgA"}'
2025-02-06 04:06:36.855 INFO [src.node.waku_node] REST service is ready !!
2025-02-06 04:06:36.856 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:8122/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.31.5/tcp/61483/p2p/16Uiu2HAkxwZyCwYLEqBLfwTWjkyhwHhMjXicvptaHhBTcb72UFK3"]'
2025-02-06 04:06:36.894 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 04:06:36.895 DEBUG [src.steps.filter] Running fixture setup: subscribe_main_nodes
2025-02-06 04:06:36.896 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:61482/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-06 04:06:36.913 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 04:06:36.914 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:8122/filter/v2/subscriptions" -H "Content-Type: application/json" -d '{"requestId": "20f07e0a-6b3d-44bc-ab0f-3ceca3718807", "contentFilters": ["/test/1/waku-filter/proto"], "pubsubTopic": "/waku/2/rs/3/1"}'
2025-02-06 04:06:36.926 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"20f07e0a-6b3d-44bc-ab0f-3ceca3718807","statusDesc":"OK"}'
2025-02-06 04:06:36.927 DEBUG [tests.filter.test_get_messages] Running test with Ephemeral True
2025-02-06 04:06:36.927 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:61482/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "RmlsdGVyIHdvcmtzISE=", "contentTopic": "/test/1/waku-filter/proto", "timestamp": '$(date +%s%N)', "ephemeral": true}'
2025-02-06 04:06:36.935 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 04:06:36.935 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-06 04:06:37.035 DEBUG [src.steps.filter] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-06 04:06:37.036 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:8122/filter/v2/messages/%2Ftest%2F1%2Fwaku-filter%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:06:37.039 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"RmlsdGVyIHdvcmtzISE=","contentTopic":"/test/1/waku-filter/proto","version":0,"timestamp":1738814796927502848,"ephemeral":true}]'
2025-02-06 04:06:37.040 DEBUG [tests.filter.test_get_messages] Running test with Ephemeral False
2025-02-06 04:06:37.041 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:61482/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "RmlsdGVyIHdvcmtzISE=", "contentTopic": "/test/1/waku-filter/proto", "timestamp": '$(date +%s%N)', "ephemeral": false}'
2025-02-06 04:06:37.045 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-06 04:06:37.046 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-06 04:06:37.146 DEBUG [src.steps.filter] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-06 04:06:37.146 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:8122/filter/v2/messages/%2Ftest%2F1%2Fwaku-filter%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-06 04:06:37.148 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"RmlsdGVyIHdvcmtzISE=","contentTopic":"/test/1/waku-filter/proto","version":0,"timestamp":1738814797041119744,"ephemeral":false}]'
2025-02-06 04:06:37.151 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-06 04:06:37.152 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-06 04:06:37.152 DEBUG [src.node.waku_node] Stopping container with id c28cb3392dfd
2025-02-06 04:06:38.110 DEBUG [src.node.waku_node] Container stopped.
2025-02-06 04:06:38.111 DEBUG [src.node.waku_node] Stopping container with id 72fecd27573e
2025-02-06 04:06:38.923 ERROR [src.node.docker_mananger] Max retries reached for container c28cb3392dfd. Exiting log stream.
2025-02-06 04:06:39.607 DEBUG [src.node.waku_node] Container stopped.
2025-02-06 04:06:39.608 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-06 04:06:39.613 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-06 04:06:39.617 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
