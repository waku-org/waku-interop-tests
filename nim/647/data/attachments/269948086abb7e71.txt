2025-02-11 04:03:39.641 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-11 04:03:39.642 DEBUG [tests.conftest] Running test: test_publish_with_invalid_payloads with id: 2025-02-11_04-03-39__dd38da5a-33bc-412f-8390-3644cea095aa
2025-02-11 04:03:39.642 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-11 04:03:39.642 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-11 04:03:39.642 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-11 04:03:39.648 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-11 04:03:39.649 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-11_04-03-39__dd38da5a-33bc-412f-8390-3644cea095aa__wakuorg_nwaku:latest.log
2025-02-11 04:03:39.649 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 04:03:39.649 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 04:03:39.650 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 04:03:39.650 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.168.36
2025-02-11 04:03:39.650 DEBUG [src.node.docker_mananger] Generated ports ['7737', '7738', '7739', '7740', '7741']
2025-02-11 04:03:39.651 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 04:03:39.651 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 04:03:39.651 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 04:03:39.651 DEBUG [src.node.docker_mananger] docker run -i -t -p 7737:7737 -p 7738:7738 -p 7739:7739 -p 7740:7740 -p 7741:7741 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=7739 --rest-port=7737 --tcp-port=7738 --discv5-udp-port=7740 --rest-address=0.0.0.0 --nat=extip:172.18.168.36 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=80cfd36684a5f4a2facecfd9ab0a8d4bccff4f703a8a921ce49e7d304c57f7f2 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=7741 --metrics-logging=true --relay=true
2025-02-11 04:03:39.883 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.168.36 waku c9144b87a7eddf1bf9e8158c6e3a1b5eca215dca714f99278c03994ae7ea66cc
2025-02-11 04:03:39.936 DEBUG [src.node.docker_mananger] Container started with ID c9144b87a7ed. Setting up logs at ./log/docker/node1_2025-02-11_04-03-39__dd38da5a-33bc-412f-8390-3644cea095aa__wakuorg_nwaku:latest.log
2025-02-11 04:03:39.937 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 7737
2025-02-11 04:03:39.937 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 04:03:40.442 ERROR [src.node.docker_mananger] Max retries reached for container b1babaa83b36. Exiting log stream.
2025-02-11 04:03:40.939 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:7737/health" -H "Content-Type: application/json" -d 'None'
2025-02-11 04:03:40.942 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-11 04:03:40.942 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-11 04:03:40.942 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:7737/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 04:03:40.944 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.168.36/tcp/7738/p2p/16Uiu2HAkuZsUiKX2K7ZVs4nNs58g5CXnRgf1aY9rJuLb5CE44uNt","/ip4/172.18.168.36/tcp/7739/ws/p2p/16Uiu2HAkuZsUiKX2K7ZVs4nNs58g5CXnRgf1aY9rJuLb5CE44uNt"],"enrUri":"enr:-L24QKWwfdVoHBFjSRlVXa5dQrkGUEj-x3-UQmKguAOgjBx3Dh3Xlk51kJfNSx0QWDGcAqEXuVP1duTe9lOD19CNd-gCgmlkgnY0gmlwhKwSqCSKbXVsdGlhZGRyc5YACASsEqgkBh46AAoErBKoJAYeO90DgnJzhQADAQAAiXNlY3AyNTZrMaECAhml4zzr_j5ZgPvOu4kNfvppOEetVHYiVaSk86jiZc2DdGNwgh46g3VkcIIePIV3YWt1MgE"}'
2025-02-11 04:03:40.944 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 04:03:40.951 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-11 04:03:40.951 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-11_04-03-39__dd38da5a-33bc-412f-8390-3644cea095aa__wakuorg_nwaku:latest.log
2025-02-11 04:03:40.951 DEBUG [src.node.waku_node] Starting Node...
2025-02-11 04:03:40.951 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-11 04:03:40.952 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-11 04:03:40.952 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.39.17
2025-02-11 04:03:40.953 DEBUG [src.node.docker_mananger] Generated ports ['59371', '59372', '59373', '59374', '59375']
2025-02-11 04:03:40.953 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-11 04:03:40.953 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-11 04:03:40.953 DEBUG [src.node.waku_node] Using volumes []
2025-02-11 04:03:40.953 DEBUG [src.node.docker_mananger] docker run -i -t -p 59371:59371 -p 59372:59372 -p 59373:59373 -p 59374:59374 -p 59375:59375 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=59373 --rest-port=59371 --tcp-port=59372 --discv5-udp-port=59374 --rest-address=0.0.0.0 --nat=extip:172.18.39.17 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=1f27cdd56472a53bf45ad98baad25b1f6ce8c9decc3dea84d174daa943eeee46 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=59375 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QKWwfdVoHBFjSRlVXa5dQrkGUEj-x3-UQmKguAOgjBx3Dh3Xlk51kJfNSx0QWDGcAqEXuVP1duTe9lOD19CNd-gCgmlkgnY0gmlwhKwSqCSKbXVsdGlhZGRyc5YACASsEqgkBh46AAoErBKoJAYeO90DgnJzhQADAQAAiXNlY3AyNTZrMaECAhml4zzr_j5ZgPvOu4kNfvppOEetVHYiVaSk86jiZc2DdGNwgh46g3VkcIIePIV3YWt1MgE
2025-02-11 04:03:41.196 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.39.17 waku 226b68177f06cb5be6dabe11ca8bac1331af4033fddab09b78c9c63b3819ece7
2025-02-11 04:03:41.243 DEBUG [src.node.docker_mananger] Container started with ID 226b68177f06. Setting up logs at ./log/docker/node2_2025-02-11_04-03-39__dd38da5a-33bc-412f-8390-3644cea095aa__wakuorg_nwaku:latest.log
2025-02-11 04:03:41.243 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 59371
2025-02-11 04:03:41.244 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-11 04:03:42.244 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:59371/health" -H "Content-Type: application/json" -d 'None'
2025-02-11 04:03:42.251 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-11 04:03:42.252 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-11 04:03:42.252 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:59371/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-11 04:03:42.257 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.39.17/tcp/59372/p2p/16Uiu2HAmKSH9AHKooNyvgBhvFxHCJD7urqTDNaKoXwQiaQG8yXY2","/ip4/172.18.39.17/tcp/59373/ws/p2p/16Uiu2HAmKSH9AHKooNyvgBhvFxHCJD7urqTDNaKoXwQiaQG8yXY2"],"enrUri":"enr:-L24QFJcV10ouLx2zTZnqiQT8Nwds1NffL_QVb6CUd1Z_nixTxVQKr97wV3NhdI5RtQHVa4TBXl-P6gTj-gRkUCPE-YCgmlkgnY0gmlwhKwSJxGKbXVsdGlhZGRyc5YACASsEicRBufsAAoErBInEQbn7d0DgnJzhQADAQAAiXNlY3AyNTZrMaEDZMA-VEjWIdVTEPuiqz1e5BKh1VJBVuXS9Uwx0X2Lew-DdGNwgufsg3VkcILn7oV3YWt1MgE"}'
2025-02-11 04:03:42.258 INFO [src.node.waku_node] REST service is ready !!
2025-02-11 04:03:42.259 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:59371/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.168.36/tcp/7738/p2p/16Uiu2HAkuZsUiKX2K7ZVs4nNs58g5CXnRgf1aY9rJuLb5CE44uNt"]'
2025-02-11 04:03:42.262 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 04:03:42.263 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-11 04:03:42.263 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7737/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 04:03:42.267 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 04:03:42.267 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:59371/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-11 04:03:42.273 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 04:03:42.274 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7737/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 04:03:42.280 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-11 04:03:42.280 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-11 04:03:42.380 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-11 04:03:42.381 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:7737/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 04:03:42.383 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739246622273944832,"ephemeral":false}]'
2025-02-11 04:03:42.385 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-11 04:03:42.385 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:59371/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-11 04:03:42.387 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739246622273944832,"ephemeral":false}]'
2025-02-11 04:03:42.388 INFO [src.steps.relay] WARM UP successful!!
2025-02-11 04:03:42.389 DEBUG [tests.relay.test_publish] Running test with payload Empty string
2025-02-11 04:03:42.389 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7737/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 04:03:42.392 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:7737/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-11 04:03:42.392 DEBUG [tests.relay.test_publish] Running test with payload Unecoded text
2025-02-11 04:03:42.392 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7737/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "Hello World!", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 04:03:42.394 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:7737/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Incorrect base64 string'
2025-02-11 04:03:42.395 DEBUG [tests.relay.test_publish] Running test with payload A dictionary
2025-02-11 04:03:42.395 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7737/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": {"key": "YWFh"}, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 04:03:42.397 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:7737/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-11 04:03:42.397 DEBUG [tests.relay.test_publish] Running test with payload An integer
2025-02-11 04:03:42.397 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7737/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": 1234567890, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 04:03:42.400 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:7737/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-11 04:03:42.400 DEBUG [tests.relay.test_publish] Running test with payload A list
2025-02-11 04:03:42.400 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7737/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": ["YWFh"], "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 04:03:42.402 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:7737/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-11 04:03:42.402 DEBUG [tests.relay.test_publish] Running test with payload A bool
2025-02-11 04:03:42.403 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7737/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": true, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-11 04:03:42.405 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:7737/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-11 04:03:42.407 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-11 04:03:42.408 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-11 04:03:42.408 DEBUG [src.node.waku_node] Stopping container with id c9144b87a7ed
2025-02-11 04:03:43.404 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 04:03:43.406 DEBUG [src.node.waku_node] Stopping container with id 226b68177f06
2025-02-11 04:03:44.232 ERROR [src.node.docker_mananger] Max retries reached for container c9144b87a7ed. Exiting log stream.
2025-02-11 04:03:44.903 DEBUG [src.node.waku_node] Container stopped.
2025-02-11 04:03:44.906 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-11 04:03:44.915 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-11 04:03:44.919 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
