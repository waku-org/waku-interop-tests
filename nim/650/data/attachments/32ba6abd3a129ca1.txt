2025-02-13 04:06:42.754 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-13 04:06:42.755 DEBUG [tests.conftest] Running test: test_node_uses_both_auto_and_regular_apis with id: 2025-02-13_04-06-42__3d319bcc-44dc-41ae-890b-26e04bf5e77b
2025-02-13 04:06:42.755 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-13 04:06:42.755 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-13 04:06:42.756 DEBUG [src.steps.sharding] Running fixture setup: sharding_setup
2025-02-13 04:06:42.763 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-13 04:06:42.764 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-13_04-06-42__3d319bcc-44dc-41ae-890b-26e04bf5e77b__wakuorg_nwaku:latest.log
2025-02-13 04:06:42.764 DEBUG [src.node.waku_node] Starting Node...
2025-02-13 04:06:42.764 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-13 04:06:42.766 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-13 04:06:42.766 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.36.30
2025-02-13 04:06:42.766 DEBUG [src.node.docker_mananger] Generated ports ['10059', '10060', '10061', '10062', '10063']
2025-02-13 04:06:42.766 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-13 04:06:42.766 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-13 04:06:42.766 DEBUG [src.node.waku_node] Using volumes []
2025-02-13 04:06:42.766 DEBUG [src.node.docker_mananger] docker run -i -t -p 10059:10059 -p 10060:10060 -p 10061:10061 -p 10062:10062 -p 10063:10063 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=10061 --rest-port=10059 --tcp-port=10060 --discv5-udp-port=10062 --rest-address=0.0.0.0 --nat=extip:172.18.36.30 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=aff1b8cde51f1a4eac54e3aadeb4ffb0d5ce05abca566b2bfd7fbc6ca09c93ff --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=10063 --metrics-logging=true --relay=true --filter=true --pubsub-topic=/waku/2/rs/2/0
2025-02-13 04:06:43.015 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.36.30 waku 55b138780d313a4b8da211729537829f74269a1ede6e71f733aab731150ece78
2025-02-13 04:06:43.065 DEBUG [src.node.docker_mananger] Container started with ID 55b138780d31. Setting up logs at ./log/docker/node1_2025-02-13_04-06-42__3d319bcc-44dc-41ae-890b-26e04bf5e77b__wakuorg_nwaku:latest.log
2025-02-13 04:06:43.066 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 10059
2025-02-13 04:06:43.066 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-13 04:06:43.562 ERROR [src.node.docker_mananger] Max retries reached for container e7a9d6551365. Exiting log stream.
2025-02-13 04:06:44.067 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10059/health" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:06:44.070 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-13 04:06:44.070 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-13 04:06:44.070 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10059/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:06:44.073 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.36.30/tcp/10060/p2p/16Uiu2HAmHq9DjtZZbvSwxwMGWEPUhDdfiCBMPPpV7LrNwaaYQzYK","/ip4/172.18.36.30/tcp/10061/ws/p2p/16Uiu2HAmHq9DjtZZbvSwxwMGWEPUhDdfiCBMPPpV7LrNwaaYQzYK"],"enrUri":"enr:-L24QO17J3GpmWFFJmcsHEXST2Tpi55L8FL0iE6x1fyQQNH5VneqrLQCb0agqWN3fCO1SIB09RHz3rgDhVPAfDLgdJ0CgmlkgnY0gmlwhKwSJB6KbXVsdGlhZGRyc5YACASsEiQeBidMAAoErBIkHgYnTd0DgnJzhQACAQAAiXNlY3AyNTZrMaEDTORFmbHek6F_E2TEZPrDrxc8jPCWikIASl7BJ8FKfISDdGNwgidMg3VkcIInToV3YWt1MgU"}'
2025-02-13 04:06:44.073 INFO [src.node.waku_node] REST service is ready !!
2025-02-13 04:06:44.080 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-13 04:06:44.080 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-13_04-06-42__3d319bcc-44dc-41ae-890b-26e04bf5e77b__wakuorg_nwaku:latest.log
2025-02-13 04:06:44.080 DEBUG [src.node.waku_node] Starting Node...
2025-02-13 04:06:44.080 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-13 04:06:44.081 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-13 04:06:44.082 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.46.61
2025-02-13 04:06:44.082 DEBUG [src.node.docker_mananger] Generated ports ['9656', '9657', '9658', '9659', '9660']
2025-02-13 04:06:44.082 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-13 04:06:44.082 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-13 04:06:44.082 DEBUG [src.node.waku_node] Using volumes []
2025-02-13 04:06:44.082 DEBUG [src.node.docker_mananger] docker run -i -t -p 9656:9656 -p 9657:9657 -p 9658:9658 -p 9659:9659 -p 9660:9660 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=9658 --rest-port=9656 --tcp-port=9657 --discv5-udp-port=9659 --rest-address=0.0.0.0 --nat=extip:172.18.46.61 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=07601ccb6bd6e9ca7d14cd85cdddbfd0da53ffefb5ccc94fde7260aaf6f1d74a --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=9660 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QO17J3GpmWFFJmcsHEXST2Tpi55L8FL0iE6x1fyQQNH5VneqrLQCb0agqWN3fCO1SIB09RHz3rgDhVPAfDLgdJ0CgmlkgnY0gmlwhKwSJB6KbXVsdGlhZGRyc5YACASsEiQeBidMAAoErBIkHgYnTd0DgnJzhQACAQAAiXNlY3AyNTZrMaEDTORFmbHek6F_E2TEZPrDrxc8jPCWikIASl7BJ8FKfISDdGNwgidMg3VkcIInToV3YWt1MgU --pubsub-topic=/waku/2/rs/2/0
2025-02-13 04:06:44.316 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.46.61 waku b048c91120a6c518c69ec44ee99d18a00cbd2e89185563bdab35ae1b03f34c71
2025-02-13 04:06:44.369 DEBUG [src.node.docker_mananger] Container started with ID b048c91120a6. Setting up logs at ./log/docker/node2_2025-02-13_04-06-42__3d319bcc-44dc-41ae-890b-26e04bf5e77b__wakuorg_nwaku:latest.log
2025-02-13 04:06:44.369 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 9656
2025-02-13 04:06:44.370 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-13 04:06:45.370 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9656/health" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:06:45.380 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-13 04:06:45.380 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-13 04:06:45.381 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9656/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:06:45.386 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.46.61/tcp/9657/p2p/16Uiu2HAmAjqfqcA33uEgRaJ8rBbY71NfXkJpYRev3QwYWehEosXr","/ip4/172.18.46.61/tcp/9658/ws/p2p/16Uiu2HAmAjqfqcA33uEgRaJ8rBbY71NfXkJpYRev3QwYWehEosXr"],"enrUri":"enr:-L24QIbLRMbkw3yjPl6l1d9Wl24Uk9lbAblP8ei5bXyj8Nx7YGHrJU3nR1r44PuFI3ycprTJDJxaWc48WZvzZZ04HqQCgmlkgnY0gmlwhKwSLj2KbXVsdGlhZGRyc5YACASsEi49BiW5AAoErBIuPQYlut0DgnJzhQACAQAAiXNlY3AyNTZrMaEC44a3KRL8-XH-ehHL9HpJTyDpuSYMiVcpEu_LHdSrxMWDdGNwgiW5g3VkcIIlu4V3YWt1MgE"}'
2025-02-13 04:06:45.388 INFO [src.node.waku_node] REST service is ready !!
2025-02-13 04:06:45.388 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9656/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.36.30/tcp/10060/p2p/16Uiu2HAmHq9DjtZZbvSwxwMGWEPUhDdfiCBMPPpV7LrNwaaYQzYK"]'
2025-02-13 04:06:45.392 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:06:45.392 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:10059/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2025-02-13 04:06:45.396 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:06:45.397 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9656/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2025-02-13 04:06:45.403 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:06:45.405 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:10059/relay/v1/auto/messages" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/toychat/2/huilong/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:06:45.412 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:06:45.412 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-13 04:06:45.513 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-13 04:06:45.513 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10059/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:06:45.516 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1739419605405047808,"ephemeral":false}]'
2025-02-13 04:06:45.518 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-13 04:06:45.518 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9656/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:06:45.520 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1739419605405047808,"ephemeral":false}]'
2025-02-13 04:06:45.522 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:10059/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2025-02-13 04:06:45.525 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:06:45.526 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9656/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2025-02-13 04:06:45.528 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:06:45.529 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:10059/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:06:45.534 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:06:45.534 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-13 04:06:45.635 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-13 04:06:45.636 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10059/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:06:45.639 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1739419605528943616,"ephemeral":false}]'
2025-02-13 04:06:45.640 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-13 04:06:45.640 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9656/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:06:45.643 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1739419605528943616,"ephemeral":false}]'
2025-02-13 04:06:45.645 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-13 04:06:45.646 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-13 04:06:45.647 DEBUG [src.node.waku_node] Stopping container with id 55b138780d31
2025-02-13 04:06:46.567 DEBUG [src.node.waku_node] Container stopped.
2025-02-13 04:06:46.568 DEBUG [src.node.waku_node] Stopping container with id b048c91120a6
2025-02-13 04:06:47.381 ERROR [src.node.docker_mananger] Max retries reached for container 55b138780d31. Exiting log stream.
2025-02-13 04:06:48.092 DEBUG [src.node.waku_node] Container stopped.
2025-02-13 04:06:48.093 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-13 04:06:48.099 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-13 04:06:48.104 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
