2025-02-13 04:08:24.154 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-13 04:08:24.155 DEBUG [tests.conftest] Running test: test_publish_after_node2_restarts with id: 2025-02-13_04-08-24__225d36a6-1f2a-4e17-abe6-d731b944e456
2025-02-13 04:08:24.155 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-13 04:08:24.155 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-13 04:08:24.156 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-13 04:08:24.162 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-13 04:08:24.162 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-13_04-08-24__225d36a6-1f2a-4e17-abe6-d731b944e456__wakuorg_nwaku:latest.log
2025-02-13 04:08:24.162 DEBUG [src.node.waku_node] Starting Node...
2025-02-13 04:08:24.162 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-13 04:08:24.164 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-13 04:08:24.164 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.237.62
2025-02-13 04:08:24.164 DEBUG [src.node.docker_mananger] Generated ports ['35776', '35777', '35778', '35779', '35780']
2025-02-13 04:08:24.164 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-13 04:08:24.164 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-13 04:08:24.164 DEBUG [src.node.waku_node] Using volumes []
2025-02-13 04:08:24.165 DEBUG [src.node.docker_mananger] docker run -i -t -p 35776:35776 -p 35777:35777 -p 35778:35778 -p 35779:35779 -p 35780:35780 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=35778 --rest-port=35776 --tcp-port=35777 --discv5-udp-port=35779 --rest-address=0.0.0.0 --nat=extip:172.18.237.62 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=109ddd0ae7cabe79ff963ce0c9c5d42c6edd291531c443b95917290a4d4d59da --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=35780 --metrics-logging=true --relay=true
2025-02-13 04:08:24.423 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.237.62 waku 715a29d5e6f4494c63fb8a57aa92303b53c81683fffe62512d0ae125aad8da19
2025-02-13 04:08:24.472 DEBUG [src.node.docker_mananger] Container started with ID 715a29d5e6f4. Setting up logs at ./log/docker/node1_2025-02-13_04-08-24__225d36a6-1f2a-4e17-abe6-d731b944e456__wakuorg_nwaku:latest.log
2025-02-13 04:08:24.474 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 35776
2025-02-13 04:08:24.474 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-13 04:08:24.844 ERROR [src.node.docker_mananger] Max retries reached for container 593454623e21. Exiting log stream.
2025-02-13 04:08:25.474 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:35776/health" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:08:25.477 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-13 04:08:25.477 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-13 04:08:25.477 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:35776/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:08:25.480 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.237.62/tcp/35777/p2p/16Uiu2HAky314cm1918KM95xeEDCq3m9Z3x88mztDaPPQHeTS6FUg","/ip4/172.18.237.62/tcp/35778/ws/p2p/16Uiu2HAky314cm1918KM95xeEDCq3m9Z3x88mztDaPPQHeTS6FUg"],"enrUri":"enr:-L24QJ5DQ4tSfKWhHA0yRKtI7JNDvM6QipVDn-d42HJ0hw7dI_h99ChmxGX_7Zx_Dsm1jjWtQzQ5u8jdHMO1tjPu3G4CgmlkgnY0gmlwhKwS7T6KbXVsdGlhZGRyc5YACASsEu0-BovBAAoErBLtPgaLwt0DgnJzhQADAQAAiXNlY3AyNTZrMaECNZ_3bOH8jwTiONR7WeCGl5Lt1RkEGh8FKlf_c66IPBWDdGNwgovBg3VkcIKLw4V3YWt1MgE"}'
2025-02-13 04:08:25.480 INFO [src.node.waku_node] REST service is ready !!
2025-02-13 04:08:25.486 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-13 04:08:25.486 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-13_04-08-24__225d36a6-1f2a-4e17-abe6-d731b944e456__wakuorg_nwaku:latest.log
2025-02-13 04:08:25.486 DEBUG [src.node.waku_node] Starting Node...
2025-02-13 04:08:25.487 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-13 04:08:25.488 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-13 04:08:25.488 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.28.250
2025-02-13 04:08:25.488 DEBUG [src.node.docker_mananger] Generated ports ['15577', '15578', '15579', '15580', '15581']
2025-02-13 04:08:25.488 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-13 04:08:25.488 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-13 04:08:25.489 DEBUG [src.node.waku_node] Using volumes []
2025-02-13 04:08:25.489 DEBUG [src.node.docker_mananger] docker run -i -t -p 15577:15577 -p 15578:15578 -p 15579:15579 -p 15580:15580 -p 15581:15581 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=15579 --rest-port=15577 --tcp-port=15578 --discv5-udp-port=15580 --rest-address=0.0.0.0 --nat=extip:172.18.28.250 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=0dd59c9e1142ed8d4247fc429d35d36bbab07ca21aa18bdeb53bcfaffbd900bc --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=15581 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QJ5DQ4tSfKWhHA0yRKtI7JNDvM6QipVDn-d42HJ0hw7dI_h99ChmxGX_7Zx_Dsm1jjWtQzQ5u8jdHMO1tjPu3G4CgmlkgnY0gmlwhKwS7T6KbXVsdGlhZGRyc5YACASsEu0-BovBAAoErBLtPgaLwt0DgnJzhQADAQAAiXNlY3AyNTZrMaECNZ_3bOH8jwTiONR7WeCGl5Lt1RkEGh8FKlf_c66IPBWDdGNwgovBg3VkcIKLw4V3YWt1MgE
2025-02-13 04:08:25.706 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.28.250 waku 4322e2d309d0a2b64f03a5055294f39b7edc67f930a126e1e0f8d80d9cea9ef8
2025-02-13 04:08:25.754 DEBUG [src.node.docker_mananger] Container started with ID 4322e2d309d0. Setting up logs at ./log/docker/node2_2025-02-13_04-08-24__225d36a6-1f2a-4e17-abe6-d731b944e456__wakuorg_nwaku:latest.log
2025-02-13 04:08:25.754 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 15577
2025-02-13 04:08:25.754 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-13 04:08:26.755 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15577/health" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:08:26.762 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-13 04:08:26.763 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-13 04:08:26.763 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15577/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:08:26.768 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.28.250/tcp/15578/p2p/16Uiu2HAmVbkgy3WNpzzgrr5Sts3Yfm6Ng5PB9DFX4wNuwYPM9dNR","/ip4/172.18.28.250/tcp/15579/ws/p2p/16Uiu2HAmVbkgy3WNpzzgrr5Sts3Yfm6Ng5PB9DFX4wNuwYPM9dNR"],"enrUri":"enr:-L24QMYfnVmsZHSDQNvXqLJsx4hxUZBryyd6R32npGnnZX5XF_I_Gre2OSq7zCm89vCbQxBT5VHdr2CnL5BHo8yvIzoCgmlkgnY0gmlwhKwSHPqKbXVsdGlhZGRyc5YACASsEhz6BjzaAAoErBIc-gY8290DgnJzhQADAQAAiXNlY3AyNTZrMaED-8J9NAgyv1bdoFyus2XqqBUYxwBOG-dJWuYtwv8MzuqDdGNwgjzag3VkcII83IV3YWt1MgE"}'
2025-02-13 04:08:26.769 INFO [src.node.waku_node] REST service is ready !!
2025-02-13 04:08:26.770 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:15577/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.237.62/tcp/35777/p2p/16Uiu2HAky314cm1918KM95xeEDCq3m9Z3x88mztDaPPQHeTS6FUg"]'
2025-02-13 04:08:26.774 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:08:26.774 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-13 04:08:26.775 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:35776/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-13 04:08:26.779 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:08:26.779 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:15577/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-13 04:08:26.784 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:08:26.785 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:35776/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:08:26.791 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:08:26.792 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-13 04:08:26.892 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-13 04:08:26.893 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:35776/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:08:26.895 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739419706784846592,"ephemeral":false}]'
2025-02-13 04:08:26.896 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-13 04:08:26.896 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15577/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:08:26.898 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739419706784846592,"ephemeral":false}]'
2025-02-13 04:08:26.900 INFO [src.steps.relay] WARM UP successful!!
2025-02-13 04:08:26.901 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:35776/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:08:26.905 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:08:26.906 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-13 04:08:27.007 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-13 04:08:27.007 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:35776/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:08:27.009 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739419706901106432,"ephemeral":false}]'
2025-02-13 04:08:27.011 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-13 04:08:27.011 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15577/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:08:27.013 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739419706901106432,"ephemeral":false}]'
2025-02-13 04:08:27.015 DEBUG [src.node.waku_node] Restarting container with id 4322e2d309d0
2025-02-13 04:08:28.464 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15577/health" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:08:28.568 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15577/health" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:08:28.570 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-13 04:08:28.571 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-13 04:08:28.571 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15577/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:08:28.573 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.28.250/tcp/15578/p2p/16Uiu2HAmVbkgy3WNpzzgrr5Sts3Yfm6Ng5PB9DFX4wNuwYPM9dNR","/ip4/172.18.28.250/tcp/15579/ws/p2p/16Uiu2HAmVbkgy3WNpzzgrr5Sts3Yfm6Ng5PB9DFX4wNuwYPM9dNR"],"enrUri":"enr:-L24QMYfnVmsZHSDQNvXqLJsx4hxUZBryyd6R32npGnnZX5XF_I_Gre2OSq7zCm89vCbQxBT5VHdr2CnL5BHo8yvIzoCgmlkgnY0gmlwhKwSHPqKbXVsdGlhZGRyc5YACASsEhz6BjzaAAoErBIc-gY8290DgnJzhQADAQAAiXNlY3AyNTZrMaED-8J9NAgyv1bdoFyus2XqqBUYxwBOG-dJWuYtwv8MzuqDdGNwgjzag3VkcII83IV3YWt1MgE"}'
2025-02-13 04:08:28.573 INFO [src.node.waku_node] REST service is ready !!
2025-02-13 04:08:28.573 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:35776/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-13 04:08:28.576 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:08:28.576 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:15577/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-13 04:08:28.594 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:08:28.595 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:35776/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:08:28.597 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:08:28.598 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-13 04:08:28.698 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-13 04:08:28.698 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:35776/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:08:28.701 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739419708594947840,"ephemeral":false}]'
2025-02-13 04:08:28.702 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-13 04:08:28.703 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15577/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:08:28.705 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[]'
2025-02-13 04:08:29.706 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:35776/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:08:29.711 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:08:29.712 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-13 04:08:29.813 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-13 04:08:29.813 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:35776/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:08:29.815 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739419709705969408,"ephemeral":false}]'
2025-02-13 04:08:29.817 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-13 04:08:29.817 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15577/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:08:29.819 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739419709705969408,"ephemeral":false}]'
2025-02-13 04:08:29.822 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-13 04:08:29.824 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-13 04:08:29.824 DEBUG [src.node.waku_node] Stopping container with id 715a29d5e6f4
2025-02-13 04:08:30.957 DEBUG [src.node.waku_node] Container stopped.
2025-02-13 04:08:30.959 DEBUG [src.node.waku_node] Stopping container with id 4322e2d309d0
2025-02-13 04:08:31.797 ERROR [src.node.docker_mananger] Max retries reached for container 715a29d5e6f4. Exiting log stream.
2025-02-13 04:08:32.445 DEBUG [src.node.waku_node] Container stopped.
2025-02-13 04:08:32.447 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-13 04:08:32.464 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-13 04:08:32.483 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
