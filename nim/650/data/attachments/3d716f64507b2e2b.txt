2025-02-13 04:03:33.829 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-13 04:03:33.829 DEBUG [tests.conftest] Running test: test_relay_unsubscribe_from_single_pubsub_topic with id: 2025-02-13_04-03-33__8232e98b-bfa1-4006-9138-a8465767534a
2025-02-13 04:03:33.830 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-13 04:03:33.830 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-13 04:03:33.830 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-13 04:03:33.837 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-13 04:03:33.837 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-13_04-03-33__8232e98b-bfa1-4006-9138-a8465767534a__wakuorg_nwaku:latest.log
2025-02-13 04:03:33.837 DEBUG [src.node.waku_node] Starting Node...
2025-02-13 04:03:33.838 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-13 04:03:33.839 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-13 04:03:33.839 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.106.0
2025-02-13 04:03:33.839 DEBUG [src.node.docker_mananger] Generated ports ['31983', '31984', '31985', '31986', '31987']
2025-02-13 04:03:33.839 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-13 04:03:33.839 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-13 04:03:33.840 DEBUG [src.node.waku_node] Using volumes []
2025-02-13 04:03:33.840 DEBUG [src.node.docker_mananger] docker run -i -t -p 31983:31983 -p 31984:31984 -p 31985:31985 -p 31986:31986 -p 31987:31987 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=31985 --rest-port=31983 --tcp-port=31984 --discv5-udp-port=31986 --rest-address=0.0.0.0 --nat=extip:172.18.106.0 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=1c0fd3f8f72e54587c44f284b8f39f3ababed4fb9c6ded597e79d29a91eacc56 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=31987 --metrics-logging=true --relay=true
2025-02-13 04:03:34.060 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.106.0 waku 17a4b04b91447aaaf6be53b60b35cc848796e4796755e44784276d6a677db7b6
2025-02-13 04:03:34.109 DEBUG [src.node.docker_mananger] Container started with ID 17a4b04b9144. Setting up logs at ./log/docker/node1_2025-02-13_04-03-33__8232e98b-bfa1-4006-9138-a8465767534a__wakuorg_nwaku:latest.log
2025-02-13 04:03:34.110 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 31983
2025-02-13 04:03:34.111 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-13 04:03:34.609 ERROR [src.node.docker_mananger] Max retries reached for container fbf02ae450c9. Exiting log stream.
2025-02-13 04:03:35.111 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31983/health" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:03:35.114 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-13 04:03:35.114 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-13 04:03:35.114 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31983/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:03:35.116 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.106.0/tcp/31984/p2p/16Uiu2HAmJmpcyD1hFZiZNLdduYRvehNgS7JCKEcE49UeSeytn5Vo","/ip4/172.18.106.0/tcp/31985/ws/p2p/16Uiu2HAmJmpcyD1hFZiZNLdduYRvehNgS7JCKEcE49UeSeytn5Vo"],"enrUri":"enr:-L24QOw3PpTNyw3vp9rGHrir423ONYeLHHkH4ZTefReHKXTRU8hToCoyN-A4LrHlvYdjlHqfSLbCFUAF2yV_3mCjdKoCgmlkgnY0gmlwhKwSagCKbXVsdGlhZGRyc5YACASsEmoABnzwAAoErBJqAAZ88d0DgnJzhQADAQAAiXNlY3AyNTZrMaEDWuYvlOpKrslzdfhMAPWZmKzfxcZxbrl4_rOgc181Qg6DdGNwgnzwg3VkcIJ88oV3YWt1MgE"}'
2025-02-13 04:03:35.116 INFO [src.node.waku_node] REST service is ready !!
2025-02-13 04:03:35.122 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-13 04:03:35.123 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-13_04-03-33__8232e98b-bfa1-4006-9138-a8465767534a__wakuorg_nwaku:latest.log
2025-02-13 04:03:35.123 DEBUG [src.node.waku_node] Starting Node...
2025-02-13 04:03:35.123 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-13 04:03:35.124 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-13 04:03:35.124 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.137.239
2025-02-13 04:03:35.124 DEBUG [src.node.docker_mananger] Generated ports ['45076', '45077', '45078', '45079', '45080']
2025-02-13 04:03:35.125 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-13 04:03:35.125 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-13 04:03:35.125 DEBUG [src.node.waku_node] Using volumes []
2025-02-13 04:03:35.125 DEBUG [src.node.docker_mananger] docker run -i -t -p 45076:45076 -p 45077:45077 -p 45078:45078 -p 45079:45079 -p 45080:45080 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=45078 --rest-port=45076 --tcp-port=45077 --discv5-udp-port=45079 --rest-address=0.0.0.0 --nat=extip:172.18.137.239 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=6a485da46756749a6afcacdd2c62ec4a69edcf05cdbdade195ad884cfe7b004b --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=45080 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QOw3PpTNyw3vp9rGHrir423ONYeLHHkH4ZTefReHKXTRU8hToCoyN-A4LrHlvYdjlHqfSLbCFUAF2yV_3mCjdKoCgmlkgnY0gmlwhKwSagCKbXVsdGlhZGRyc5YACASsEmoABnzwAAoErBJqAAZ88d0DgnJzhQADAQAAiXNlY3AyNTZrMaEDWuYvlOpKrslzdfhMAPWZmKzfxcZxbrl4_rOgc181Qg6DdGNwgnzwg3VkcIJ88oV3YWt1MgE
2025-02-13 04:03:35.343 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.137.239 waku 6314f9f90f115231406130bbf89ae8f18476d5f8b1a6946666b8e67ef0882fc9
2025-02-13 04:03:35.389 DEBUG [src.node.docker_mananger] Container started with ID 6314f9f90f11. Setting up logs at ./log/docker/node2_2025-02-13_04-03-33__8232e98b-bfa1-4006-9138-a8465767534a__wakuorg_nwaku:latest.log
2025-02-13 04:03:35.389 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 45076
2025-02-13 04:03:35.389 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-13 04:03:36.392 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:45076/health" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:03:36.399 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-13 04:03:36.400 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-13 04:03:36.400 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:45076/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:03:36.404 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.137.239/tcp/45077/p2p/16Uiu2HAmVYJNMSXrD5q4yF463pgarWTfitdMEmsgy69saHEdvZZp","/ip4/172.18.137.239/tcp/45078/ws/p2p/16Uiu2HAmVYJNMSXrD5q4yF463pgarWTfitdMEmsgy69saHEdvZZp"],"enrUri":"enr:-L24QN-O4ot5UetEA4mY-0BunFc0IKrtn4e0ldJhhpqKmiQncljqdZPue1KdOosc7scAZPie1waUgZ31ZfnJkY0xQXACgmlkgnY0gmlwhKwSie-KbXVsdGlhZGRyc5YACASsEonvBrAVAAoErBKJ7wawFt0DgnJzhQADAQAAiXNlY3AyNTZrMaED-t_8SGCcBEZfVuXdVeDcLMr6zrToAyp02z-FqQxsSheDdGNwgrAVg3VkcIKwF4V3YWt1MgE"}'
2025-02-13 04:03:36.404 INFO [src.node.waku_node] REST service is ready !!
2025-02-13 04:03:36.405 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:45076/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.106.0/tcp/31984/p2p/16Uiu2HAmJmpcyD1hFZiZNLdduYRvehNgS7JCKEcE49UeSeytn5Vo"]'
2025-02-13 04:03:36.407 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:03:36.408 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31983/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-13 04:03:36.412 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:03:36.412 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:45076/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-13 04:03:36.418 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:03:36.419 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31983/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:03:36.424 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:03:36.424 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-13 04:03:36.524 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-13 04:03:36.525 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31983/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:03:36.528 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739419416419049216,"ephemeral":false}]'
2025-02-13 04:03:36.529 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-13 04:03:36.529 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:45076/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:03:36.531 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739419416419049216,"ephemeral":false}]'
2025-02-13 04:03:36.533 INFO [src.node.api_clients.base_client] curl -v -X DELETE "http://127.0.0.1:31983/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-13 04:03:36.537 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:03:36.537 INFO [src.node.api_clients.base_client] curl -v -X DELETE "http://127.0.0.1:45076/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-13 04:03:36.542 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:03:36.543 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31983/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:03:36.545 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:31983/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Failed to publish: Node not subscribed to topic: /waku/2/rs/3/1'
2025-02-13 04:03:36.547 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-13 04:03:36.548 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-13 04:03:36.548 DEBUG [src.node.waku_node] Stopping container with id 17a4b04b9144
2025-02-13 04:03:37.589 DEBUG [src.node.waku_node] Container stopped.
2025-02-13 04:03:37.589 DEBUG [src.node.waku_node] Stopping container with id 6314f9f90f11
2025-02-13 04:03:38.401 ERROR [src.node.docker_mananger] Max retries reached for container 17a4b04b9144. Exiting log stream.
2025-02-13 04:03:39.061 DEBUG [src.node.waku_node] Container stopped.
2025-02-13 04:03:39.064 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-13 04:03:39.069 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-13 04:03:39.075 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
