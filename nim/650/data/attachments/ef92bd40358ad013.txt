2025-02-13 04:05:53.547 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-13 04:05:53.548 DEBUG [tests.conftest] Running test: test_publish_with_invalid_timestamps with id: 2025-02-13_04-05-53__96879bb7-e73a-4d95-9d34-386a324fbdc8
2025-02-13 04:05:53.548 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-13 04:05:53.548 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-13 04:05:53.548 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-13 04:05:53.555 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-13 04:05:53.555 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-13_04-05-53__96879bb7-e73a-4d95-9d34-386a324fbdc8__wakuorg_nwaku:latest.log
2025-02-13 04:05:53.555 DEBUG [src.node.waku_node] Starting Node...
2025-02-13 04:05:53.555 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-13 04:05:53.556 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-13 04:05:53.557 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.21.192
2025-02-13 04:05:53.557 DEBUG [src.node.docker_mananger] Generated ports ['64143', '64144', '64145', '64146', '64147']
2025-02-13 04:05:53.557 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-13 04:05:53.557 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-13 04:05:53.557 DEBUG [src.node.waku_node] Using volumes []
2025-02-13 04:05:53.557 DEBUG [src.node.docker_mananger] docker run -i -t -p 64143:64143 -p 64144:64144 -p 64145:64145 -p 64146:64146 -p 64147:64147 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=64145 --rest-port=64143 --tcp-port=64144 --discv5-udp-port=64146 --rest-address=0.0.0.0 --nat=extip:172.18.21.192 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=eca8dced3192b98f8db7ca3a83190226b6deefab80597c3ffb821efdf3ee9dab --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=64147 --metrics-logging=true --relay=true
2025-02-13 04:05:53.791 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.21.192 waku 4fd40d923b23bd6ebdb8057fa089b7a50311bdc9a7520e5763a1f9b470d55e3a
2025-02-13 04:05:53.844 DEBUG [src.node.docker_mananger] Container started with ID 4fd40d923b23. Setting up logs at ./log/docker/node1_2025-02-13_04-05-53__96879bb7-e73a-4d95-9d34-386a324fbdc8__wakuorg_nwaku:latest.log
2025-02-13 04:05:53.844 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 64143
2025-02-13 04:05:53.845 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-13 04:05:54.338 ERROR [src.node.docker_mananger] Max retries reached for container 830c9d3b24c1. Exiting log stream.
2025-02-13 04:05:54.846 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:64143/health" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:05:54.849 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-13 04:05:54.849 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-13 04:05:54.849 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:64143/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:05:54.851 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.21.192/tcp/64144/p2p/16Uiu2HAmDnFrdhYpY9Do2ULvb9p5RvbRG12nR3qbRjUjkgmBj35x","/ip4/172.18.21.192/tcp/64145/ws/p2p/16Uiu2HAmDnFrdhYpY9Do2ULvb9p5RvbRG12nR3qbRjUjkgmBj35x"],"enrUri":"enr:-L24QB5AedJDGVcHo_B3YUCJGqHjatpOlbOqTGQRlCRb734RReLOwZBfaiPngH0b84jjRq3wUswH3TXYB3IglTxgvAcCgmlkgnY0gmlwhKwSFcCKbXVsdGlhZGRyc5YACASsEhXABvqQAAoErBIVwAb6kd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDELhJApf-QLLLoXgvyCFPvaMmGOBCXd9_Ah6_niVbJ1eDdGNwgvqQg3VkcIL6koV3YWt1MgE"}'
2025-02-13 04:05:54.851 INFO [src.node.waku_node] REST service is ready !!
2025-02-13 04:05:54.858 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-13 04:05:54.858 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-13_04-05-53__96879bb7-e73a-4d95-9d34-386a324fbdc8__wakuorg_nwaku:latest.log
2025-02-13 04:05:54.858 DEBUG [src.node.waku_node] Starting Node...
2025-02-13 04:05:54.858 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-13 04:05:54.859 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-13 04:05:54.859 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.157.24
2025-02-13 04:05:54.860 DEBUG [src.node.docker_mananger] Generated ports ['7204', '7205', '7206', '7207', '7208']
2025-02-13 04:05:54.860 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-13 04:05:54.860 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-13 04:05:54.860 DEBUG [src.node.waku_node] Using volumes []
2025-02-13 04:05:54.860 DEBUG [src.node.docker_mananger] docker run -i -t -p 7204:7204 -p 7205:7205 -p 7206:7206 -p 7207:7207 -p 7208:7208 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=7206 --rest-port=7204 --tcp-port=7205 --discv5-udp-port=7207 --rest-address=0.0.0.0 --nat=extip:172.18.157.24 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=af11ab249f8fe6fb26dda5f2cc4afe96a2ca40ba8e6d4e2b01dcb6fad4620d36 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=7208 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QB5AedJDGVcHo_B3YUCJGqHjatpOlbOqTGQRlCRb734RReLOwZBfaiPngH0b84jjRq3wUswH3TXYB3IglTxgvAcCgmlkgnY0gmlwhKwSFcCKbXVsdGlhZGRyc5YACASsEhXABvqQAAoErBIVwAb6kd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDELhJApf-QLLLoXgvyCFPvaMmGOBCXd9_Ah6_niVbJ1eDdGNwgvqQg3VkcIL6koV3YWt1MgE
2025-02-13 04:05:55.092 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.157.24 waku b4db528981dc09d36c2bfc35aa0ee922cc3573c802fe454e22146f86062f9edd
2025-02-13 04:05:55.144 DEBUG [src.node.docker_mananger] Container started with ID b4db528981dc. Setting up logs at ./log/docker/node2_2025-02-13_04-05-53__96879bb7-e73a-4d95-9d34-386a324fbdc8__wakuorg_nwaku:latest.log
2025-02-13 04:05:55.144 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 7204
2025-02-13 04:05:55.144 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-13 04:05:56.147 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:7204/health" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:05:56.154 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-13 04:05:56.155 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-13 04:05:56.155 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:7204/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:05:56.158 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.157.24/tcp/7205/p2p/16Uiu2HAmFsGnJx8DZyfeMBXe5aBUXbzJBqgWfn3ZV7WHets3jjMB","/ip4/172.18.157.24/tcp/7206/ws/p2p/16Uiu2HAmFsGnJx8DZyfeMBXe5aBUXbzJBqgWfn3ZV7WHets3jjMB"],"enrUri":"enr:-L24QKbxCXNA7Me2JoMThsuOYkhUGNX76cxfvYt_e3PjxG7wHjp-xDotW1brEKLU7Uac4SbocqR2lUc6UL12isC6FwQCgmlkgnY0gmlwhKwSnRiKbXVsdGlhZGRyc5YACASsEp0YBhwlAAoErBKdGAYcJt0DgnJzhQADAQAAiXNlY3AyNTZrMaEDL7icCUBakFnZ4--eVMmP39JusnKheXmK6pcLcPGR56qDdGNwghwlg3VkcIIcJ4V3YWt1MgE"}'
2025-02-13 04:05:56.159 INFO [src.node.waku_node] REST service is ready !!
2025-02-13 04:05:56.159 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7204/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.21.192/tcp/64144/p2p/16Uiu2HAmDnFrdhYpY9Do2ULvb9p5RvbRG12nR3qbRjUjkgmBj35x"]'
2025-02-13 04:05:56.161 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:05:56.162 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-13 04:05:56.162 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:64143/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-13 04:05:56.166 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:05:56.166 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:7204/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-13 04:05:56.171 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:05:56.172 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:05:56.176 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-13 04:05:56.177 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-13 04:05:56.277 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-13 04:05:56.277 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:05:56.279 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739419556172449280,"ephemeral":false}]'
2025-02-13 04:05:56.281 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-13 04:05:56.281 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:7204/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-13 04:05:56.283 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739419556172449280,"ephemeral":false}]'
2025-02-13 04:05:56.284 INFO [src.steps.relay] WARM UP successful!!
2025-02-13 04:05:56.285 DEBUG [tests.relay.test_publish] Running test with timestamp Timestamp as string number
2025-02-13 04:05:56.286 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:05:56.288 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-13 04:05:56.289 DEBUG [tests.relay.test_publish] Running test with timestamp Invalid large number
2025-02-13 04:05:56.289 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:05:56.291 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-13 04:05:56.292 DEBUG [tests.relay.test_publish] Running test with timestamp Float number
2025-02-13 04:05:56.292 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:05:56.295 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-13 04:05:56.295 DEBUG [tests.relay.test_publish] Running test with timestamp Array instead of timestamp
2025-02-13 04:05:56.296 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:05:56.298 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-13 04:05:56.298 DEBUG [tests.relay.test_publish] Running test with timestamp Object instead of timestamp
2025-02-13 04:05:56.299 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:05:56.301 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-13 04:05:56.301 DEBUG [tests.relay.test_publish] Running test with timestamp ISO 8601 timestamp
2025-02-13 04:05:56.302 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:05:56.304 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-13 04:05:56.305 DEBUG [tests.relay.test_publish] Running test with timestamp Missing
2025-02-13 04:05:56.305 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-13 04:05:56.308 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:64143/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-13 04:05:56.310 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-13 04:05:56.311 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-13 04:05:56.311 DEBUG [src.node.waku_node] Stopping container with id 4fd40d923b23
2025-02-13 04:05:57.340 DEBUG [src.node.waku_node] Container stopped.
2025-02-13 04:05:57.340 DEBUG [src.node.waku_node] Stopping container with id b4db528981dc
2025-02-13 04:05:58.153 ERROR [src.node.docker_mananger] Max retries reached for container 4fd40d923b23. Exiting log stream.
2025-02-13 04:05:58.829 DEBUG [src.node.waku_node] Container stopped.
2025-02-13 04:05:58.831 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-13 04:05:58.837 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-13 04:05:58.844 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
