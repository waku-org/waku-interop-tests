2025-02-15 04:03:39.537 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-15 04:03:39.538 DEBUG [tests.conftest] Running test: test_relay_resubscribe_to_unsubscribed_pubsub_topic with id: 2025-02-15_04-03-39__1244fd42-5f9e-48ff-8782-a8c0139a895d
2025-02-15 04:03:39.539 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-15 04:03:39.540 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-15 04:03:39.541 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-15 04:03:39.549 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-15 04:03:39.550 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-15_04-03-39__1244fd42-5f9e-48ff-8782-a8c0139a895d__wakuorg_nwaku:latest.log
2025-02-15 04:03:39.550 DEBUG [src.node.waku_node] Starting Node...
2025-02-15 04:03:39.550 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-15 04:03:39.553 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-15 04:03:39.554 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.78.31
2025-02-15 04:03:39.554 DEBUG [src.node.docker_mananger] Generated ports ['2395', '2396', '2397', '2398', '2399']
2025-02-15 04:03:39.554 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-15 04:03:39.555 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-15 04:03:39.555 DEBUG [src.node.waku_node] Using volumes []
2025-02-15 04:03:39.556 DEBUG [src.node.docker_mananger] docker run -i -t -p 2395:2395 -p 2396:2396 -p 2397:2397 -p 2398:2398 -p 2399:2399 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=2397 --rest-port=2395 --tcp-port=2396 --discv5-udp-port=2398 --rest-address=0.0.0.0 --nat=extip:172.18.78.31 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=45ddf1132dcfff39b68bdbb4ef1d85194c9d781bba51ebcfe7db74d6b9a95fb3 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=2399 --metrics-logging=true --relay=true
2025-02-15 04:03:39.793 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.78.31 waku dd48af507694255934fccef49512b7b5fecbcc1652a0d316e017ae8e32037d66
2025-02-15 04:03:39.841 DEBUG [src.node.docker_mananger] Container started with ID dd48af507694. Setting up logs at ./log/docker/node1_2025-02-15_04-03-39__1244fd42-5f9e-48ff-8782-a8c0139a895d__wakuorg_nwaku:latest.log
2025-02-15 04:03:39.841 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 2395
2025-02-15 04:03:39.841 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-15 04:03:40.370 ERROR [src.node.docker_mananger] Max retries reached for container ce6df456c134. Exiting log stream.
2025-02-15 04:03:40.843 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:2395/health" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:03:40.845 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-15 04:03:40.845 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-15 04:03:40.845 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:2395/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:03:40.847 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.78.31/tcp/2396/p2p/16Uiu2HAmKmHimFNvmHe3Txp4uXAinUHc2cuQQ1kxu3xVHc85jBqo","/ip4/172.18.78.31/tcp/2397/ws/p2p/16Uiu2HAmKmHimFNvmHe3Txp4uXAinUHc2cuQQ1kxu3xVHc85jBqo"],"enrUri":"enr:-L24QDvi7J-Zy8_18lTAGBxVPfMG1vW3van7duXVMYxMSfzsHld3Eu-E6vPB-yoKmRPJyQprY2Yu6w7wAbm7-LvduZMCgmlkgnY0gmlwhKwSTh-KbXVsdGlhZGRyc5YACASsEk4fBglcAAoErBJOHwYJXd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDaZ7vFg12ghJjKvkFhcWi23r_A9kno_ySPCgs75XWsWaDdGNwgglcg3VkcIIJXoV3YWt1MgE"}'
2025-02-15 04:03:40.848 INFO [src.node.waku_node] REST service is ready !!
2025-02-15 04:03:40.854 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-15 04:03:40.854 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-15_04-03-39__1244fd42-5f9e-48ff-8782-a8c0139a895d__wakuorg_nwaku:latest.log
2025-02-15 04:03:40.854 DEBUG [src.node.waku_node] Starting Node...
2025-02-15 04:03:40.854 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-15 04:03:40.855 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-15 04:03:40.856 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.43.164
2025-02-15 04:03:40.856 DEBUG [src.node.docker_mananger] Generated ports ['53877', '53878', '53879', '53880', '53881']
2025-02-15 04:03:40.856 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-15 04:03:40.856 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-15 04:03:40.856 DEBUG [src.node.waku_node] Using volumes []
2025-02-15 04:03:40.856 DEBUG [src.node.docker_mananger] docker run -i -t -p 53877:53877 -p 53878:53878 -p 53879:53879 -p 53880:53880 -p 53881:53881 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=53879 --rest-port=53877 --tcp-port=53878 --discv5-udp-port=53880 --rest-address=0.0.0.0 --nat=extip:172.18.43.164 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=bad0ca5379a8b7a1c9b67eff26ebed5485c9e4f5c397d0ed3bdee2d9d61a84de --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=53881 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QDvi7J-Zy8_18lTAGBxVPfMG1vW3van7duXVMYxMSfzsHld3Eu-E6vPB-yoKmRPJyQprY2Yu6w7wAbm7-LvduZMCgmlkgnY0gmlwhKwSTh-KbXVsdGlhZGRyc5YACASsEk4fBglcAAoErBJOHwYJXd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDaZ7vFg12ghJjKvkFhcWi23r_A9kno_ySPCgs75XWsWaDdGNwgglcg3VkcIIJXoV3YWt1MgE
2025-02-15 04:03:41.082 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.43.164 waku 2af4e1a914c9f2cd781ea2b6b9bbc174e553660e2f482aadfd8e93ea5a3c0925
2025-02-15 04:03:41.130 DEBUG [src.node.docker_mananger] Container started with ID 2af4e1a914c9. Setting up logs at ./log/docker/node2_2025-02-15_04-03-39__1244fd42-5f9e-48ff-8782-a8c0139a895d__wakuorg_nwaku:latest.log
2025-02-15 04:03:41.130 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 53877
2025-02-15 04:03:41.130 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-15 04:03:42.131 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:53877/health" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:03:42.141 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-15 04:03:42.142 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-15 04:03:42.142 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:53877/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:03:42.145 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.43.164/tcp/53878/p2p/16Uiu2HAkyLhnPJ97U8J8P7LmVxJycB3XKTTspAhWNbKBM8om88GJ","/ip4/172.18.43.164/tcp/53879/ws/p2p/16Uiu2HAkyLhnPJ97U8J8P7LmVxJycB3XKTTspAhWNbKBM8om88GJ"],"enrUri":"enr:-L24QIkwYva1p89CiDG0dcMryQVNbYE6ThyEnIrneR0czCIjTt98wb-h-ylKeJZKQ0Bf0xWqncPTPPG4nniSTtFTzqcCgmlkgnY0gmlwhKwSK6SKbXVsdGlhZGRyc5YACASsEiukBtJ2AAoErBIrpAbSd90DgnJzhQADAQAAiXNlY3AyNTZrMaECOijh9kEBbSSMqc4o5v-szZ-SJMDRk0EohfhM_zbNc8uDdGNwgtJ2g3VkcILSeIV3YWt1MgE"}'
2025-02-15 04:03:42.146 INFO [src.node.waku_node] REST service is ready !!
2025-02-15 04:03:42.146 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:53877/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.78.31/tcp/2396/p2p/16Uiu2HAmKmHimFNvmHe3Txp4uXAinUHc2cuQQ1kxu3xVHc85jBqo"]'
2025-02-15 04:03:42.149 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:03:42.150 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2395/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 04:03:42.154 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:03:42.154 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:53877/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 04:03:42.160 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:03:42.161 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2395/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 04:03:42.167 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:03:42.167 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-15 04:03:42.267 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-15 04:03:42.268 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:2395/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:03:42.270 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739592222161580288,"ephemeral":false}]'
2025-02-15 04:03:42.271 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-15 04:03:42.272 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:53877/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:03:42.273 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739592222161580288,"ephemeral":false}]'
2025-02-15 04:03:42.275 INFO [src.node.api_clients.base_client] curl -v -X DELETE "http://127.0.0.1:2395/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 04:03:42.279 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:03:42.280 INFO [src.node.api_clients.base_client] curl -v -X DELETE "http://127.0.0.1:53877/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 04:03:42.284 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:03:42.285 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2395/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 04:03:42.287 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:2395/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Failed to publish: Node not subscribed to topic: /waku/2/rs/3/1'
2025-02-15 04:03:42.287 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2395/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 04:03:42.291 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:03:42.292 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:53877/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 04:03:42.296 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:03:42.297 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2395/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 04:03:42.302 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:03:42.302 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-15 04:03:42.402 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-15 04:03:42.402 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:2395/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:03:42.405 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739592222296955648,"ephemeral":false}]'
2025-02-15 04:03:42.406 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-15 04:03:42.406 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:53877/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:03:42.408 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739592222296955648,"ephemeral":false}]'
2025-02-15 04:03:42.411 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-15 04:03:42.412 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-15 04:03:42.412 DEBUG [src.node.waku_node] Stopping container with id dd48af507694
2025-02-15 04:03:43.308 DEBUG [src.node.waku_node] Container stopped.
2025-02-15 04:03:43.309 DEBUG [src.node.waku_node] Stopping container with id 2af4e1a914c9
2025-02-15 04:03:44.138 ERROR [src.node.docker_mananger] Max retries reached for container dd48af507694. Exiting log stream.
2025-02-15 04:03:44.800 DEBUG [src.node.waku_node] Container stopped.
2025-02-15 04:03:44.801 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-15 04:03:44.812 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-15 04:03:44.818 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
