2025-02-15 04:08:27.632 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-15 04:08:27.633 DEBUG [tests.conftest] Running test: test_publish_after_node2_restarts with id: 2025-02-15_04-08-27__4eabe66b-a841-4635-89e2-8c46e3c93151
2025-02-15 04:08:27.633 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-15 04:08:27.633 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-15 04:08:27.634 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-15 04:08:27.640 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-15 04:08:27.641 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-15_04-08-27__4eabe66b-a841-4635-89e2-8c46e3c93151__wakuorg_nwaku:latest.log
2025-02-15 04:08:27.641 DEBUG [src.node.waku_node] Starting Node...
2025-02-15 04:08:27.641 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-15 04:08:27.642 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-15 04:08:27.643 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.253.219
2025-02-15 04:08:27.643 DEBUG [src.node.docker_mananger] Generated ports ['61366', '61367', '61368', '61369', '61370']
2025-02-15 04:08:27.643 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-15 04:08:27.643 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-15 04:08:27.643 DEBUG [src.node.waku_node] Using volumes []
2025-02-15 04:08:27.643 DEBUG [src.node.docker_mananger] docker run -i -t -p 61366:61366 -p 61367:61367 -p 61368:61368 -p 61369:61369 -p 61370:61370 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=61368 --rest-port=61366 --tcp-port=61367 --discv5-udp-port=61369 --rest-address=0.0.0.0 --nat=extip:172.18.253.219 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=eef643dacbec3edafbfeb2d7bab61c1d621cdc4bc4680c7acabd25df5ff5564c --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=61370 --metrics-logging=true --relay=true
2025-02-15 04:08:27.910 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.253.219 waku e91075b66dcb9368e40a92ec9cedb747a58ba42302567b9906bf2a9fb502e359
2025-02-15 04:08:27.965 DEBUG [src.node.docker_mananger] Container started with ID e91075b66dcb. Setting up logs at ./log/docker/node1_2025-02-15_04-08-27__4eabe66b-a841-4635-89e2-8c46e3c93151__wakuorg_nwaku:latest.log
2025-02-15 04:08:27.965 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 61366
2025-02-15 04:08:27.966 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-15 04:08:28.327 ERROR [src.node.docker_mananger] Max retries reached for container 8693ec5d5c4f. Exiting log stream.
2025-02-15 04:08:28.967 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:61366/health" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:08:28.970 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-15 04:08:28.970 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-15 04:08:28.970 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:61366/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:08:28.972 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.253.219/tcp/61367/p2p/16Uiu2HAm7ywWPyyfgA6JwLZc3sa749ffhek4549gA5dMaLx61BHm","/ip4/172.18.253.219/tcp/61368/ws/p2p/16Uiu2HAm7ywWPyyfgA6JwLZc3sa749ffhek4549gA5dMaLx61BHm"],"enrUri":"enr:-L24QBKHiIl5lW4X4ScId_YEWdtYdx1hzNmQ6-NOnMGcn2d0Vc9G5pHC7cs1v-jbax1W5sNLjxHwahdBe60Fc7nPXJcCgmlkgnY0gmlwhKwS_duKbXVsdGlhZGRyc5YACASsEv3bBu-3AAoErBL92wbvuN0DgnJzhQADAQAAiXNlY3AyNTZrMaECupBi3EPOwxWDzUwCq3-7pA9hSRMLqQXFCQ_1YcI6IySDdGNwgu-3g3VkcILvuYV3YWt1MgE"}'
2025-02-15 04:08:28.973 INFO [src.node.waku_node] REST service is ready !!
2025-02-15 04:08:28.979 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-15 04:08:28.980 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-15_04-08-27__4eabe66b-a841-4635-89e2-8c46e3c93151__wakuorg_nwaku:latest.log
2025-02-15 04:08:28.980 DEBUG [src.node.waku_node] Starting Node...
2025-02-15 04:08:28.980 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-15 04:08:28.981 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-15 04:08:28.981 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.38.200
2025-02-15 04:08:28.981 DEBUG [src.node.docker_mananger] Generated ports ['10700', '10701', '10702', '10703', '10704']
2025-02-15 04:08:28.982 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-15 04:08:28.982 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-15 04:08:28.982 DEBUG [src.node.waku_node] Using volumes []
2025-02-15 04:08:28.982 DEBUG [src.node.docker_mananger] docker run -i -t -p 10700:10700 -p 10701:10701 -p 10702:10702 -p 10703:10703 -p 10704:10704 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=10702 --rest-port=10700 --tcp-port=10701 --discv5-udp-port=10703 --rest-address=0.0.0.0 --nat=extip:172.18.38.200 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=8744e9baca9a2193df5bad2a0ec75db9a26a98c706d424a4ecc8c39fffabe02b --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=10704 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QBKHiIl5lW4X4ScId_YEWdtYdx1hzNmQ6-NOnMGcn2d0Vc9G5pHC7cs1v-jbax1W5sNLjxHwahdBe60Fc7nPXJcCgmlkgnY0gmlwhKwS_duKbXVsdGlhZGRyc5YACASsEv3bBu-3AAoErBL92wbvuN0DgnJzhQADAQAAiXNlY3AyNTZrMaECupBi3EPOwxWDzUwCq3-7pA9hSRMLqQXFCQ_1YcI6IySDdGNwgu-3g3VkcILvuYV3YWt1MgE
2025-02-15 04:08:29.218 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.38.200 waku 7e3299c58c6ec356d3bcd6988dd5a131d215b8b0454721e2bcf5a36da867f8bc
2025-02-15 04:08:29.267 DEBUG [src.node.docker_mananger] Container started with ID 7e3299c58c6e. Setting up logs at ./log/docker/node2_2025-02-15_04-08-27__4eabe66b-a841-4635-89e2-8c46e3c93151__wakuorg_nwaku:latest.log
2025-02-15 04:08:29.267 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 10700
2025-02-15 04:08:29.268 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-15 04:08:30.269 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10700/health" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:08:30.278 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-15 04:08:30.278 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-15 04:08:30.279 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10700/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:08:30.282 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.38.200/tcp/10701/p2p/16Uiu2HAmNpmE21CqTH2wF3ScRsSMGyts1yJU5ozYCQWGQFTanGza","/ip4/172.18.38.200/tcp/10702/ws/p2p/16Uiu2HAmNpmE21CqTH2wF3ScRsSMGyts1yJU5ozYCQWGQFTanGza"],"enrUri":"enr:-L24QB6gHuxrsCLB9XP_SSrCH-BDvsrJ9Q5yUCbZHmWsRu0qUIIFCedYFUHFqqHd15wd3dSs6TY6rRsSc-bp53Etr98CgmlkgnY0gmlwhKwSJsiKbXVsdGlhZGRyc5YACASsEibIBinNAAoErBImyAYpzt0DgnJzhQADAQAAiXNlY3AyNTZrMaEDlxXWIUd3z-rJd9ykxgIze1qqsq3532zoR4iwPqX7un-DdGNwginNg3VkcIIpz4V3YWt1MgE"}'
2025-02-15 04:08:30.283 INFO [src.node.waku_node] REST service is ready !!
2025-02-15 04:08:30.283 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:10700/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.253.219/tcp/61367/p2p/16Uiu2HAm7ywWPyyfgA6JwLZc3sa749ffhek4549gA5dMaLx61BHm"]'
2025-02-15 04:08:30.286 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:08:30.286 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-15 04:08:30.287 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:61366/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 04:08:30.291 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:08:30.292 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:10700/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 04:08:30.298 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:08:30.299 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:61366/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 04:08:30.305 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:08:30.306 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-15 04:08:30.406 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-15 04:08:30.406 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:61366/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:08:30.409 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739592510298960128,"ephemeral":false}]'
2025-02-15 04:08:30.411 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-15 04:08:30.411 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10700/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:08:30.414 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739592510298960128,"ephemeral":false}]'
2025-02-15 04:08:30.415 INFO [src.steps.relay] WARM UP successful!!
2025-02-15 04:08:30.416 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:61366/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 04:08:30.421 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:08:30.421 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-15 04:08:30.522 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-15 04:08:30.522 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:61366/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:08:30.525 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739592510416652800,"ephemeral":false}]'
2025-02-15 04:08:30.526 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-15 04:08:30.527 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10700/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:08:30.529 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739592510416652800,"ephemeral":false}]'
2025-02-15 04:08:30.531 DEBUG [src.node.waku_node] Restarting container with id 7e3299c58c6e
2025-02-15 04:08:32.008 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10700/health" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:08:32.112 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10700/health" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:08:32.114 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-15 04:08:32.115 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-15 04:08:32.115 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10700/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:08:32.117 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.38.200/tcp/10701/p2p/16Uiu2HAmNpmE21CqTH2wF3ScRsSMGyts1yJU5ozYCQWGQFTanGza","/ip4/172.18.38.200/tcp/10702/ws/p2p/16Uiu2HAmNpmE21CqTH2wF3ScRsSMGyts1yJU5ozYCQWGQFTanGza"],"enrUri":"enr:-L24QB6gHuxrsCLB9XP_SSrCH-BDvsrJ9Q5yUCbZHmWsRu0qUIIFCedYFUHFqqHd15wd3dSs6TY6rRsSc-bp53Etr98CgmlkgnY0gmlwhKwSJsiKbXVsdGlhZGRyc5YACASsEibIBinNAAoErBImyAYpzt0DgnJzhQADAQAAiXNlY3AyNTZrMaEDlxXWIUd3z-rJd9ykxgIze1qqsq3532zoR4iwPqX7un-DdGNwginNg3VkcIIpz4V3YWt1MgE"}'
2025-02-15 04:08:32.117 INFO [src.node.waku_node] REST service is ready !!
2025-02-15 04:08:32.118 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:61366/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 04:08:32.120 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:08:32.120 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:10700/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 04:08:32.137 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:08:32.138 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:61366/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 04:08:32.142 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:08:32.142 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-15 04:08:32.242 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-15 04:08:32.243 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:61366/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:08:32.246 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739592512138351360,"ephemeral":false}]'
2025-02-15 04:08:32.247 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-15 04:08:32.247 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10700/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:08:32.250 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[]'
2025-02-15 04:08:33.251 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:61366/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 04:08:33.256 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:08:33.256 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-15 04:08:33.357 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-15 04:08:33.357 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:61366/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:08:33.360 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739592513250989312,"ephemeral":false}]'
2025-02-15 04:08:33.362 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-15 04:08:33.362 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10700/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:08:33.364 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739592513250989312,"ephemeral":false}]'
2025-02-15 04:08:33.368 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-15 04:08:33.369 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-15 04:08:33.369 DEBUG [src.node.waku_node] Stopping container with id e91075b66dcb
2025-02-15 04:08:34.485 DEBUG [src.node.waku_node] Container stopped.
2025-02-15 04:08:34.485 DEBUG [src.node.waku_node] Stopping container with id 7e3299c58c6e
2025-02-15 04:08:35.298 ERROR [src.node.docker_mananger] Max retries reached for container e91075b66dcb. Exiting log stream.
2025-02-15 04:08:36.028 DEBUG [src.node.waku_node] Container stopped.
2025-02-15 04:08:36.031 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-15 04:08:36.041 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-15 04:08:36.060 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
