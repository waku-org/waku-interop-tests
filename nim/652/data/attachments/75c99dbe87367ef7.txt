2025-02-15 04:05:30.551 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-15 04:05:30.552 DEBUG [tests.conftest] Running test: test_filter_get_message_after_node2_restarts with id: 2025-02-15_04-05-30__d8347163-c5fe-4a43-b799-f10e6b81eb3f
2025-02-15 04:05:30.552 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-15 04:05:30.552 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-15 04:05:30.552 DEBUG [src.steps.filter] Running fixture setup: setup_main_relay_node
2025-02-15 04:05:30.561 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-15 04:05:30.561 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-15_04-05-30__d8347163-c5fe-4a43-b799-f10e6b81eb3f__wakuorg_nwaku:latest.log
2025-02-15 04:05:30.562 DEBUG [src.node.waku_node] Starting Node...
2025-02-15 04:05:30.562 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-15 04:05:30.563 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-15 04:05:30.563 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.63.73
2025-02-15 04:05:30.563 DEBUG [src.node.docker_mananger] Generated ports ['26013', '26014', '26015', '26016', '26017']
2025-02-15 04:05:30.563 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-15 04:05:30.564 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-15 04:05:30.564 DEBUG [src.node.waku_node] Using volumes []
2025-02-15 04:05:30.564 DEBUG [src.node.docker_mananger] docker run -i -t -p 26013:26013 -p 26014:26014 -p 26015:26015 -p 26016:26016 -p 26017:26017 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=26015 --rest-port=26013 --tcp-port=26014 --discv5-udp-port=26016 --rest-address=0.0.0.0 --nat=extip:172.18.63.73 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=ecbc45357eac1cc189b342a4dcf7fd17a1c5b47c9e7479b28ec36097c06f8c56 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=26017 --metrics-logging=true --relay=true --filter=true
2025-02-15 04:05:30.795 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.63.73 waku eb843b8320d2ef1095374e3d77988e04eb67cdbb250cdb3cd532d83eaa00e443
2025-02-15 04:05:30.847 DEBUG [src.node.docker_mananger] Container started with ID eb843b8320d2. Setting up logs at ./log/docker/node1_2025-02-15_04-05-30__d8347163-c5fe-4a43-b799-f10e6b81eb3f__wakuorg_nwaku:latest.log
2025-02-15 04:05:30.847 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 26013
2025-02-15 04:05:30.847 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-15 04:05:31.155 ERROR [src.node.docker_mananger] Max retries reached for container 318d4866c594. Exiting log stream.
2025-02-15 04:05:31.849 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:26013/health" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:05:31.852 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-15 04:05:31.852 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-15 04:05:31.852 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:26013/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:05:31.854 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.63.73/tcp/26014/p2p/16Uiu2HAmMzRqq2kZaHKzwwmNr7V1b1ndzZTZwxFybkUGW2Vxa9a5","/ip4/172.18.63.73/tcp/26015/ws/p2p/16Uiu2HAmMzRqq2kZaHKzwwmNr7V1b1ndzZTZwxFybkUGW2Vxa9a5"],"enrUri":"enr:-L24QFsmWG0_nHTd-FKU3hgzBbd3VQJ3_dSkQBKoEU7zCgsSWdny9NvdRNAf-JXVIH02XZRR4QxpLzt2qfaM-hDIdqACgmlkgnY0gmlwhKwSP0mKbXVsdGlhZGRyc5YACASsEj9JBmWeAAoErBI_SQZln90DgnJzhQADAQAAiXNlY3AyNTZrMaEDirQKqpOaqY0AJxs7o8u6z-oRvdkTz0SdjDMH1QxUW3aDdGNwgmWeg3VkcIJloIV3YWt1MgU"}'
2025-02-15 04:05:31.854 INFO [src.node.waku_node] REST service is ready !!
2025-02-15 04:05:31.855 DEBUG [src.steps.filter] Running fixture setup: setup_main_filter_node
2025-02-15 04:05:31.860 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-15 04:05:31.860 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-15_04-05-30__d8347163-c5fe-4a43-b799-f10e6b81eb3f__wakuorg_nwaku:latest.log
2025-02-15 04:05:31.861 DEBUG [src.node.waku_node] Starting Node...
2025-02-15 04:05:31.861 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-15 04:05:31.862 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-15 04:05:31.862 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.51.247
2025-02-15 04:05:31.862 DEBUG [src.node.docker_mananger] Generated ports ['9783', '9784', '9785', '9786', '9787']
2025-02-15 04:05:31.862 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-15 04:05:31.863 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-15 04:05:31.863 DEBUG [src.node.waku_node] Using volumes []
2025-02-15 04:05:31.863 DEBUG [src.node.docker_mananger] docker run -i -t -p 9783:9783 -p 9784:9784 -p 9785:9785 -p 9786:9786 -p 9787:9787 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=9785 --rest-port=9783 --tcp-port=9784 --discv5-udp-port=9786 --rest-address=0.0.0.0 --nat=extip:172.18.51.247 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=701da5001db04e9bcafecec5e5aed73c4edee19eb3c7bbc9fae6971b7b2dd313 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=9787 --metrics-logging=true --relay=false --discv5-bootstrap-node=enr:-L24QFsmWG0_nHTd-FKU3hgzBbd3VQJ3_dSkQBKoEU7zCgsSWdny9NvdRNAf-JXVIH02XZRR4QxpLzt2qfaM-hDIdqACgmlkgnY0gmlwhKwSP0mKbXVsdGlhZGRyc5YACASsEj9JBmWeAAoErBI_SQZln90DgnJzhQADAQAAiXNlY3AyNTZrMaEDirQKqpOaqY0AJxs7o8u6z-oRvdkTz0SdjDMH1QxUW3aDdGNwgmWeg3VkcIJloIV3YWt1MgU --filternode=/ip4/172.18.63.73/tcp/26014/p2p/16Uiu2HAmMzRqq2kZaHKzwwmNr7V1b1ndzZTZwxFybkUGW2Vxa9a5
2025-02-15 04:05:32.099 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.51.247 waku 1de14755504c7bb3d3d232f04e6ecc65015da07db360b4431fbff1aa671fc475
2025-02-15 04:05:32.147 DEBUG [src.node.docker_mananger] Container started with ID 1de14755504c. Setting up logs at ./log/docker/node2_2025-02-15_04-05-30__d8347163-c5fe-4a43-b799-f10e6b81eb3f__wakuorg_nwaku:latest.log
2025-02-15 04:05:32.147 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 9783
2025-02-15 04:05:32.148 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-15 04:05:33.149 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9783/health" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:05:33.152 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-15 04:05:33.152 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-15 04:05:33.152 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9783/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:05:33.154 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.51.247/tcp/9784/p2p/16Uiu2HAmRdv4NHD8LtViycGgRjERQHLSP3mQwDgYsbAs1MwxMpu9","/ip4/172.18.51.247/tcp/9785/ws/p2p/16Uiu2HAmRdv4NHD8LtViycGgRjERQHLSP3mQwDgYsbAs1MwxMpu9"],"enrUri":"enr:-L24QP3B-z7wQS6gOSkNwYD1UrcGq1D-RonqGYONY8X5Y_k5VCFks2vCuwmecT-n0fWyCqd2N-X_rWlPFXaVmNRlphUCgmlkgnY0gmlwhKwSM_eKbXVsdGlhZGRyc5YACASsEjP3BiY4AAoErBIz9wYmOd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDwOF_HCULgCtZAj5YeowJDl62b_LdE54CaKmc9X58H7yDdGNwgiY4g3VkcIImOoV3YWt1MgA"}'
2025-02-15 04:05:33.155 INFO [src.node.waku_node] REST service is ready !!
2025-02-15 04:05:33.155 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9783/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.63.73/tcp/26014/p2p/16Uiu2HAmMzRqq2kZaHKzwwmNr7V1b1ndzZTZwxFybkUGW2Vxa9a5"]'
2025-02-15 04:05:33.191 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:05:33.194 DEBUG [src.steps.filter] Running fixture setup: subscribe_main_nodes
2025-02-15 04:05:33.194 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:26013/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 04:05:33.213 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:05:33.214 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9783/filter/v2/subscriptions" -H "Content-Type: application/json" -d '{"requestId": "6e0968be-ffd3-410f-9a48-073ba0948db9", "contentFilters": ["/test/1/waku-filter/proto"], "pubsubTopic": "/waku/2/rs/3/1"}'
2025-02-15 04:05:33.225 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"6e0968be-ffd3-410f-9a48-073ba0948db9","statusDesc":"OK"}'
2025-02-15 04:05:33.226 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:26013/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "RmlsdGVyIHdvcmtzISE=", "contentTopic": "/test/1/waku-filter/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 04:05:33.234 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:05:33.234 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-15 04:05:33.334 DEBUG [src.steps.filter] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-15 04:05:33.335 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9783/filter/v2/messages/%2Ftest%2F1%2Fwaku-filter%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:05:33.337 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"RmlsdGVyIHdvcmtzISE=","contentTopic":"/test/1/waku-filter/proto","version":0,"timestamp":1739592333226905600,"ephemeral":false}]'
2025-02-15 04:05:33.338 DEBUG [src.node.waku_node] Restarting container with id 1de14755504c
2025-02-15 04:05:34.883 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9783/health" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:05:34.986 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9783/health" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:05:34.989 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-15 04:05:34.989 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-15 04:05:34.989 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9783/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:05:34.991 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.51.247/tcp/9784/p2p/16Uiu2HAmRdv4NHD8LtViycGgRjERQHLSP3mQwDgYsbAs1MwxMpu9","/ip4/172.18.51.247/tcp/9785/ws/p2p/16Uiu2HAmRdv4NHD8LtViycGgRjERQHLSP3mQwDgYsbAs1MwxMpu9"],"enrUri":"enr:-L24QP3B-z7wQS6gOSkNwYD1UrcGq1D-RonqGYONY8X5Y_k5VCFks2vCuwmecT-n0fWyCqd2N-X_rWlPFXaVmNRlphUCgmlkgnY0gmlwhKwSM_eKbXVsdGlhZGRyc5YACASsEjP3BiY4AAoErBIz9wYmOd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDwOF_HCULgCtZAj5YeowJDl62b_LdE54CaKmc9X58H7yDdGNwgiY4g3VkcIImOoV3YWt1MgA"}'
2025-02-15 04:05:34.991 INFO [src.node.waku_node] REST service is ready !!
2025-02-15 04:05:34.992 DEBUG [src.libs.common] Sleeping for 2 seconds
2025-02-15 04:05:36.992 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:26013/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-15 04:05:36.995 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:05:36.995 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9783/filter/v2/subscriptions" -H "Content-Type: application/json" -d '{"requestId": "5b3b96fb-fe10-41cd-b7e6-5056dc91d002", "contentFilters": ["/test/1/waku-filter/proto"], "pubsubTopic": "/waku/2/rs/3/1"}'
2025-02-15 04:05:37.003 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"5b3b96fb-fe10-41cd-b7e6-5056dc91d002","statusDesc":"OK"}'
2025-02-15 04:05:37.004 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:26013/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "RmlsdGVyIHdvcmtzISE=", "contentTopic": "/test/1/waku-filter/proto", "timestamp": '$(date +%s%N)'}'
2025-02-15 04:05:37.011 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-15 04:05:37.012 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-15 04:05:37.112 DEBUG [src.steps.filter] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-15 04:05:37.112 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9783/filter/v2/messages/%2Ftest%2F1%2Fwaku-filter%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-15 04:05:37.115 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"RmlsdGVyIHdvcmtzISE=","contentTopic":"/test/1/waku-filter/proto","version":0,"timestamp":1739592337004353280,"ephemeral":false}]'
2025-02-15 04:05:37.117 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-15 04:05:37.118 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-15 04:05:37.118 DEBUG [src.node.waku_node] Stopping container with id eb843b8320d2
2025-02-15 04:05:37.622 DEBUG [src.node.waku_node] Container stopped.
2025-02-15 04:05:37.623 DEBUG [src.node.waku_node] Stopping container with id 1de14755504c
2025-02-15 04:05:38.433 ERROR [src.node.docker_mananger] Max retries reached for container eb843b8320d2. Exiting log stream.
2025-02-15 04:05:38.856 DEBUG [src.node.waku_node] Container stopped.
2025-02-15 04:05:38.858 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-15 04:05:38.867 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-15 04:05:38.882 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
