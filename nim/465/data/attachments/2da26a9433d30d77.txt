[35mDEBUG   [0m tests.conftest:conftest.py:51 Running fixture setup: test_id
[35mDEBUG   [0m tests.conftest:conftest.py:57 Running test: test_publish_with_payload_equal_or_more_150_kb with id: 2024-11-27_04-19-00__ff65ac7a-9bae-4612-b495-5cf523e84a7a
[35mDEBUG   [0m src.steps.common:common.py:18 Running fixture setup: common_setup
[35mDEBUG   [0m src.steps.relay:relay.py:28 Running fixture setup: relay_setup
[35mDEBUG   [0m src.steps.relay:relay.py:34 Running fixture setup: setup_main_relay_nodes
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:19 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:85 WakuNode instance initialized with log path ./log/docker/node1_2024-11-27_04-19-00__ff65ac7a-9bae-4612-b495-5cf523e84a7a__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:22 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:25 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:108 Generated random external IP 172.18.169.141
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:101 Generated ports ['61662', '61663', '61664', '61665', '61666']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:436 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:165 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:167 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:49 docker run -i -t -p 61662:61662 -p 61663:61663 -p 61664:61664 -p 61665:61665 -p 61666:61666 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=61664 --rest-port=61662 --tcp-port=61663 --discv5-udp-port=61665 --rest-address=0.0.0.0 --nat=extip:172.18.169.141 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=cc6c39e51b78a7caec968b9811c80f3b01a55ccaf0525ccec1aec424c875c222 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=61666 --metrics-logging=true --relay=true
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:55 docker network connect --ip 172.18.169.141 waku 5688ce58d8f99e648e8f4a1e110e2301c3c9515a8eb2514357c7cb0d2f1426cd
[31m[1mERROR   [0m src.node.docker_mananger:docker_mananger.py:89 Max retries reached for container ed6e63e37794. Exiting log stream.
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:58 Container started with ID 5688ce58d8f9. Setting up logs at ./log/docker/node1_2024-11-27_04-19-00__ff65ac7a-9bae-4612-b495-5cf523e84a7a__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:179 Started container from image wakuorg/nwaku:latest. REST: 61662
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:61662/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:279 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:61662/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.169.141/tcp/61663/p2p/16Uiu2HAmBrx75QJVBCr4MgPDfE8Ew8XmiZ6vSJ5UtGHN8m1zdV1Q","/ip4/172.18.169.141/tcp/61664/ws/p2p/16Uiu2HAmBrx75QJVBCr4MgPDfE8Ew8XmiZ6vSJ5UtGHN8m1zdV1Q"],"enrUri":"enr:-L24QKGMe792BYCKhSlnFiiVGwJ2eRvjpNghk_twObsuV0R_ABWgMZB5ofqhNdPW_cd7bc0eOkIHJTd8HiRYaDUwS_8CgmlkgnY0gmlwhKwSqY2KbXVsdGlhZGRyc5YACASsEqmNBvDfAAoErBKpjQbw4N0DgnJzhQADAQAAiXNlY3AyNTZrMaEC9DS-id5ZxPvtsACo9c1c8N8gqUV_hTTPCrz_QmUtu7eDdGNwgvDfg3VkcILw4YV3YWt1MgE"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:284 REST service is ready !!
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:19 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:85 WakuNode instance initialized with log path ./log/docker/node2_2024-11-27_04-19-00__ff65ac7a-9bae-4612-b495-5cf523e84a7a__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:22 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:25 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:108 Generated random external IP 172.18.100.237
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:101 Generated ports ['52161', '52162', '52163', '52164', '52165']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:436 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:165 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:167 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:49 docker run -i -t -p 52161:52161 -p 52162:52162 -p 52163:52163 -p 52164:52164 -p 52165:52165 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=52163 --rest-port=52161 --tcp-port=52162 --discv5-udp-port=52164 --rest-address=0.0.0.0 --nat=extip:172.18.100.237 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=cdb952aa1ceacdfdeb4b37ffcdcd327ca43d165a1ab38c73bab4d80d9b2a7a46 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=52165 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QKGMe792BYCKhSlnFiiVGwJ2eRvjpNghk_twObsuV0R_ABWgMZB5ofqhNdPW_cd7bc0eOkIHJTd8HiRYaDUwS_8CgmlkgnY0gmlwhKwSqY2KbXVsdGlhZGRyc5YACASsEqmNBvDfAAoErBKpjQbw4N0DgnJzhQADAQAAiXNlY3AyNTZrMaEC9DS-id5ZxPvtsACo9c1c8N8gqUV_hTTPCrz_QmUtu7eDdGNwgvDfg3VkcILw4YV3YWt1MgE
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:55 docker network connect --ip 172.18.100.237 waku 22fea7faaa0b862d186eb831a756eb0b98fb64aa96d222815d5e4052c18afc97
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:58 Container started with ID 22fea7faaa0b. Setting up logs at ./log/docker/node2_2024-11-27_04-19-00__ff65ac7a-9bae-4612-b495-5cf523e84a7a__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:179 Started container from image wakuorg/nwaku:latest. REST: 52161
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:52161/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:279 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:52161/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.100.237/tcp/52162/p2p/16Uiu2HAmG9uPNMctUED4LWghRQD6Udozjgx7op3Ne1e43i1L2dPa","/ip4/172.18.100.237/tcp/52163/ws/p2p/16Uiu2HAmG9uPNMctUED4LWghRQD6Udozjgx7op3Ne1e43i1L2dPa"],"enrUri":"enr:-L24QMFdretU2eqgaRhW1xUPQjLh0q9Sp3gUHe1bTvzSZx29MQKBXWISRQriCosbqEAAowPAtHdjbwGoz3RnSpKGpZICgmlkgnY0gmlwhKwSZO2KbXVsdGlhZGRyc5YACASsEmTtBsvCAAoErBJk7QbLw90DgnJzhQADAQAAiXNlY3AyNTZrMaEDM_tKj84FEUJRkE4gI75T8QthYcnOXp_DvoewN89ZwsWDdGNwgsvCg3VkcILLxIV3YWt1MgE"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:284 REST service is ready !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:52161/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.169.141/tcp/61663/p2p/16Uiu2HAmBrx75QJVBCr4MgPDfE8Ew8XmiZ6vSJ5UtGHN8m1zdV1Q"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.steps.relay:relay.py:59 Running fixture setup: subscribe_main_relay_nodes
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:61662/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:52161/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:61662/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 0.1 seconds
[35mDEBUG   [0m src.steps.relay:relay.py:123 Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:61662/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1732681144116910080,"ephemeral":false}]'
[35mDEBUG   [0m src.steps.relay:relay.py:123 Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:52161/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1732681144116910080,"ephemeral":false}]'
[32mINFO    [0m src.steps.relay:relay.py:71 WARM UP successful!!
[35mDEBUG   [0m tests.relay.test_publish:test_publish.py:55 Running test with payload length of 204800 bytes
[32mINFO    [0m src.node.api_clients.base_client:custom_logger.py:10 Log line was discarded because it's longer than max_log_line_length=5000
[31m[1mERROR   [0m src.node.api_clients.base_client:base_client.py:16 HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:61662/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
[35mDEBUG   [0m tests.relay.test_publish:test_publish.py:55 Running test with payload length of 1048576 bytes
[32mINFO    [0m src.node.api_clients.base_client:custom_logger.py:10 Log line was discarded because it's longer than max_log_line_length=5000
[31m[1mERROR   [0m src.node.api_clients.base_client:base_client.py:16 HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:61662/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Failed to publish: Message size exceeded maximum of 153600 bytes'
[35mDEBUG   [0m tests.relay.test_publish:test_publish.py:55 Running test with payload length of 10485760 bytes
[32mINFO    [0m src.node.api_clients.base_client:custom_logger.py:10 Log line was discarded because it's longer than max_log_line_length=5000
[31m[1mERROR   [0m src.node.api_clients.base_client:base_client.py:16 HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:61662/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Failed to publish: Message size exceeded maximum of 153600 bytes'
[35mDEBUG   [0m tests.conftest:conftest.py:59 Running fixture teardown: test_setup
[35mDEBUG   [0m tests.conftest:conftest.py:83 Running fixture teardown: close_open_nodes
[35mDEBUG   [0m src.node.waku_node:waku_node.py:223 Stopping container with id 5688ce58d8f9
[35mDEBUG   [0m src.node.waku_node:waku_node.py:230 Container stopped.
[35mDEBUG   [0m src.node.waku_node:waku_node.py:223 Stopping container with id 22fea7faaa0b
[31m[1mERROR   [0m src.node.docker_mananger:docker_mananger.py:89 Max retries reached for container 5688ce58d8f9. Exiting log stream.
[35mDEBUG   [0m src.node.waku_node:waku_node.py:230 Container stopped.
[35mDEBUG   [0m tests.conftest:conftest.py:98 Running fixture teardown: check_waku_log_errors
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:144 No errors found in the waku logs.
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:144 No errors found in the waku logs.