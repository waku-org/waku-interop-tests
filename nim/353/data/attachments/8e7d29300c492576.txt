[35mDEBUG   [0m tests.conftest:conftest.py:51 Running fixture setup: test_id
[35mDEBUG   [0m tests.conftest:conftest.py:57 Running test: test_light_push_and_retrieve_duplicate_message with id: 2024-09-10_13-44-37__64c4fa1e-7ddd-4e8d-a7e0-f9ff6de58811
[35mDEBUG   [0m src.steps.common:common.py:17 Running fixture setup: common_setup
[35mDEBUG   [0m src.steps.light_push:light_push.py:27 Running fixture setup: light_push_setup
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:18 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:85 WakuNode instance initialized with log path ./log/docker/receiving_node1_2024-09-10_13-44-37__64c4fa1e-7ddd-4e8d-a7e0-f9ff6de58811__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:21 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:24 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:81 Generated random external IP 172.18.83.7
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:74 Generated ports ['54164', '54165', '54166', '54167', '54168']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:434 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:163 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:165 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:48 docker run -i -t -p 54164:54164 -p 54165:54165 -p 54166:54166 -p 54167:54167 -p 54168:54168 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=54166 --rest-port=54164 --tcp-port=54165 --discv5-udp-port=54167 --rest-address=0.0.0.0 --nat=extip:172.18.83.7 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=edd4dddfec8899cad0ca80f9ce1414efdaaaf6b5d89c0d130e1d43bc0baffb3d --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=54168 --metrics-logging=true --lightpush=true --relay=true
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:54 docker network connect --ip 172.18.83.7 waku a8bf344c96ad67979309902ceb371294eae7c544a5ac412e3360ae3d65124e7b
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:57 Container started with ID a8bf344c96ad. Setting up logs at ./log/docker/receiving_node1_2024-09-10_13-44-37__64c4fa1e-7ddd-4e8d-a7e0-f9ff6de58811__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:177 Started container from image wakuorg/nwaku:latest. REST: 54164
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:54164/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:277 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:54164/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.83.7/tcp/54165/p2p/16Uiu2HAmEPXUoeC3h8c3nqAxc7krct5mkYwEQjFBh3w4eiAHSkdz","/ip4/172.18.83.7/tcp/54166/ws/p2p/16Uiu2HAmEPXUoeC3h8c3nqAxc7krct5mkYwEQjFBh3w4eiAHSkdz"],"enrUri":"enr:-LO4QKQUEqZpcgdnPEvs-UciIs26gWH70mS7aQfnB08LLoO6W4su7t4rj-PC5_ErPNLo5LGAsBim4XjcH0Qkq6AA7ToBgmlkgnY0gmlwhKwSUweKbXVsdGlhZGRyc4wACgSsElMHBtOW3QOCcnOFAAMBAACJc2VjcDI1NmsxoQMZwUd7Tt5-okb9WuGt2rGQwtaIcZgWU18fjNZmdeqqtYN0Y3CC05WDdWRwgtOXhXdha3UyCQ"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:282 REST service is ready !!
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:18 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:85 WakuNode instance initialized with log path ./log/docker/receiving_node2_2024-09-10_13-44-37__64c4fa1e-7ddd-4e8d-a7e0-f9ff6de58811__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:21 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:24 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:81 Generated random external IP 172.18.158.228
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:74 Generated ports ['26643', '26644', '26645', '26646', '26647']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:434 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:163 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:165 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:48 docker run -i -t -p 26643:26643 -p 26644:26644 -p 26645:26645 -p 26646:26646 -p 26647:26647 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=26645 --rest-port=26643 --tcp-port=26644 --discv5-udp-port=26646 --rest-address=0.0.0.0 --nat=extip:172.18.158.228 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=d68c0645ea83d4c6ba005bae19c7e15f7bbff52c6d4d743eabfe46ea06becebc --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=26647 --metrics-logging=true --lightpush=false --relay=true
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:54 docker network connect --ip 172.18.158.228 waku b5c4ff31c4478f84c300ed9b1a69c1dc30509d8d3cea54e5fc9fe7d13ddd9b7c
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:57 Container started with ID b5c4ff31c447. Setting up logs at ./log/docker/receiving_node2_2024-09-10_13-44-37__64c4fa1e-7ddd-4e8d-a7e0-f9ff6de58811__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:177 Started container from image wakuorg/nwaku:latest. REST: 26643
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:26643/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:277 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:26643/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.158.228/tcp/26644/p2p/16Uiu2HAmBTDTqLLWDCTh99J3vJQpiZTum3vVcKR8XXvdfWGNT5Tn","/ip4/172.18.158.228/tcp/26645/ws/p2p/16Uiu2HAmBTDTqLLWDCTh99J3vJQpiZTum3vVcKR8XXvdfWGNT5Tn"],"enrUri":"enr:-LO4QLED8T1uBSk1dAPQuQi3S91mqlwJvOFLpnHHDrfEU2cMHW6Z15DnL4YBiiIKxI3qXx00drGOtxjiEEKvPzREvpgBgmlkgnY0gmlwhKwSnuSKbXVsdGlhZGRyc4wACgSsEp7kBmgV3QOCcnOFAAMBAACJc2VjcDI1NmsxoQLuICuLHir69UlSbJxT5PyRKMbbdvUw7iOsf2NiTv3boYN0Y3CCaBSDdWRwgmgWhXdha3UyAQ"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:282 REST service is ready !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:26643/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.83.7/tcp/54165/p2p/16Uiu2HAmEPXUoeC3h8c3nqAxc7krct5mkYwEQjFBh3w4eiAHSkdz"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:18 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:85 WakuNode instance initialized with log path ./log/docker/lightpush_node1_2024-09-10_13-44-37__64c4fa1e-7ddd-4e8d-a7e0-f9ff6de58811__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:21 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:24 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:81 Generated random external IP 172.18.244.112
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:74 Generated ports ['48974', '48975', '48976', '48977', '48978']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:434 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:163 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:165 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:48 docker run -i -t -p 48974:48974 -p 48975:48975 -p 48976:48976 -p 48977:48977 -p 48978:48978 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=48976 --rest-port=48974 --tcp-port=48975 --discv5-udp-port=48977 --rest-address=0.0.0.0 --nat=extip:172.18.244.112 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=6eb7b4dec36e9df41f6da74eb54d2dd0e8eeca43027e867fc1229dcebdea2d98 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=48978 --metrics-logging=true --discv5-bootstrap-node=enr:-LO4QKQUEqZpcgdnPEvs-UciIs26gWH70mS7aQfnB08LLoO6W4su7t4rj-PC5_ErPNLo5LGAsBim4XjcH0Qkq6AA7ToBgmlkgnY0gmlwhKwSUweKbXVsdGlhZGRyc4wACgSsElMHBtOW3QOCcnOFAAMBAACJc2VjcDI1NmsxoQMZwUd7Tt5-okb9WuGt2rGQwtaIcZgWU18fjNZmdeqqtYN0Y3CC05WDdWRwgtOXhXdha3UyCQ --lightpushnode=/ip4/172.18.83.7/tcp/54165/p2p/16Uiu2HAmEPXUoeC3h8c3nqAxc7krct5mkYwEQjFBh3w4eiAHSkdz --lightpush=true --relay=false
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:54 docker network connect --ip 172.18.244.112 waku f4aeb52432f70ec1e3a9c2f3351f056e78e35f976847bda83f4928de2c219816
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:57 Container started with ID f4aeb52432f7. Setting up logs at ./log/docker/lightpush_node1_2024-09-10_13-44-37__64c4fa1e-7ddd-4e8d-a7e0-f9ff6de58811__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:177 Started container from image wakuorg/nwaku:latest. REST: 48974
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:48974/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:277 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:48974/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.244.112/tcp/48975/p2p/16Uiu2HAmV4Xbdqmgv2XqYiHs6y86VJu6jrZKW8ZPWaDB6GRGqiWc","/ip4/172.18.244.112/tcp/48976/ws/p2p/16Uiu2HAmV4Xbdqmgv2XqYiHs6y86VJu6jrZKW8ZPWaDB6GRGqiWc"],"enrUri":"enr:-LO4QGXNwrVatzrDo6d0TG1ntp_N603yTncDYcI2m894KKAuUKrXWD1gmmTnPjAiv9ir0KjSq-qTs9BXcIldqVO8coMBgmlkgnY0gmlwhKwS9HCKbXVsdGlhZGRyc4wACgSsEvRwBr9Q3QOCcnOFAAMBAACJc2VjcDI1NmsxoQPzwq5QqTuX3fmgFXy1SaS4B6HS5oJPGyDZFEA3sQkUKYN0Y3CCv0-DdWRwgr9RhXdha3UyCA"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:282 REST service is ready !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:48974/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.83.7/tcp/54165/p2p/16Uiu2HAmEPXUoeC3h8c3nqAxc7krct5mkYwEQjFBh3w4eiAHSkdz"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:48974/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.158.228/tcp/26644/p2p/16Uiu2HAmBTDTqLLWDCTh99J3vJQpiZTum3vVcKR8XXvdfWGNT5Tn"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:54164/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:26643/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.steps.light_push:light_push.py:120 Lightpushing message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:48974/lightpush/v1/message" -H "Content-Type: application/json" -d '{"pubsubTopic": "/waku/2/rs/3/0", "message": {"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": 1725975883333673216}}'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 0.1 seconds
[35mDEBUG   [0m src.steps.light_push:light_push.py:124 Checking that peer NODE_1:wakuorg/nwaku:latest can find the lightpushed message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:54164/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1725975883333673216,"ephemeral":false}]'
[35mDEBUG   [0m src.steps.light_push:light_push.py:124 Checking that peer NODE_2:wakuorg/nwaku:latest can find the lightpushed message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:26643/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1725975883333673216,"ephemeral":false}]'
[35mDEBUG   [0m src.steps.light_push:light_push.py:120 Lightpushing message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:48974/lightpush/v1/message" -H "Content-Type: application/json" -d '{"pubsubTopic": "/waku/2/rs/3/0", "message": {"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": 1725975883333673216}}'
[1m[31mERROR   [0m src.node.api_clients.base_client:base_client.py:16 HTTP error occurred: 503 Server Error: Service Unavailable for url: http://127.0.0.1:48974/lightpush/v1/message. Response content: b'Failed to request a message push: Lightpush request has not been published to any peers. msg_hash: 0xd52331c70cb08af57f5fcf2f6a017669053e8f295dc47cd5054581cd182f8dae'
[35mDEBUG   [0m tests.conftest:conftest.py:59 Running fixture teardown: test_setup
[35mDEBUG   [0m tests.conftest:conftest.py:83 Running fixture teardown: close_open_nodes
[35mDEBUG   [0m src.node.waku_node:waku_node.py:221 Stopping container with id a8bf344c96ad
[35mDEBUG   [0m src.node.waku_node:waku_node.py:228 Container stopped.
[35mDEBUG   [0m src.node.waku_node:waku_node.py:221 Stopping container with id b5c4ff31c447
[35mDEBUG   [0m src.node.waku_node:waku_node.py:228 Container stopped.
[35mDEBUG   [0m src.node.waku_node:waku_node.py:221 Stopping container with id f4aeb52432f7
[35mDEBUG   [0m src.node.waku_node:waku_node.py:228 Container stopped.
[35mDEBUG   [0m tests.conftest:conftest.py:98 Running fixture teardown: check_waku_log_errors
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:117 No errors found in the waku logs.
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:117 No errors found in the waku logs.
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:117 No errors found in the waku logs.