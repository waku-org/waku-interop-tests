{"uid":"d0004bb132dba092","name":"test_ping_only_some_nodes_have_subscriptions","fullName":"tests.filter.test_multiple_nodes.TestFilterMultipleNodes#test_ping_only_some_nodes_have_subscriptions","historyId":"2d6409c42149872333898c33c1f95002","time":{"start":1705896814507,"stop":1705896822456,"duration":7949},"status":"failed","statusMessage":"AssertionError","statusTrace":"src/node/api_clients/base_client.py:14: in make_request\n    response.raise_for_status()\n/opt/hostedtoolcache/Python/3.12.1/x64/lib/python3.12/site-packages/requests/models.py:1021: in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\nE   requests.exceptions.HTTPError: 500 Server Error: Internal Server Error for url: http://127.0.0.1:44902/filter/v2/subscriptions/b913b908-550e-4188-a12f-ee2e1e7b89a2\n\nDuring handling of the above exception, another exception occurred:\nsrc/steps/filter.py:182: in ping_without_filter_subscription\n    self.ping_filter_subscriptions(str(uuid4()), node=node)\nsrc/steps/filter.py:176: in ping_filter_subscriptions\n    ping_sub_response = node.ping_filter_subscriptions(request_id)\nsrc/node/waku_node.py:159: in ping_filter_subscriptions\n    return self._api.ping_filter_subscriptions(request_id)\nsrc/node/api_clients/rest.py:52: in ping_filter_subscriptions\n    ping_subscriptions_response = self.rest_call(\"get\", f\"filter/v2/subscriptions/{quote(request_id, safe='')}\")\nsrc/node/api_clients/rest.py:16: in rest_call\n    return self.make_request(method, url, headers=headers, data=payload)\nsrc/node/api_clients/base_client.py:17: in make_request\n    raise Exception(f\"Error: {http_err} with response: {response.content}\")\nE   Exception: Error: 500 Server Error: Internal Server Error for url: http://127.0.0.1:44902/filter/v2/subscriptions/b913b908-550e-4188-a12f-ee2e1e7b89a2 with response: b'{\"requestId\":\"b913b908-550e-4188-a12f-ee2e1e7b89a2\",\"statusDesc\":\"ping request failed\"}'\n\nDuring handling of the above exception, another exception occurred:\ntests/filter/test_multiple_nodes.py:55: in test_ping_only_some_nodes_have_subscriptions\n    self.ping_without_filter_subscription(node=node)\nsrc/steps/filter.py:185: in ping_without_filter_subscription\n    assert \"peer has no subscription\" in str(ex)\nE   AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"set_allure_env_variables","time":{"start":1705896663310,"stop":1705896663310,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"attach_logs_on_fail","time":{"start":1705896811289,"stop":1705896811289,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"test_setup","time":{"start":1705896811290,"stop":1705896811290,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_main_relay_node","time":{"start":1705896811290,"stop":1705896812910,"duration":1620},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"filter_setup","time":{"start":1705896811290,"stop":1705896811290,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"test_id","time":{"start":1705896811290,"stop":1705896811290,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"close_open_nodes","time":{"start":1705896811290,"stop":1705896811290,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_main_filter_node","time":{"start":1705896812910,"stop":1705896814506,"duration":1596},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"AssertionError","statusTrace":"src/node/api_clients/base_client.py:14: in make_request\n    response.raise_for_status()\n/opt/hostedtoolcache/Python/3.12.1/x64/lib/python3.12/site-packages/requests/models.py:1021: in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\nE   requests.exceptions.HTTPError: 500 Server Error: Internal Server Error for url: http://127.0.0.1:44902/filter/v2/subscriptions/b913b908-550e-4188-a12f-ee2e1e7b89a2\n\nDuring handling of the above exception, another exception occurred:\nsrc/steps/filter.py:182: in ping_without_filter_subscription\n    self.ping_filter_subscriptions(str(uuid4()), node=node)\nsrc/steps/filter.py:176: in ping_filter_subscriptions\n    ping_sub_response = node.ping_filter_subscriptions(request_id)\nsrc/node/waku_node.py:159: in ping_filter_subscriptions\n    return self._api.ping_filter_subscriptions(request_id)\nsrc/node/api_clients/rest.py:52: in ping_filter_subscriptions\n    ping_subscriptions_response = self.rest_call(\"get\", f\"filter/v2/subscriptions/{quote(request_id, safe='')}\")\nsrc/node/api_clients/rest.py:16: in rest_call\n    return self.make_request(method, url, headers=headers, data=payload)\nsrc/node/api_clients/base_client.py:17: in make_request\n    raise Exception(f\"Error: {http_err} with response: {response.content}\")\nE   Exception: Error: 500 Server Error: Internal Server Error for url: http://127.0.0.1:44902/filter/v2/subscriptions/b913b908-550e-4188-a12f-ee2e1e7b89a2 with response: b'{\"requestId\":\"b913b908-550e-4188-a12f-ee2e1e7b89a2\",\"statusDesc\":\"ping request failed\"}'\n\nDuring handling of the above exception, another exception occurred:\ntests/filter/test_multiple_nodes.py:55: in test_ping_only_some_nodes_have_subscriptions\n    self.ping_without_filter_subscription(node=node)\nsrc/steps/filter.py:185: in ping_without_filter_subscription\n    assert \"peer has no subscription\" in str(ex)\nE   AssertionError","steps":[{"name":"wait_for_subscriptions_on_main_nodes","time":{"start":1705896814507,"stop":1705896814571,"duration":64},"status":"passed","steps":[{"name":"create_filter_subscription_with_retry","time":{"start":1705896814526,"stop":1705896814571,"duration":45},"status":"passed","steps":[{"name":"create_filter_subscription","time":{"start":1705896814526,"stop":1705896814571,"duration":45},"status":"passed","steps":[],"attachments":[],"parameters":[{"name":"subscription","value":"{'requestId': '488ba7b9-1fa9-40fd-a8a1-2422bf8339ec', 'contentFilters': ['/test/1/waku-filter/proto'], 'pubsubTopic': '/waku/2/rs/0/1'}"},{"name":"node","value":"None"}],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"subscription","value":"{'requestId': '488ba7b9-1fa9-40fd-a8a1-2422bf8339ec', 'contentFilters': ['/test/1/waku-filter/proto'], 'pubsubTopic': '/waku/2/rs/0/1'}"},{"name":"node","value":"None"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"content_topic_list","value":"['/test/1/waku-filter/proto']"},{"name":"pubsub_topic","value":"None"}],"shouldDisplayMessage":false,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"ping_filter_subscriptions","time":{"start":1705896819903,"stop":1705896819914,"duration":11},"status":"passed","steps":[],"attachments":[],"parameters":[{"name":"request_id","value":"'1'"},{"name":"node","value":"<src.node.waku_node.WakuNode object at 0x7f3ed5cda930>"}],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"ping_filter_subscriptions","time":{"start":1705896819915,"stop":1705896819974,"duration":59},"status":"broken","statusMessage":"Exception: Error: 404 Client Error: Not Found for url: http://127.0.0.1:20833/filter/v2/subscriptions/ae49cad4-d695-4d0c-919c-60fca81d1686 with response: b'{\"requestId\":\"ae49cad4-d695-4d0c-919c-60fca81d1686\",\"statusCode\":404,\"statusDesc\":\"NOT_FOUND: peer has no subscriptions\"}'\n","statusTrace":"  File \"/opt/hostedtoolcache/Python/3.12.1/x64/lib/python3.12/site-packages/allure_commons/_allure.py\", line 192, in impl\n    return func(*a, **kw)\n           ^^^^^^^^^^^^^^\n  File \"/home/runner/work/waku-interop-tests/waku-interop-tests/src/steps/filter.py\", line 176, in ping_filter_subscriptions\n    ping_sub_response = node.ping_filter_subscriptions(request_id)\n                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/waku-interop-tests/waku-interop-tests/src/node/waku_node.py\", line 159, in ping_filter_subscriptions\n    return self._api.ping_filter_subscriptions(request_id)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/waku-interop-tests/waku-interop-tests/src/node/api_clients/rest.py\", line 52, in ping_filter_subscriptions\n    ping_subscriptions_response = self.rest_call(\"get\", f\"filter/v2/subscriptions/{quote(request_id, safe='')}\")\n                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/waku-interop-tests/waku-interop-tests/src/node/api_clients/rest.py\", line 16, in rest_call\n    return self.make_request(method, url, headers=headers, data=payload)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/waku-interop-tests/waku-interop-tests/src/node/api_clients/base_client.py\", line 17, in make_request\n    raise Exception(f\"Error: {http_err} with response: {response.content}\")\n","steps":[],"attachments":[],"parameters":[{"name":"request_id","value":"'ae49cad4-d695-4d0c-919c-60fca81d1686'"},{"name":"node","value":"<src.node.waku_node.WakuNode object at 0x7f3ed5ce6d20>"}],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"ping_filter_subscriptions","time":{"start":1705896819975,"stop":1705896822454,"duration":2479},"status":"broken","statusMessage":"Exception: Error: 500 Server Error: Internal Server Error for url: http://127.0.0.1:44902/filter/v2/subscriptions/b913b908-550e-4188-a12f-ee2e1e7b89a2 with response: b'{\"requestId\":\"b913b908-550e-4188-a12f-ee2e1e7b89a2\",\"statusDesc\":\"ping request failed\"}'\n","statusTrace":"  File \"/opt/hostedtoolcache/Python/3.12.1/x64/lib/python3.12/site-packages/allure_commons/_allure.py\", line 192, in impl\n    return func(*a, **kw)\n           ^^^^^^^^^^^^^^\n  File \"/home/runner/work/waku-interop-tests/waku-interop-tests/src/steps/filter.py\", line 176, in ping_filter_subscriptions\n    ping_sub_response = node.ping_filter_subscriptions(request_id)\n                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/waku-interop-tests/waku-interop-tests/src/node/waku_node.py\", line 159, in ping_filter_subscriptions\n    return self._api.ping_filter_subscriptions(request_id)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/waku-interop-tests/waku-interop-tests/src/node/api_clients/rest.py\", line 52, in ping_filter_subscriptions\n    ping_subscriptions_response = self.rest_call(\"get\", f\"filter/v2/subscriptions/{quote(request_id, safe='')}\")\n                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/waku-interop-tests/waku-interop-tests/src/node/api_clients/rest.py\", line 16, in rest_call\n    return self.make_request(method, url, headers=headers, data=payload)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/waku-interop-tests/waku-interop-tests/src/node/api_clients/base_client.py\", line 17, in make_request\n    raise Exception(f\"Error: {http_err} with response: {response.content}\")\n","steps":[],"attachments":[],"parameters":[{"name":"request_id","value":"'b913b908-550e-4188-a12f-ee2e1e7b89a2'"},{"name":"node","value":"<src.node.waku_node.WakuNode object at 0x7f3ed4c111f0>"}],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[{"uid":"29e98c3107ec70fc","name":"log","source":"29e98c3107ec70fc.txt","type":"text/plain","size":20695}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":6,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"test_setup::0","time":{"start":1705896822507,"stop":1705896822508,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"close_open_nodes::0","time":{"start":1705896822509,"stop":1705896835895,"duration":13386},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"attach_logs_on_fail::0","time":{"start":1705896835896,"stop":1705896835900,"duration":4},"status":"passed","steps":[],"attachments":[{"uid":"74cb126ec30b06ef","name":"node1_2024-01-22_04-13-31__bbb0444d-5bc5-4db6-8919-b7f6405535e2__harbor.status.im_wakuorg_nwaku:latest.log","source":"74cb126ec30b06ef.txt","type":"text/plain","size":241174},{"uid":"2fc9bdbd342da339","name":"node2_2024-01-22_04-13-31__bbb0444d-5bc5-4db6-8919-b7f6405535e2__harbor.status.im_wakuorg_nwaku:latest.log","source":"2fc9bdbd342da339.txt","type":"text/plain","size":131658},{"uid":"ce5eda8f84f911aa","name":"additional_node3_2024-01-22_04-13-31__bbb0444d-5bc5-4db6-8919-b7f6405535e2__harbor.status.im_wakuorg_nwaku:latest.log","source":"ce5eda8f84f911aa.txt","type":"text/plain","size":65139},{"uid":"296f75b8949d9cb5","name":"additional_node2_2024-01-22_04-13-31__bbb0444d-5bc5-4db6-8919-b7f6405535e2__harbor.status.im_wakuorg_go-waku:latest.log","source":"296f75b8949d9cb5.txt","type":"text/plain","size":74029},{"uid":"7e2a46caebab711e","name":"additional_node1_2024-01-22_04-13-31__bbb0444d-5bc5-4db6-8919-b7f6405535e2__harbor.status.im_wakuorg_nwaku:latest.log","source":"7e2a46caebab711e.txt","type":"text/plain","size":159755}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":5,"hasContent":true,"attachmentStep":false},{"name":"set_allure_env_variables::0","time":{"start":1705897097131,"stop":1705897097132,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"@pytest.mark.usefixtures('setup_main_relay_node', 'setup_main_filter_node')"},{"name":"parentSuite","value":"tests.filter"},{"name":"suite","value":"test_multiple_nodes"},{"name":"subSuite","value":"TestFilterMultipleNodes"},{"name":"host","value":"fv-az1153-664"},{"name":"thread","value":"2074-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.filter.test_multiple_nodes"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":true,"retry":true,"extra":{"categories":[],"tags":["@pytest.mark.usefixtures('setup_main_relay_node', 'setup_main_filter_node')"]},"source":"d0004bb132dba092.json","parameterValues":[]}