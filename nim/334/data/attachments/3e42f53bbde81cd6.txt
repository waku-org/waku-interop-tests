[35mDEBUG   [0m tests.conftest:conftest.py:51 Running fixture setup: test_id
[35mDEBUG   [0m tests.conftest:conftest.py:57 Running test: test_light_push_and_retrieve_duplicate_message with id: 2024-08-27_04-23-46__2bc05b80-5ed8-4131-bad6-40b8c61df8a4
[35mDEBUG   [0m src.steps.common:common.py:17 Running fixture setup: common_setup
[35mDEBUG   [0m src.steps.light_push:light_push.py:27 Running fixture setup: light_push_setup
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:17 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:84 WakuNode instance initialized with log path ./log/docker/receiving_node1_2024-08-27_04-23-46__2bc05b80-5ed8-4131-bad6-40b8c61df8a4__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:88 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:20 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:23 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:80 Generated random external IP 172.18.214.27
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:73 Generated ports ['15769', '15770', '15771', '15772', '15773']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:430 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:162 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:164 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:47 docker run -i -t -p 15769:15769 -p 15770:15770 -p 15771:15771 -p 15772:15772 -p 15773:15773 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=15771 --rest-port=15769 --tcp-port=15770 --discv5-udp-port=15772 --rest-address=0.0.0.0 --nat=extip:172.18.214.27 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=2b7ecffdc79b3fdbccf9c12fd50efd3bfe21137d7581733a7f0a2a876c848d39 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=15773 --metrics-logging=true --lightpush=true --relay=true
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:53 docker network connect --ip 172.18.214.27 waku 8a76492bae4a1b91c3063e32f134674ea4e4248672050914f041ce3ecc70ea97
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:56 Container started with ID 8a76492bae4a. Setting up logs at ./log/docker/receiving_node1_2024-08-27_04-23-46__2bc05b80-5ed8-4131-bad6-40b8c61df8a4__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:176 Started container from image wakuorg/nwaku:latest. REST: 15769
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:15769/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:276 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:15769/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.214.27/tcp/15770/p2p/16Uiu2HAmKXXVgaipePNKBy3iRRqSdf51VaDK5RCQk46D5scuYzL3","/ip4/172.18.214.27/tcp/15771/ws/p2p/16Uiu2HAmKXXVgaipePNKBy3iRRqSdf51VaDK5RCQk46D5scuYzL3"],"enrUri":"enr:-LO4QIKLeLT1vgxnJloiXa9t4FsmG5bRWaVddj6_zspOnmSUOpC3ffrM546ztHQktvaC9un_--upScLBV5JxI8jZ48ABgmlkgnY0gmlwhKwS1huKbXVsdGlhZGRyc4wACgSsEtYbBj2b3QOCcnOFAAMBAACJc2VjcDI1NmsxoQNmGGCgqvf0FhZzSyoBAffPj7S_555EZyoURcOF78u8zIN0Y3CCPZqDdWRwgj2chXdha3UyCQ"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:281 REST service is ready !!
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:17 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:84 WakuNode instance initialized with log path ./log/docker/receiving_node2_2024-08-27_04-23-46__2bc05b80-5ed8-4131-bad6-40b8c61df8a4__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:88 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:20 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:23 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:80 Generated random external IP 172.18.14.41
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:73 Generated ports ['59117', '59118', '59119', '59120', '59121']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:430 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:162 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:164 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:47 docker run -i -t -p 59117:59117 -p 59118:59118 -p 59119:59119 -p 59120:59120 -p 59121:59121 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=59119 --rest-port=59117 --tcp-port=59118 --discv5-udp-port=59120 --rest-address=0.0.0.0 --nat=extip:172.18.14.41 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=afdcc322d08dcfd2cfa01fbde1dbba52710796df7466aa9eec1abf8d52b7e9e6 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=59121 --metrics-logging=true --lightpush=false --relay=true
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:53 docker network connect --ip 172.18.14.41 waku eb94f189b0dc30a0c087e1f1fe6a1443008dcf3fca2f418c14add4e0e97dd793
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:56 Container started with ID eb94f189b0dc. Setting up logs at ./log/docker/receiving_node2_2024-08-27_04-23-46__2bc05b80-5ed8-4131-bad6-40b8c61df8a4__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:176 Started container from image wakuorg/nwaku:latest. REST: 59117
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:59117/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:276 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:59117/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.14.41/tcp/59118/p2p/16Uiu2HAmTLtKMcPk71vrBnBVfit7tH342Z2qiGUx2UoaNkQdvoD5","/ip4/172.18.14.41/tcp/59119/ws/p2p/16Uiu2HAmTLtKMcPk71vrBnBVfit7tH342Z2qiGUx2UoaNkQdvoD5"],"enrUri":"enr:-LO4QPpVc45BQL_AEK8woq3KlHGw2letVdsjrV-lJDx2uVIUOom211YEDzGXYdX93X2bV6gkCF0Yx5tEyQ-i7Vj43HYBgmlkgnY0gmlwhKwSDimKbXVsdGlhZGRyc4wACgSsEg4pBubv3QOCcnOFAAMBAACJc2VjcDI1NmsxoQPaPAcEhsvLTRCsuIMX5k_iN3Vm_YkkZufJNIinCxFrXIN0Y3CC5u6DdWRwgubwhXdha3UyAQ"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:281 REST service is ready !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:59117/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.214.27/tcp/15770/p2p/16Uiu2HAmKXXVgaipePNKBy3iRRqSdf51VaDK5RCQk46D5scuYzL3"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:17 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:84 WakuNode instance initialized with log path ./log/docker/lightpush_node1_2024-08-27_04-23-46__2bc05b80-5ed8-4131-bad6-40b8c61df8a4__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:88 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:20 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:23 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:80 Generated random external IP 172.18.239.51
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:73 Generated ports ['23170', '23171', '23172', '23173', '23174']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:430 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:162 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:164 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:47 docker run -i -t -p 23170:23170 -p 23171:23171 -p 23172:23172 -p 23173:23173 -p 23174:23174 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=23172 --rest-port=23170 --tcp-port=23171 --discv5-udp-port=23173 --rest-address=0.0.0.0 --nat=extip:172.18.239.51 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=5eb9bb4cb6567d2cfeb301a024d9f7c7e28c6bfe18ddcb71afffbedcdfee25d4 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=23174 --metrics-logging=true --discv5-bootstrap-node=enr:-LO4QIKLeLT1vgxnJloiXa9t4FsmG5bRWaVddj6_zspOnmSUOpC3ffrM546ztHQktvaC9un_--upScLBV5JxI8jZ48ABgmlkgnY0gmlwhKwS1huKbXVsdGlhZGRyc4wACgSsEtYbBj2b3QOCcnOFAAMBAACJc2VjcDI1NmsxoQNmGGCgqvf0FhZzSyoBAffPj7S_555EZyoURcOF78u8zIN0Y3CCPZqDdWRwgj2chXdha3UyCQ --lightpushnode=/ip4/172.18.214.27/tcp/15770/p2p/16Uiu2HAmKXXVgaipePNKBy3iRRqSdf51VaDK5RCQk46D5scuYzL3 --lightpush=true --relay=false
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:53 docker network connect --ip 172.18.239.51 waku b23f2680a0da719b5af774f841ad9b94bc436ddf972f0093b2e0c9a5a7a8e7ec
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:56 Container started with ID b23f2680a0da. Setting up logs at ./log/docker/lightpush_node1_2024-08-27_04-23-46__2bc05b80-5ed8-4131-bad6-40b8c61df8a4__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:176 Started container from image wakuorg/nwaku:latest. REST: 23170
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:23170/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:276 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:23170/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.239.51/tcp/23171/p2p/16Uiu2HAmKBPAt4xp5wL6Xb8jFWyHiGwzgCPg5sdNfandiSMkgAVu","/ip4/172.18.239.51/tcp/23172/ws/p2p/16Uiu2HAmKBPAt4xp5wL6Xb8jFWyHiGwzgCPg5sdNfandiSMkgAVu"],"enrUri":"enr:-LO4QEhECJbQr0k1mg4jrH1xTeFmPxBbcmqA2-De483Cwv5oQoEM351grJTWY2UdpQ01DnAZLBKCoQlAjXx0cJCWlRMBgmlkgnY0gmlwhKwS7zOKbXVsdGlhZGRyc4wACgSsEu8zBlqE3QOCcnOFAAMBAACJc2VjcDI1NmsxoQNg71lekrorZRY6LBudcdecs3WHvynF-tIjP9dUP-df2IN0Y3CCWoODdWRwglqFhXdha3UyCA"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:281 REST service is ready !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:23170/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.214.27/tcp/15770/p2p/16Uiu2HAmKXXVgaipePNKBy3iRRqSdf51VaDK5RCQk46D5scuYzL3"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:23170/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.14.41/tcp/59118/p2p/16Uiu2HAmTLtKMcPk71vrBnBVfit7tH342Z2qiGUx2UoaNkQdvoD5"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:15769/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:59117/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.steps.light_push:light_push.py:120 Lightpushing message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:23170/lightpush/v1/message" -H "Content-Type: application/json" -d '{"pubsubTopic": "/waku/2/rs/3/0", "message": {"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": 1724732632003355392}}'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 0.1 seconds
[35mDEBUG   [0m src.steps.light_push:light_push.py:124 Checking that peer NODE_1:wakuorg/nwaku:latest can find the lightpushed message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:15769/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1724732632003355392,"ephemeral":false}]'
[35mDEBUG   [0m src.steps.light_push:light_push.py:124 Checking that peer NODE_2:wakuorg/nwaku:latest can find the lightpushed message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:59117/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1724732632003355392,"ephemeral":false}]'
[35mDEBUG   [0m src.steps.light_push:light_push.py:120 Lightpushing message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:23170/lightpush/v1/message" -H "Content-Type: application/json" -d '{"pubsubTopic": "/waku/2/rs/3/0", "message": {"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": 1724732632003355392}}'
[31m[1mERROR   [0m src.node.api_clients.base_client:base_client.py:16 HTTP error occurred: 503 Server Error: Service Unavailable for url: http://127.0.0.1:23170/lightpush/v1/message. Response content: b'Failed to request a message push: Lightpush request has not been published to any peers. msg_hash: 0xa4fa4b1ab65fd40861ba70e236f26bd6cdf8ab34d811b666e2ae250a0b7a1356'
[35mDEBUG   [0m tests.conftest:conftest.py:59 Running fixture teardown: test_setup
[35mDEBUG   [0m tests.conftest:conftest.py:83 Running fixture teardown: close_open_nodes
[35mDEBUG   [0m src.node.waku_node:waku_node.py:220 Stopping container with id 8a76492bae4a
[35mDEBUG   [0m src.node.waku_node:waku_node.py:227 Container stopped.
[35mDEBUG   [0m src.node.waku_node:waku_node.py:220 Stopping container with id eb94f189b0dc
[35mDEBUG   [0m src.node.waku_node:waku_node.py:227 Container stopped.
[35mDEBUG   [0m src.node.waku_node:waku_node.py:220 Stopping container with id b23f2680a0da
[35mDEBUG   [0m src.node.waku_node:waku_node.py:227 Container stopped.