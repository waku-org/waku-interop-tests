2025-02-10 04:04:07.979 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-10 04:04:07.980 DEBUG [tests.conftest] Running test: test_publish_with_invalid_content_topics with id: 2025-02-10_04-04-07__7a8d13f5-c5c6-450d-bd77-ddcf0861b214
2025-02-10 04:04:07.980 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-10 04:04:07.980 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-10 04:04:07.980 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-10 04:04:07.986 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-10 04:04:07.987 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-10_04-04-07__7a8d13f5-c5c6-450d-bd77-ddcf0861b214__wakuorg_nwaku:latest.log
2025-02-10 04:04:07.987 DEBUG [src.node.waku_node] Starting Node...
2025-02-10 04:04:07.987 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-10 04:04:07.988 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-10 04:04:07.988 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.203.79
2025-02-10 04:04:07.988 DEBUG [src.node.docker_mananger] Generated ports ['14070', '14071', '14072', '14073', '14074']
2025-02-10 04:04:07.988 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-10 04:04:07.989 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-10 04:04:07.989 DEBUG [src.node.waku_node] Using volumes []
2025-02-10 04:04:07.989 DEBUG [src.node.docker_mananger] docker run -i -t -p 14070:14070 -p 14071:14071 -p 14072:14072 -p 14073:14073 -p 14074:14074 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=14072 --rest-port=14070 --tcp-port=14071 --discv5-udp-port=14073 --rest-address=0.0.0.0 --nat=extip:172.18.203.79 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=485d0ebcc5bbbfd741f20846deedfcae9a4aa5ccbcc6df83eb6e6fbe10a31b8b --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=14074 --metrics-logging=true --relay=true
2025-02-10 04:04:08.213 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.203.79 waku 58c368715aa85208b586f967de029fa3d7c3a309a5b130f7864b229cc38fd025
2025-02-10 04:04:08.263 DEBUG [src.node.docker_mananger] Container started with ID 58c368715aa8. Setting up logs at ./log/docker/node1_2025-02-10_04-04-07__7a8d13f5-c5c6-450d-bd77-ddcf0861b214__wakuorg_nwaku:latest.log
2025-02-10 04:04:08.264 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 14070
2025-02-10 04:04:08.264 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-10 04:04:08.767 ERROR [src.node.docker_mananger] Max retries reached for container 685cb5e5ed2a. Exiting log stream.
2025-02-10 04:04:09.265 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:14070/health" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:04:09.267 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-10 04:04:09.267 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-10 04:04:09.267 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:14070/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:04:09.269 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.203.79/tcp/14071/p2p/16Uiu2HAmLS8Hy5exYUN1bkkHgV1KjTsky77U7otCcktUT6LsV8vY","/ip4/172.18.203.79/tcp/14072/ws/p2p/16Uiu2HAmLS8Hy5exYUN1bkkHgV1KjTsky77U7otCcktUT6LsV8vY"],"enrUri":"enr:-L24QK_SZmfWBenYCVNIj3YtVwCA5bXz6MwmSRMPUtQS5L6ebCIx7NfXsoXz_4mgTYjGvGjbWemvMMr3oHiBChlWnfsCgmlkgnY0gmlwhKwSy0-KbXVsdGlhZGRyc5YACASsEstPBjb3AAoErBLLTwY2-N0DgnJzhQADAQAAiXNlY3AyNTZrMaEDc5Hs_mHNxZSdaoodm19j940ihfgYV6W35Aglq_se-b2DdGNwgjb3g3VkcII2-YV3YWt1MgE"}'
2025-02-10 04:04:09.270 INFO [src.node.waku_node] REST service is ready !!
2025-02-10 04:04:09.275 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-10 04:04:09.275 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-10_04-04-07__7a8d13f5-c5c6-450d-bd77-ddcf0861b214__wakuorg_nwaku:latest.log
2025-02-10 04:04:09.276 DEBUG [src.node.waku_node] Starting Node...
2025-02-10 04:04:09.276 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-10 04:04:09.277 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-10 04:04:09.277 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.219.68
2025-02-10 04:04:09.277 DEBUG [src.node.docker_mananger] Generated ports ['34001', '34002', '34003', '34004', '34005']
2025-02-10 04:04:09.277 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-10 04:04:09.278 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-10 04:04:09.278 DEBUG [src.node.waku_node] Using volumes []
2025-02-10 04:04:09.278 DEBUG [src.node.docker_mananger] docker run -i -t -p 34001:34001 -p 34002:34002 -p 34003:34003 -p 34004:34004 -p 34005:34005 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=34003 --rest-port=34001 --tcp-port=34002 --discv5-udp-port=34004 --rest-address=0.0.0.0 --nat=extip:172.18.219.68 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=e8dc2bfdcc37a7ce3addbf9f6ba8f569a74efcaebcdea061c977fe498b90d84f --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=34005 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QK_SZmfWBenYCVNIj3YtVwCA5bXz6MwmSRMPUtQS5L6ebCIx7NfXsoXz_4mgTYjGvGjbWemvMMr3oHiBChlWnfsCgmlkgnY0gmlwhKwSy0-KbXVsdGlhZGRyc5YACASsEstPBjb3AAoErBLLTwY2-N0DgnJzhQADAQAAiXNlY3AyNTZrMaEDc5Hs_mHNxZSdaoodm19j940ihfgYV6W35Aglq_se-b2DdGNwgjb3g3VkcII2-YV3YWt1MgE
2025-02-10 04:04:09.502 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.219.68 waku 781ae654491138b180ab4ed03b91f22b3cf1caca85f540fab9ce1cca700f1ffa
2025-02-10 04:04:09.548 DEBUG [src.node.docker_mananger] Container started with ID 781ae6544911. Setting up logs at ./log/docker/node2_2025-02-10_04-04-07__7a8d13f5-c5c6-450d-bd77-ddcf0861b214__wakuorg_nwaku:latest.log
2025-02-10 04:04:09.549 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 34001
2025-02-10 04:04:09.549 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-10 04:04:10.550 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:34001/health" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:04:10.564 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-10 04:04:10.564 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-10 04:04:10.564 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:34001/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:04:10.567 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.219.68/tcp/34002/p2p/16Uiu2HAmBPuyhnZ5xMUeXwza1dXPLeA9CfFg6FcDP67ETbh8Q7dH","/ip4/172.18.219.68/tcp/34003/ws/p2p/16Uiu2HAmBPuyhnZ5xMUeXwza1dXPLeA9CfFg6FcDP67ETbh8Q7dH"],"enrUri":"enr:-L24QPrrlspl4TAP7Wkr3Ame7QISaBjKOCjD1CvX-aNWhAVPMSr7RH5oRXVP8Pkadh1kIUZPJZOkBk8l6IzQMOQ3cAMCgmlkgnY0gmlwhKwS20SKbXVsdGlhZGRyc5YACASsEttEBoTSAAoErBLbRAaE090DgnJzhQADAQAAiXNlY3AyNTZrMaEC7UeoRWhzd20e5k4E_uimn3XMhPtiJcigUQVId2MVn5iDdGNwgoTSg3VkcIKE1IV3YWt1MgE"}'
2025-02-10 04:04:10.567 INFO [src.node.waku_node] REST service is ready !!
2025-02-10 04:04:10.567 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:34001/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.203.79/tcp/14071/p2p/16Uiu2HAmLS8Hy5exYUN1bkkHgV1KjTsky77U7otCcktUT6LsV8vY"]'
2025-02-10 04:04:10.570 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:04:10.570 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-10 04:04:10.571 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:14070/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-10 04:04:10.574 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:04:10.575 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:34001/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-10 04:04:10.580 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:04:10.581 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:14070/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-10 04:04:10.588 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:04:10.589 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-10 04:04:10.689 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-10 04:04:10.689 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:14070/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:04:10.691 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739160250581841152,"ephemeral":false}]'
2025-02-10 04:04:10.693 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-10 04:04:10.693 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:34001/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:04:10.695 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739160250581841152,"ephemeral":false}]'
2025-02-10 04:04:10.696 INFO [src.steps.relay] WARM UP successful!!
2025-02-10 04:04:10.697 DEBUG [tests.relay.test_publish] Running test with contetn topic Empty string
2025-02-10 04:04:10.697 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:14070/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "", "timestamp": '$(date +%s%N)'}'
2025-02-10 04:04:10.700 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:14070/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-10 04:04:10.700 DEBUG [tests.relay.test_publish] Running test with contetn topic A dictionary
2025-02-10 04:04:10.700 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:14070/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": {"key": "YWFh"}, "timestamp": '$(date +%s%N)'}'
2025-02-10 04:04:10.702 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:14070/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-10 04:04:10.703 DEBUG [tests.relay.test_publish] Running test with contetn topic An integer
2025-02-10 04:04:10.703 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:14070/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": 1234567890, "timestamp": '$(date +%s%N)'}'
2025-02-10 04:04:10.705 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:14070/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-10 04:04:10.706 DEBUG [tests.relay.test_publish] Running test with contetn topic A list
2025-02-10 04:04:10.706 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:14070/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": ["YWFh"], "timestamp": '$(date +%s%N)'}'
2025-02-10 04:04:10.708 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:14070/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-10 04:04:10.708 DEBUG [tests.relay.test_publish] Running test with contetn topic A bool
2025-02-10 04:04:10.708 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:14070/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": true, "timestamp": '$(date +%s%N)'}'
2025-02-10 04:04:10.710 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:14070/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-10 04:04:10.712 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-10 04:04:10.713 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-10 04:04:10.713 DEBUG [src.node.waku_node] Stopping container with id 58c368715aa8
2025-02-10 04:04:11.752 DEBUG [src.node.waku_node] Container stopped.
2025-02-10 04:04:11.752 DEBUG [src.node.waku_node] Stopping container with id 781ae6544911
2025-02-10 04:04:12.563 ERROR [src.node.docker_mananger] Max retries reached for container 58c368715aa8. Exiting log stream.
2025-02-10 04:04:13.238 DEBUG [src.node.waku_node] Container stopped.
2025-02-10 04:04:13.240 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-10 04:04:13.245 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-10 04:04:13.250 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
