2025-02-10 04:03:35.731 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-10 04:03:35.731 DEBUG [tests.conftest] Running test: test_relay_unsubscribe_from_single_pubsub_topic with id: 2025-02-10_04-03-35__30a6594a-9747-49fd-a651-5e2d5aec2bf1
2025-02-10 04:03:35.731 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-10 04:03:35.732 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-10 04:03:35.732 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-10 04:03:35.738 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-10 04:03:35.738 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-10_04-03-35__30a6594a-9747-49fd-a651-5e2d5aec2bf1__wakuorg_nwaku:latest.log
2025-02-10 04:03:35.738 DEBUG [src.node.waku_node] Starting Node...
2025-02-10 04:03:35.738 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-10 04:03:35.739 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-10 04:03:35.740 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.23.125
2025-02-10 04:03:35.740 DEBUG [src.node.docker_mananger] Generated ports ['12932', '12933', '12934', '12935', '12936']
2025-02-10 04:03:35.740 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-10 04:03:35.740 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-10 04:03:35.740 DEBUG [src.node.waku_node] Using volumes []
2025-02-10 04:03:35.740 DEBUG [src.node.docker_mananger] docker run -i -t -p 12932:12932 -p 12933:12933 -p 12934:12934 -p 12935:12935 -p 12936:12936 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=12934 --rest-port=12932 --tcp-port=12933 --discv5-udp-port=12935 --rest-address=0.0.0.0 --nat=extip:172.18.23.125 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=4c21976146cae3cdafb56b6f81f4c525aeafae7dcb5c95bc2cfc65af4cbdd6ef --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=12936 --metrics-logging=true --relay=true
2025-02-10 04:03:35.965 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.23.125 waku b57b119d003bf7349c100281aea3fb87cc967bfd8a61abe2cfc016b059e24243
2025-02-10 04:03:36.014 DEBUG [src.node.docker_mananger] Container started with ID b57b119d003b. Setting up logs at ./log/docker/node1_2025-02-10_04-03-35__30a6594a-9747-49fd-a651-5e2d5aec2bf1__wakuorg_nwaku:latest.log
2025-02-10 04:03:36.015 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 12932
2025-02-10 04:03:36.015 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-10 04:03:36.518 ERROR [src.node.docker_mananger] Max retries reached for container 812e9c3ab04e. Exiting log stream.
2025-02-10 04:03:37.016 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:12932/health" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:37.019 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-10 04:03:37.019 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-10 04:03:37.019 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:12932/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:37.022 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.23.125/tcp/12933/p2p/16Uiu2HAkxdNUUfmpMndKWHih3R8m4FxS68zwRwmCHiyJ5dbMgFys","/ip4/172.18.23.125/tcp/12934/ws/p2p/16Uiu2HAkxdNUUfmpMndKWHih3R8m4FxS68zwRwmCHiyJ5dbMgFys"],"enrUri":"enr:-L24QBLLB4ocj34qe4zQwJ36pRG1N9fFlbIUU1pe0xMwRgyCSxd_YGrBcKJ6Uo8re1bCXzt3OGBaNLObb4s3h7y3yrkCgmlkgnY0gmlwhKwSF32KbXVsdGlhZGRyc5YACASsEhd9BjKFAAoErBIXfQYyht0DgnJzhQADAQAAiXNlY3AyNTZrMaECL5I8rWtE8dD8DGcER4aoMaUexlPtdFJ8qIlg-a2xZXKDdGNwgjKFg3VkcIIyh4V3YWt1MgE"}'
2025-02-10 04:03:37.022 INFO [src.node.waku_node] REST service is ready !!
2025-02-10 04:03:37.028 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-10 04:03:37.028 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-10_04-03-35__30a6594a-9747-49fd-a651-5e2d5aec2bf1__wakuorg_nwaku:latest.log
2025-02-10 04:03:37.028 DEBUG [src.node.waku_node] Starting Node...
2025-02-10 04:03:37.028 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-10 04:03:37.029 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-10 04:03:37.029 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.160.114
2025-02-10 04:03:37.030 DEBUG [src.node.docker_mananger] Generated ports ['64624', '64625', '64626', '64627', '64628']
2025-02-10 04:03:37.030 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-10 04:03:37.030 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-10 04:03:37.030 DEBUG [src.node.waku_node] Using volumes []
2025-02-10 04:03:37.030 DEBUG [src.node.docker_mananger] docker run -i -t -p 64624:64624 -p 64625:64625 -p 64626:64626 -p 64627:64627 -p 64628:64628 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=64626 --rest-port=64624 --tcp-port=64625 --discv5-udp-port=64627 --rest-address=0.0.0.0 --nat=extip:172.18.160.114 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=2c7cd5cabb0b01a8fcbae1ad8e3bcdfea3d4b9ac2a4818114bbeeb8dcbd729ad --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=64628 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QBLLB4ocj34qe4zQwJ36pRG1N9fFlbIUU1pe0xMwRgyCSxd_YGrBcKJ6Uo8re1bCXzt3OGBaNLObb4s3h7y3yrkCgmlkgnY0gmlwhKwSF32KbXVsdGlhZGRyc5YACASsEhd9BjKFAAoErBIXfQYyht0DgnJzhQADAQAAiXNlY3AyNTZrMaECL5I8rWtE8dD8DGcER4aoMaUexlPtdFJ8qIlg-a2xZXKDdGNwgjKFg3VkcIIyh4V3YWt1MgE
2025-02-10 04:03:37.261 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.160.114 waku 4b0ab69efdae78026efafde4a1b099ba37eed1e1486569b7bdb23cecc4776c28
2025-02-10 04:03:37.310 DEBUG [src.node.docker_mananger] Container started with ID 4b0ab69efdae. Setting up logs at ./log/docker/node2_2025-02-10_04-03-35__30a6594a-9747-49fd-a651-5e2d5aec2bf1__wakuorg_nwaku:latest.log
2025-02-10 04:03:37.311 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 64624
2025-02-10 04:03:37.311 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-10 04:03:38.312 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:64624/health" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:38.320 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-10 04:03:38.321 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-10 04:03:38.321 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:64624/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:38.325 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.160.114/tcp/64625/p2p/16Uiu2HAmA7Aa3h8wj1dMpQa968EGPUGXLJG5VUpotM3QFnziw2aG","/ip4/172.18.160.114/tcp/64626/ws/p2p/16Uiu2HAmA7Aa3h8wj1dMpQa968EGPUGXLJG5VUpotM3QFnziw2aG"],"enrUri":"enr:-L24QH46qR6EGba9fOXgJH49gsMle9ZIde27Xr49SSjrDm89G8wmJ1kI5B7tptJ2lX9gHI-xSzQ6lGaGS3vfioTi0hcCgmlkgnY0gmlwhKwSoHKKbXVsdGlhZGRyc5YACASsEqByBvxxAAoErBKgcgb8ct0DgnJzhQADAQAAiXNlY3AyNTZrMaEC2iGYkzRNSA31cUULEyzpy6qc8oHVZTnfg1ZWdVruwI2DdGNwgvxxg3VkcIL8c4V3YWt1MgE"}'
2025-02-10 04:03:38.325 INFO [src.node.waku_node] REST service is ready !!
2025-02-10 04:03:38.326 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:64624/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.23.125/tcp/12933/p2p/16Uiu2HAkxdNUUfmpMndKWHih3R8m4FxS68zwRwmCHiyJ5dbMgFys"]'
2025-02-10 04:03:38.329 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:03:38.330 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:12932/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-10 04:03:38.334 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:03:38.334 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:64624/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-10 04:03:38.340 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:03:38.341 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:12932/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-10 04:03:38.345 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:03:38.346 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-10 04:03:38.446 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-10 04:03:38.446 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:12932/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:38.449 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739160218341066496,"ephemeral":false}]'
2025-02-10 04:03:38.450 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-10 04:03:38.450 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:64624/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:38.453 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739160218341066496,"ephemeral":false}]'
2025-02-10 04:03:38.455 INFO [src.node.api_clients.base_client] curl -v -X DELETE "http://127.0.0.1:12932/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-10 04:03:38.459 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:03:38.460 INFO [src.node.api_clients.base_client] curl -v -X DELETE "http://127.0.0.1:64624/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-10 04:03:38.464 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:03:38.464 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:12932/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-10 04:03:38.467 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:12932/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Failed to publish: Node not subscribed to topic: /waku/2/rs/3/1'
2025-02-10 04:03:38.469 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-10 04:03:38.470 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-10 04:03:38.470 DEBUG [src.node.waku_node] Stopping container with id b57b119d003b
2025-02-10 04:03:39.507 DEBUG [src.node.waku_node] Container stopped.
2025-02-10 04:03:39.508 DEBUG [src.node.waku_node] Stopping container with id 4b0ab69efdae
2025-02-10 04:03:40.320 ERROR [src.node.docker_mananger] Max retries reached for container b57b119d003b. Exiting log stream.
2025-02-10 04:03:40.994 DEBUG [src.node.waku_node] Container stopped.
2025-02-10 04:03:40.996 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-10 04:03:41.001 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-10 04:03:41.006 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
