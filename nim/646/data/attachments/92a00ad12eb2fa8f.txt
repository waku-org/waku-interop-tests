2025-02-10 04:03:56.353 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-10 04:03:56.353 DEBUG [tests.conftest] Running test: test_metrics_after_store_get with id: 2025-02-10_04-03-56__e0a7b614-6d9a-495e-9c31-e1bc16a88c93
2025-02-10 04:03:56.354 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-10 04:03:56.354 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-10 04:03:56.354 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-10 04:03:56.354 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-10 04:03:56.355 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-10 04:03:56.355 DEBUG [src.steps.store] Running fixture setup: node_setup
2025-02-10 04:03:56.360 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-10 04:03:56.361 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/publishing_node1_2025-02-10_04-03-56__e0a7b614-6d9a-495e-9c31-e1bc16a88c93__wakuorg_nwaku:latest.log
2025-02-10 04:03:56.361 DEBUG [src.node.waku_node] Starting Node...
2025-02-10 04:03:56.361 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-10 04:03:56.362 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-10 04:03:56.362 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.140.6
2025-02-10 04:03:56.362 DEBUG [src.node.docker_mananger] Generated ports ['33195', '33196', '33197', '33198', '33199']
2025-02-10 04:03:56.363 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-10 04:03:56.363 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-10 04:03:56.363 DEBUG [src.node.waku_node] Using volumes []
2025-02-10 04:03:56.363 DEBUG [src.node.docker_mananger] docker run -i -t -p 33195:33195 -p 33196:33196 -p 33197:33197 -p 33198:33198 -p 33199:33199 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=33197 --rest-port=33195 --tcp-port=33196 --discv5-udp-port=33198 --rest-address=0.0.0.0 --nat=extip:172.18.140.6 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=9f9969434fd08e836de7bac6f07fee1fa148d2788cf1cfaecad2c87bd9c20ece --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=33199 --metrics-logging=true --store=true --relay=true
2025-02-10 04:03:56.576 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.140.6 waku c6e5f86a5803717aa0ec3e96cb49d54f73fb4c2354eebba11efe6d983efe33f5
2025-02-10 04:03:56.627 DEBUG [src.node.docker_mananger] Container started with ID c6e5f86a5803. Setting up logs at ./log/docker/publishing_node1_2025-02-10_04-03-56__e0a7b614-6d9a-495e-9c31-e1bc16a88c93__wakuorg_nwaku:latest.log
2025-02-10 04:03:56.628 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 33195
2025-02-10 04:03:56.629 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-10 04:03:57.101 ERROR [src.node.docker_mananger] Max retries reached for container cc9ecb1188fc. Exiting log stream.
2025-02-10 04:03:57.629 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33195/health" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:57.631 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-10 04:03:57.632 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-10 04:03:57.632 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33195/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:57.634 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.140.6/tcp/33196/p2p/16Uiu2HAm7A9Bp9wwWoLPdHDovTJLuj31A8AXofMqnU4TfViwWbSo","/ip4/172.18.140.6/tcp/33197/ws/p2p/16Uiu2HAm7A9Bp9wwWoLPdHDovTJLuj31A8AXofMqnU4TfViwWbSo"],"enrUri":"enr:-L24QCfOd40jtDevVpwgA0u5z0qbD-SZf1JfxCiBndcd6Vj2CWL42zdACqy43NSkH8t_JnmD7aauKGMxD1EzqZsiXTECgmlkgnY0gmlwhKwSjAaKbXVsdGlhZGRyc5YACASsEowGBoGsAAoErBKMBgaBrd0DgnJzhQADAQAAiXNlY3AyNTZrMaECrlG2qB-EJzYnpTGSTwxc3nZ41QHx8_j5Aklbul_HzSiDdGNwgoGsg3VkcIKBroV3YWt1MgM"}'
2025-02-10 04:03:57.634 INFO [src.node.waku_node] REST service is ready !!
2025-02-10 04:03:57.640 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-10 04:03:57.640 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/store_node1_2025-02-10_04-03-56__e0a7b614-6d9a-495e-9c31-e1bc16a88c93__wakuorg_nwaku:latest.log
2025-02-10 04:03:57.640 DEBUG [src.node.waku_node] Starting Node...
2025-02-10 04:03:57.640 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-10 04:03:57.642 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-10 04:03:57.642 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.113.60
2025-02-10 04:03:57.642 DEBUG [src.node.docker_mananger] Generated ports ['46209', '46210', '46211', '46212', '46213']
2025-02-10 04:03:57.642 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-10 04:03:57.642 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-10 04:03:57.642 DEBUG [src.node.waku_node] Using volumes []
2025-02-10 04:03:57.643 DEBUG [src.node.docker_mananger] docker run -i -t -p 46209:46209 -p 46210:46210 -p 46211:46211 -p 46212:46212 -p 46213:46213 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=46211 --rest-port=46209 --tcp-port=46210 --discv5-udp-port=46212 --rest-address=0.0.0.0 --nat=extip:172.18.113.60 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=4aa8dca2fc0c9dfeadfaf114a9fbbe2acc23113ddbe3cb3aa479ccfa1ce674eb --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=46213 --metrics-logging=true --discv5-bootstrap-node=enr:-L24QCfOd40jtDevVpwgA0u5z0qbD-SZf1JfxCiBndcd6Vj2CWL42zdACqy43NSkH8t_JnmD7aauKGMxD1EzqZsiXTECgmlkgnY0gmlwhKwSjAaKbXVsdGlhZGRyc5YACASsEowGBoGsAAoErBKMBgaBrd0DgnJzhQADAQAAiXNlY3AyNTZrMaECrlG2qB-EJzYnpTGSTwxc3nZ41QHx8_j5Aklbul_HzSiDdGNwgoGsg3VkcIKBroV3YWt1MgM --storenode=/ip4/172.18.140.6/tcp/33196/p2p/16Uiu2HAm7A9Bp9wwWoLPdHDovTJLuj31A8AXofMqnU4TfViwWbSo --store=true --relay=true
2025-02-10 04:03:57.857 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.113.60 waku d2a7d4350d86ffa7a07d406c6e4068d824b867543c6c51042eca6557591e2c92
2025-02-10 04:03:57.907 DEBUG [src.node.docker_mananger] Container started with ID d2a7d4350d86. Setting up logs at ./log/docker/store_node1_2025-02-10_04-03-56__e0a7b614-6d9a-495e-9c31-e1bc16a88c93__wakuorg_nwaku:latest.log
2025-02-10 04:03:57.909 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 46209
2025-02-10 04:03:57.909 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-10 04:03:58.909 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46209/health" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:58.912 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-10 04:03:58.912 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-10 04:03:58.912 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46209/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:58.914 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.113.60/tcp/46210/p2p/16Uiu2HAmL5vzVw2LioVATfr1cX8eHq6XpYMEqBiLyuMcVMNTmpyp","/ip4/172.18.113.60/tcp/46211/ws/p2p/16Uiu2HAmL5vzVw2LioVATfr1cX8eHq6XpYMEqBiLyuMcVMNTmpyp"],"enrUri":"enr:-L24QJNJxLrQ14AFu8gCaPJ1isY4aBuy2P8o_aI7ZN0B4-MiZCtVVlovfdqPjRLn_CYSUAAuJ5fYDVdO7D67lwqmwUUCgmlkgnY0gmlwhKwScTyKbXVsdGlhZGRyc5YACASsEnE8BrSCAAoErBJxPAa0g90DgnJzhQADAQAAiXNlY3AyNTZrMaEDbmWIAxV5IbY-FauAgSAVnsQ4SGY6s3NwGs2Ane8z_RuDdGNwgrSCg3VkcIK0hIV3YWt1MgM"}'
2025-02-10 04:03:58.914 INFO [src.node.waku_node] REST service is ready !!
2025-02-10 04:03:58.914 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46209/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.140.6/tcp/33196/p2p/16Uiu2HAm7A9Bp9wwWoLPdHDovTJLuj31A8AXofMqnU4TfViwWbSo"]'
2025-02-10 04:03:58.917 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:03:58.917 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:33195/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-10 04:03:58.921 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:03:58.921 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46209/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-10 04:03:58.927 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:03:58.929 DEBUG [src.steps.store] Relaying message
2025-02-10 04:03:58.929 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:33195/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-10 04:03:58.934 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:03:58.934 DEBUG [src.libs.common] Sleeping for 0.2 seconds
2025-02-10 04:03:59.135 DEBUG [src.steps.store] Checking that peer wakuorg/nwaku:latest can find the stored messages
2025-02-10 04:03:59.135 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33195/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F1&pageSize=50&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:59.138 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"","statusCode":200,"statusDesc":"OK","messages":[{"messageHash":"0x349da23c43285acfa9a93b01de3f18b80d07d778b254974f65e07ead9a0dae14"}]}'
2025-02-10 04:03:59.138 DEBUG [src.steps.store] Checking that peer wakuorg/nwaku:latest can find the stored messages
2025-02-10 04:03:59.138 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46209/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F1&pageSize=50&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:59.141 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"","statusCode":200,"statusDesc":"OK","messages":[{"messageHash":"0x349da23c43285acfa9a93b01de3f18b80d07d778b254974f65e07ead9a0dae14"}]}'
2025-02-10 04:03:59.141 DEBUG [src.libs.common] Sleeping for 5 seconds
2025-02-10 04:04:04.141 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-10 04:04:04.145 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-10 04:04:04.146 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-10 04:04:04.149 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-10 04:04:04.149 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-10 04:04:04.152 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-10 04:04:04.152 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-10 04:04:04.155 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-10 04:04:04.155 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-10 04:04:04.158 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-10 04:04:04.158 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-10 04:04:04.161 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 1.0
2025-02-10 04:04:04.161 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-10 04:04:04.164 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 1.0
2025-02-10 04:04:04.164 DEBUG [src.steps.metrics] Checking metric: waku_service_peers{protocol="/vac/waku/store/2.0.0-beta4",peerId="/ip4/172.18.140.6/tcp/33196"} has 1
2025-02-10 04:04:04.168 DEBUG [src.steps.metrics] Found metric: waku_service_peers{protocol="/vac/waku/store/2.0.0-beta4",peerId="/ip4/172.18.140.6/tcp/33196"} with value 1.0
2025-02-10 04:04:04.168 DEBUG [src.steps.metrics] Checking metric: waku_service_peers{protocol="/vac/waku/store-query/3.0.0",peerId="/ip4/172.18.140.6/tcp/33196"} has 1
2025-02-10 04:04:04.171 DEBUG [src.steps.metrics] Found metric: waku_service_peers{protocol="/vac/waku/store-query/3.0.0",peerId="/ip4/172.18.140.6/tcp/33196"} with value 1.0
2025-02-10 04:04:04.171 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-10 04:04:04.174 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-10 04:04:04.174 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-10 04:04:04.177 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-10 04:04:04.177 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-10 04:04:04.180 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-10 04:04:04.180 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-10 04:04:04.183 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-10 04:04:04.183 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-10 04:04:04.186 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-10 04:04:04.186 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-10 04:04:04.189 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 1.0
2025-02-10 04:04:04.189 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-10 04:04:04.192 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 1.0
2025-02-10 04:04:04.194 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-10 04:04:04.195 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-10 04:04:04.195 DEBUG [src.node.waku_node] Stopping container with id c6e5f86a5803
2025-02-10 04:04:05.684 DEBUG [src.node.waku_node] Container stopped.
2025-02-10 04:04:05.684 DEBUG [src.node.waku_node] Stopping container with id d2a7d4350d86
2025-02-10 04:04:06.496 ERROR [src.node.docker_mananger] Max retries reached for container c6e5f86a5803. Exiting log stream.
2025-02-10 04:04:06.872 DEBUG [src.node.waku_node] Container stopped.
2025-02-10 04:04:06.873 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-10 04:04:06.879 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-10 04:04:06.885 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
