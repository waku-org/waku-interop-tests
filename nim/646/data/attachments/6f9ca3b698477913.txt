2025-02-10 04:03:49.131 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-10 04:03:49.131 DEBUG [tests.conftest] Running test: test_publish_with_invalid_payloads with id: 2025-02-10_04-03-49__d3247c28-1c5e-473a-a8e7-629ba3a9cfdc
2025-02-10 04:03:49.132 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-10 04:03:49.132 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-10 04:03:49.132 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-10 04:03:49.139 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-10 04:03:49.139 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-10_04-03-49__d3247c28-1c5e-473a-a8e7-629ba3a9cfdc__wakuorg_nwaku:latest.log
2025-02-10 04:03:49.140 DEBUG [src.node.waku_node] Starting Node...
2025-02-10 04:03:49.140 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-10 04:03:49.141 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-10 04:03:49.141 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.49.171
2025-02-10 04:03:49.141 DEBUG [src.node.docker_mananger] Generated ports ['48276', '48277', '48278', '48279', '48280']
2025-02-10 04:03:49.142 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-10 04:03:49.142 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-10 04:03:49.142 DEBUG [src.node.waku_node] Using volumes []
2025-02-10 04:03:49.142 DEBUG [src.node.docker_mananger] docker run -i -t -p 48276:48276 -p 48277:48277 -p 48278:48278 -p 48279:48279 -p 48280:48280 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=48278 --rest-port=48276 --tcp-port=48277 --discv5-udp-port=48279 --rest-address=0.0.0.0 --nat=extip:172.18.49.171 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=4bf6cac62d2feb3c738fdfb3dd9f379cec1ebbb1dbbca1d3856a51eef9fcbdad --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=48280 --metrics-logging=true --relay=true
2025-02-10 04:03:49.374 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.49.171 waku 8b2c8303abdc0ef71fdd2fb8f16ca7f68dc23e69d02c548039e592f5f31077a8
2025-02-10 04:03:49.431 DEBUG [src.node.docker_mananger] Container started with ID 8b2c8303abdc. Setting up logs at ./log/docker/node1_2025-02-10_04-03-49__d3247c28-1c5e-473a-a8e7-629ba3a9cfdc__wakuorg_nwaku:latest.log
2025-02-10 04:03:49.432 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 48276
2025-02-10 04:03:49.432 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-10 04:03:49.934 ERROR [src.node.docker_mananger] Max retries reached for container 29e7542df7b3. Exiting log stream.
2025-02-10 04:03:50.433 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48276/health" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:50.436 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-10 04:03:50.436 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-10 04:03:50.436 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48276/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:50.439 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.49.171/tcp/48277/p2p/16Uiu2HAmLt7YFWRP27G444XiwNz8PhkNziZYG61tySYdVXox7fhE","/ip4/172.18.49.171/tcp/48278/ws/p2p/16Uiu2HAmLt7YFWRP27G444XiwNz8PhkNziZYG61tySYdVXox7fhE"],"enrUri":"enr:-L24QPItv-G8Ht3OhIa6Z4NSrjiXa7X0MnRdrg3kL_XWDxBZMczE1lCsUTSXB1vk3ZqF7Ejyez5RsPQg0DA5tpMPKHACgmlkgnY0gmlwhKwSMauKbXVsdGlhZGRyc5YACASsEjGrBryVAAoErBIxqwa8lt0DgnJzhQADAQAAiXNlY3AyNTZrMaEDejosrpLvnC8H4HrnM-Zc_AgkMERS1BzTHVRxj2Qk6hWDdGNwgryVg3VkcIK8l4V3YWt1MgE"}'
2025-02-10 04:03:50.439 INFO [src.node.waku_node] REST service is ready !!
2025-02-10 04:03:50.445 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-10 04:03:50.446 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-10_04-03-49__d3247c28-1c5e-473a-a8e7-629ba3a9cfdc__wakuorg_nwaku:latest.log
2025-02-10 04:03:50.446 DEBUG [src.node.waku_node] Starting Node...
2025-02-10 04:03:50.446 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-10 04:03:50.448 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-10 04:03:50.448 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.221.178
2025-02-10 04:03:50.448 DEBUG [src.node.docker_mananger] Generated ports ['28933', '28934', '28935', '28936', '28937']
2025-02-10 04:03:50.448 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-10 04:03:50.448 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-10 04:03:50.448 DEBUG [src.node.waku_node] Using volumes []
2025-02-10 04:03:50.449 DEBUG [src.node.docker_mananger] docker run -i -t -p 28933:28933 -p 28934:28934 -p 28935:28935 -p 28936:28936 -p 28937:28937 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=28935 --rest-port=28933 --tcp-port=28934 --discv5-udp-port=28936 --rest-address=0.0.0.0 --nat=extip:172.18.221.178 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=c56faccb3b72ace7d04a7ca1af2fba539fabeb0cbb7d2abfc0ddf3aa5d995cea --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=28937 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QPItv-G8Ht3OhIa6Z4NSrjiXa7X0MnRdrg3kL_XWDxBZMczE1lCsUTSXB1vk3ZqF7Ejyez5RsPQg0DA5tpMPKHACgmlkgnY0gmlwhKwSMauKbXVsdGlhZGRyc5YACASsEjGrBryVAAoErBIxqwa8lt0DgnJzhQADAQAAiXNlY3AyNTZrMaEDejosrpLvnC8H4HrnM-Zc_AgkMERS1BzTHVRxj2Qk6hWDdGNwgryVg3VkcIK8l4V3YWt1MgE
2025-02-10 04:03:50.687 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.221.178 waku 2eb8deb88fafd6f7dde7722530889142e4d507cfeaeb6b5b2e1b0e07585d22cf
2025-02-10 04:03:50.740 DEBUG [src.node.docker_mananger] Container started with ID 2eb8deb88faf. Setting up logs at ./log/docker/node2_2025-02-10_04-03-49__d3247c28-1c5e-473a-a8e7-629ba3a9cfdc__wakuorg_nwaku:latest.log
2025-02-10 04:03:50.741 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 28933
2025-02-10 04:03:50.741 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-10 04:03:51.741 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:28933/health" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:51.744 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-10 04:03:51.744 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-10 04:03:51.744 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:28933/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:51.746 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.221.178/tcp/28934/p2p/16Uiu2HAmQvP5nGNi1jDNPJ8bxNV6EQfxVS87MstavFxvfANCNm6S","/ip4/172.18.221.178/tcp/28935/ws/p2p/16Uiu2HAmQvP5nGNi1jDNPJ8bxNV6EQfxVS87MstavFxvfANCNm6S"],"enrUri":"enr:-L24QJeqQYCTQriyNiRr2imVcQzGM72ptZxt48IsxLGQnHFFCKT7mP1kDAtGdfs-mNSgMoxZe4SNS0-LK-yaiX_7bDECgmlkgnY0gmlwhKwS3bKKbXVsdGlhZGRyc5YACASsEt2yBnEGAAoErBLdsgZxB90DgnJzhQADAQAAiXNlY3AyNTZrMaEDtj2ouoi1WMbk4gyj5DpVVY92T0vCoPBWDFrlvM_KgMODdGNwgnEGg3VkcIJxCIV3YWt1MgE"}'
2025-02-10 04:03:51.747 INFO [src.node.waku_node] REST service is ready !!
2025-02-10 04:03:51.747 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:28933/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.49.171/tcp/48277/p2p/16Uiu2HAmLt7YFWRP27G444XiwNz8PhkNziZYG61tySYdVXox7fhE"]'
2025-02-10 04:03:51.750 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:03:51.750 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-10 04:03:51.750 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48276/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-10 04:03:51.754 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:03:51.755 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:28933/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-10 04:03:51.759 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:03:51.760 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48276/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-10 04:03:51.766 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-10 04:03:51.766 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-10 04:03:51.867 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-10 04:03:51.867 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48276/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:51.870 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739160231760533248,"ephemeral":false}]'
2025-02-10 04:03:51.872 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-10 04:03:51.872 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:28933/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-10 04:03:51.874 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739160231760533248,"ephemeral":false}]'
2025-02-10 04:03:51.876 INFO [src.steps.relay] WARM UP successful!!
2025-02-10 04:03:51.877 DEBUG [tests.relay.test_publish] Running test with payload Empty string
2025-02-10 04:03:51.877 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48276/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-10 04:03:51.880 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:48276/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-10 04:03:51.881 DEBUG [tests.relay.test_publish] Running test with payload Unecoded text
2025-02-10 04:03:51.881 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48276/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "Hello World!", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-10 04:03:51.884 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:48276/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Incorrect base64 string'
2025-02-10 04:03:51.884 DEBUG [tests.relay.test_publish] Running test with payload A dictionary
2025-02-10 04:03:51.884 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48276/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": {"key": "YWFh"}, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-10 04:03:51.887 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:48276/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-10 04:03:51.887 DEBUG [tests.relay.test_publish] Running test with payload An integer
2025-02-10 04:03:51.887 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48276/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": 1234567890, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-10 04:03:51.889 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:48276/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-10 04:03:51.889 DEBUG [tests.relay.test_publish] Running test with payload A list
2025-02-10 04:03:51.890 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48276/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": ["YWFh"], "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-10 04:03:51.892 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:48276/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-10 04:03:51.892 DEBUG [tests.relay.test_publish] Running test with payload A bool
2025-02-10 04:03:51.893 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48276/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": true, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-10 04:03:51.895 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:48276/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-10 04:03:51.897 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-10 04:03:51.898 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-10 04:03:51.898 DEBUG [src.node.waku_node] Stopping container with id 8b2c8303abdc
2025-02-10 04:03:52.914 DEBUG [src.node.waku_node] Container stopped.
2025-02-10 04:03:52.915 DEBUG [src.node.waku_node] Stopping container with id 2eb8deb88faf
2025-02-10 04:03:53.728 ERROR [src.node.docker_mananger] Max retries reached for container 8b2c8303abdc. Exiting log stream.
2025-02-10 04:03:54.450 DEBUG [src.node.waku_node] Container stopped.
2025-02-10 04:03:54.451 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-10 04:03:54.456 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-10 04:03:54.461 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
