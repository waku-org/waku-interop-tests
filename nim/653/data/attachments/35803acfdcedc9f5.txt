2025-02-16 04:04:37.548 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-16 04:04:37.548 DEBUG [tests.conftest] Running test: test_publish_with_invalid_payloads with id: 2025-02-16_04-04-37__9135c182-068f-46ee-a848-e8178918dbaa
2025-02-16 04:04:37.548 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-16 04:04:37.548 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-16 04:04:37.549 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-16 04:04:37.555 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-16 04:04:37.555 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-16_04-04-37__9135c182-068f-46ee-a848-e8178918dbaa__wakuorg_nwaku:latest.log
2025-02-16 04:04:37.555 DEBUG [src.node.waku_node] Starting Node...
2025-02-16 04:04:37.555 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-16 04:04:37.556 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-16 04:04:37.556 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.37.14
2025-02-16 04:04:37.557 DEBUG [src.node.docker_mananger] Generated ports ['3505', '3506', '3507', '3508', '3509']
2025-02-16 04:04:37.557 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-16 04:04:37.557 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-16 04:04:37.557 DEBUG [src.node.waku_node] Using volumes []
2025-02-16 04:04:37.557 DEBUG [src.node.docker_mananger] docker run -i -t -p 3505:3505 -p 3506:3506 -p 3507:3507 -p 3508:3508 -p 3509:3509 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=3507 --rest-port=3505 --tcp-port=3506 --discv5-udp-port=3508 --rest-address=0.0.0.0 --nat=extip:172.18.37.14 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=bfc457f6c1a49f0144e2b7a32d267e1adbdcf4aab9010a096ed3cc6d22e26e5a --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=3509 --metrics-logging=true --relay=true
2025-02-16 04:04:37.784 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.37.14 waku fffda37ec72324160a89a1852c319b30f0098a545e35f2472563dfc51e358c97
2025-02-16 04:04:37.831 DEBUG [src.node.docker_mananger] Container started with ID fffda37ec723. Setting up logs at ./log/docker/node1_2025-02-16_04-04-37__9135c182-068f-46ee-a848-e8178918dbaa__wakuorg_nwaku:latest.log
2025-02-16 04:04:37.832 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 3505
2025-02-16 04:04:37.833 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-16 04:04:38.342 ERROR [src.node.docker_mananger] Max retries reached for container d8d84db0ba0a. Exiting log stream.
2025-02-16 04:04:38.833 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:3505/health" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:04:38.836 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-16 04:04:38.836 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-16 04:04:38.836 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:3505/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:04:38.839 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.37.14/tcp/3506/p2p/16Uiu2HAmNLaSYMYH9aojSo7gCqNjuhdUhWUoq1MoEC3uvs8S2MNJ","/ip4/172.18.37.14/tcp/3507/ws/p2p/16Uiu2HAmNLaSYMYH9aojSo7gCqNjuhdUhWUoq1MoEC3uvs8S2MNJ"],"enrUri":"enr:-L24QJl4suhunom9b9qZ1MCy7soF1jiNSDZvnEtCCViPccNyF1THTvcp4MmyF7w0Wt3lml4PszdbHOL30gXkTZBievECgmlkgnY0gmlwhKwSJQ6KbXVsdGlhZGRyc5YACASsEiUOBg2yAAoErBIlDgYNs90DgnJzhQADAQAAiXNlY3AyNTZrMaEDj91hVD0k7NmiHX9t2MBltsuek05ENUDfmCvXRoh2RLuDdGNwgg2yg3VkcIINtIV3YWt1MgE"}'
2025-02-16 04:04:38.839 INFO [src.node.waku_node] REST service is ready !!
2025-02-16 04:04:38.845 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-16 04:04:38.845 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-16_04-04-37__9135c182-068f-46ee-a848-e8178918dbaa__wakuorg_nwaku:latest.log
2025-02-16 04:04:38.845 DEBUG [src.node.waku_node] Starting Node...
2025-02-16 04:04:38.845 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-16 04:04:38.846 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-16 04:04:38.847 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.129.196
2025-02-16 04:04:38.847 DEBUG [src.node.docker_mananger] Generated ports ['33683', '33684', '33685', '33686', '33687']
2025-02-16 04:04:38.847 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-16 04:04:38.847 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-16 04:04:38.847 DEBUG [src.node.waku_node] Using volumes []
2025-02-16 04:04:38.847 DEBUG [src.node.docker_mananger] docker run -i -t -p 33683:33683 -p 33684:33684 -p 33685:33685 -p 33686:33686 -p 33687:33687 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=33685 --rest-port=33683 --tcp-port=33684 --discv5-udp-port=33686 --rest-address=0.0.0.0 --nat=extip:172.18.129.196 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=9eccd17ed795e95badd1fbbfe1d8c6ac4dcdb1ed4ed0f77218c303daaad5d8d7 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=33687 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QJl4suhunom9b9qZ1MCy7soF1jiNSDZvnEtCCViPccNyF1THTvcp4MmyF7w0Wt3lml4PszdbHOL30gXkTZBievECgmlkgnY0gmlwhKwSJQ6KbXVsdGlhZGRyc5YACASsEiUOBg2yAAoErBIlDgYNs90DgnJzhQADAQAAiXNlY3AyNTZrMaEDj91hVD0k7NmiHX9t2MBltsuek05ENUDfmCvXRoh2RLuDdGNwgg2yg3VkcIINtIV3YWt1MgE
2025-02-16 04:04:39.086 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.129.196 waku d2de1b8a9875f036cdd9b9484e921dbfe0c95e3f7f76d6ed319486dbc19492d1
2025-02-16 04:04:39.133 DEBUG [src.node.docker_mananger] Container started with ID d2de1b8a9875. Setting up logs at ./log/docker/node2_2025-02-16_04-04-37__9135c182-068f-46ee-a848-e8178918dbaa__wakuorg_nwaku:latest.log
2025-02-16 04:04:39.133 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 33683
2025-02-16 04:04:39.134 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-16 04:04:40.134 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33683/health" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:04:40.139 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-16 04:04:40.144 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-16 04:04:40.147 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33683/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:04:40.150 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.129.196/tcp/33684/p2p/16Uiu2HAmDhJYKkaYDUWFX7wvnaKmEV7zCCNoA6scDKgHjxopJsxQ","/ip4/172.18.129.196/tcp/33685/ws/p2p/16Uiu2HAmDhJYKkaYDUWFX7wvnaKmEV7zCCNoA6scDKgHjxopJsxQ"],"enrUri":"enr:-L24QDAM6i-qaEXvcOxyzUBMe24KIZ2P72MB_RvEFBNMs_8QRwFOA4TZ7NWCv_goL9zAN6rKjcarypUjLgwkjV9eKPwCgmlkgnY0gmlwhKwSgcSKbXVsdGlhZGRyc5YACASsEoHEBoOUAAoErBKBxAaDld0DgnJzhQADAQAAiXNlY3AyNTZrMaEDD3Nqk_3NexJxQz5SmG8ctWPHyiNvd9UQqnhedcplEa2DdGNwgoOUg3VkcIKDloV3YWt1MgE"}'
2025-02-16 04:04:40.152 INFO [src.node.waku_node] REST service is ready !!
2025-02-16 04:04:40.152 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:33683/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.37.14/tcp/3506/p2p/16Uiu2HAmNLaSYMYH9aojSo7gCqNjuhdUhWUoq1MoEC3uvs8S2MNJ"]'
2025-02-16 04:04:40.155 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:04:40.155 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-16 04:04:40.155 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3505/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-16 04:04:40.159 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:04:40.159 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:33683/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-16 04:04:40.164 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:04:40.165 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3505/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-16 04:04:40.171 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:04:40.172 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-16 04:04:40.272 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-16 04:04:40.273 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:3505/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:04:40.275 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739678680165784832,"ephemeral":false,"proof":""}]'
2025-02-16 04:04:40.277 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-16 04:04:40.277 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33683/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:04:40.279 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739678680165784832,"ephemeral":false,"proof":""}]'
2025-02-16 04:04:40.281 INFO [src.steps.relay] WARM UP successful!!
2025-02-16 04:04:40.281 DEBUG [tests.relay.test_publish] Running test with payload Empty string
2025-02-16 04:04:40.282 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3505/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-16 04:04:40.284 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:3505/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data: '
2025-02-16 04:04:40.284 DEBUG [tests.relay.test_publish] Running test with payload Unecoded text
2025-02-16 04:04:40.284 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3505/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "Hello World!", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-16 04:04:40.286 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:3505/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Incorrect base64 string'
2025-02-16 04:04:40.287 DEBUG [tests.relay.test_publish] Running test with payload A dictionary
2025-02-16 04:04:40.287 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3505/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": {"key": "YWFh"}, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-16 04:04:40.289 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:3505/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data: '
2025-02-16 04:04:40.289 DEBUG [tests.relay.test_publish] Running test with payload An integer
2025-02-16 04:04:40.289 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3505/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": 1234567890, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-16 04:04:40.291 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:3505/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data: '
2025-02-16 04:04:40.292 DEBUG [tests.relay.test_publish] Running test with payload A list
2025-02-16 04:04:40.292 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3505/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": ["YWFh"], "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-16 04:04:40.294 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:3505/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data: '
2025-02-16 04:04:40.294 DEBUG [tests.relay.test_publish] Running test with payload A bool
2025-02-16 04:04:40.294 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3505/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": true, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-16 04:04:40.297 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:3505/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data: '
2025-02-16 04:04:40.298 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-16 04:04:40.299 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-16 04:04:40.299 DEBUG [src.node.waku_node] Stopping container with id fffda37ec723
2025-02-16 04:04:41.308 DEBUG [src.node.waku_node] Container stopped.
2025-02-16 04:04:41.308 DEBUG [src.node.waku_node] Stopping container with id d2de1b8a9875
2025-02-16 04:04:42.121 ERROR [src.node.docker_mananger] Max retries reached for container fffda37ec723. Exiting log stream.
2025-02-16 04:04:42.808 DEBUG [src.node.waku_node] Container stopped.
2025-02-16 04:04:42.809 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-16 04:04:42.814 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-16 04:04:42.820 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
