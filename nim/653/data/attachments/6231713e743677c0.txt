2025-02-16 04:03:38.271 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-16 04:03:38.271 DEBUG [tests.conftest] Running test: test_relay_resubscribe_to_unsubscribed_pubsub_topic with id: 2025-02-16_04-03-38__57c90616-bdcd-49d4-84c1-e04046b9a89c
2025-02-16 04:03:38.272 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-16 04:03:38.272 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-16 04:03:38.272 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-16 04:03:38.279 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-16 04:03:38.279 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-16_04-03-38__57c90616-bdcd-49d4-84c1-e04046b9a89c__wakuorg_nwaku:latest.log
2025-02-16 04:03:38.279 DEBUG [src.node.waku_node] Starting Node...
2025-02-16 04:03:38.279 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-16 04:03:38.281 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-16 04:03:38.281 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.242.215
2025-02-16 04:03:38.281 DEBUG [src.node.docker_mananger] Generated ports ['53876', '53877', '53878', '53879', '53880']
2025-02-16 04:03:38.281 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-16 04:03:38.281 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-16 04:03:38.282 DEBUG [src.node.waku_node] Using volumes []
2025-02-16 04:03:38.282 DEBUG [src.node.docker_mananger] docker run -i -t -p 53876:53876 -p 53877:53877 -p 53878:53878 -p 53879:53879 -p 53880:53880 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=53878 --rest-port=53876 --tcp-port=53877 --discv5-udp-port=53879 --rest-address=0.0.0.0 --nat=extip:172.18.242.215 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=81af86cb9944eeea77e29e4f47495be208ee2a3cdfad930e8e67ddc515beb6fb --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=53880 --metrics-logging=true --relay=true
2025-02-16 04:03:38.511 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.242.215 waku eda5a4fe15468f0bff289734832f0f3b18bf83b66a7bcf7384492f3fe8e1779a
2025-02-16 04:03:38.560 DEBUG [src.node.docker_mananger] Container started with ID eda5a4fe1546. Setting up logs at ./log/docker/node1_2025-02-16_04-03-38__57c90616-bdcd-49d4-84c1-e04046b9a89c__wakuorg_nwaku:latest.log
2025-02-16 04:03:38.560 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 53876
2025-02-16 04:03:38.560 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-16 04:03:39.077 ERROR [src.node.docker_mananger] Max retries reached for container ebf9621e2f03. Exiting log stream.
2025-02-16 04:03:39.561 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:53876/health" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:03:39.563 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-16 04:03:39.563 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-16 04:03:39.564 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:53876/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:03:39.566 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.242.215/tcp/53877/p2p/16Uiu2HAkz2tAhskDwoR3nNtzJhtPP2eoc7pTsWELc75xrs4auQJV","/ip4/172.18.242.215/tcp/53878/ws/p2p/16Uiu2HAkz2tAhskDwoR3nNtzJhtPP2eoc7pTsWELc75xrs4auQJV"],"enrUri":"enr:-L24QB-mUc6Q02vYJXmTdj79fxdUXZ05Z5KQpc82DHHw_Ee_H3kKowmg48XdukQUXZRm6NRuktENgdPOusUcwcBjr1sCgmlkgnY0gmlwhKwS8teKbXVsdGlhZGRyc5YACASsEvLXBtJ1AAoErBLy1wbSdt0DgnJzhQADAQAAiXNlY3AyNTZrMaECRHPbcSakgTM7H6bC7fV4XoHw9fZ0WYKMi7uN9qEsbEKDdGNwgtJ1g3VkcILSd4V3YWt1MgE"}'
2025-02-16 04:03:39.566 INFO [src.node.waku_node] REST service is ready !!
2025-02-16 04:03:39.572 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-16 04:03:39.572 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-16_04-03-38__57c90616-bdcd-49d4-84c1-e04046b9a89c__wakuorg_nwaku:latest.log
2025-02-16 04:03:39.572 DEBUG [src.node.waku_node] Starting Node...
2025-02-16 04:03:39.572 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-16 04:03:39.573 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-16 04:03:39.574 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.204.129
2025-02-16 04:03:39.574 DEBUG [src.node.docker_mananger] Generated ports ['45551', '45552', '45553', '45554', '45555']
2025-02-16 04:03:39.574 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-16 04:03:39.574 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-16 04:03:39.574 DEBUG [src.node.waku_node] Using volumes []
2025-02-16 04:03:39.574 DEBUG [src.node.docker_mananger] docker run -i -t -p 45551:45551 -p 45552:45552 -p 45553:45553 -p 45554:45554 -p 45555:45555 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=45553 --rest-port=45551 --tcp-port=45552 --discv5-udp-port=45554 --rest-address=0.0.0.0 --nat=extip:172.18.204.129 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=ec114e242e7dc1a763bac771fdf1dd5a05dbadeddbdfde266f0001ad5f1a5daa --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=45555 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QB-mUc6Q02vYJXmTdj79fxdUXZ05Z5KQpc82DHHw_Ee_H3kKowmg48XdukQUXZRm6NRuktENgdPOusUcwcBjr1sCgmlkgnY0gmlwhKwS8teKbXVsdGlhZGRyc5YACASsEvLXBtJ1AAoErBLy1wbSdt0DgnJzhQADAQAAiXNlY3AyNTZrMaECRHPbcSakgTM7H6bC7fV4XoHw9fZ0WYKMi7uN9qEsbEKDdGNwgtJ1g3VkcILSd4V3YWt1MgE
2025-02-16 04:03:39.803 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.204.129 waku 3d20804ae3f3a2486513b64b21eb385d8665f634d7903293dfd72dce3505cba1
2025-02-16 04:03:39.847 DEBUG [src.node.docker_mananger] Container started with ID 3d20804ae3f3. Setting up logs at ./log/docker/node2_2025-02-16_04-03-38__57c90616-bdcd-49d4-84c1-e04046b9a89c__wakuorg_nwaku:latest.log
2025-02-16 04:03:39.847 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 45551
2025-02-16 04:03:39.848 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-16 04:03:40.848 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:45551/health" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:03:40.863 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-16 04:03:40.864 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-16 04:03:40.864 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:45551/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:03:40.872 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.204.129/tcp/45552/p2p/16Uiu2HAkzeWLLNDCCMR5b2FYq3yXT3g4R6jFdhQ3dhjTF6goHS9N","/ip4/172.18.204.129/tcp/45553/ws/p2p/16Uiu2HAkzeWLLNDCCMR5b2FYq3yXT3g4R6jFdhQ3dhjTF6goHS9N"],"enrUri":"enr:-L24QO4-WOvbsSWgbnDSgvMd_F3JyYGsd-L0sOeDEM_wzLxtcT9g5sKJ5l0mfk2OljD4vaYDcnzlqxPUgxT7a6Lxx6YCgmlkgnY0gmlwhKwSzIGKbXVsdGlhZGRyc5YACASsEsyBBrHwAAoErBLMgQax8d0DgnJzhQADAQAAiXNlY3AyNTZrMaECTZQUHKKUV0AHJKgy4nLPe72Jb-3jcwB3VEEI9x_eYWmDdGNwgrHwg3VkcIKx8oV3YWt1MgE"}'
2025-02-16 04:03:40.872 INFO [src.node.waku_node] REST service is ready !!
2025-02-16 04:03:40.873 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:45551/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.242.215/tcp/53877/p2p/16Uiu2HAkz2tAhskDwoR3nNtzJhtPP2eoc7pTsWELc75xrs4auQJV"]'
2025-02-16 04:03:40.877 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:03:40.878 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:53876/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-16 04:03:40.882 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:03:40.882 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:45551/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-16 04:03:40.888 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:03:40.889 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:53876/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-16 04:03:40.895 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:03:40.895 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-16 04:03:40.996 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-16 04:03:40.996 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:53876/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:03:40.998 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739678620889219328,"ephemeral":false,"proof":""}]'
2025-02-16 04:03:40.999 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-16 04:03:40.999 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:45551/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:03:41.002 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739678620889219328,"ephemeral":false,"proof":""}]'
2025-02-16 04:03:41.003 INFO [src.node.api_clients.base_client] curl -v -X DELETE "http://127.0.0.1:53876/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-16 04:03:41.007 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:03:41.007 INFO [src.node.api_clients.base_client] curl -v -X DELETE "http://127.0.0.1:45551/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-16 04:03:41.012 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:03:41.012 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:53876/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-16 04:03:41.015 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:53876/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Failed to publish: Node not subscribed to topic: /waku/2/rs/3/1'
2025-02-16 04:03:41.015 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:53876/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-16 04:03:41.018 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:03:41.019 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:45551/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-16 04:03:41.023 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:03:41.024 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:53876/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-16 04:03:41.029 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:03:41.029 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-16 04:03:41.130 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-16 04:03:41.130 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:53876/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:03:41.132 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739678621024163584,"ephemeral":false,"proof":""}]'
2025-02-16 04:03:41.133 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-16 04:03:41.134 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:45551/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:03:41.135 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739678621024163584,"ephemeral":false,"proof":""}]'
2025-02-16 04:03:41.138 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-16 04:03:41.139 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-16 04:03:41.139 DEBUG [src.node.waku_node] Stopping container with id eda5a4fe1546
2025-02-16 04:03:42.036 DEBUG [src.node.waku_node] Container stopped.
2025-02-16 04:03:42.036 DEBUG [src.node.waku_node] Stopping container with id 3d20804ae3f3
2025-02-16 04:03:42.847 ERROR [src.node.docker_mananger] Max retries reached for container eda5a4fe1546. Exiting log stream.
2025-02-16 04:03:43.516 DEBUG [src.node.waku_node] Container stopped.
2025-02-16 04:03:43.517 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-16 04:03:43.524 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-16 04:03:43.529 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
