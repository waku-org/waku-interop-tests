2025-02-16 04:05:46.038 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-16 04:05:46.038 DEBUG [tests.conftest] Running test: test_node_uses_both_auto_and_regular_apis with id: 2025-02-16_04-05-46__c6e12cfd-13fc-4b05-9c9e-a39ff24da31b
2025-02-16 04:05:46.038 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-16 04:05:46.039 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-16 04:05:46.039 DEBUG [src.steps.sharding] Running fixture setup: sharding_setup
2025-02-16 04:05:46.046 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-16 04:05:46.046 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-16_04-05-46__c6e12cfd-13fc-4b05-9c9e-a39ff24da31b__wakuorg_nwaku:latest.log
2025-02-16 04:05:46.046 DEBUG [src.node.waku_node] Starting Node...
2025-02-16 04:05:46.046 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-16 04:05:46.048 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-16 04:05:46.048 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.21.42
2025-02-16 04:05:46.048 DEBUG [src.node.docker_mananger] Generated ports ['9874', '9875', '9876', '9877', '9878']
2025-02-16 04:05:46.048 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-16 04:05:46.048 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-16 04:05:46.048 DEBUG [src.node.waku_node] Using volumes []
2025-02-16 04:05:46.049 DEBUG [src.node.docker_mananger] docker run -i -t -p 9874:9874 -p 9875:9875 -p 9876:9876 -p 9877:9877 -p 9878:9878 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=9876 --rest-port=9874 --tcp-port=9875 --discv5-udp-port=9877 --rest-address=0.0.0.0 --nat=extip:172.18.21.42 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=70affcea88bb1be580dd723d613ef28ec3dccbbfdddbdc767bbbdcfdcebaf08b --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=9878 --metrics-logging=true --relay=true --filter=true --pubsub-topic=/waku/2/rs/2/0
2025-02-16 04:05:46.278 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.21.42 waku 43baa64f98fdbf6b06166b82dacafe8f25311f93e1044f7345b97ef32c6fc8c1
2025-02-16 04:05:46.326 DEBUG [src.node.docker_mananger] Container started with ID 43baa64f98fd. Setting up logs at ./log/docker/node1_2025-02-16_04-05-46__c6e12cfd-13fc-4b05-9c9e-a39ff24da31b__wakuorg_nwaku:latest.log
2025-02-16 04:05:46.327 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 9874
2025-02-16 04:05:46.327 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-16 04:05:46.840 ERROR [src.node.docker_mananger] Max retries reached for container d1fb2e0f6bb0. Exiting log stream.
2025-02-16 04:05:47.328 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9874/health" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:05:47.331 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-16 04:05:47.331 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-16 04:05:47.331 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9874/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:05:47.333 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.21.42/tcp/9875/p2p/16Uiu2HAmM2vGJRUjepx6gb3x4CrQZUe6q1Mu9MXnSW5MZSoDWHUd","/ip4/172.18.21.42/tcp/9876/ws/p2p/16Uiu2HAmM2vGJRUjepx6gb3x4CrQZUe6q1Mu9MXnSW5MZSoDWHUd"],"enrUri":"enr:-L24QHz_Munm8vQT-2NrJqwBNn-vO6suqLe3CRgqMuigkyuHKf2eMqXuQZDlrbNu6M9aBtadrYGOtBOfwt9f8n-L0xcCgmlkgnY0gmlwhKwSFSqKbXVsdGlhZGRyc5YACASsEhUqBiaTAAoErBIVKgYmlN0DgnJzhQACAQAAiXNlY3AyNTZrMaEDfHunNFVKGypGzYwjKbBjzU3q0MTrlnM5ed12joOogsqDdGNwgiaTg3VkcIImlYV3YWt1MgU"}'
2025-02-16 04:05:47.334 INFO [src.node.waku_node] REST service is ready !!
2025-02-16 04:05:47.340 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-16 04:05:47.341 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-16_04-05-46__c6e12cfd-13fc-4b05-9c9e-a39ff24da31b__wakuorg_nwaku:latest.log
2025-02-16 04:05:47.341 DEBUG [src.node.waku_node] Starting Node...
2025-02-16 04:05:47.341 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-16 04:05:47.342 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-16 04:05:47.343 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.250.218
2025-02-16 04:05:47.343 DEBUG [src.node.docker_mananger] Generated ports ['59044', '59045', '59046', '59047', '59048']
2025-02-16 04:05:47.343 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-16 04:05:47.343 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-16 04:05:47.343 DEBUG [src.node.waku_node] Using volumes []
2025-02-16 04:05:47.343 DEBUG [src.node.docker_mananger] docker run -i -t -p 59044:59044 -p 59045:59045 -p 59046:59046 -p 59047:59047 -p 59048:59048 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=59046 --rest-port=59044 --tcp-port=59045 --discv5-udp-port=59047 --rest-address=0.0.0.0 --nat=extip:172.18.250.218 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=aae76faf6d9f8f47d44ba8fdab818cde47ce11ca59d694edaa0dc550ac1dd1d8 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=59048 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QHz_Munm8vQT-2NrJqwBNn-vO6suqLe3CRgqMuigkyuHKf2eMqXuQZDlrbNu6M9aBtadrYGOtBOfwt9f8n-L0xcCgmlkgnY0gmlwhKwSFSqKbXVsdGlhZGRyc5YACASsEhUqBiaTAAoErBIVKgYmlN0DgnJzhQACAQAAiXNlY3AyNTZrMaEDfHunNFVKGypGzYwjKbBjzU3q0MTrlnM5ed12joOogsqDdGNwgiaTg3VkcIImlYV3YWt1MgU --pubsub-topic=/waku/2/rs/2/0
2025-02-16 04:05:47.579 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.250.218 waku fd8eafe23e47ed98fa3ffc8457d2afb46fdb614e51d73291a14f2fdca5c6b6a7
2025-02-16 04:05:47.629 DEBUG [src.node.docker_mananger] Container started with ID fd8eafe23e47. Setting up logs at ./log/docker/node2_2025-02-16_04-05-46__c6e12cfd-13fc-4b05-9c9e-a39ff24da31b__wakuorg_nwaku:latest.log
2025-02-16 04:05:47.629 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 59044
2025-02-16 04:05:47.630 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-16 04:05:48.630 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:59044/health" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:05:48.637 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-16 04:05:48.640 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-16 04:05:48.641 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:59044/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:05:48.647 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.250.218/tcp/59045/p2p/16Uiu2HAmLenFWGaS8YMjRidbRdwrYpDZiRvMMgPenqj9MpM37TB4","/ip4/172.18.250.218/tcp/59046/ws/p2p/16Uiu2HAmLenFWGaS8YMjRidbRdwrYpDZiRvMMgPenqj9MpM37TB4"],"enrUri":"enr:-L24QGVzps1oVNZU7MuQqCY3z7JoVo5d-DzB4VvuWNk4hA0lAj3aLXn74pDjh9l7xWy1uxWspf6UMfvC9piv4Vaw1wMCgmlkgnY0gmlwhKwS-tqKbXVsdGlhZGRyc5YACASsEvraBualAAoErBL62gbmpt0DgnJzhQACAQAAiXNlY3AyNTZrMaEDds_Qb3Xb2fKyzJA-j6xvrKswj0QURqujqHHRKV1Zuz-DdGNwgualg3VkcILmp4V3YWt1MgE"}'
2025-02-16 04:05:48.647 INFO [src.node.waku_node] REST service is ready !!
2025-02-16 04:05:48.648 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:59044/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.21.42/tcp/9875/p2p/16Uiu2HAmM2vGJRUjepx6gb3x4CrQZUe6q1Mu9MXnSW5MZSoDWHUd"]'
2025-02-16 04:05:48.650 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:05:48.651 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9874/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2025-02-16 04:05:48.655 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:05:48.655 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:59044/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2025-02-16 04:05:48.660 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:05:48.662 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9874/relay/v1/auto/messages" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/toychat/2/huilong/proto", "timestamp": '$(date +%s%N)'}'
2025-02-16 04:05:48.668 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:05:48.669 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-16 04:05:48.770 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-16 04:05:48.770 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9874/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:05:48.773 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1739678748661892864,"ephemeral":false,"proof":""}]'
2025-02-16 04:05:48.775 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-16 04:05:48.775 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:59044/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:05:48.777 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1739678748661892864,"ephemeral":false,"proof":""}]'
2025-02-16 04:05:48.779 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9874/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2025-02-16 04:05:48.781 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:05:48.782 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:59044/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2025-02-16 04:05:48.784 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:05:48.784 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9874/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2025-02-16 04:05:48.790 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-16 04:05:48.790 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-16 04:05:48.890 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-16 04:05:48.891 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9874/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:05:48.894 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1739678748784821248,"ephemeral":false,"proof":""}]'
2025-02-16 04:05:48.895 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-16 04:05:48.895 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:59044/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-16 04:05:48.897 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1739678748784821248,"ephemeral":false,"proof":""}]'
2025-02-16 04:05:48.900 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-16 04:05:48.901 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-16 04:05:48.901 DEBUG [src.node.waku_node] Stopping container with id 43baa64f98fd
2025-02-16 04:05:49.821 DEBUG [src.node.waku_node] Container stopped.
2025-02-16 04:05:49.821 DEBUG [src.node.waku_node] Stopping container with id fd8eafe23e47
2025-02-16 04:05:50.634 ERROR [src.node.docker_mananger] Max retries reached for container 43baa64f98fd. Exiting log stream.
2025-02-16 04:05:51.353 DEBUG [src.node.waku_node] Container stopped.
2025-02-16 04:05:51.355 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-16 04:05:51.361 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-16 04:05:51.366 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
