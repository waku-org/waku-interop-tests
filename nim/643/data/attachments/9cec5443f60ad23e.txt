2025-02-07 04:03:42.806 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-07 04:03:42.806 DEBUG [tests.conftest] Running test: test_relay_unsubscribe_from_single_pubsub_topic with id: 2025-02-07_04-03-42__368b5dae-ec93-4271-8bf9-98db62f37da0
2025-02-07 04:03:42.807 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-07 04:03:42.807 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-07 04:03:42.807 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-07 04:03:42.813 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-07 04:03:42.813 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-07_04-03-42__368b5dae-ec93-4271-8bf9-98db62f37da0__wakuorg_nwaku:latest.log
2025-02-07 04:03:42.813 DEBUG [src.node.waku_node] Starting Node...
2025-02-07 04:03:42.813 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-07 04:03:42.815 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-07 04:03:42.815 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.74.56
2025-02-07 04:03:42.815 DEBUG [src.node.docker_mananger] Generated ports ['33161', '33162', '33163', '33164', '33165']
2025-02-07 04:03:42.815 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-07 04:03:42.815 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-07 04:03:42.815 DEBUG [src.node.waku_node] Using volumes []
2025-02-07 04:03:42.815 DEBUG [src.node.docker_mananger] docker run -i -t -p 33161:33161 -p 33162:33162 -p 33163:33163 -p 33164:33164 -p 33165:33165 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=33163 --rest-port=33161 --tcp-port=33162 --discv5-udp-port=33164 --rest-address=0.0.0.0 --nat=extip:172.18.74.56 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=bfb984625c5a8ce046b9fade62a51358bea6f793aeedd1eedb098f4c6dcf5760 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=33165 --metrics-logging=true --relay=true
2025-02-07 04:03:43.049 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.74.56 waku 19a3cfc1cc78f5fce61c899eaa10deaf69282221e877c874f1b0a20c6e317d69
2025-02-07 04:03:43.095 DEBUG [src.node.docker_mananger] Container started with ID 19a3cfc1cc78. Setting up logs at ./log/docker/node1_2025-02-07_04-03-42__368b5dae-ec93-4271-8bf9-98db62f37da0__wakuorg_nwaku:latest.log
2025-02-07 04:03:43.095 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 33161
2025-02-07 04:03:43.095 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-07 04:03:43.592 ERROR [src.node.docker_mananger] Max retries reached for container 0c0e63664eba. Exiting log stream.
2025-02-07 04:03:44.096 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33161/health" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:03:44.099 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-07 04:03:44.099 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-07 04:03:44.099 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33161/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:03:44.101 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.74.56/tcp/33162/p2p/16Uiu2HAmUvJ5TNfSAkAwm5mvVj2CCX1YvRNV9E2C1NXe9fgWqtaY","/ip4/172.18.74.56/tcp/33163/ws/p2p/16Uiu2HAmUvJ5TNfSAkAwm5mvVj2CCX1YvRNV9E2C1NXe9fgWqtaY"],"enrUri":"enr:-L24QG_obIpKFgsUs93ubcWJPux6WhGMhbFQDPqTLFrNE_7DLxgnWN8bvzCl0jC8js7NNr09tFXSpfb4KXtyRgyFebwCgmlkgnY0gmlwhKwSSjiKbXVsdGlhZGRyc5YACASsEko4BoGKAAoErBJKOAaBi90DgnJzhQADAQAAiXNlY3AyNTZrMaED8aa_Nw6cKnJEAqnOB_XZr_b2GmoNPt1t_WpKJIRz6fWDdGNwgoGKg3VkcIKBjIV3YWt1MgE"}'
2025-02-07 04:03:44.102 INFO [src.node.waku_node] REST service is ready !!
2025-02-07 04:03:44.108 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-07 04:03:44.108 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-07_04-03-42__368b5dae-ec93-4271-8bf9-98db62f37da0__wakuorg_nwaku:latest.log
2025-02-07 04:03:44.108 DEBUG [src.node.waku_node] Starting Node...
2025-02-07 04:03:44.108 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-07 04:03:44.110 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-07 04:03:44.110 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.113.243
2025-02-07 04:03:44.110 DEBUG [src.node.docker_mananger] Generated ports ['12007', '12008', '12009', '12010', '12011']
2025-02-07 04:03:44.110 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-07 04:03:44.110 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-07 04:03:44.110 DEBUG [src.node.waku_node] Using volumes []
2025-02-07 04:03:44.110 DEBUG [src.node.docker_mananger] docker run -i -t -p 12007:12007 -p 12008:12008 -p 12009:12009 -p 12010:12010 -p 12011:12011 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=12009 --rest-port=12007 --tcp-port=12008 --discv5-udp-port=12010 --rest-address=0.0.0.0 --nat=extip:172.18.113.243 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=f29fef03cfb4ce2fe009eaa422f98ccbec452c3afc2dccabfa6ecf6d9fa0aaf5 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=12011 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QG_obIpKFgsUs93ubcWJPux6WhGMhbFQDPqTLFrNE_7DLxgnWN8bvzCl0jC8js7NNr09tFXSpfb4KXtyRgyFebwCgmlkgnY0gmlwhKwSSjiKbXVsdGlhZGRyc5YACASsEko4BoGKAAoErBJKOAaBi90DgnJzhQADAQAAiXNlY3AyNTZrMaED8aa_Nw6cKnJEAqnOB_XZr_b2GmoNPt1t_WpKJIRz6fWDdGNwgoGKg3VkcIKBjIV3YWt1MgE
2025-02-07 04:03:44.335 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.113.243 waku c06d3e773596759f1bef2b8cd0a332d4cf4d3deda6820d6d0415ed8cd04acef2
2025-02-07 04:03:44.386 DEBUG [src.node.docker_mananger] Container started with ID c06d3e773596. Setting up logs at ./log/docker/node2_2025-02-07_04-03-42__368b5dae-ec93-4271-8bf9-98db62f37da0__wakuorg_nwaku:latest.log
2025-02-07 04:03:44.386 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 12007
2025-02-07 04:03:44.386 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-07 04:03:45.387 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:12007/health" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:03:45.396 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-07 04:03:45.406 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-07 04:03:45.406 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:12007/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:03:45.409 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.113.243/tcp/12008/p2p/16Uiu2HAm9p8UvchzDHpYsaXkqb7xR3FtreoYBsS5Gn8mFK4FEPNG","/ip4/172.18.113.243/tcp/12009/ws/p2p/16Uiu2HAm9p8UvchzDHpYsaXkqb7xR3FtreoYBsS5Gn8mFK4FEPNG"],"enrUri":"enr:-L24QOcY35Rt6CyjMHOITe9I2RUeyaniFNBlceDsuMljWSfFMjoYdmqOHH4lXB423yMYgONe1KyQxhnqeALHeuc0L6sCgmlkgnY0gmlwhKwScfOKbXVsdGlhZGRyc5YACASsEnHzBi7oAAoErBJx8wYu6d0DgnJzhQADAQAAiXNlY3AyNTZrMaEC1cRcaUxJCt6kvTntKBmshr9tFzl4EMg9LhY_zuY2gzGDdGNwgi7og3VkcIIu6oV3YWt1MgE"}'
2025-02-07 04:03:45.409 INFO [src.node.waku_node] REST service is ready !!
2025-02-07 04:03:45.409 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:12007/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.74.56/tcp/33162/p2p/16Uiu2HAmUvJ5TNfSAkAwm5mvVj2CCX1YvRNV9E2C1NXe9fgWqtaY"]'
2025-02-07 04:03:45.412 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:03:45.413 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:33161/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-07 04:03:45.417 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:03:45.417 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:12007/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-07 04:03:45.423 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:03:45.423 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:33161/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-07 04:03:45.429 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:03:45.430 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-07 04:03:45.530 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-07 04:03:45.530 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33161/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:03:45.532 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901025423703296,"ephemeral":false}]'
2025-02-07 04:03:45.534 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-07 04:03:45.534 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:12007/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:03:45.536 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901025423703296,"ephemeral":false}]'
2025-02-07 04:03:45.537 INFO [src.node.api_clients.base_client] curl -v -X DELETE "http://127.0.0.1:33161/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-07 04:03:45.543 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:03:45.543 INFO [src.node.api_clients.base_client] curl -v -X DELETE "http://127.0.0.1:12007/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-07 04:03:45.547 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:03:45.548 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:33161/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-07 04:03:45.550 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:33161/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Failed to publish: Node not subscribed to topic: /waku/2/rs/3/1'
2025-02-07 04:03:45.551 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-07 04:03:45.552 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-07 04:03:45.552 DEBUG [src.node.waku_node] Stopping container with id 19a3cfc1cc78
2025-02-07 04:03:46.579 DEBUG [src.node.waku_node] Container stopped.
2025-02-07 04:03:46.579 DEBUG [src.node.waku_node] Stopping container with id c06d3e773596
2025-02-07 04:03:47.406 ERROR [src.node.docker_mananger] Max retries reached for container 19a3cfc1cc78. Exiting log stream.
2025-02-07 04:03:48.066 DEBUG [src.node.waku_node] Container stopped.
2025-02-07 04:03:48.068 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-07 04:03:48.078 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-07 04:03:48.082 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
