2025-02-07 04:04:42.943 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-07 04:04:42.943 DEBUG [tests.conftest] Running test: test_publish_with_ephemeral with id: 2025-02-07_04-04-42__87ae373e-227d-4b8e-8ed4-618606df4764
2025-02-07 04:04:42.944 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-07 04:04:42.944 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-07 04:04:42.944 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-07 04:04:42.951 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-07 04:04:42.951 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-07_04-04-42__87ae373e-227d-4b8e-8ed4-618606df4764__wakuorg_nwaku:latest.log
2025-02-07 04:04:42.951 DEBUG [src.node.waku_node] Starting Node...
2025-02-07 04:04:42.951 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-07 04:04:42.952 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-07 04:04:42.953 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.196.80
2025-02-07 04:04:42.953 DEBUG [src.node.docker_mananger] Generated ports ['46474', '46475', '46476', '46477', '46478']
2025-02-07 04:04:42.953 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-07 04:04:42.953 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-07 04:04:42.953 DEBUG [src.node.waku_node] Using volumes []
2025-02-07 04:04:42.953 DEBUG [src.node.docker_mananger] docker run -i -t -p 46474:46474 -p 46475:46475 -p 46476:46476 -p 46477:46477 -p 46478:46478 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=46476 --rest-port=46474 --tcp-port=46475 --discv5-udp-port=46477 --rest-address=0.0.0.0 --nat=extip:172.18.196.80 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=59affaf4ae99f44b5eb1967f227cbfa5121a9df2ab02db0798e8dc8deace92a4 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=46478 --metrics-logging=true --relay=true
2025-02-07 04:04:43.188 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.196.80 waku ae5c7a2a4f7c8a2d33f94f070e071a51a03beae3b4a4545938e127b5118b3075
2025-02-07 04:04:43.240 DEBUG [src.node.docker_mananger] Container started with ID ae5c7a2a4f7c. Setting up logs at ./log/docker/node1_2025-02-07_04-04-42__87ae373e-227d-4b8e-8ed4-618606df4764__wakuorg_nwaku:latest.log
2025-02-07 04:04:43.240 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 46474
2025-02-07 04:04:43.241 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-07 04:04:43.747 ERROR [src.node.docker_mananger] Max retries reached for container 0616cbe0a2a5. Exiting log stream.
2025-02-07 04:04:44.241 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46474/health" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:44.244 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-07 04:04:44.244 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-07 04:04:44.244 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46474/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:44.247 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.196.80/tcp/46475/p2p/16Uiu2HAmF81zf18EUW8NjVVX1m9C7w8cfSQtkMyzGaPQAK2gVbTA","/ip4/172.18.196.80/tcp/46476/ws/p2p/16Uiu2HAmF81zf18EUW8NjVVX1m9C7w8cfSQtkMyzGaPQAK2gVbTA"],"enrUri":"enr:-L24QPIk1yesXNo6novnNJQIVO_I1Ros-TvGjfI8tGtyiQkfZmmJwAXS-X6oq_HKw4zrVNi61m08djJVKrjM8KuRAokCgmlkgnY0gmlwhKwSxFCKbXVsdGlhZGRyc5YACASsEsRQBrWLAAoErBLEUAa1jN0DgnJzhQADAQAAiXNlY3AyNTZrMaEDJKPqM6EzrJfDryMR41sWhRm4FfAx5jOUqgSv0umw4iWDdGNwgrWLg3VkcIK1jYV3YWt1MgE"}'
2025-02-07 04:04:44.247 INFO [src.node.waku_node] REST service is ready !!
2025-02-07 04:04:44.253 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-07 04:04:44.253 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-07_04-04-42__87ae373e-227d-4b8e-8ed4-618606df4764__wakuorg_nwaku:latest.log
2025-02-07 04:04:44.253 DEBUG [src.node.waku_node] Starting Node...
2025-02-07 04:04:44.253 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-07 04:04:44.255 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-07 04:04:44.255 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.46.75
2025-02-07 04:04:44.255 DEBUG [src.node.docker_mananger] Generated ports ['27383', '27384', '27385', '27386', '27387']
2025-02-07 04:04:44.255 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-07 04:04:44.255 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-07 04:04:44.255 DEBUG [src.node.waku_node] Using volumes []
2025-02-07 04:04:44.255 DEBUG [src.node.docker_mananger] docker run -i -t -p 27383:27383 -p 27384:27384 -p 27385:27385 -p 27386:27386 -p 27387:27387 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=27385 --rest-port=27383 --tcp-port=27384 --discv5-udp-port=27386 --rest-address=0.0.0.0 --nat=extip:172.18.46.75 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=1fcfbeafbf3afdc3e2da51ef1f3ebadef1a69609f460c67cdfbaf1c77f5badbe --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=27387 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QPIk1yesXNo6novnNJQIVO_I1Ros-TvGjfI8tGtyiQkfZmmJwAXS-X6oq_HKw4zrVNi61m08djJVKrjM8KuRAokCgmlkgnY0gmlwhKwSxFCKbXVsdGlhZGRyc5YACASsEsRQBrWLAAoErBLEUAa1jN0DgnJzhQADAQAAiXNlY3AyNTZrMaEDJKPqM6EzrJfDryMR41sWhRm4FfAx5jOUqgSv0umw4iWDdGNwgrWLg3VkcIK1jYV3YWt1MgE
2025-02-07 04:04:44.486 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.46.75 waku d5c316c869929e958486a256a3ca5e3d4f0b0dcd4dfbe0ac0033924e6dab880a
2025-02-07 04:04:44.536 DEBUG [src.node.docker_mananger] Container started with ID d5c316c86992. Setting up logs at ./log/docker/node2_2025-02-07_04-04-42__87ae373e-227d-4b8e-8ed4-618606df4764__wakuorg_nwaku:latest.log
2025-02-07 04:04:44.537 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 27383
2025-02-07 04:04:44.537 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-07 04:04:45.539 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:27383/health" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:45.543 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-07 04:04:45.544 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-07 04:04:45.544 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:27383/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:45.548 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.46.75/tcp/27384/p2p/16Uiu2HAm4PMJtCXaYpJfVLozi7mmgyUJah51wZcRKHqzBFaeA9rv","/ip4/172.18.46.75/tcp/27385/ws/p2p/16Uiu2HAm4PMJtCXaYpJfVLozi7mmgyUJah51wZcRKHqzBFaeA9rv"],"enrUri":"enr:-L24QJwg9C9csf9GfdN-gHxnzV53rne94gkoAK82eyEn7e0JfiaXZLqVhx7d9tUVzfqQQ0ZJYc6MjQ39pCJrI858TBQCgmlkgnY0gmlwhKwSLkuKbXVsdGlhZGRyc5YACASsEi5LBmr4AAoErBIuSwZq-d0DgnJzhQADAQAAiXNlY3AyNTZrMaEChSDo1Y-pr3OZ6RQhVnUkCjzXWK4-VIFXw7u7tGd4FkeDdGNwgmr4g3VkcIJq-oV3YWt1MgE"}'
2025-02-07 04:04:45.549 INFO [src.node.waku_node] REST service is ready !!
2025-02-07 04:04:45.550 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:27383/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.196.80/tcp/46475/p2p/16Uiu2HAmF81zf18EUW8NjVVX1m9C7w8cfSQtkMyzGaPQAK2gVbTA"]'
2025-02-07 04:04:45.553 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:04:45.553 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-07 04:04:45.554 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46474/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-07 04:04:45.557 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:04:45.557 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:27383/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-07 04:04:45.564 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:04:45.564 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46474/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-07 04:04:45.569 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:04:45.570 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-07 04:04:45.670 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-07 04:04:45.670 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46474/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:45.673 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901085564669696,"ephemeral":false}]'
2025-02-07 04:04:45.675 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-07 04:04:45.675 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:27383/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:45.678 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901085564669696,"ephemeral":false}]'
2025-02-07 04:04:45.679 INFO [src.steps.relay] WARM UP successful!!
2025-02-07 04:04:45.680 DEBUG [tests.relay.test_publish] Running test with Ephemeral True
2025-02-07 04:04:45.680 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46474/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)', "ephemeral": true}'
2025-02-07 04:04:45.685 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:04:45.685 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-07 04:04:45.786 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-07 04:04:45.786 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46474/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:45.789 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901085680631040,"ephemeral":true}]'
2025-02-07 04:04:45.790 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-07 04:04:45.790 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:27383/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:45.793 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901085680631040,"ephemeral":true}]'
2025-02-07 04:04:45.794 DEBUG [tests.relay.test_publish] Running test with Ephemeral False
2025-02-07 04:04:45.795 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46474/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)', "ephemeral": false}'
2025-02-07 04:04:45.799 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:04:45.799 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-07 04:04:45.900 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-07 04:04:45.900 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46474/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:45.903 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901085794901248,"ephemeral":false}]'
2025-02-07 04:04:45.904 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-07 04:04:45.904 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:27383/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:45.906 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901085794901248,"ephemeral":false}]'
2025-02-07 04:04:45.910 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-07 04:04:45.911 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-07 04:04:45.911 DEBUG [src.node.waku_node] Stopping container with id ae5c7a2a4f7c
2025-02-07 04:04:46.704 DEBUG [src.node.waku_node] Container stopped.
2025-02-07 04:04:46.705 DEBUG [src.node.waku_node] Stopping container with id d5c316c86992
2025-02-07 04:04:47.518 ERROR [src.node.docker_mananger] Max retries reached for container ae5c7a2a4f7c. Exiting log stream.
2025-02-07 04:04:48.225 DEBUG [src.node.waku_node] Container stopped.
2025-02-07 04:04:48.226 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-07 04:04:48.233 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-07 04:04:48.238 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
