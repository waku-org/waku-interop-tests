2025-02-07 04:04:36.824 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-07 04:04:36.824 DEBUG [tests.conftest] Running test: test_lightpush_node_with_relay_works_correctly with id: 2025-02-07_04-04-36__664475f4-7e56-4c90-bb38-e1400c0fe2be
2025-02-07 04:04:36.824 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-07 04:04:36.824 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-07 04:04:36.831 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-07 04:04:36.831 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/receiving_node1_2025-02-07_04-04-36__664475f4-7e56-4c90-bb38-e1400c0fe2be__wakuorg_nwaku:latest.log
2025-02-07 04:04:36.831 DEBUG [src.node.waku_node] Starting Node...
2025-02-07 04:04:36.831 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-07 04:04:36.833 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-07 04:04:36.833 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.113.127
2025-02-07 04:04:36.833 DEBUG [src.node.docker_mananger] Generated ports ['6673', '6674', '6675', '6676', '6677']
2025-02-07 04:04:36.833 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-07 04:04:36.833 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-07 04:04:36.833 DEBUG [src.node.waku_node] Using volumes []
2025-02-07 04:04:36.833 DEBUG [src.node.docker_mananger] docker run -i -t -p 6673:6673 -p 6674:6674 -p 6675:6675 -p 6676:6676 -p 6677:6677 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=6675 --rest-port=6673 --tcp-port=6674 --discv5-udp-port=6676 --rest-address=0.0.0.0 --nat=extip:172.18.113.127 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=43b0bc9da3f4ec89b5acf3a3ec4f89afe4ebaa36072e9bff998924bfe73947cf --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=6677 --metrics-logging=true --lightpush=true --relay=true --filter=true
2025-02-07 04:04:37.063 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.113.127 waku db2187c41915a119e725e42f714d5da3f45bbaa5612f65ca66a9136407c76440
2025-02-07 04:04:37.111 DEBUG [src.node.docker_mananger] Container started with ID db2187c41915. Setting up logs at ./log/docker/receiving_node1_2025-02-07_04-04-36__664475f4-7e56-4c90-bb38-e1400c0fe2be__wakuorg_nwaku:latest.log
2025-02-07 04:04:37.111 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 6673
2025-02-07 04:04:37.112 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-07 04:04:37.625 ERROR [src.node.docker_mananger] Max retries reached for container 7974474945ad. Exiting log stream.
2025-02-07 04:04:38.113 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:6673/health" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:38.116 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-07 04:04:38.116 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-07 04:04:38.116 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:6673/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:38.119 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.113.127/tcp/6674/p2p/16Uiu2HAmNn6nxMNAbWtN8ZMxgm7T6HqByqtYSkk4tS5B4TN5kaFT","/ip4/172.18.113.127/tcp/6675/ws/p2p/16Uiu2HAmNn6nxMNAbWtN8ZMxgm7T6HqByqtYSkk4tS5B4TN5kaFT"],"enrUri":"enr:-L24QECgDR8WwI-4Ksuqckl36BfQy-dn_fWHIY5tpEJ8FB4UIMXudFyltFFVsy7EWZZgC5Pv0abU113EzDvRwPj7KlYCgmlkgnY0gmlwhKwScX-KbXVsdGlhZGRyc5YACASsEnF_BhoSAAoErBJxfwYaE90DgnJzhQADAQAAiXNlY3AyNTZrMaEDlmc4MIPxRuzsq0tx3zluDVyR2Nk-NSWyLFyjhGCVNAKDdGNwghoSg3VkcIIaFIV3YWt1Mg0"}'
2025-02-07 04:04:38.119 INFO [src.node.waku_node] REST service is ready !!
2025-02-07 04:04:38.125 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-07 04:04:38.125 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/lightpush_node1_2025-02-07_04-04-36__664475f4-7e56-4c90-bb38-e1400c0fe2be__wakuorg_nwaku:latest.log
2025-02-07 04:04:38.125 DEBUG [src.node.waku_node] Starting Node...
2025-02-07 04:04:38.126 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-07 04:04:38.127 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-07 04:04:38.127 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.212.202
2025-02-07 04:04:38.127 DEBUG [src.node.docker_mananger] Generated ports ['62421', '62422', '62423', '62424', '62425']
2025-02-07 04:04:38.127 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-07 04:04:38.127 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-07 04:04:38.128 DEBUG [src.node.waku_node] Using volumes []
2025-02-07 04:04:38.128 DEBUG [src.node.docker_mananger] docker run -i -t -p 62421:62421 -p 62422:62422 -p 62423:62423 -p 62424:62424 -p 62425:62425 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=62423 --rest-port=62421 --tcp-port=62422 --discv5-udp-port=62424 --rest-address=0.0.0.0 --nat=extip:172.18.212.202 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=15d3a2a79d2da8cdda32bebe7bfd6b7dfe74c5d3c50d0fb1b0e7c08e0cfca3fd --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=62425 --metrics-logging=true --discv5-bootstrap-node=enr:-L24QECgDR8WwI-4Ksuqckl36BfQy-dn_fWHIY5tpEJ8FB4UIMXudFyltFFVsy7EWZZgC5Pv0abU113EzDvRwPj7KlYCgmlkgnY0gmlwhKwScX-KbXVsdGlhZGRyc5YACASsEnF_BhoSAAoErBJxfwYaE90DgnJzhQADAQAAiXNlY3AyNTZrMaEDlmc4MIPxRuzsq0tx3zluDVyR2Nk-NSWyLFyjhGCVNAKDdGNwghoSg3VkcIIaFIV3YWt1Mg0 --lightpushnode=/ip4/172.18.113.127/tcp/6674/p2p/16Uiu2HAmNn6nxMNAbWtN8ZMxgm7T6HqByqtYSkk4tS5B4TN5kaFT --lightpush=true --relay=true --filter=true
2025-02-07 04:04:38.351 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.212.202 waku 5bbaa58db4841bcc89ddde6437d4e58ff63ffc4243ff389916bd3d84b9d5aa24
2025-02-07 04:04:38.402 DEBUG [src.node.docker_mananger] Container started with ID 5bbaa58db484. Setting up logs at ./log/docker/lightpush_node1_2025-02-07_04-04-36__664475f4-7e56-4c90-bb38-e1400c0fe2be__wakuorg_nwaku:latest.log
2025-02-07 04:04:38.402 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 62421
2025-02-07 04:04:38.403 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-07 04:04:39.403 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:62421/health" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:39.406 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-07 04:04:39.406 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-07 04:04:39.406 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:62421/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:39.408 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.212.202/tcp/62422/p2p/16Uiu2HAmGZnPiinV9PJRRWYTbEFHmBp9TuzhQfX6rxMxsciHvnaA","/ip4/172.18.212.202/tcp/62423/ws/p2p/16Uiu2HAmGZnPiinV9PJRRWYTbEFHmBp9TuzhQfX6rxMxsciHvnaA"],"enrUri":"enr:-L24QNrRofubEv8tZ7wtFOsxNCSHiQuStdO54XJvHk_10qLafqHgY6EbK4ALbAdc4vSozCvQbrgVnqsUFkQPPCKD67UCgmlkgnY0gmlwhKwS1MqKbXVsdGlhZGRyc5YACASsEtTKBvPWAAoErBLUygbz190DgnJzhQADAQAAiXNlY3AyNTZrMaEDOhlSlYu3UEKOeQ5FdUgNroDgMjbCF0oMdXWcVyitI3-DdGNwgvPWg3VkcILz2IV3YWt1Mg0"}'
2025-02-07 04:04:39.408 INFO [src.node.waku_node] REST service is ready !!
2025-02-07 04:04:39.409 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:62421/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.113.127/tcp/6674/p2p/16Uiu2HAmNn6nxMNAbWtN8ZMxgm7T6HqByqtYSkk4tS5B4TN5kaFT"]'
2025-02-07 04:04:48.372 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:04:48.373 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:6673/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2025-02-07 04:04:48.382 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:04:48.382 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:62421/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2025-02-07 04:04:48.384 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:04:48.385 DEBUG [src.libs.common] Sleeping for 0.5 seconds
2025-02-07 04:04:48.885 DEBUG [src.steps.light_push] Lightpushing message
2025-02-07 04:04:48.886 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:62421/lightpush/v1/message" -H "Content-Type: application/json" -d '{"pubsubTopic": "/waku/2/rs/3/0", "message": {"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": 1738901088885786880}}'
2025-02-07 04:04:48.897 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:04:48.897 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-07 04:04:48.998 DEBUG [src.steps.light_push] Checking that peer NODE_1:wakuorg/nwaku:latest can find the lightpushed message
2025-02-07 04:04:48.998 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:6673/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:49.000 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1738901088885786880,"ephemeral":false}]'
2025-02-07 04:04:49.002 DEBUG [src.steps.light_push] Checking that peer NODE_2:wakuorg/nwaku:latest can find the lightpushed message
2025-02-07 04:04:49.003 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:62421/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:49.005 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1738901088885786880,"ephemeral":false}]'
2025-02-07 04:04:49.006 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:62421/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d '{"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2025-02-07 04:04:49.011 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:04:49.012 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:6673/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d '{"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2025-02-07 04:04:49.017 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:04:49.018 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-07 04:04:49.118 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:6673/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:49.121 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1738901089006499840,"ephemeral":false},{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1738901089011942144,"ephemeral":false}]'
2025-02-07 04:04:49.121 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:62421/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:04:49.124 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1738901089006499840,"ephemeral":false},{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1738901089011942144,"ephemeral":false}]'
2025-02-07 04:04:49.125 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-07 04:04:49.126 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-07 04:04:49.126 DEBUG [src.node.waku_node] Stopping container with id db2187c41915
2025-02-07 04:04:50.587 DEBUG [src.node.waku_node] Container stopped.
2025-02-07 04:04:50.587 DEBUG [src.node.waku_node] Stopping container with id 5bbaa58db484
2025-02-07 04:04:51.399 ERROR [src.node.docker_mananger] Max retries reached for container db2187c41915. Exiting log stream.
2025-02-07 04:04:52.108 DEBUG [src.node.waku_node] Container stopped.
2025-02-07 04:04:52.109 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-07 04:04:52.116 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-07 04:04:52.123 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
