2025-02-07 04:08:20.760 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-07 04:08:20.761 DEBUG [tests.conftest] Running test: test_publish_with_payload_equal_or_more_150_kb with id: 2025-02-07_04-08-20__4baf32b7-c3c5-43c7-b505-652f76ab87d0
2025-02-07 04:08:20.761 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-07 04:08:20.761 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-07 04:08:20.762 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-07 04:08:20.767 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-07 04:08:20.768 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-07_04-08-20__4baf32b7-c3c5-43c7-b505-652f76ab87d0__wakuorg_nwaku:latest.log
2025-02-07 04:08:20.768 DEBUG [src.node.waku_node] Starting Node...
2025-02-07 04:08:20.768 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-07 04:08:20.769 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-07 04:08:20.769 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.76.91
2025-02-07 04:08:20.770 DEBUG [src.node.docker_mananger] Generated ports ['30413', '30414', '30415', '30416', '30417']
2025-02-07 04:08:20.770 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-07 04:08:20.770 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-07 04:08:20.770 DEBUG [src.node.waku_node] Using volumes []
2025-02-07 04:08:20.770 DEBUG [src.node.docker_mananger] docker run -i -t -p 30413:30413 -p 30414:30414 -p 30415:30415 -p 30416:30416 -p 30417:30417 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=30415 --rest-port=30413 --tcp-port=30414 --discv5-udp-port=30416 --rest-address=0.0.0.0 --nat=extip:172.18.76.91 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=fcefa35bd6efe67a08566bced20bbaba0ae59ceecf1dcddeebdde68cf267a45c --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=30417 --metrics-logging=true --relay=true
2025-02-07 04:08:20.998 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.76.91 waku 480248d23004aa1ec558636dd24a223da957530edc7635ae81f0a8a9cd0eb045
2025-02-07 04:08:21.045 DEBUG [src.node.docker_mananger] Container started with ID 480248d23004. Setting up logs at ./log/docker/node1_2025-02-07_04-08-20__4baf32b7-c3c5-43c7-b505-652f76ab87d0__wakuorg_nwaku:latest.log
2025-02-07 04:08:21.045 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 30413
2025-02-07 04:08:21.046 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-07 04:08:21.562 ERROR [src.node.docker_mananger] Max retries reached for container 78301ab16878. Exiting log stream.
2025-02-07 04:08:22.047 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:30413/health" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:22.049 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-07 04:08:22.049 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-07 04:08:22.049 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:30413/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:22.051 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.76.91/tcp/30414/p2p/16Uiu2HAm6RqZczxjsyN41rJ4qxLYCqoRc8QiRbF6dGp5kB2vgaUm","/ip4/172.18.76.91/tcp/30415/ws/p2p/16Uiu2HAm6RqZczxjsyN41rJ4qxLYCqoRc8QiRbF6dGp5kB2vgaUm"],"enrUri":"enr:-L24QE2R-epJBKF4yc2UCttswOz5mXsKJbHuL5se3Vo7Y1cFZ_ejRByI68UK9D2WgADoMlj4vHqdIHB4kbo9l9qkUuICgmlkgnY0gmlwhKwSTFuKbXVsdGlhZGRyc5YACASsEkxbBnbOAAoErBJMWwZ2z90DgnJzhQADAQAAiXNlY3AyNTZrMaECo3tkWcjwC1jP7mZq7FmKkH_g1XIU_tk9d9gEiyVZtfaDdGNwgnbOg3VkcIJ20IV3YWt1MgE"}'
2025-02-07 04:08:22.052 INFO [src.node.waku_node] REST service is ready !!
2025-02-07 04:08:22.057 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-07 04:08:22.057 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-07_04-08-20__4baf32b7-c3c5-43c7-b505-652f76ab87d0__wakuorg_nwaku:latest.log
2025-02-07 04:08:22.058 DEBUG [src.node.waku_node] Starting Node...
2025-02-07 04:08:22.058 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-07 04:08:22.059 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-07 04:08:22.059 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.84.168
2025-02-07 04:08:22.059 DEBUG [src.node.docker_mananger] Generated ports ['58104', '58105', '58106', '58107', '58108']
2025-02-07 04:08:22.059 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-07 04:08:22.060 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-07 04:08:22.060 DEBUG [src.node.waku_node] Using volumes []
2025-02-07 04:08:22.060 DEBUG [src.node.docker_mananger] docker run -i -t -p 58104:58104 -p 58105:58105 -p 58106:58106 -p 58107:58107 -p 58108:58108 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=58106 --rest-port=58104 --tcp-port=58105 --discv5-udp-port=58107 --rest-address=0.0.0.0 --nat=extip:172.18.84.168 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=fbba84e11da5c4fabcb2a407fabb8771f5ca5c480b0739aeb530b24b42b1bb2d --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=58108 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QE2R-epJBKF4yc2UCttswOz5mXsKJbHuL5se3Vo7Y1cFZ_ejRByI68UK9D2WgADoMlj4vHqdIHB4kbo9l9qkUuICgmlkgnY0gmlwhKwSTFuKbXVsdGlhZGRyc5YACASsEkxbBnbOAAoErBJMWwZ2z90DgnJzhQADAQAAiXNlY3AyNTZrMaECo3tkWcjwC1jP7mZq7FmKkH_g1XIU_tk9d9gEiyVZtfaDdGNwgnbOg3VkcIJ20IV3YWt1MgE
2025-02-07 04:08:22.278 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.84.168 waku ab2394a616dcbff3d528cbd5d51fcd5c936da24f4200b63e5790200e82cf2d0a
2025-02-07 04:08:22.326 DEBUG [src.node.docker_mananger] Container started with ID ab2394a616dc. Setting up logs at ./log/docker/node2_2025-02-07_04-08-20__4baf32b7-c3c5-43c7-b505-652f76ab87d0__wakuorg_nwaku:latest.log
2025-02-07 04:08:22.326 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 58104
2025-02-07 04:08:22.326 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-07 04:08:23.326 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58104/health" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:23.336 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-07 04:08:23.338 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-07 04:08:23.340 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58104/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:23.342 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.84.168/tcp/58105/p2p/16Uiu2HAmSREhDGDMtt34TnBPM4btz3JWEAJ387ik7fWDr2WjmC3r","/ip4/172.18.84.168/tcp/58106/ws/p2p/16Uiu2HAmSREhDGDMtt34TnBPM4btz3JWEAJ387ik7fWDr2WjmC3r"],"enrUri":"enr:-L24QGLm1jmLR4h0ZkG2AnPTspIJSnvVaxR4wIyUHVBOpF08GPTAjlsdJqQSzULEXeQZoq1eQuPMVLEP7w2WunLS_P4CgmlkgnY0gmlwhKwSVKiKbXVsdGlhZGRyc5YACASsElSoBuL5AAoErBJUqAbi-t0DgnJzhQADAQAAiXNlY3AyNTZrMaEDzH20MUDYPBVTtDubfMRp0x-TgGo99dPeNI2V7a4LxpGDdGNwguL5g3VkcILi-4V3YWt1MgE"}'
2025-02-07 04:08:23.343 INFO [src.node.waku_node] REST service is ready !!
2025-02-07 04:08:23.343 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:58104/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.76.91/tcp/30414/p2p/16Uiu2HAm6RqZczxjsyN41rJ4qxLYCqoRc8QiRbF6dGp5kB2vgaUm"]'
2025-02-07 04:08:23.345 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:08:23.346 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-07 04:08:23.346 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:30413/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-07 04:08:23.350 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:08:23.351 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:58104/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-07 04:08:23.355 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:08:23.356 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:30413/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-07 04:08:23.361 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:08:23.362 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-07 04:08:23.463 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-07 04:08:23.463 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:30413/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:23.465 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901303356457728,"ephemeral":false}]'
2025-02-07 04:08:23.467 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-07 04:08:23.467 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58104/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:23.469 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901303356457728,"ephemeral":false}]'
2025-02-07 04:08:23.470 INFO [src.steps.relay] WARM UP successful!!
2025-02-07 04:08:23.471 DEBUG [tests.relay.test_publish] Running test with payload length of 204800 bytes
2025-02-07 04:08:23.475 INFO [src.node.api_clients.base_client] Log line was discarded because it's longer than max_log_line_length=5000
2025-02-07 04:08:23.492 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:30413/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Failed to publish: Message size exceeded maximum of 153600 bytes'
2025-02-07 04:08:23.493 DEBUG [tests.relay.test_publish] Running test with payload length of 1048576 bytes
2025-02-07 04:08:23.511 INFO [src.node.api_clients.base_client] Log line was discarded because it's longer than max_log_line_length=5000
2025-02-07 04:08:23.576 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:30413/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Failed to publish: Message size exceeded maximum of 153600 bytes'
2025-02-07 04:08:23.577 DEBUG [tests.relay.test_publish] Running test with payload length of 10485760 bytes
2025-02-07 04:08:23.715 INFO [src.node.api_clients.base_client] Log line was discarded because it's longer than max_log_line_length=5000
2025-02-07 04:08:24.278 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:30413/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Failed to publish: Message size exceeded maximum of 153600 bytes'
2025-02-07 04:08:24.281 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-07 04:08:24.282 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-07 04:08:24.282 DEBUG [src.node.waku_node] Stopping container with id 480248d23004
2025-02-07 04:08:25.523 DEBUG [src.node.waku_node] Container stopped.
2025-02-07 04:08:25.523 DEBUG [src.node.waku_node] Stopping container with id ab2394a616dc
2025-02-07 04:08:26.335 ERROR [src.node.docker_mananger] Max retries reached for container 480248d23004. Exiting log stream.
2025-02-07 04:08:27.018 DEBUG [src.node.waku_node] Container stopped.
2025-02-07 04:08:27.020 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-07 04:08:27.026 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-07 04:08:27.031 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
