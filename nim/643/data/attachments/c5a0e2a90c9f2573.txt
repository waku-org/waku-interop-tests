2025-02-07 04:08:27.155 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-07 04:08:27.156 DEBUG [tests.conftest] Running test: test_publish_after_node2_restarts with id: 2025-02-07_04-08-27__ba101049-b68b-4be4-8d82-76004ec95efe
2025-02-07 04:08:27.156 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-07 04:08:27.156 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-07 04:08:27.157 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-07 04:08:27.163 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-07 04:08:27.163 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-07_04-08-27__ba101049-b68b-4be4-8d82-76004ec95efe__wakuorg_nwaku:latest.log
2025-02-07 04:08:27.163 DEBUG [src.node.waku_node] Starting Node...
2025-02-07 04:08:27.163 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-07 04:08:27.165 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-07 04:08:27.165 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.85.59
2025-02-07 04:08:27.165 DEBUG [src.node.docker_mananger] Generated ports ['56028', '56029', '56030', '56031', '56032']
2025-02-07 04:08:27.165 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-07 04:08:27.165 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-07 04:08:27.165 DEBUG [src.node.waku_node] Using volumes []
2025-02-07 04:08:27.166 DEBUG [src.node.docker_mananger] docker run -i -t -p 56028:56028 -p 56029:56029 -p 56030:56030 -p 56031:56031 -p 56032:56032 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=56030 --rest-port=56028 --tcp-port=56029 --discv5-udp-port=56031 --rest-address=0.0.0.0 --nat=extip:172.18.85.59 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=9bb61a9d788fdae2d49a364950c0f17baa6cfa91eec7172b3cc92cdbeb85fa99 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=56032 --metrics-logging=true --relay=true
2025-02-07 04:08:27.415 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.85.59 waku f057d50e347f0b4999be5ed0b7e48aa23bb846164a562f15389940ec16e1d151
2025-02-07 04:08:27.462 DEBUG [src.node.docker_mananger] Container started with ID f057d50e347f. Setting up logs at ./log/docker/node1_2025-02-07_04-08-27__ba101049-b68b-4be4-8d82-76004ec95efe__wakuorg_nwaku:latest.log
2025-02-07 04:08:27.463 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 56028
2025-02-07 04:08:27.463 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-07 04:08:27.910 ERROR [src.node.docker_mananger] Max retries reached for container ab2394a616dc. Exiting log stream.
2025-02-07 04:08:28.464 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:56028/health" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:28.467 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-07 04:08:28.467 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-07 04:08:28.467 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:56028/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:28.469 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.85.59/tcp/56029/p2p/16Uiu2HAmRU8XekDQ8fUSX8JCLNi55RUpvMUHuHfcvD1ChXq6DXC7","/ip4/172.18.85.59/tcp/56030/ws/p2p/16Uiu2HAmRU8XekDQ8fUSX8JCLNi55RUpvMUHuHfcvD1ChXq6DXC7"],"enrUri":"enr:-L24QI7GeWbYKgxo904D1fhaFisO6zKa7v3A3i3EAyUMC8AjEGYwSTrAiYNTCMxyCDUxfdmo-ntF9wUVlYxTRHjXuR4CgmlkgnY0gmlwhKwSVTuKbXVsdGlhZGRyc5YACASsElU7BtrdAAoErBJVOwba3t0DgnJzhQADAQAAiXNlY3AyNTZrMaEDvl_J7PhoQRi61DsXBSsVfZIKWgDXm3WYqVYCCZ9OqGyDdGNwgtrdg3VkcILa34V3YWt1MgE"}'
2025-02-07 04:08:28.469 INFO [src.node.waku_node] REST service is ready !!
2025-02-07 04:08:28.475 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-07 04:08:28.475 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-07_04-08-27__ba101049-b68b-4be4-8d82-76004ec95efe__wakuorg_nwaku:latest.log
2025-02-07 04:08:28.475 DEBUG [src.node.waku_node] Starting Node...
2025-02-07 04:08:28.476 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-07 04:08:28.477 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-07 04:08:28.477 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.55.112
2025-02-07 04:08:28.477 DEBUG [src.node.docker_mananger] Generated ports ['22858', '22859', '22860', '22861', '22862']
2025-02-07 04:08:28.477 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-07 04:08:28.477 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-07 04:08:28.478 DEBUG [src.node.waku_node] Using volumes []
2025-02-07 04:08:28.478 DEBUG [src.node.docker_mananger] docker run -i -t -p 22858:22858 -p 22859:22859 -p 22860:22860 -p 22861:22861 -p 22862:22862 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=22860 --rest-port=22858 --tcp-port=22859 --discv5-udp-port=22861 --rest-address=0.0.0.0 --nat=extip:172.18.55.112 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=cdbe9bff83df7fb6fe5f133ea6d37015abecc5ab45cfcfe855b68d4b7d7cfb6d --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=22862 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QI7GeWbYKgxo904D1fhaFisO6zKa7v3A3i3EAyUMC8AjEGYwSTrAiYNTCMxyCDUxfdmo-ntF9wUVlYxTRHjXuR4CgmlkgnY0gmlwhKwSVTuKbXVsdGlhZGRyc5YACASsElU7BtrdAAoErBJVOwba3t0DgnJzhQADAQAAiXNlY3AyNTZrMaEDvl_J7PhoQRi61DsXBSsVfZIKWgDXm3WYqVYCCZ9OqGyDdGNwgtrdg3VkcILa34V3YWt1MgE
2025-02-07 04:08:28.705 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.55.112 waku 3a1bce2243e2a8cbda5ec1f1225060b8f353e6885d1a1945404b26bbe2829549
2025-02-07 04:08:28.753 DEBUG [src.node.docker_mananger] Container started with ID 3a1bce2243e2. Setting up logs at ./log/docker/node2_2025-02-07_04-08-27__ba101049-b68b-4be4-8d82-76004ec95efe__wakuorg_nwaku:latest.log
2025-02-07 04:08:28.753 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 22858
2025-02-07 04:08:28.753 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-07 04:08:29.753 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22858/health" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:29.761 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-07 04:08:29.762 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-07 04:08:29.762 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22858/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:29.768 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.55.112/tcp/22859/p2p/16Uiu2HAkwbLSozf76z66aGX3b5dYkeUiTbDWm8qEuuKYr9na8aS9","/ip4/172.18.55.112/tcp/22860/ws/p2p/16Uiu2HAkwbLSozf76z66aGX3b5dYkeUiTbDWm8qEuuKYr9na8aS9"],"enrUri":"enr:-L24QMFgCqkJRlXKiOKbjcXwxfDZwKQaNsim8o_yL6QfUvLQXX0I09FwtAfhpKHA9IIuvDrhABulDqZ_A-kgCFW_U9ECgmlkgnY0gmlwhKwSN3CKbXVsdGlhZGRyc5YACASsEjdwBllLAAoErBI3cAZZTN0DgnJzhQADAQAAiXNlY3AyNTZrMaECIDEYNhdc2YevelXd56AIezMFcU_5B4kHsOETzx6LMh6DdGNwgllLg3VkcIJZTYV3YWt1MgE"}'
2025-02-07 04:08:29.768 INFO [src.node.waku_node] REST service is ready !!
2025-02-07 04:08:29.769 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:22858/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.85.59/tcp/56029/p2p/16Uiu2HAmRU8XekDQ8fUSX8JCLNi55RUpvMUHuHfcvD1ChXq6DXC7"]'
2025-02-07 04:08:29.772 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:08:29.773 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-07 04:08:29.773 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:56028/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-07 04:08:29.777 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:08:29.777 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:22858/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-07 04:08:29.783 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:08:29.784 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:56028/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-07 04:08:29.790 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:08:29.790 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-07 04:08:29.890 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-07 04:08:29.890 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:56028/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:29.892 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901309784039168,"ephemeral":false}]'
2025-02-07 04:08:29.894 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-07 04:08:29.894 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22858/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:29.896 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901309784039168,"ephemeral":false}]'
2025-02-07 04:08:29.897 INFO [src.steps.relay] WARM UP successful!!
2025-02-07 04:08:29.898 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:56028/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-07 04:08:29.903 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:08:29.903 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-07 04:08:30.004 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-07 04:08:30.004 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:56028/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:30.006 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901309898806016,"ephemeral":false}]'
2025-02-07 04:08:30.007 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-07 04:08:30.007 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22858/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:30.010 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901309898806016,"ephemeral":false}]'
2025-02-07 04:08:30.011 DEBUG [src.node.waku_node] Restarting container with id 3a1bce2243e2
2025-02-07 04:08:31.482 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22858/health" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:31.586 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22858/health" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:31.588 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-07 04:08:31.589 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-07 04:08:31.589 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22858/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:31.591 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.55.112/tcp/22859/p2p/16Uiu2HAkwbLSozf76z66aGX3b5dYkeUiTbDWm8qEuuKYr9na8aS9","/ip4/172.18.55.112/tcp/22860/ws/p2p/16Uiu2HAkwbLSozf76z66aGX3b5dYkeUiTbDWm8qEuuKYr9na8aS9"],"enrUri":"enr:-L24QMFgCqkJRlXKiOKbjcXwxfDZwKQaNsim8o_yL6QfUvLQXX0I09FwtAfhpKHA9IIuvDrhABulDqZ_A-kgCFW_U9ECgmlkgnY0gmlwhKwSN3CKbXVsdGlhZGRyc5YACASsEjdwBllLAAoErBI3cAZZTN0DgnJzhQADAQAAiXNlY3AyNTZrMaECIDEYNhdc2YevelXd56AIezMFcU_5B4kHsOETzx6LMh6DdGNwgllLg3VkcIJZTYV3YWt1MgE"}'
2025-02-07 04:08:31.591 INFO [src.node.waku_node] REST service is ready !!
2025-02-07 04:08:31.591 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:56028/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-07 04:08:31.594 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:08:31.594 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:22858/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-07 04:08:31.612 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:08:31.612 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:56028/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-07 04:08:31.615 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:08:31.615 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-07 04:08:31.715 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-07 04:08:31.715 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:56028/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:31.717 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901311612415232,"ephemeral":false}]'
2025-02-07 04:08:31.719 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-07 04:08:31.719 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22858/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:31.721 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[]'
2025-02-07 04:08:32.722 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:56028/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-07 04:08:32.727 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-07 04:08:32.728 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-07 04:08:32.828 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-07 04:08:32.828 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:56028/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:32.831 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901312722345728,"ephemeral":false}]'
2025-02-07 04:08:32.832 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-07 04:08:32.832 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22858/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-07 04:08:32.834 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738901312722345728,"ephemeral":false}]'
2025-02-07 04:08:32.837 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-07 04:08:32.838 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-07 04:08:32.838 DEBUG [src.node.waku_node] Stopping container with id f057d50e347f
2025-02-07 04:08:33.931 DEBUG [src.node.waku_node] Container stopped.
2025-02-07 04:08:33.932 DEBUG [src.node.waku_node] Stopping container with id 3a1bce2243e2
2025-02-07 04:08:34.743 ERROR [src.node.docker_mananger] Max retries reached for container f057d50e347f. Exiting log stream.
2025-02-07 04:08:35.410 DEBUG [src.node.waku_node] Container stopped.
2025-02-07 04:08:35.411 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-07 04:08:35.419 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-07 04:08:35.436 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
