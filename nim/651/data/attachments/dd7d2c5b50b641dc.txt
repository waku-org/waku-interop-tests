2025-02-14 04:06:19.841 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-14 04:06:19.841 DEBUG [tests.conftest] Running test: test_single_pubsub_topic[/waku/2/rs/2/0] with id: 2025-02-14_04-06-19__a5d331f8-4b41-4465-8e71-0505fd28f269
2025-02-14 04:06:19.841 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-14 04:06:19.842 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-14 04:06:19.842 DEBUG [src.steps.sharding] Running fixture setup: sharding_setup
2025-02-14 04:06:19.849 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-14 04:06:19.849 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-14_04-06-19__a5d331f8-4b41-4465-8e71-0505fd28f269__wakuorg_nwaku:latest.log
2025-02-14 04:06:19.849 DEBUG [src.node.waku_node] Starting Node...
2025-02-14 04:06:19.850 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-14 04:06:19.851 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-14 04:06:19.851 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.38.232
2025-02-14 04:06:19.851 DEBUG [src.node.docker_mananger] Generated ports ['27166', '27167', '27168', '27169', '27170']
2025-02-14 04:06:19.852 DEBUG [src.node.waku_node] Cluster id was resolved to: 2
2025-02-14 04:06:19.852 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-14 04:06:19.852 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-14 04:06:19.852 DEBUG [src.node.waku_node] Using volumes []
2025-02-14 04:06:19.852 DEBUG [src.node.docker_mananger] docker run -i -t -p 27166:27166 -p 27167:27167 -p 27168:27168 -p 27169:27169 -p 27170:27170 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=27168 --rest-port=27166 --tcp-port=27167 --discv5-udp-port=27169 --rest-address=0.0.0.0 --nat=extip:172.18.38.232 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=36fdedb27ad434bc9d4ffc9ccb45a3fff0d6ca3cdaec8e1a7a48caa278a5ab1d --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=27170 --metrics-logging=true --relay=true --filter=true --pubsub-topic=/waku/2/rs/2/0
2025-02-14 04:06:20.079 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.38.232 waku 790bffbfa9362118c46b633251b1042a6a4dea4ba34e5e46e500773f47cd6a80
2025-02-14 04:06:20.125 DEBUG [src.node.docker_mananger] Container started with ID 790bffbfa936. Setting up logs at ./log/docker/node1_2025-02-14_04-06-19__a5d331f8-4b41-4465-8e71-0505fd28f269__wakuorg_nwaku:latest.log
2025-02-14 04:06:20.126 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 27166
2025-02-14 04:06:20.126 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-14 04:06:20.634 ERROR [src.node.docker_mananger] Max retries reached for container 77edee40fee0. Exiting log stream.
2025-02-14 04:06:21.126 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:27166/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:06:21.129 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-14 04:06:21.130 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-14 04:06:21.130 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:27166/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:06:21.132 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.38.232/tcp/27167/p2p/16Uiu2HAmLXPtNbB4RkrTQGNoFyKG9JoqYBmvWYyhXfMFzCb5YJHe","/ip4/172.18.38.232/tcp/27168/ws/p2p/16Uiu2HAmLXPtNbB4RkrTQGNoFyKG9JoqYBmvWYyhXfMFzCb5YJHe"],"enrUri":"enr:-L24QGJhC5JPi14rOz8YJWZFnY1r62RSaXUYzlO0NUeyYJDTQPTvtv5dHPlxNPEeR-zSzWB6m4H98rCy5PvRdpkG-t0CgmlkgnY0gmlwhKwSJuiKbXVsdGlhZGRyc5YACASsEiboBmofAAoErBIm6AZqIN0DgnJzhQACAQAAiXNlY3AyNTZrMaEDdOt2CZrYHMLy3yZdeLTt8STLVnS1L_FgyJsd4G-KusGDdGNwgmofg3VkcIJqIYV3YWt1MgU"}'
2025-02-14 04:06:21.132 INFO [src.node.waku_node] REST service is ready !!
2025-02-14 04:06:21.139 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-14 04:06:21.139 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-14_04-06-19__a5d331f8-4b41-4465-8e71-0505fd28f269__wakuorg_nwaku:latest.log
2025-02-14 04:06:21.139 DEBUG [src.node.waku_node] Starting Node...
2025-02-14 04:06:21.139 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-14 04:06:21.141 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-14 04:06:21.141 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.87.123
2025-02-14 04:06:21.141 DEBUG [src.node.docker_mananger] Generated ports ['22280', '22281', '22282', '22283', '22284']
2025-02-14 04:06:21.141 DEBUG [src.node.waku_node] Cluster id was resolved to: 2
2025-02-14 04:06:21.141 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-14 04:06:21.141 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-14 04:06:21.141 DEBUG [src.node.waku_node] Using volumes []
2025-02-14 04:06:21.141 DEBUG [src.node.docker_mananger] docker run -i -t -p 22280:22280 -p 22281:22281 -p 22282:22282 -p 22283:22283 -p 22284:22284 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=22282 --rest-port=22280 --tcp-port=22281 --discv5-udp-port=22283 --rest-address=0.0.0.0 --nat=extip:172.18.87.123 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=2d023de755144494cbbccb1c43ef82adc7ffdadf8cfcdf7df49c71c53ec4add6 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=22284 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QGJhC5JPi14rOz8YJWZFnY1r62RSaXUYzlO0NUeyYJDTQPTvtv5dHPlxNPEeR-zSzWB6m4H98rCy5PvRdpkG-t0CgmlkgnY0gmlwhKwSJuiKbXVsdGlhZGRyc5YACASsEiboBmofAAoErBIm6AZqIN0DgnJzhQACAQAAiXNlY3AyNTZrMaEDdOt2CZrYHMLy3yZdeLTt8STLVnS1L_FgyJsd4G-KusGDdGNwgmofg3VkcIJqIYV3YWt1MgU --pubsub-topic=/waku/2/rs/2/0
2025-02-14 04:06:21.372 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.87.123 waku 9c97e7a7bcefab57385a8e0111d35965d2fccb4bc44039becabd5ba6d13490c6
2025-02-14 04:06:21.423 DEBUG [src.node.docker_mananger] Container started with ID 9c97e7a7bcef. Setting up logs at ./log/docker/node2_2025-02-14_04-06-19__a5d331f8-4b41-4465-8e71-0505fd28f269__wakuorg_nwaku:latest.log
2025-02-14 04:06:21.423 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 22280
2025-02-14 04:06:21.423 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-14 04:06:22.424 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22280/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:06:22.428 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-14 04:06:22.429 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-14 04:06:22.429 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22280/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:06:22.437 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.87.123/tcp/22281/p2p/16Uiu2HAm1TMphQ4LaVKQKaGPgvAeYmZ8CnqvCTHptkMfS5T1dqRS","/ip4/172.18.87.123/tcp/22282/ws/p2p/16Uiu2HAm1TMphQ4LaVKQKaGPgvAeYmZ8CnqvCTHptkMfS5T1dqRS"],"enrUri":"enr:-L24QNpkNTCANv8nFPJ_J2_HG_-Rjx-tUDEShR0EHEt3KeOKJIRDgPJ04dUPUbAjoRGn1_g2devQ90IsIm3h4YUmoEICgmlkgnY0gmlwhKwSV3uKbXVsdGlhZGRyc5YACASsEld7BlcJAAoErBJXewZXCt0DgnJzhQACAQAAiXNlY3AyNTZrMaECWZTA0ItXZd_CpjyFKVJKlAMOgn2C43gFMBD_S4amPamDdGNwglcJg3VkcIJXC4V3YWt1MgE"}'
2025-02-14 04:06:22.438 INFO [src.node.waku_node] REST service is ready !!
2025-02-14 04:06:22.438 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:22280/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.38.232/tcp/27167/p2p/16Uiu2HAmLXPtNbB4RkrTQGNoFyKG9JoqYBmvWYyhXfMFzCb5YJHe"]'
2025-02-14 04:06:22.442 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:06:22.442 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:27166/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2025-02-14 04:06:22.444 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:06:22.445 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:22280/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2025-02-14 04:06:22.447 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:06:22.448 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:27166/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:06:22.453 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:06:22.453 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-14 04:06:22.554 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-14 04:06:22.554 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:27166/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:06:22.557 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1739505982448006144,"ephemeral":false}]'
2025-02-14 04:06:22.559 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-14 04:06:22.559 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22280/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:06:22.561 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1739505982448006144,"ephemeral":false}]'
2025-02-14 04:06:22.564 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-14 04:06:22.565 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-14 04:06:22.565 DEBUG [src.node.waku_node] Stopping container with id 790bffbfa936
2025-02-14 04:06:23.323 DEBUG [src.node.waku_node] Container stopped.
2025-02-14 04:06:23.323 DEBUG [src.node.waku_node] Stopping container with id 9c97e7a7bcef
2025-02-14 04:06:24.137 ERROR [src.node.docker_mananger] Max retries reached for container 790bffbfa936. Exiting log stream.
2025-02-14 04:06:24.208 DEBUG [src.node.waku_node] Container stopped.
2025-02-14 04:06:24.209 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-14 04:06:24.214 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-14 04:06:24.220 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
