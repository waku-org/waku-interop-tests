2025-02-14 04:03:35.583 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-14 04:03:35.583 DEBUG [tests.conftest] Running test: test_relay_resubscribe_to_unsubscribed_pubsub_topic with id: 2025-02-14_04-03-35__5e5c74d7-66d6-487b-82cc-967cc78ba138
2025-02-14 04:03:35.583 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-14 04:03:35.584 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-14 04:03:35.584 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-14 04:03:35.590 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-14 04:03:35.590 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-14_04-03-35__5e5c74d7-66d6-487b-82cc-967cc78ba138__wakuorg_nwaku:latest.log
2025-02-14 04:03:35.590 DEBUG [src.node.waku_node] Starting Node...
2025-02-14 04:03:35.590 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-14 04:03:35.592 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-14 04:03:35.592 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.156.180
2025-02-14 04:03:35.592 DEBUG [src.node.docker_mananger] Generated ports ['48524', '48525', '48526', '48527', '48528']
2025-02-14 04:03:35.592 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-14 04:03:35.592 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-14 04:03:35.592 DEBUG [src.node.waku_node] Using volumes []
2025-02-14 04:03:35.593 DEBUG [src.node.docker_mananger] docker run -i -t -p 48524:48524 -p 48525:48525 -p 48526:48526 -p 48527:48527 -p 48528:48528 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=48526 --rest-port=48524 --tcp-port=48525 --discv5-udp-port=48527 --rest-address=0.0.0.0 --nat=extip:172.18.156.180 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=fb9431ff1587d72a1fdaa809e75dcaf522e38ef1f042cc4d3fde72cdf20dbecd --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=48528 --metrics-logging=true --relay=true
2025-02-14 04:03:35.822 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.156.180 waku 75977d54040382984206b78e8cc0b1fb9bcba2f97e11ca6d046f0d01c74df807
2025-02-14 04:03:35.875 DEBUG [src.node.docker_mananger] Container started with ID 75977d540403. Setting up logs at ./log/docker/node1_2025-02-14_04-03-35__5e5c74d7-66d6-487b-82cc-967cc78ba138__wakuorg_nwaku:latest.log
2025-02-14 04:03:35.875 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 48524
2025-02-14 04:03:35.876 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-14 04:03:36.390 ERROR [src.node.docker_mananger] Max retries reached for container 959c73f5c8b5. Exiting log stream.
2025-02-14 04:03:36.877 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48524/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:36.880 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-14 04:03:36.880 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-14 04:03:36.880 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48524/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:36.882 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.156.180/tcp/48525/p2p/16Uiu2HAmSj4ev1jTq4Dq8vxwNb86Bbz8pG6RKWUcBFaiHcRAcmXP","/ip4/172.18.156.180/tcp/48526/ws/p2p/16Uiu2HAmSj4ev1jTq4Dq8vxwNb86Bbz8pG6RKWUcBFaiHcRAcmXP"],"enrUri":"enr:-L24QNUpSB7w48flIzQ6kPvFJ_x-km5lA9nCNavH4YgMfPaEBVLYxGRO1WEf8iucrH9B7Nm29ryNrn4w5yShbnlFr0ACgmlkgnY0gmlwhKwSnLSKbXVsdGlhZGRyc5YACASsEpy0Br2NAAoErBKctAa9jt0DgnJzhQADAQAAiXNlY3AyNTZrMaED0Q7OfmUNSz77_mstRU_vQXOQ-7uOBzod2ANMi3Vs1tqDdGNwgr2Ng3VkcIK9j4V3YWt1MgE"}'
2025-02-14 04:03:36.882 INFO [src.node.waku_node] REST service is ready !!
2025-02-14 04:03:36.888 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-14 04:03:36.889 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-14_04-03-35__5e5c74d7-66d6-487b-82cc-967cc78ba138__wakuorg_nwaku:latest.log
2025-02-14 04:03:36.889 DEBUG [src.node.waku_node] Starting Node...
2025-02-14 04:03:36.889 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-14 04:03:36.890 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-14 04:03:36.890 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.130.133
2025-02-14 04:03:36.890 DEBUG [src.node.docker_mananger] Generated ports ['38954', '38955', '38956', '38957', '38958']
2025-02-14 04:03:36.891 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-14 04:03:36.891 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-14 04:03:36.891 DEBUG [src.node.waku_node] Using volumes []
2025-02-14 04:03:36.891 DEBUG [src.node.docker_mananger] docker run -i -t -p 38954:38954 -p 38955:38955 -p 38956:38956 -p 38957:38957 -p 38958:38958 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=38956 --rest-port=38954 --tcp-port=38955 --discv5-udp-port=38957 --rest-address=0.0.0.0 --nat=extip:172.18.130.133 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=71cfeac1ce2cca1f8fcdffda1daa7c9b86bcbdb2b0be4eea891cc512f7b5eed7 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=38958 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QNUpSB7w48flIzQ6kPvFJ_x-km5lA9nCNavH4YgMfPaEBVLYxGRO1WEf8iucrH9B7Nm29ryNrn4w5yShbnlFr0ACgmlkgnY0gmlwhKwSnLSKbXVsdGlhZGRyc5YACASsEpy0Br2NAAoErBKctAa9jt0DgnJzhQADAQAAiXNlY3AyNTZrMaED0Q7OfmUNSz77_mstRU_vQXOQ-7uOBzod2ANMi3Vs1tqDdGNwgr2Ng3VkcIK9j4V3YWt1MgE
2025-02-14 04:03:37.132 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.130.133 waku 0dfb5073c509750b3a1911441aabdea7f6d2cd9f7d5ce9db23434aa65081a2cf
2025-02-14 04:03:37.179 DEBUG [src.node.docker_mananger] Container started with ID 0dfb5073c509. Setting up logs at ./log/docker/node2_2025-02-14_04-03-35__5e5c74d7-66d6-487b-82cc-967cc78ba138__wakuorg_nwaku:latest.log
2025-02-14 04:03:37.180 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 38954
2025-02-14 04:03:37.181 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-14 04:03:38.181 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:38954/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:38.193 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-14 04:03:38.194 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-14 04:03:38.195 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:38954/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:38.202 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.130.133/tcp/38955/p2p/16Uiu2HAkvZsoGx8mvgFN2a121P4FRxpvVQmSdT2ciKW17AN9zPEC","/ip4/172.18.130.133/tcp/38956/ws/p2p/16Uiu2HAkvZsoGx8mvgFN2a121P4FRxpvVQmSdT2ciKW17AN9zPEC"],"enrUri":"enr:-L24QJzXqYEMzz0a9DRvfZx3MDU0yjEanMtRHVMuaAGPryC5EibMh6Vw8e-6vwA7ZMEWJdCAY2px7Nh71We3WxGlfxwCgmlkgnY0gmlwhKwSgoWKbXVsdGlhZGRyc5YACASsEoKFBpgrAAoErBKChQaYLN0DgnJzhQADAQAAiXNlY3AyNTZrMaECEPWyYYzEO-h_wMTVO2Ykw-A7ZDsJ7eT6Sg1ABx-qDt2DdGNwgpgrg3VkcIKYLYV3YWt1MgE"}'
2025-02-14 04:03:38.202 INFO [src.node.waku_node] REST service is ready !!
2025-02-14 04:03:38.203 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:38954/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.156.180/tcp/48525/p2p/16Uiu2HAmSj4ev1jTq4Dq8vxwNb86Bbz8pG6RKWUcBFaiHcRAcmXP"]'
2025-02-14 04:03:38.205 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:38.207 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48524/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:03:38.210 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:38.211 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:38954/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:03:38.217 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:38.217 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48524/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:03:38.224 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:38.224 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-14 04:03:38.325 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-14 04:03:38.325 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48524/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:38.328 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739505818217546240,"ephemeral":false}]'
2025-02-14 04:03:38.329 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-14 04:03:38.330 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:38954/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:38.332 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739505818217546240,"ephemeral":false}]'
2025-02-14 04:03:38.333 INFO [src.node.api_clients.base_client] curl -v -X DELETE "http://127.0.0.1:48524/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:03:38.338 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:38.338 INFO [src.node.api_clients.base_client] curl -v -X DELETE "http://127.0.0.1:38954/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:03:38.342 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:38.343 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48524/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:03:38.346 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:48524/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Failed to publish: Node not subscribed to topic: /waku/2/rs/3/1'
2025-02-14 04:03:38.346 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48524/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:03:38.350 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:38.350 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:38954/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:03:38.354 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:38.355 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48524/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:03:38.361 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:38.361 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-14 04:03:38.461 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-14 04:03:38.461 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48524/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:38.464 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739505818355546880,"ephemeral":false}]'
2025-02-14 04:03:38.465 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-14 04:03:38.466 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:38954/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:38.468 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739505818355546880,"ephemeral":false}]'
2025-02-14 04:03:38.470 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-14 04:03:38.471 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-14 04:03:38.471 DEBUG [src.node.waku_node] Stopping container with id 75977d540403
2025-02-14 04:03:39.370 DEBUG [src.node.waku_node] Container stopped.
2025-02-14 04:03:39.370 DEBUG [src.node.waku_node] Stopping container with id 0dfb5073c509
2025-02-14 04:03:40.183 ERROR [src.node.docker_mananger] Max retries reached for container 75977d540403. Exiting log stream.
2025-02-14 04:03:40.867 DEBUG [src.node.waku_node] Container stopped.
2025-02-14 04:03:40.868 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-14 04:03:40.875 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-14 04:03:40.881 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
