2025-02-14 04:07:22.086 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-14 04:07:22.086 DEBUG [tests.conftest] Running test: test_publish_after_node2_restarts with id: 2025-02-14_04-07-22__238ee03a-1108-4d2f-ae33-f87cdf12797f
2025-02-14 04:07:22.087 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-14 04:07:22.087 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-14 04:07:22.087 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-14 04:07:22.094 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-14 04:07:22.094 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-14_04-07-22__238ee03a-1108-4d2f-ae33-f87cdf12797f__wakuorg_nwaku:latest.log
2025-02-14 04:07:22.094 DEBUG [src.node.waku_node] Starting Node...
2025-02-14 04:07:22.095 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-14 04:07:22.096 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-14 04:07:22.096 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.179.135
2025-02-14 04:07:22.096 DEBUG [src.node.docker_mananger] Generated ports ['65307', '65308', '65309', '65310', '65311']
2025-02-14 04:07:22.097 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-14 04:07:22.097 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-14 04:07:22.097 DEBUG [src.node.waku_node] Using volumes []
2025-02-14 04:07:22.097 DEBUG [src.node.docker_mananger] docker run -i -t -p 65307:65307 -p 65308:65308 -p 65309:65309 -p 65310:65310 -p 65311:65311 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=65309 --rest-port=65307 --tcp-port=65308 --discv5-udp-port=65310 --rest-address=0.0.0.0 --nat=extip:172.18.179.135 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=f20ec2ef4d46b98c520cdef024d82d868f4bd3ec3ea44d73be08be3eee67df2d --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=65311 --metrics-logging=true --relay=true
2025-02-14 04:07:22.369 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.179.135 waku ee2d8f4493034dd964a47de13fa21dba78c8864fcaa96832f363c29035a9d032
2025-02-14 04:07:22.429 DEBUG [src.node.docker_mananger] Container started with ID ee2d8f449303. Setting up logs at ./log/docker/node1_2025-02-14_04-07-22__238ee03a-1108-4d2f-ae33-f87cdf12797f__wakuorg_nwaku:latest.log
2025-02-14 04:07:22.430 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 65307
2025-02-14 04:07:22.430 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-14 04:07:22.769 ERROR [src.node.docker_mananger] Max retries reached for container 914dd7397956. Exiting log stream.
2025-02-14 04:07:23.431 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:65307/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:07:23.433 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-14 04:07:23.434 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-14 04:07:23.434 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:65307/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:07:23.436 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.179.135/tcp/65308/p2p/16Uiu2HAmDi8CFExrfyj2qTW6ktWixdErraum4hUHfpLKh5m9P9nJ","/ip4/172.18.179.135/tcp/65309/ws/p2p/16Uiu2HAmDi8CFExrfyj2qTW6ktWixdErraum4hUHfpLKh5m9P9nJ"],"enrUri":"enr:-L24QLqBSwrxXLFtiUkhxdV1KX3C9Z0KumPWvP1EC1yzR3IyZdDCEGKbaV3JCUlMiTKEaz1FIJhlMhi7-JNTYiPA4IcCgmlkgnY0gmlwhKwSs4eKbXVsdGlhZGRyc5YACASsErOHBv8cAAoErBKzhwb_Hd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDD6lMdkeRorTNvMpkVwYYqMaCJIeJUzFrOibe6w2Rm9ODdGNwgv8cg3VkcIL_HoV3YWt1MgE"}'
2025-02-14 04:07:23.436 INFO [src.node.waku_node] REST service is ready !!
2025-02-14 04:07:23.442 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-14 04:07:23.443 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-14_04-07-22__238ee03a-1108-4d2f-ae33-f87cdf12797f__wakuorg_nwaku:latest.log
2025-02-14 04:07:23.443 DEBUG [src.node.waku_node] Starting Node...
2025-02-14 04:07:23.443 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-14 04:07:23.444 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-14 04:07:23.444 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.248.123
2025-02-14 04:07:23.444 DEBUG [src.node.docker_mananger] Generated ports ['58640', '58641', '58642', '58643', '58644']
2025-02-14 04:07:23.445 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-14 04:07:23.445 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-14 04:07:23.445 DEBUG [src.node.waku_node] Using volumes []
2025-02-14 04:07:23.445 DEBUG [src.node.docker_mananger] docker run -i -t -p 58640:58640 -p 58641:58641 -p 58642:58642 -p 58643:58643 -p 58644:58644 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=58642 --rest-port=58640 --tcp-port=58641 --discv5-udp-port=58643 --rest-address=0.0.0.0 --nat=extip:172.18.248.123 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=bf9bea3dadeecd6ddeff1b9fb8d6ee4db00cea02db22b72ee56c63b52dca1cad --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=58644 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QLqBSwrxXLFtiUkhxdV1KX3C9Z0KumPWvP1EC1yzR3IyZdDCEGKbaV3JCUlMiTKEaz1FIJhlMhi7-JNTYiPA4IcCgmlkgnY0gmlwhKwSs4eKbXVsdGlhZGRyc5YACASsErOHBv8cAAoErBKzhwb_Hd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDD6lMdkeRorTNvMpkVwYYqMaCJIeJUzFrOibe6w2Rm9ODdGNwgv8cg3VkcIL_HoV3YWt1MgE
2025-02-14 04:07:23.678 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.248.123 waku fccb04ef054a39b8eb351642712d2355af7d72c81de9e6d867c27dc5b74e0582
2025-02-14 04:07:23.726 DEBUG [src.node.docker_mananger] Container started with ID fccb04ef054a. Setting up logs at ./log/docker/node2_2025-02-14_04-07-22__238ee03a-1108-4d2f-ae33-f87cdf12797f__wakuorg_nwaku:latest.log
2025-02-14 04:07:23.726 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 58640
2025-02-14 04:07:23.726 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-14 04:07:24.727 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58640/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:07:24.741 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-14 04:07:24.742 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-14 04:07:24.742 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58640/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:07:24.749 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.248.123/tcp/58641/p2p/16Uiu2HAm8SrFChDRZ2A2ebMkrzhDzraW99rHArfUHR88cqJpNPsV","/ip4/172.18.248.123/tcp/58642/ws/p2p/16Uiu2HAm8SrFChDRZ2A2ebMkrzhDzraW99rHArfUHR88cqJpNPsV"],"enrUri":"enr:-L24QBzuGLfyoESk4WgsidjHxt9aNEGeqwKW-FJc2lWy6azWWImM-SBlIM_T72_EqWIvgndd_xfMbdq8VgTjZF5FSg4CgmlkgnY0gmlwhKwS-HuKbXVsdGlhZGRyc5YACASsEvh7BuURAAoErBL4ewblEt0DgnJzhQADAQAAiXNlY3AyNTZrMaECwXUeR8YaLCfU7ftoyC5h4BhFuALW-NXv_ZRNP41LT-CDdGNwguURg3VkcILlE4V3YWt1MgE"}'
2025-02-14 04:07:24.750 INFO [src.node.waku_node] REST service is ready !!
2025-02-14 04:07:24.751 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:58640/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.179.135/tcp/65308/p2p/16Uiu2HAmDi8CFExrfyj2qTW6ktWixdErraum4hUHfpLKh5m9P9nJ"]'
2025-02-14 04:07:24.754 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:07:24.754 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-14 04:07:24.754 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:65307/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:07:24.758 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:07:24.758 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:58640/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:07:24.764 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:07:24.766 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:65307/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:07:24.772 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:07:24.772 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-14 04:07:24.873 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-14 04:07:24.873 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:65307/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:07:24.876 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739506044766329600,"ephemeral":false}]'
2025-02-14 04:07:24.878 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-14 04:07:24.878 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58640/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:07:24.881 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739506044766329600,"ephemeral":false}]'
2025-02-14 04:07:24.882 INFO [src.steps.relay] WARM UP successful!!
2025-02-14 04:07:24.883 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:65307/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:07:24.887 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:07:24.888 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-14 04:07:24.988 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-14 04:07:24.988 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:65307/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:07:24.991 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739506044883366656,"ephemeral":false}]'
2025-02-14 04:07:24.993 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-14 04:07:24.993 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58640/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:07:24.995 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739506044883366656,"ephemeral":false}]'
2025-02-14 04:07:24.997 DEBUG [src.node.waku_node] Restarting container with id fccb04ef054a
2025-02-14 04:07:26.459 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58640/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:07:26.563 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58640/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:07:26.566 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-14 04:07:26.566 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-14 04:07:26.566 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58640/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:07:26.568 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.248.123/tcp/58641/p2p/16Uiu2HAm8SrFChDRZ2A2ebMkrzhDzraW99rHArfUHR88cqJpNPsV","/ip4/172.18.248.123/tcp/58642/ws/p2p/16Uiu2HAm8SrFChDRZ2A2ebMkrzhDzraW99rHArfUHR88cqJpNPsV"],"enrUri":"enr:-L24QBzuGLfyoESk4WgsidjHxt9aNEGeqwKW-FJc2lWy6azWWImM-SBlIM_T72_EqWIvgndd_xfMbdq8VgTjZF5FSg4CgmlkgnY0gmlwhKwS-HuKbXVsdGlhZGRyc5YACASsEvh7BuURAAoErBL4ewblEt0DgnJzhQADAQAAiXNlY3AyNTZrMaECwXUeR8YaLCfU7ftoyC5h4BhFuALW-NXv_ZRNP41LT-CDdGNwguURg3VkcILlE4V3YWt1MgE"}'
2025-02-14 04:07:26.568 INFO [src.node.waku_node] REST service is ready !!
2025-02-14 04:07:26.568 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:65307/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:07:26.571 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:07:26.571 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:58640/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:07:26.587 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:07:26.588 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:65307/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:07:26.591 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:07:26.591 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-14 04:07:26.691 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-14 04:07:26.692 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:65307/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:07:26.694 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739506046587899392,"ephemeral":false}]'
2025-02-14 04:07:26.696 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-14 04:07:26.696 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58640/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:07:26.699 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[]'
2025-02-14 04:07:27.700 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:65307/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:07:27.705 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:07:27.706 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-14 04:07:27.806 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-14 04:07:27.806 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:65307/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:07:27.809 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739506047699858432,"ephemeral":false}]'
2025-02-14 04:07:27.811 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-14 04:07:27.811 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58640/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:07:27.813 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739506047699858432,"ephemeral":false}]'
2025-02-14 04:07:27.817 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-14 04:07:27.818 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-14 04:07:27.818 DEBUG [src.node.waku_node] Stopping container with id ee2d8f449303
2025-02-14 04:07:28.932 DEBUG [src.node.waku_node] Container stopped.
2025-02-14 04:07:28.932 DEBUG [src.node.waku_node] Stopping container with id fccb04ef054a
2025-02-14 04:07:29.745 ERROR [src.node.docker_mananger] Max retries reached for container ee2d8f449303. Exiting log stream.
2025-02-14 04:07:30.448 DEBUG [src.node.waku_node] Container stopped.
2025-02-14 04:07:30.448 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-14 04:07:30.458 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-14 04:07:30.479 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
