2025-02-14 04:04:42.412 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-14 04:04:42.412 DEBUG [tests.conftest] Running test: test_publish_with_ephemeral with id: 2025-02-14_04-04-42__0be5b9e3-ee40-4324-898c-62d1c6000e67
2025-02-14 04:04:42.412 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-14 04:04:42.412 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-14 04:04:42.413 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-14 04:04:42.419 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-14 04:04:42.419 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-14_04-04-42__0be5b9e3-ee40-4324-898c-62d1c6000e67__wakuorg_nwaku:latest.log
2025-02-14 04:04:42.420 DEBUG [src.node.waku_node] Starting Node...
2025-02-14 04:04:42.420 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-14 04:04:42.421 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-14 04:04:42.421 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.232.198
2025-02-14 04:04:42.421 DEBUG [src.node.docker_mananger] Generated ports ['2828', '2829', '2830', '2831', '2832']
2025-02-14 04:04:42.421 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-14 04:04:42.421 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-14 04:04:42.422 DEBUG [src.node.waku_node] Using volumes []
2025-02-14 04:04:42.422 DEBUG [src.node.docker_mananger] docker run -i -t -p 2828:2828 -p 2829:2829 -p 2830:2830 -p 2831:2831 -p 2832:2832 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=2830 --rest-port=2828 --tcp-port=2829 --discv5-udp-port=2831 --rest-address=0.0.0.0 --nat=extip:172.18.232.198 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=84f6102a3fb5cb6f464f87172fadbad14fd4bcbfcc3fb20b5b6f9acaab2f0c7f --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=2832 --metrics-logging=true --relay=true
2025-02-14 04:04:42.653 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.232.198 waku 9d15104cc0e80f2b7ca0747cd598b4c04900e84409be9810d49850c6c671de84
2025-02-14 04:04:42.700 DEBUG [src.node.docker_mananger] Container started with ID 9d15104cc0e8. Setting up logs at ./log/docker/node1_2025-02-14_04-04-42__0be5b9e3-ee40-4324-898c-62d1c6000e67__wakuorg_nwaku:latest.log
2025-02-14 04:04:42.701 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 2828
2025-02-14 04:04:42.702 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-14 04:04:43.213 ERROR [src.node.docker_mananger] Max retries reached for container 0b2fffa1c6db. Exiting log stream.
2025-02-14 04:04:43.704 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:2828/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:43.706 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-14 04:04:43.707 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-14 04:04:43.707 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:2828/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:43.709 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.232.198/tcp/2829/p2p/16Uiu2HAm2wbgH5X9fMT47aMJiL9tQdWP47ToqSaVb6bhy3ajjyJ6","/ip4/172.18.232.198/tcp/2830/ws/p2p/16Uiu2HAm2wbgH5X9fMT47aMJiL9tQdWP47ToqSaVb6bhy3ajjyJ6"],"enrUri":"enr:-L24QCHrXMr1XoSkWYly1CQKn_htaNFFATzQJpaBSYSAMhJLb6D4FO9xFGP5L34KhdFba9oybqbSDgDnP3aGMoIWn5oCgmlkgnY0gmlwhKwS6MaKbXVsdGlhZGRyc5YACASsEujGBgsNAAoErBLoxgYLDt0DgnJzhQADAQAAiXNlY3AyNTZrMaECb6xeVK7GV1imWgAsW43m1y2hfAJd_ejyqFpXIwJEVQ-DdGNwggsNg3VkcIILD4V3YWt1MgE"}'
2025-02-14 04:04:43.709 INFO [src.node.waku_node] REST service is ready !!
2025-02-14 04:04:43.715 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-14 04:04:43.716 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-14_04-04-42__0be5b9e3-ee40-4324-898c-62d1c6000e67__wakuorg_nwaku:latest.log
2025-02-14 04:04:43.716 DEBUG [src.node.waku_node] Starting Node...
2025-02-14 04:04:43.716 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-14 04:04:43.717 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-14 04:04:43.717 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.191.93
2025-02-14 04:04:43.718 DEBUG [src.node.docker_mananger] Generated ports ['12046', '12047', '12048', '12049', '12050']
2025-02-14 04:04:43.718 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-14 04:04:43.718 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-14 04:04:43.718 DEBUG [src.node.waku_node] Using volumes []
2025-02-14 04:04:43.718 DEBUG [src.node.docker_mananger] docker run -i -t -p 12046:12046 -p 12047:12047 -p 12048:12048 -p 12049:12049 -p 12050:12050 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=12048 --rest-port=12046 --tcp-port=12047 --discv5-udp-port=12049 --rest-address=0.0.0.0 --nat=extip:172.18.191.93 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=1abd1db9ae3c22dfafdc9fea706a74edc8a67eb3ba2e59dc0fc37544c8e910ed --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=12050 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QCHrXMr1XoSkWYly1CQKn_htaNFFATzQJpaBSYSAMhJLb6D4FO9xFGP5L34KhdFba9oybqbSDgDnP3aGMoIWn5oCgmlkgnY0gmlwhKwS6MaKbXVsdGlhZGRyc5YACASsEujGBgsNAAoErBLoxgYLDt0DgnJzhQADAQAAiXNlY3AyNTZrMaECb6xeVK7GV1imWgAsW43m1y2hfAJd_ejyqFpXIwJEVQ-DdGNwggsNg3VkcIILD4V3YWt1MgE
2025-02-14 04:04:43.955 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.191.93 waku 6807c23c4849ee6c3b38dc86c5faa2b44042badad064d89e7582d2c923d0a06a
2025-02-14 04:04:44.006 DEBUG [src.node.docker_mananger] Container started with ID 6807c23c4849. Setting up logs at ./log/docker/node2_2025-02-14_04-04-42__0be5b9e3-ee40-4324-898c-62d1c6000e67__wakuorg_nwaku:latest.log
2025-02-14 04:04:44.008 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 12046
2025-02-14 04:04:44.008 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-14 04:04:45.008 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:12046/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:45.018 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-14 04:04:45.020 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-14 04:04:45.021 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:12046/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:45.030 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.191.93/tcp/12047/p2p/16Uiu2HAmAoYvediJdC4cPV76W2mh88gZwnAK44xM1Mt544Som2HB","/ip4/172.18.191.93/tcp/12048/ws/p2p/16Uiu2HAmAoYvediJdC4cPV76W2mh88gZwnAK44xM1Mt544Som2HB"],"enrUri":"enr:-L24QNA0bbM7z5R69zGWJmMI7igpW1qKrBkcPEPtnw3Qe7oGIP8xOkmV7ypWy5UFasJiIfMOgkgzxVJVUqVuNZmOby4CgmlkgnY0gmlwhKwSv12KbXVsdGlhZGRyc5YACASsEr9dBi8PAAoErBK_XQYvEN0DgnJzhQADAQAAiXNlY3AyNTZrMaEC5HobAMZQGWqfby60AwjISNirhgLeUsCd_RVdDN83WW6DdGNwgi8Pg3VkcIIvEYV3YWt1MgE"}'
2025-02-14 04:04:45.031 INFO [src.node.waku_node] REST service is ready !!
2025-02-14 04:04:45.031 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:12046/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.232.198/tcp/2829/p2p/16Uiu2HAm2wbgH5X9fMT47aMJiL9tQdWP47ToqSaVb6bhy3ajjyJ6"]'
2025-02-14 04:04:45.034 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:04:45.034 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-14 04:04:45.035 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2828/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:04:45.038 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:04:45.038 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:12046/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:04:45.045 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:04:45.046 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2828/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:04:45.052 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:04:45.053 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-14 04:04:45.153 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-14 04:04:45.153 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:2828/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:45.156 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739505885045862912,"ephemeral":false}]'
2025-02-14 04:04:45.158 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-14 04:04:45.158 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:12046/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:45.161 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739505885045862912,"ephemeral":false}]'
2025-02-14 04:04:45.162 INFO [src.steps.relay] WARM UP successful!!
2025-02-14 04:04:45.163 DEBUG [tests.relay.test_publish] Running test with Ephemeral True
2025-02-14 04:04:45.163 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2828/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)', "ephemeral": true}'
2025-02-14 04:04:45.169 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:04:45.170 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-14 04:04:45.270 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-14 04:04:45.270 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:2828/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:45.273 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739505885163770112,"ephemeral":true}]'
2025-02-14 04:04:45.275 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-14 04:04:45.275 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:12046/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:45.277 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739505885163770112,"ephemeral":true}]'
2025-02-14 04:04:45.279 DEBUG [tests.relay.test_publish] Running test with Ephemeral False
2025-02-14 04:04:45.279 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:2828/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)', "ephemeral": false}'
2025-02-14 04:04:45.284 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:04:45.284 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-14 04:04:45.385 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-14 04:04:45.385 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:2828/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:45.388 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739505885279358976,"ephemeral":false}]'
2025-02-14 04:04:45.389 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-14 04:04:45.389 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:12046/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:45.392 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739505885279358976,"ephemeral":false}]'
2025-02-14 04:04:45.396 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-14 04:04:45.397 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-14 04:04:45.397 DEBUG [src.node.waku_node] Stopping container with id 9d15104cc0e8
2025-02-14 04:04:46.212 DEBUG [src.node.waku_node] Container stopped.
2025-02-14 04:04:46.213 DEBUG [src.node.waku_node] Stopping container with id 6807c23c4849
2025-02-14 04:04:47.025 ERROR [src.node.docker_mananger] Max retries reached for container 9d15104cc0e8. Exiting log stream.
2025-02-14 04:04:47.702 DEBUG [src.node.waku_node] Container stopped.
2025-02-14 04:04:47.703 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-14 04:04:47.709 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-14 04:04:47.715 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
