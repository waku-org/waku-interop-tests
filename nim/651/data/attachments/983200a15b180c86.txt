2025-02-14 04:03:10.091 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-14 04:03:10.092 DEBUG [tests.conftest] Running test: test_metrics_after_relay_publish with id: 2025-02-14_04-03-10__8793189b-1b5b-44a9-bf82-bbea014c608e
2025-02-14 04:03:10.092 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-14 04:03:10.092 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-14 04:03:10.092 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-14 04:03:10.093 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-14 04:03:10.093 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-14 04:03:10.093 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-14 04:03:10.099 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-14 04:03:10.099 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-14_04-03-10__8793189b-1b5b-44a9-bf82-bbea014c608e__wakuorg_nwaku:latest.log
2025-02-14 04:03:10.099 DEBUG [src.node.waku_node] Starting Node...
2025-02-14 04:03:10.100 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-14 04:03:10.101 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-14 04:03:10.101 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.15.123
2025-02-14 04:03:10.101 DEBUG [src.node.docker_mananger] Generated ports ['48240', '48241', '48242', '48243', '48244']
2025-02-14 04:03:10.101 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-14 04:03:10.101 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-14 04:03:10.101 DEBUG [src.node.waku_node] Using volumes []
2025-02-14 04:03:10.102 DEBUG [src.node.docker_mananger] docker run -i -t -p 48240:48240 -p 48241:48241 -p 48242:48242 -p 48243:48243 -p 48244:48244 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=48242 --rest-port=48240 --tcp-port=48241 --discv5-udp-port=48243 --rest-address=0.0.0.0 --nat=extip:172.18.15.123 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=5bebfdac3f7df0babecdfffb85ac38f7f1e6ffecb7c0cefbc02cd391bc2e292b --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=48244 --metrics-logging=true --relay=true
2025-02-14 04:03:10.333 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.15.123 waku fcc067f87dfe3b30635e9e387250ca3dd946b54e91e06c41b2b7dc5c1ab8839d
2025-02-14 04:03:10.383 DEBUG [src.node.docker_mananger] Container started with ID fcc067f87dfe. Setting up logs at ./log/docker/node1_2025-02-14_04-03-10__8793189b-1b5b-44a9-bf82-bbea014c608e__wakuorg_nwaku:latest.log
2025-02-14 04:03:10.384 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 48240
2025-02-14 04:03:10.385 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-14 04:03:10.886 ERROR [src.node.docker_mananger] Max retries reached for container a63d722b51cf. Exiting log stream.
2025-02-14 04:03:11.385 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48240/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:11.388 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-14 04:03:11.388 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-14 04:03:11.388 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48240/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:11.390 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.15.123/tcp/48241/p2p/16Uiu2HAm4msRpZY5EUbc8TPrNYctVpszYFBaRs9rBwhDgxzfv1nQ","/ip4/172.18.15.123/tcp/48242/ws/p2p/16Uiu2HAm4msRpZY5EUbc8TPrNYctVpszYFBaRs9rBwhDgxzfv1nQ"],"enrUri":"enr:-L24QPUF0qSB2nMtmkTbCidztl3ctIHmSTlKxFASt8BrFC4LC61z5NnJViG2B-aoxO_LsAnWg0WoDoJOMX1lJj-0E_kCgmlkgnY0gmlwhKwSD3uKbXVsdGlhZGRyc5YACASsEg97BrxxAAoErBIPewa8ct0DgnJzhQADAQAAiXNlY3AyNTZrMaECiuW-YF6KYagbAoJaXBOv8JfbWU9tFba7YJiJdTpN-tGDdGNwgrxxg3VkcIK8c4V3YWt1MgE"}'
2025-02-14 04:03:11.391 INFO [src.node.waku_node] REST service is ready !!
2025-02-14 04:03:11.397 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-14 04:03:11.397 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-14_04-03-10__8793189b-1b5b-44a9-bf82-bbea014c608e__wakuorg_nwaku:latest.log
2025-02-14 04:03:11.397 DEBUG [src.node.waku_node] Starting Node...
2025-02-14 04:03:11.397 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-14 04:03:11.399 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-14 04:03:11.399 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.108.177
2025-02-14 04:03:11.399 DEBUG [src.node.docker_mananger] Generated ports ['18769', '18770', '18771', '18772', '18773']
2025-02-14 04:03:11.399 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-14 04:03:11.399 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-14 04:03:11.399 DEBUG [src.node.waku_node] Using volumes []
2025-02-14 04:03:11.399 DEBUG [src.node.docker_mananger] docker run -i -t -p 18769:18769 -p 18770:18770 -p 18771:18771 -p 18772:18772 -p 18773:18773 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=18771 --rest-port=18769 --tcp-port=18770 --discv5-udp-port=18772 --rest-address=0.0.0.0 --nat=extip:172.18.108.177 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=00ee1ebce6d7bf728b1a079ac1fe8fbc0ba31ec79facee2a4629dffac3f5ff02 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=18773 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QPUF0qSB2nMtmkTbCidztl3ctIHmSTlKxFASt8BrFC4LC61z5NnJViG2B-aoxO_LsAnWg0WoDoJOMX1lJj-0E_kCgmlkgnY0gmlwhKwSD3uKbXVsdGlhZGRyc5YACASsEg97BrxxAAoErBIPewa8ct0DgnJzhQADAQAAiXNlY3AyNTZrMaECiuW-YF6KYagbAoJaXBOv8JfbWU9tFba7YJiJdTpN-tGDdGNwgrxxg3VkcIK8c4V3YWt1MgE
2025-02-14 04:03:11.621 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.108.177 waku 50ec832f28b0422d40811c553fb128ee761bca32c40715bfb23539deafaf5b0f
2025-02-14 04:03:11.669 DEBUG [src.node.docker_mananger] Container started with ID 50ec832f28b0. Setting up logs at ./log/docker/node2_2025-02-14_04-03-10__8793189b-1b5b-44a9-bf82-bbea014c608e__wakuorg_nwaku:latest.log
2025-02-14 04:03:11.670 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 18769
2025-02-14 04:03:11.670 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-14 04:03:12.670 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:18769/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:12.677 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-14 04:03:12.679 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-14 04:03:12.680 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:18769/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:12.684 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.108.177/tcp/18770/p2p/16Uiu2HAmKLK66E5jvh3xmQAWbwBSwkU8XpCuw6XqAaKX8ZV4scoN","/ip4/172.18.108.177/tcp/18771/ws/p2p/16Uiu2HAmKLK66E5jvh3xmQAWbwBSwkU8XpCuw6XqAaKX8ZV4scoN"],"enrUri":"enr:-L24QFLLglkvWDE2jQ7kl9Id9lnKlySpt119g-ysPnLt8L4aC6zlyIVbuwWl7AeM6htdWZtO_UbjEfFtMghyzO0vw-YCgmlkgnY0gmlwhKwSbLGKbXVsdGlhZGRyc5YACASsEmyxBklSAAoErBJssQZJU90DgnJzhQADAQAAiXNlY3AyNTZrMaEDYzj1zkB5vAEFgkWZ3K3qulpags6baCmhWdXq02ogBm2DdGNwgklSg3VkcIJJVIV3YWt1MgE"}'
2025-02-14 04:03:12.684 INFO [src.node.waku_node] REST service is ready !!
2025-02-14 04:03:12.685 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:18769/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.15.123/tcp/48241/p2p/16Uiu2HAm4msRpZY5EUbc8TPrNYctVpszYFBaRs9rBwhDgxzfv1nQ"]'
2025-02-14 04:03:12.687 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:12.688 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-14 04:03:12.688 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48240/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:03:12.692 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:12.692 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:18769/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:03:12.698 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:12.699 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48240/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:03:12.704 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:12.705 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-14 04:03:12.805 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-14 04:03:12.805 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:48240/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:12.808 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739505792699360256,"ephemeral":false}]'
2025-02-14 04:03:12.809 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-14 04:03:12.810 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:18769/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:12.812 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739505792699360256,"ephemeral":false}]'
2025-02-14 04:03:12.813 INFO [src.steps.relay] WARM UP successful!!
2025-02-14 04:03:12.814 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:48240/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:03:12.819 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:12.820 DEBUG [src.libs.common] Sleeping for 0.5 seconds
2025-02-14 04:03:13.320 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:18769/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:13.323 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739505792814777600,"ephemeral":false}]'
2025-02-14 04:03:13.323 DEBUG [src.libs.common] Sleeping for 5 seconds
2025-02-14 04:03:18.323 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-14 04:03:18.328 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-14 04:03:18.328 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-14 04:03:18.331 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-14 04:03:18.331 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-14 04:03:18.334 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-14 04:03:18.334 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-14 04:03:18.337 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-14 04:03:18.337 DEBUG [src.steps.metrics] Checking metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} has 1
2025-02-14 04:03:18.340 DEBUG [src.steps.metrics] Found metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} with value 2.0
2025-02-14 04:03:18.340 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-14 04:03:18.343 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-14 04:03:18.343 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-14 04:03:18.347 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 2.0
2025-02-14 04:03:18.347 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-14 04:03:18.350 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 2.0
2025-02-14 04:03:18.350 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-14 04:03:18.353 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-14 04:03:18.354 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-14 04:03:18.357 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-14 04:03:18.357 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-14 04:03:18.360 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-14 04:03:18.360 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-14 04:03:18.363 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-14 04:03:18.363 DEBUG [src.steps.metrics] Checking metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} has 1
2025-02-14 04:03:18.366 DEBUG [src.steps.metrics] Found metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} with value 2.0
2025-02-14 04:03:18.366 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-14 04:03:18.369 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-14 04:03:18.369 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-14 04:03:18.372 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 2.0
2025-02-14 04:03:18.373 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-14 04:03:18.375 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 2.0
2025-02-14 04:03:18.378 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-14 04:03:18.379 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-14 04:03:18.379 DEBUG [src.node.waku_node] Stopping container with id fcc067f87dfe
2025-02-14 04:03:19.874 DEBUG [src.node.waku_node] Container stopped.
2025-02-14 04:03:19.875 DEBUG [src.node.waku_node] Stopping container with id 50ec832f28b0
2025-02-14 04:03:20.687 ERROR [src.node.docker_mananger] Max retries reached for container fcc067f87dfe. Exiting log stream.
2025-02-14 04:03:21.273 DEBUG [src.node.waku_node] Container stopped.
2025-02-14 04:03:21.274 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-14 04:03:21.281 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-14 04:03:21.287 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
