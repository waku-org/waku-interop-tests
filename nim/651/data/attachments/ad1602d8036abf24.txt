2025-02-14 04:04:25.245 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-14 04:04:25.245 DEBUG [tests.conftest] Running test: test_lightpush_node_with_relay_works_correctly with id: 2025-02-14_04-04-25__8e9159d1-2153-4882-a9eb-1293d1202016
2025-02-14 04:04:25.245 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-14 04:04:25.245 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-14 04:04:25.252 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-14 04:04:25.252 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/receiving_node1_2025-02-14_04-04-25__8e9159d1-2153-4882-a9eb-1293d1202016__wakuorg_nwaku:latest.log
2025-02-14 04:04:25.252 DEBUG [src.node.waku_node] Starting Node...
2025-02-14 04:04:25.252 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-14 04:04:25.253 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-14 04:04:25.253 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.245.121
2025-02-14 04:04:25.254 DEBUG [src.node.docker_mananger] Generated ports ['14328', '14329', '14330', '14331', '14332']
2025-02-14 04:04:25.254 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-14 04:04:25.254 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-14 04:04:25.254 DEBUG [src.node.waku_node] Using volumes []
2025-02-14 04:04:25.254 DEBUG [src.node.docker_mananger] docker run -i -t -p 14328:14328 -p 14329:14329 -p 14330:14330 -p 14331:14331 -p 14332:14332 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=14330 --rest-port=14328 --tcp-port=14329 --discv5-udp-port=14331 --rest-address=0.0.0.0 --nat=extip:172.18.245.121 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=1d4b7bf54c83c6bca3b503fa3ca9d64dc89d34d5b1bebafae6df9bcabcf2d8eb --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=14332 --metrics-logging=true --lightpush=true --relay=true --filter=true
2025-02-14 04:04:25.481 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.245.121 waku fcb5665eb76a02816af2254dd948ad954bf976e75613f9d73925c2f8004d55d5
2025-02-14 04:04:25.536 DEBUG [src.node.docker_mananger] Container started with ID fcb5665eb76a. Setting up logs at ./log/docker/receiving_node1_2025-02-14_04-04-25__8e9159d1-2153-4882-a9eb-1293d1202016__wakuorg_nwaku:latest.log
2025-02-14 04:04:25.537 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 14328
2025-02-14 04:04:25.539 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-14 04:04:26.045 ERROR [src.node.docker_mananger] Max retries reached for container 690ca4c6b20d. Exiting log stream.
2025-02-14 04:04:26.540 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:14328/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:26.542 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-14 04:04:26.542 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-14 04:04:26.543 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:14328/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:26.545 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.245.121/tcp/14329/p2p/16Uiu2HAmPoxrqQGQYVdNo2nkfyMwHMKaEJZ9TFh5BtEf33yXXwGe","/ip4/172.18.245.121/tcp/14330/ws/p2p/16Uiu2HAmPoxrqQGQYVdNo2nkfyMwHMKaEJZ9TFh5BtEf33yXXwGe"],"enrUri":"enr:-L24QArjxlHwKT_b2cIHsq0gmF7lU6yZSeX2VxNKZhlnvjLHfVtFkVnJ_XnD8J1wNpPSaZxDzizUqS-OA7NHGXuEoYwCgmlkgnY0gmlwhKwS9XmKbXVsdGlhZGRyc5YACASsEvV5Bjf5AAoErBL1eQY3-t0DgnJzhQADAQAAiXNlY3AyNTZrMaEDpb0ZGcVxLfUJo7mvJNcCZx474hhDgsBDhlGq5FNm0jODdGNwgjf5g3VkcII3-4V3YWt1Mg0"}'
2025-02-14 04:04:26.545 INFO [src.node.waku_node] REST service is ready !!
2025-02-14 04:04:26.551 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-14 04:04:26.551 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/lightpush_node1_2025-02-14_04-04-25__8e9159d1-2153-4882-a9eb-1293d1202016__wakuorg_nwaku:latest.log
2025-02-14 04:04:26.551 DEBUG [src.node.waku_node] Starting Node...
2025-02-14 04:04:26.551 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-14 04:04:26.552 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-14 04:04:26.553 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.36.113
2025-02-14 04:04:26.553 DEBUG [src.node.docker_mananger] Generated ports ['52848', '52849', '52850', '52851', '52852']
2025-02-14 04:04:26.553 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-14 04:04:26.553 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-14 04:04:26.553 DEBUG [src.node.waku_node] Using volumes []
2025-02-14 04:04:26.553 DEBUG [src.node.docker_mananger] docker run -i -t -p 52848:52848 -p 52849:52849 -p 52850:52850 -p 52851:52851 -p 52852:52852 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=52850 --rest-port=52848 --tcp-port=52849 --discv5-udp-port=52851 --rest-address=0.0.0.0 --nat=extip:172.18.36.113 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=01af66b1ebf01ba4acd7fc4d6becdfc10088855da7fa241f7968fc7e17072fe8 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=52852 --metrics-logging=true --discv5-bootstrap-node=enr:-L24QArjxlHwKT_b2cIHsq0gmF7lU6yZSeX2VxNKZhlnvjLHfVtFkVnJ_XnD8J1wNpPSaZxDzizUqS-OA7NHGXuEoYwCgmlkgnY0gmlwhKwS9XmKbXVsdGlhZGRyc5YACASsEvV5Bjf5AAoErBL1eQY3-t0DgnJzhQADAQAAiXNlY3AyNTZrMaEDpb0ZGcVxLfUJo7mvJNcCZx474hhDgsBDhlGq5FNm0jODdGNwgjf5g3VkcII3-4V3YWt1Mg0 --lightpushnode=/ip4/172.18.245.121/tcp/14329/p2p/16Uiu2HAmPoxrqQGQYVdNo2nkfyMwHMKaEJZ9TFh5BtEf33yXXwGe --lightpush=true --relay=true --filter=true
2025-02-14 04:04:26.767 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.36.113 waku 3de05605cf6ea0f6a55b2ad2d1e62e3cbfa3daf81b89cd5ae164ef0089bfee9c
2025-02-14 04:04:26.817 DEBUG [src.node.docker_mananger] Container started with ID 3de05605cf6e. Setting up logs at ./log/docker/lightpush_node1_2025-02-14_04-04-25__8e9159d1-2153-4882-a9eb-1293d1202016__wakuorg_nwaku:latest.log
2025-02-14 04:04:26.817 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 52848
2025-02-14 04:04:26.818 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-14 04:04:27.818 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:52848/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:27.820 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-14 04:04:27.821 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-14 04:04:27.821 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:52848/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:27.823 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.36.113/tcp/52849/p2p/16Uiu2HAmDfXd5F6jjAnB28w48Zg5oxQGhvrrL4fpkFL9JtRz5F7k","/ip4/172.18.36.113/tcp/52850/ws/p2p/16Uiu2HAmDfXd5F6jjAnB28w48Zg5oxQGhvrrL4fpkFL9JtRz5F7k"],"enrUri":"enr:-L24QJdK71gFCtukJi5p0N3P5M3tvKaks1krRKj4tHvizeF4b0Wz5aWvRp0D6UZ5MWjzwxK7bm-VkYnUXoSE-sJRamQCgmlkgnY0gmlwhKwSJHGKbXVsdGlhZGRyc5YACASsEiRxBs5xAAoErBIkcQbOct0DgnJzhQADAQAAiXNlY3AyNTZrMaEDDv8L4_jid2meo3N9G7BOPj0f2GGlLT0d16wlIffE2O-DdGNwgs5xg3VkcILOc4V3YWt1Mg0"}'
2025-02-14 04:04:27.823 INFO [src.node.waku_node] REST service is ready !!
2025-02-14 04:04:27.823 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:52848/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.245.121/tcp/14329/p2p/16Uiu2HAmPoxrqQGQYVdNo2nkfyMwHMKaEJZ9TFh5BtEf33yXXwGe"]'
2025-02-14 04:04:36.787 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:04:36.787 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:14328/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2025-02-14 04:04:36.790 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:04:36.790 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:52848/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2025-02-14 04:04:36.792 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:04:36.792 DEBUG [src.libs.common] Sleeping for 0.5 seconds
2025-02-14 04:04:37.293 DEBUG [src.steps.light_push] Lightpushing message
2025-02-14 04:04:37.293 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:52848/lightpush/v1/message" -H "Content-Type: application/json" -d '{"pubsubTopic": "/waku/2/rs/3/0", "message": {"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": 1739505877293379072}}'
2025-02-14 04:04:37.304 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:04:37.305 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-14 04:04:37.405 DEBUG [src.steps.light_push] Checking that peer NODE_1:wakuorg/nwaku:latest can find the lightpushed message
2025-02-14 04:04:37.405 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:14328/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:37.407 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1739505877293379072,"ephemeral":false}]'
2025-02-14 04:04:37.409 DEBUG [src.steps.light_push] Checking that peer NODE_2:wakuorg/nwaku:latest can find the lightpushed message
2025-02-14 04:04:37.409 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:52848/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:37.411 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1739505877293379072,"ephemeral":false}]'
2025-02-14 04:04:37.413 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:52848/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d '{"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:04:37.417 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:04:37.418 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:14328/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d '{"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:04:37.424 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:04:37.425 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-14 04:04:37.525 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:14328/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:37.528 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1739505877413118464,"ephemeral":false},{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1739505877418649344,"ephemeral":false}]'
2025-02-14 04:04:37.528 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:52848/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:04:37.530 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1739505877413118464,"ephemeral":false},{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1739505877418649344,"ephemeral":false}]'
2025-02-14 04:04:37.531 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-14 04:04:37.532 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-14 04:04:37.532 DEBUG [src.node.waku_node] Stopping container with id fcb5665eb76a
2025-02-14 04:04:38.992 DEBUG [src.node.waku_node] Container stopped.
2025-02-14 04:04:38.993 DEBUG [src.node.waku_node] Stopping container with id 3de05605cf6e
2025-02-14 04:04:39.804 ERROR [src.node.docker_mananger] Max retries reached for container fcb5665eb76a. Exiting log stream.
2025-02-14 04:04:40.464 DEBUG [src.node.waku_node] Container stopped.
2025-02-14 04:04:40.465 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-14 04:04:40.473 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-14 04:04:40.479 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
