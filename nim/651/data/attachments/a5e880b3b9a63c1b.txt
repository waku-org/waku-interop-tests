2025-02-14 04:03:42.431 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-14 04:03:42.431 DEBUG [tests.conftest] Running test: test_publish_with_invalid_payloads with id: 2025-02-14_04-03-42__934668ec-0e7f-4d66-86c0-b143d920be50
2025-02-14 04:03:42.431 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-14 04:03:42.431 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-14 04:03:42.432 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-14 04:03:42.437 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-14 04:03:42.438 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-14_04-03-42__934668ec-0e7f-4d66-86c0-b143d920be50__wakuorg_nwaku:latest.log
2025-02-14 04:03:42.438 DEBUG [src.node.waku_node] Starting Node...
2025-02-14 04:03:42.438 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-14 04:03:42.439 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-14 04:03:42.439 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.79.69
2025-02-14 04:03:42.439 DEBUG [src.node.docker_mananger] Generated ports ['13713', '13714', '13715', '13716', '13717']
2025-02-14 04:03:42.440 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-14 04:03:42.440 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-14 04:03:42.440 DEBUG [src.node.waku_node] Using volumes []
2025-02-14 04:03:42.440 DEBUG [src.node.docker_mananger] docker run -i -t -p 13713:13713 -p 13714:13714 -p 13715:13715 -p 13716:13716 -p 13717:13717 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=13715 --rest-port=13713 --tcp-port=13714 --discv5-udp-port=13716 --rest-address=0.0.0.0 --nat=extip:172.18.79.69 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=f7a55c6ef1e0e7d6eac28402e052853e5fdf16aca08ada78dd7ead86fe975f97 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=13717 --metrics-logging=true --relay=true
2025-02-14 04:03:42.663 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.79.69 waku ad643b60779702f7238da646b4036ac20c036807ca4948838576375479fdf993
2025-02-14 04:03:42.711 DEBUG [src.node.docker_mananger] Container started with ID ad643b607797. Setting up logs at ./log/docker/node1_2025-02-14_04-03-42__934668ec-0e7f-4d66-86c0-b143d920be50__wakuorg_nwaku:latest.log
2025-02-14 04:03:42.712 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 13713
2025-02-14 04:03:42.712 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-14 04:03:43.224 ERROR [src.node.docker_mananger] Max retries reached for container 8f3f9db1c4f0. Exiting log stream.
2025-02-14 04:03:43.713 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:13713/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:43.716 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-14 04:03:43.716 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-14 04:03:43.716 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:13713/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:43.718 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.79.69/tcp/13714/p2p/16Uiu2HAm1DPh1d8cpscNqeQ5SDBLY8JzJVaxF11HviSDAeDx3QVe","/ip4/172.18.79.69/tcp/13715/ws/p2p/16Uiu2HAm1DPh1d8cpscNqeQ5SDBLY8JzJVaxF11HviSDAeDx3QVe"],"enrUri":"enr:-L24QLF4GvjZRVU1YR8f5QxB7B7lwZo0Fu5uY_Q82PxvCHDoO4eV-6sgNXFJ2_PE_mpkd3WpW9P4Mqu8MGwNQtN9BO8CgmlkgnY0gmlwhKwST0WKbXVsdGlhZGRyc5YACASsEk9FBjWSAAoErBJPRQY1k90DgnJzhQADAQAAiXNlY3AyNTZrMaECVgC7wgINLKmNs2sItJ8-pUl5sdCf33yBYbQMW9X1YrmDdGNwgjWSg3VkcII1lIV3YWt1MgE"}'
2025-02-14 04:03:43.719 INFO [src.node.waku_node] REST service is ready !!
2025-02-14 04:03:43.725 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-14 04:03:43.725 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-14_04-03-42__934668ec-0e7f-4d66-86c0-b143d920be50__wakuorg_nwaku:latest.log
2025-02-14 04:03:43.725 DEBUG [src.node.waku_node] Starting Node...
2025-02-14 04:03:43.725 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-14 04:03:43.726 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-14 04:03:43.727 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.180.107
2025-02-14 04:03:43.727 DEBUG [src.node.docker_mananger] Generated ports ['15949', '15950', '15951', '15952', '15953']
2025-02-14 04:03:43.727 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-14 04:03:43.727 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-14 04:03:43.727 DEBUG [src.node.waku_node] Using volumes []
2025-02-14 04:03:43.727 DEBUG [src.node.docker_mananger] docker run -i -t -p 15949:15949 -p 15950:15950 -p 15951:15951 -p 15952:15952 -p 15953:15953 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=15951 --rest-port=15949 --tcp-port=15950 --discv5-udp-port=15952 --rest-address=0.0.0.0 --nat=extip:172.18.180.107 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=be67a3d7dba589c6ddefa6d218418dcb64cd29aff0fc722fc0bb19cc9ddd4c82 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=15953 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QLF4GvjZRVU1YR8f5QxB7B7lwZo0Fu5uY_Q82PxvCHDoO4eV-6sgNXFJ2_PE_mpkd3WpW9P4Mqu8MGwNQtN9BO8CgmlkgnY0gmlwhKwST0WKbXVsdGlhZGRyc5YACASsEk9FBjWSAAoErBJPRQY1k90DgnJzhQADAQAAiXNlY3AyNTZrMaECVgC7wgINLKmNs2sItJ8-pUl5sdCf33yBYbQMW9X1YrmDdGNwgjWSg3VkcII1lIV3YWt1MgE
2025-02-14 04:03:43.955 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.180.107 waku 218e6981d3f69dc08f5a411cda47cbbb37a4ffa7ab033722bdc5369ab85d1fba
2025-02-14 04:03:44.005 DEBUG [src.node.docker_mananger] Container started with ID 218e6981d3f6. Setting up logs at ./log/docker/node2_2025-02-14_04-03-42__934668ec-0e7f-4d66-86c0-b143d920be50__wakuorg_nwaku:latest.log
2025-02-14 04:03:44.005 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 15949
2025-02-14 04:03:44.006 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-14 04:03:45.006 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15949/health" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:45.011 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-14 04:03:45.012 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-14 04:03:45.013 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15949/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:45.017 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.180.107/tcp/15950/p2p/16Uiu2HAm94tMGJQrPARD69bCB3DhDVY9Ky1rAnhdZiwYhMWVXWz5","/ip4/172.18.180.107/tcp/15951/ws/p2p/16Uiu2HAm94tMGJQrPARD69bCB3DhDVY9Ky1rAnhdZiwYhMWVXWz5"],"enrUri":"enr:-L24QLMQJ5bESOJ361KHrLGzLgYEJcRrVTsOaZupGfnf1rvTWvRdIV8hUbHPNRBZ-qre5pzoub4GBeFj0cD3IekxGjcCgmlkgnY0gmlwhKwStGuKbXVsdGlhZGRyc5YACASsErRrBj5OAAoErBK0awY-T90DgnJzhQADAQAAiXNlY3AyNTZrMaECyrBoMQm3HniD9psN97VvOj5u_7Ym0JM-esl38hy9-5KDdGNwgj5Og3VkcII-UIV3YWt1MgE"}'
2025-02-14 04:03:45.019 INFO [src.node.waku_node] REST service is ready !!
2025-02-14 04:03:45.019 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:15949/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.79.69/tcp/13714/p2p/16Uiu2HAm1DPh1d8cpscNqeQ5SDBLY8JzJVaxF11HviSDAeDx3QVe"]'
2025-02-14 04:03:45.022 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:45.023 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-14 04:03:45.023 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:13713/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:03:45.027 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:45.027 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:15949/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-14 04:03:45.033 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:45.034 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:13713/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:03:45.039 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-14 04:03:45.040 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-14 04:03:45.140 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-14 04:03:45.140 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:13713/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:45.143 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739505825034263808,"ephemeral":false}]'
2025-02-14 04:03:45.144 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-14 04:03:45.144 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:15949/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-14 04:03:45.146 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739505825034263808,"ephemeral":false}]'
2025-02-14 04:03:45.148 INFO [src.steps.relay] WARM UP successful!!
2025-02-14 04:03:45.149 DEBUG [tests.relay.test_publish] Running test with payload Empty string
2025-02-14 04:03:45.149 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:13713/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:03:45.151 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:13713/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-14 04:03:45.151 DEBUG [tests.relay.test_publish] Running test with payload Unecoded text
2025-02-14 04:03:45.152 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:13713/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "Hello World!", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:03:45.154 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:13713/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Incorrect base64 string'
2025-02-14 04:03:45.154 DEBUG [tests.relay.test_publish] Running test with payload A dictionary
2025-02-14 04:03:45.154 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:13713/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": {"key": "YWFh"}, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:03:45.157 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:13713/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-14 04:03:45.157 DEBUG [tests.relay.test_publish] Running test with payload An integer
2025-02-14 04:03:45.157 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:13713/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": 1234567890, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:03:45.159 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:13713/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-14 04:03:45.159 DEBUG [tests.relay.test_publish] Running test with payload A list
2025-02-14 04:03:45.160 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:13713/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": ["YWFh"], "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:03:45.162 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:13713/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-14 04:03:45.162 DEBUG [tests.relay.test_publish] Running test with payload A bool
2025-02-14 04:03:45.162 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:13713/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": true, "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-14 04:03:45.164 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:13713/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1. Response content: b'Invalid content body, could not decode. Unable to deserialize data'
2025-02-14 04:03:45.166 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-14 04:03:45.167 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-14 04:03:45.167 DEBUG [src.node.waku_node] Stopping container with id ad643b607797
2025-02-14 04:03:46.205 DEBUG [src.node.waku_node] Container stopped.
2025-02-14 04:03:46.205 DEBUG [src.node.waku_node] Stopping container with id 218e6981d3f6
2025-02-14 04:03:47.020 ERROR [src.node.docker_mananger] Max retries reached for container ad643b607797. Exiting log stream.
2025-02-14 04:03:47.725 DEBUG [src.node.waku_node] Container stopped.
2025-02-14 04:03:47.727 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-14 04:03:47.732 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-14 04:03:47.737 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
