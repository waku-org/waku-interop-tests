2025-02-12 04:03:13.602 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-12 04:03:13.602 DEBUG [tests.conftest] Running test: test_metrics_after_relay_publish with id: 2025-02-12_04-03-13__3e45bdb0-9b92-40ff-ba81-6209f60c148b
2025-02-12 04:03:13.603 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-12 04:03:13.603 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-12 04:03:13.603 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-12 04:03:13.603 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-12 04:03:13.604 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-12 04:03:13.604 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-12 04:03:13.610 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-12 04:03:13.610 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-12_04-03-13__3e45bdb0-9b92-40ff-ba81-6209f60c148b__wakuorg_nwaku:latest.log
2025-02-12 04:03:13.610 DEBUG [src.node.waku_node] Starting Node...
2025-02-12 04:03:13.610 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-12 04:03:13.611 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-12 04:03:13.612 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.78.57
2025-02-12 04:03:13.612 DEBUG [src.node.docker_mananger] Generated ports ['9103', '9104', '9105', '9106', '9107']
2025-02-12 04:03:13.612 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-12 04:03:13.612 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-12 04:03:13.612 DEBUG [src.node.waku_node] Using volumes []
2025-02-12 04:03:13.612 DEBUG [src.node.docker_mananger] docker run -i -t -p 9103:9103 -p 9104:9104 -p 9105:9105 -p 9106:9106 -p 9107:9107 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=9105 --rest-port=9103 --tcp-port=9104 --discv5-udp-port=9106 --rest-address=0.0.0.0 --nat=extip:172.18.78.57 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=c4fbf8ca4ea1bdb9c1f40ef1fc670ece42eea0aeeb5c5dfa7f8b11ae41d8cd7c --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=9107 --metrics-logging=true --relay=true
2025-02-12 04:03:13.836 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.78.57 waku edfdf5997b40e5155498e3849c48875dbd06ca82c58aaa18e75d30faf4e5b1cf
2025-02-12 04:03:13.890 DEBUG [src.node.docker_mananger] Container started with ID edfdf5997b40. Setting up logs at ./log/docker/node1_2025-02-12_04-03-13__3e45bdb0-9b92-40ff-ba81-6209f60c148b__wakuorg_nwaku:latest.log
2025-02-12 04:03:13.891 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 9103
2025-02-12 04:03:13.891 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-12 04:03:14.398 ERROR [src.node.docker_mananger] Max retries reached for container 907e37fa3ee2. Exiting log stream.
2025-02-12 04:03:14.892 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9103/health" -H "Content-Type: application/json" -d 'None'
2025-02-12 04:03:14.894 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-12 04:03:14.895 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-12 04:03:14.895 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9103/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-12 04:03:14.897 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.78.57/tcp/9104/p2p/16Uiu2HAmChrhyugCmT6bweaZfpD9UTmZHqGUoRyUwgXe8pMTyYQ5","/ip4/172.18.78.57/tcp/9105/ws/p2p/16Uiu2HAmChrhyugCmT6bweaZfpD9UTmZHqGUoRyUwgXe8pMTyYQ5"],"enrUri":"enr:-L24QC716VToMXtehWj7iizJKN8oP0Alt2gpBRMpPkCAilgPG5tezLiQ_VmKKg1ADYzaUNWNoZ-KU-C_PKx_2fa786ICgmlkgnY0gmlwhKwSTjmKbXVsdGlhZGRyc5YACASsEk45BiOQAAoErBJOOQYjkd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDALwZpfsJV5Qm7zwEZn1-XyfR0zRJ7amzM7DdLUn_dbaDdGNwgiOQg3VkcIIjkoV3YWt1MgE"}'
2025-02-12 04:03:14.897 INFO [src.node.waku_node] REST service is ready !!
2025-02-12 04:03:14.903 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-12 04:03:14.904 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-12_04-03-13__3e45bdb0-9b92-40ff-ba81-6209f60c148b__wakuorg_nwaku:latest.log
2025-02-12 04:03:14.904 DEBUG [src.node.waku_node] Starting Node...
2025-02-12 04:03:14.904 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-12 04:03:14.905 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-12 04:03:14.905 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.95.66
2025-02-12 04:03:14.906 DEBUG [src.node.docker_mananger] Generated ports ['31841', '31842', '31843', '31844', '31845']
2025-02-12 04:03:14.906 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-12 04:03:14.906 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-12 04:03:14.906 DEBUG [src.node.waku_node] Using volumes []
2025-02-12 04:03:14.906 DEBUG [src.node.docker_mananger] docker run -i -t -p 31841:31841 -p 31842:31842 -p 31843:31843 -p 31844:31844 -p 31845:31845 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=31843 --rest-port=31841 --tcp-port=31842 --discv5-udp-port=31844 --rest-address=0.0.0.0 --nat=extip:172.18.95.66 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=0acabfb5cd8fbe2ad6aabcf9a150513beaca92ef116cc4e2ca015136edbbceed --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=31845 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QC716VToMXtehWj7iizJKN8oP0Alt2gpBRMpPkCAilgPG5tezLiQ_VmKKg1ADYzaUNWNoZ-KU-C_PKx_2fa786ICgmlkgnY0gmlwhKwSTjmKbXVsdGlhZGRyc5YACASsEk45BiOQAAoErBJOOQYjkd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDALwZpfsJV5Qm7zwEZn1-XyfR0zRJ7amzM7DdLUn_dbaDdGNwgiOQg3VkcIIjkoV3YWt1MgE
2025-02-12 04:03:15.141 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.95.66 waku c408f37b2db319803fc5d380a421c771873cb3d605f549ad62d6416bac2f93c7
2025-02-12 04:03:15.194 DEBUG [src.node.docker_mananger] Container started with ID c408f37b2db3. Setting up logs at ./log/docker/node2_2025-02-12_04-03-13__3e45bdb0-9b92-40ff-ba81-6209f60c148b__wakuorg_nwaku:latest.log
2025-02-12 04:03:15.195 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 31841
2025-02-12 04:03:15.195 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-12 04:03:16.197 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31841/health" -H "Content-Type: application/json" -d 'None'
2025-02-12 04:03:16.200 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-12 04:03:16.201 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-12 04:03:16.201 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31841/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-12 04:03:16.203 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.95.66/tcp/31842/p2p/16Uiu2HAm2e7vq7B7WH7fDJB3N7Wm8ginp4n5UcLdc3cviFKRuUQj","/ip4/172.18.95.66/tcp/31843/ws/p2p/16Uiu2HAm2e7vq7B7WH7fDJB3N7Wm8ginp4n5UcLdc3cviFKRuUQj"],"enrUri":"enr:-L24QNT-FTZ251YEMvD0iQC2Q2-qsvg_sRhldgDFOkCOFAS-JeOi_qqMWptcE3mFvUDfiwcXkTCP0Sc87gTWHGUZf4QCgmlkgnY0gmlwhKwSX0KKbXVsdGlhZGRyc5YACASsEl9CBnxiAAoErBJfQgZ8Y90DgnJzhQADAQAAiXNlY3AyNTZrMaECazIeZFJx5ZczWgmiY6NVpt7o_C6lom7W-UI0TJ3ewAyDdGNwgnxig3VkcIJ8ZIV3YWt1MgE"}'
2025-02-12 04:03:16.203 INFO [src.node.waku_node] REST service is ready !!
2025-02-12 04:03:16.204 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31841/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.78.57/tcp/9104/p2p/16Uiu2HAmChrhyugCmT6bweaZfpD9UTmZHqGUoRyUwgXe8pMTyYQ5"]'
2025-02-12 04:03:16.206 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-12 04:03:16.207 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-12 04:03:16.207 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9103/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-12 04:03:16.211 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-12 04:03:16.212 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31841/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-12 04:03:16.218 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-12 04:03:16.218 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9103/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-12 04:03:16.223 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-12 04:03:16.224 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-12 04:03:16.324 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-12 04:03:16.324 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9103/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-12 04:03:16.327 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739332996218784000,"ephemeral":false}]'
2025-02-12 04:03:16.329 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-12 04:03:16.329 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31841/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-12 04:03:16.331 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739332996218784000,"ephemeral":false}]'
2025-02-12 04:03:16.333 INFO [src.steps.relay] WARM UP successful!!
2025-02-12 04:03:16.333 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9103/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-12 04:03:16.338 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-12 04:03:16.338 DEBUG [src.libs.common] Sleeping for 0.5 seconds
2025-02-12 04:03:16.838 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31841/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-12 04:03:16.841 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739332996333941248,"ephemeral":false}]'
2025-02-12 04:03:16.841 DEBUG [src.libs.common] Sleeping for 5 seconds
2025-02-12 04:03:21.842 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-12 04:03:21.846 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-12 04:03:21.847 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-12 04:03:21.850 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-12 04:03:21.850 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-12 04:03:21.853 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-12 04:03:21.854 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-12 04:03:21.856 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-12 04:03:21.857 DEBUG [src.steps.metrics] Checking metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} has 1
2025-02-12 04:03:21.860 DEBUG [src.steps.metrics] Found metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} with value 2.0
2025-02-12 04:03:21.860 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-12 04:03:21.863 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-12 04:03:21.863 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-12 04:03:21.866 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 2.0
2025-02-12 04:03:21.867 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-12 04:03:21.869 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 2.0
2025-02-12 04:03:21.870 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-12 04:03:21.873 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-12 04:03:21.873 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-12 04:03:21.876 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-12 04:03:21.877 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-12 04:03:21.880 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-12 04:03:21.880 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-12 04:03:21.883 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-12 04:03:21.883 DEBUG [src.steps.metrics] Checking metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} has 1
2025-02-12 04:03:21.886 DEBUG [src.steps.metrics] Found metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} with value 2.0
2025-02-12 04:03:21.887 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-12 04:03:21.889 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-12 04:03:21.890 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-12 04:03:21.893 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 2.0
2025-02-12 04:03:21.893 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-12 04:03:21.896 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 2.0
2025-02-12 04:03:21.899 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-12 04:03:21.899 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-12 04:03:21.900 DEBUG [src.node.waku_node] Stopping container with id edfdf5997b40
2025-02-12 04:03:23.427 DEBUG [src.node.waku_node] Container stopped.
2025-02-12 04:03:23.428 DEBUG [src.node.waku_node] Stopping container with id c408f37b2db3
2025-02-12 04:03:24.240 ERROR [src.node.docker_mananger] Max retries reached for container edfdf5997b40. Exiting log stream.
2025-02-12 04:03:24.917 DEBUG [src.node.waku_node] Container stopped.
2025-02-12 04:03:24.918 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-12 04:03:24.924 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-12 04:03:24.930 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
