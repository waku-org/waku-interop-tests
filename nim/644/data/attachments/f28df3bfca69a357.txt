2025-02-08 04:03:22.942 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-08 04:03:22.942 DEBUG [tests.conftest] Running test: test_light_push_and_retrieve_duplicate_message with id: 2025-02-08_04-03-22__30c61e91-ea6c-4350-a3a6-f4a2ecd3c566
2025-02-08 04:03:22.942 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-08 04:03:22.943 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-08 04:03:22.949 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-08 04:03:22.949 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/receiving_node1_2025-02-08_04-03-22__30c61e91-ea6c-4350-a3a6-f4a2ecd3c566__wakuorg_nwaku:latest.log
2025-02-08 04:03:22.949 DEBUG [src.node.waku_node] Starting Node...
2025-02-08 04:03:22.949 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-08 04:03:22.951 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-08 04:03:22.952 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.44.167
2025-02-08 04:03:22.952 DEBUG [src.node.docker_mananger] Generated ports ['11542', '11543', '11544', '11545', '11546']
2025-02-08 04:03:22.952 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-08 04:03:22.952 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-08 04:03:22.952 DEBUG [src.node.waku_node] Using volumes []
2025-02-08 04:03:22.952 DEBUG [src.node.docker_mananger] docker run -i -t -p 11542:11542 -p 11543:11543 -p 11544:11544 -p 11545:11545 -p 11546:11546 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=11544 --rest-port=11542 --tcp-port=11543 --discv5-udp-port=11545 --rest-address=0.0.0.0 --nat=extip:172.18.44.167 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=2ccfaa107d59f83766bf8138c2ccacd6baa67a91ee96df458c292db3acde5cb6 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=11546 --metrics-logging=true --lightpush=true --relay=true
2025-02-08 04:03:23.179 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.44.167 waku e1c25919155e174bdfe1e2a778c7c5f4a9048af7fec124b67e88ac16c117f4e8
2025-02-08 04:03:23.228 DEBUG [src.node.docker_mananger] Container started with ID e1c25919155e. Setting up logs at ./log/docker/receiving_node1_2025-02-08_04-03-22__30c61e91-ea6c-4350-a3a6-f4a2ecd3c566__wakuorg_nwaku:latest.log
2025-02-08 04:03:23.229 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 11542
2025-02-08 04:03:23.230 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-08 04:03:23.731 ERROR [src.node.docker_mananger] Max retries reached for container 9b92723d6b62. Exiting log stream.
2025-02-08 04:03:24.230 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:11542/health" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:03:24.233 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-08 04:03:24.233 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-08 04:03:24.234 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:11542/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:03:24.236 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.44.167/tcp/11543/p2p/16Uiu2HAmKHB6rdLt7SijFmFNeoiZ9NePWKXdKfh8gKyh9diVDZAH","/ip4/172.18.44.167/tcp/11544/ws/p2p/16Uiu2HAmKHB6rdLt7SijFmFNeoiZ9NePWKXdKfh8gKyh9diVDZAH"],"enrUri":"enr:-L24QKGMfsbGdgrrW7jJaqNfknu98tcyG_LlQfDZXWQOmWNIO3ClZcUKFOpzssUxojYI2ZbY7b4_BYqpSR-Xoj6gyN0CgmlkgnY0gmlwhKwSLKeKbXVsdGlhZGRyc5YACASsEiynBi0XAAoErBIspwYtGN0DgnJzhQADAQAAiXNlY3AyNTZrMaEDYmsv4kVTyerx0WXlS8MT1MzuLauZy15LN_9okmIIAdqDdGNwgi0Xg3VkcIItGYV3YWt1Mgk"}'
2025-02-08 04:03:24.236 INFO [src.node.waku_node] REST service is ready !!
2025-02-08 04:03:24.243 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-08 04:03:24.243 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/receiving_node2_2025-02-08_04-03-22__30c61e91-ea6c-4350-a3a6-f4a2ecd3c566__wakuorg_nwaku:latest.log
2025-02-08 04:03:24.243 DEBUG [src.node.waku_node] Starting Node...
2025-02-08 04:03:24.243 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-08 04:03:24.244 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-08 04:03:24.244 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.249.12
2025-02-08 04:03:24.245 DEBUG [src.node.docker_mananger] Generated ports ['34783', '34784', '34785', '34786', '34787']
2025-02-08 04:03:24.245 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-08 04:03:24.245 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-08 04:03:24.245 DEBUG [src.node.waku_node] Using volumes []
2025-02-08 04:03:24.245 DEBUG [src.node.docker_mananger] docker run -i -t -p 34783:34783 -p 34784:34784 -p 34785:34785 -p 34786:34786 -p 34787:34787 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=34785 --rest-port=34783 --tcp-port=34784 --discv5-udp-port=34786 --rest-address=0.0.0.0 --nat=extip:172.18.249.12 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=a0c69f66331fec529aa9016bbd3e4b42c62c88bbab3ab538faff2a9be192f92b --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=34787 --metrics-logging=true --lightpush=false --relay=true
2025-02-08 04:03:24.467 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.249.12 waku 9233247f3ab8a0ec6f24c7d65a8f25702893f435df31c35f78695d98a9c483ab
2025-02-08 04:03:24.516 DEBUG [src.node.docker_mananger] Container started with ID 9233247f3ab8. Setting up logs at ./log/docker/receiving_node2_2025-02-08_04-03-22__30c61e91-ea6c-4350-a3a6-f4a2ecd3c566__wakuorg_nwaku:latest.log
2025-02-08 04:03:24.516 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 34783
2025-02-08 04:03:24.517 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-08 04:03:25.517 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:34783/health" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:03:25.521 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-08 04:03:25.521 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-08 04:03:25.521 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:34783/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:03:25.523 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.249.12/tcp/34784/p2p/16Uiu2HAmLeuBqiRyY1jkFbGHbEXXg3voatJG4YRepstrc75Fo8Cc","/ip4/172.18.249.12/tcp/34785/ws/p2p/16Uiu2HAmLeuBqiRyY1jkFbGHbEXXg3voatJG4YRepstrc75Fo8Cc"],"enrUri":"enr:-L24QH-7YJNw8Jb0QcVJJIZnMFLMQh7Bv1f_LIUL-DZWY8gYCTFkhR-523rTdDHKhz-e8v88uvzFSa3yIK94DlWVf5QCgmlkgnY0gmlwhKwS-QyKbXVsdGlhZGRyc5YACASsEvkMBofgAAoErBL5DAaH4d0DgnJzhQADAQAAiXNlY3AyNTZrMaEDdteoXeGJ650g4qLJ1uZohQEYLFGfsNcBEtzqqxQx4y2DdGNwgofgg3VkcIKH4oV3YWt1MgE"}'
2025-02-08 04:03:25.523 INFO [src.node.waku_node] REST service is ready !!
2025-02-08 04:03:25.524 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:34783/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.44.167/tcp/11543/p2p/16Uiu2HAmKHB6rdLt7SijFmFNeoiZ9NePWKXdKfh8gKyh9diVDZAH"]'
2025-02-08 04:03:25.562 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:03:25.572 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-08 04:03:25.572 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/lightpush_node1_2025-02-08_04-03-22__30c61e91-ea6c-4350-a3a6-f4a2ecd3c566__wakuorg_nwaku:latest.log
2025-02-08 04:03:25.572 DEBUG [src.node.waku_node] Starting Node...
2025-02-08 04:03:25.572 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-08 04:03:25.573 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-08 04:03:25.574 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.1.109
2025-02-08 04:03:25.574 DEBUG [src.node.docker_mananger] Generated ports ['46235', '46236', '46237', '46238', '46239']
2025-02-08 04:03:25.574 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-08 04:03:25.574 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-08 04:03:25.574 DEBUG [src.node.waku_node] Using volumes []
2025-02-08 04:03:25.574 DEBUG [src.node.docker_mananger] docker run -i -t -p 46235:46235 -p 46236:46236 -p 46237:46237 -p 46238:46238 -p 46239:46239 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=46237 --rest-port=46235 --tcp-port=46236 --discv5-udp-port=46238 --rest-address=0.0.0.0 --nat=extip:172.18.1.109 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=c3eafa7bde6ea2ebaa82bf193dc3e81507d614a7a8ed9f2e3d9bce3a1d801e3e --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=46239 --metrics-logging=true --discv5-bootstrap-node=enr:-L24QKGMfsbGdgrrW7jJaqNfknu98tcyG_LlQfDZXWQOmWNIO3ClZcUKFOpzssUxojYI2ZbY7b4_BYqpSR-Xoj6gyN0CgmlkgnY0gmlwhKwSLKeKbXVsdGlhZGRyc5YACASsEiynBi0XAAoErBIspwYtGN0DgnJzhQADAQAAiXNlY3AyNTZrMaEDYmsv4kVTyerx0WXlS8MT1MzuLauZy15LN_9okmIIAdqDdGNwgi0Xg3VkcIItGYV3YWt1Mgk --lightpushnode=/ip4/172.18.44.167/tcp/11543/p2p/16Uiu2HAmKHB6rdLt7SijFmFNeoiZ9NePWKXdKfh8gKyh9diVDZAH --lightpush=true --relay=false
2025-02-08 04:03:25.805 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.1.109 waku 5c8c820e885185fd04ee0ab3cd093c93b1620f532fd0ccbee8327d96eb3ddd11
2025-02-08 04:03:25.855 DEBUG [src.node.docker_mananger] Container started with ID 5c8c820e8851. Setting up logs at ./log/docker/lightpush_node1_2025-02-08_04-03-22__30c61e91-ea6c-4350-a3a6-f4a2ecd3c566__wakuorg_nwaku:latest.log
2025-02-08 04:03:25.855 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 46235
2025-02-08 04:03:25.855 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-08 04:03:26.856 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46235/health" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:03:26.859 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-08 04:03:26.859 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-08 04:03:26.859 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46235/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:03:26.861 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.1.109/tcp/46236/p2p/16Uiu2HAmMY9d1oYmiVpaq2Y6P8qhgJjnzRbje7diVAUfPJ9ChHX8","/ip4/172.18.1.109/tcp/46237/ws/p2p/16Uiu2HAmMY9d1oYmiVpaq2Y6P8qhgJjnzRbje7diVAUfPJ9ChHX8"],"enrUri":"enr:-L24QKq6yfwot0ao17iQaIvRu34PF73rt4uCfxsRZvHfHb9fEhA6pSecZ9txdlc7cwMWE_4yx2mi-fKAr2kWRe4Fl1kCgmlkgnY0gmlwhKwSAW2KbXVsdGlhZGRyc5YACASsEgFtBrScAAoErBIBbQa0nd0DgnJzhQADAQAAiXNlY3AyNTZrMaEDg_iZfLEBLCbzwz4BhVv8xSyzVwrcIBY-CvFQU5jONUODdGNwgrScg3VkcIK0noV3YWt1Mgg"}'
2025-02-08 04:03:26.862 INFO [src.node.waku_node] REST service is ready !!
2025-02-08 04:03:26.862 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46235/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.44.167/tcp/11543/p2p/16Uiu2HAmKHB6rdLt7SijFmFNeoiZ9NePWKXdKfh8gKyh9diVDZAH"]'
2025-02-08 04:03:26.898 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:03:26.899 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46235/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.249.12/tcp/34784/p2p/16Uiu2HAmLeuBqiRyY1jkFbGHbEXXg3voatJG4YRepstrc75Fo8Cc"]'
2025-02-08 04:03:26.931 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:03:26.931 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:11542/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2025-02-08 04:03:26.941 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:03:26.942 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:34783/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2025-02-08 04:03:26.947 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:03:26.949 DEBUG [src.steps.light_push] Lightpushing message
2025-02-08 04:03:26.949 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46235/lightpush/v1/message" -H "Content-Type: application/json" -d '{"pubsubTopic": "/waku/2/rs/3/0", "message": {"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": 1738987406949050624}}'
2025-02-08 04:03:26.959 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:03:26.959 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-08 04:03:27.060 DEBUG [src.steps.light_push] Checking that peer NODE_1:wakuorg/nwaku:latest can find the lightpushed message
2025-02-08 04:03:27.060 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:11542/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:03:27.062 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1738987406949050624,"ephemeral":false}]'
2025-02-08 04:03:27.064 DEBUG [src.steps.light_push] Checking that peer NODE_2:wakuorg/nwaku:latest can find the lightpushed message
2025-02-08 04:03:27.064 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:34783/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:03:27.066 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1738987406949050624,"ephemeral":false}]'
2025-02-08 04:03:27.067 DEBUG [src.steps.light_push] Lightpushing message
2025-02-08 04:03:27.067 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46235/lightpush/v1/message" -H "Content-Type: application/json" -d '{"pubsubTopic": "/waku/2/rs/3/0", "message": {"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": 1738987406949050624}}'
2025-02-08 04:03:27.075 ERROR [src.node.api_clients.base_client] HTTP error occurred: 503 Server Error: Service Unavailable for url: http://127.0.0.1:46235/lightpush/v1/message. Response content: b'Failed to request a message push: not_published_to_any_peer'
2025-02-08 04:03:27.077 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-08 04:03:27.078 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-08 04:03:27.078 DEBUG [src.node.waku_node] Stopping container with id e1c25919155e
2025-02-08 04:03:27.719 DEBUG [src.node.waku_node] Container stopped.
2025-02-08 04:03:27.719 DEBUG [src.node.waku_node] Stopping container with id 9233247f3ab8
2025-02-08 04:03:28.531 ERROR [src.node.docker_mananger] Max retries reached for container e1c25919155e. Exiting log stream.
2025-02-08 04:03:29.225 DEBUG [src.node.waku_node] Container stopped.
2025-02-08 04:03:29.225 DEBUG [src.node.waku_node] Stopping container with id 5c8c820e8851
2025-02-08 04:03:30.038 ERROR [src.node.docker_mananger] Max retries reached for container 9233247f3ab8. Exiting log stream.
2025-02-08 04:03:30.724 DEBUG [src.node.waku_node] Container stopped.
2025-02-08 04:03:30.725 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-08 04:03:30.733 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-08 04:03:30.740 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-08 04:03:30.746 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
