2025-02-08 04:04:31.830 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-08 04:04:31.831 DEBUG [tests.conftest] Running test: test_publish_with_ephemeral with id: 2025-02-08_04-04-31__4bac47cc-f1cc-4893-95c0-ae05a3570f87
2025-02-08 04:04:31.831 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-08 04:04:31.831 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-08 04:04:31.831 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-08 04:04:31.837 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-08 04:04:31.837 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-08_04-04-31__4bac47cc-f1cc-4893-95c0-ae05a3570f87__wakuorg_nwaku:latest.log
2025-02-08 04:04:31.837 DEBUG [src.node.waku_node] Starting Node...
2025-02-08 04:04:31.838 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-08 04:04:31.839 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-08 04:04:31.839 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.139.4
2025-02-08 04:04:31.839 DEBUG [src.node.docker_mananger] Generated ports ['10687', '10688', '10689', '10690', '10691']
2025-02-08 04:04:31.839 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-08 04:04:31.839 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-08 04:04:31.840 DEBUG [src.node.waku_node] Using volumes []
2025-02-08 04:04:31.840 DEBUG [src.node.docker_mananger] docker run -i -t -p 10687:10687 -p 10688:10688 -p 10689:10689 -p 10690:10690 -p 10691:10691 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=10689 --rest-port=10687 --tcp-port=10688 --discv5-udp-port=10690 --rest-address=0.0.0.0 --nat=extip:172.18.139.4 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=c820ce79f32aef9687bd8ebd5c3d308b90c2fcc0bdc1a54da3eb10cfbe22f5bf --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=10691 --metrics-logging=true --relay=true
2025-02-08 04:04:32.066 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.139.4 waku 7246d475f60f45dcfa0c198d5af8e992c3f1fced69911765e57bcb824e20ff18
2025-02-08 04:04:32.116 DEBUG [src.node.docker_mananger] Container started with ID 7246d475f60f. Setting up logs at ./log/docker/node1_2025-02-08_04-04-31__4bac47cc-f1cc-4893-95c0-ae05a3570f87__wakuorg_nwaku:latest.log
2025-02-08 04:04:32.117 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 10687
2025-02-08 04:04:32.117 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-08 04:04:32.625 ERROR [src.node.docker_mananger] Max retries reached for container 5fe01f535576. Exiting log stream.
2025-02-08 04:04:33.118 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10687/health" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:04:33.120 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-08 04:04:33.121 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-08 04:04:33.121 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10687/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:04:33.123 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.139.4/tcp/10688/p2p/16Uiu2HAm7ug7WYc4HrHfea4TVR4WHo8DKxpF9Asr1mynYyUDgZni","/ip4/172.18.139.4/tcp/10689/ws/p2p/16Uiu2HAm7ug7WYc4HrHfea4TVR4WHo8DKxpF9Asr1mynYyUDgZni"],"enrUri":"enr:-L24QNUixPXVNym-mKk_WehZ2yFWRMIf1BJKs_W5b-y9j8WRMA8KmqnY463IW7DXEHYZOYotlERBN6OBYtXINtMnDdwCgmlkgnY0gmlwhKwSiwSKbXVsdGlhZGRyc5YACASsEosEBinAAAoErBKLBAYpwd0DgnJzhQADAQAAiXNlY3AyNTZrMaECuXin_SUTcQW86l_iciqn2FICcIN-b9bThShmL3HmUBODdGNwginAg3VkcIIpwoV3YWt1MgE"}'
2025-02-08 04:04:33.123 INFO [src.node.waku_node] REST service is ready !!
2025-02-08 04:04:33.129 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-08 04:04:33.129 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-08_04-04-31__4bac47cc-f1cc-4893-95c0-ae05a3570f87__wakuorg_nwaku:latest.log
2025-02-08 04:04:33.129 DEBUG [src.node.waku_node] Starting Node...
2025-02-08 04:04:33.129 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-08 04:04:33.131 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-08 04:04:33.131 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.92.128
2025-02-08 04:04:33.131 DEBUG [src.node.docker_mananger] Generated ports ['60349', '60350', '60351', '60352', '60353']
2025-02-08 04:04:33.131 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-08 04:04:33.131 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-08 04:04:33.131 DEBUG [src.node.waku_node] Using volumes []
2025-02-08 04:04:33.131 DEBUG [src.node.docker_mananger] docker run -i -t -p 60349:60349 -p 60350:60350 -p 60351:60351 -p 60352:60352 -p 60353:60353 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=60351 --rest-port=60349 --tcp-port=60350 --discv5-udp-port=60352 --rest-address=0.0.0.0 --nat=extip:172.18.92.128 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=e6ec1726781642c9eaf5ababd7a0b492e5dfe45c16ca4d1c1f39cd8fa0c8adf6 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=60353 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QNUixPXVNym-mKk_WehZ2yFWRMIf1BJKs_W5b-y9j8WRMA8KmqnY463IW7DXEHYZOYotlERBN6OBYtXINtMnDdwCgmlkgnY0gmlwhKwSiwSKbXVsdGlhZGRyc5YACASsEosEBinAAAoErBKLBAYpwd0DgnJzhQADAQAAiXNlY3AyNTZrMaECuXin_SUTcQW86l_iciqn2FICcIN-b9bThShmL3HmUBODdGNwginAg3VkcIIpwoV3YWt1MgE
2025-02-08 04:04:33.351 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.92.128 waku 7c1034f5a1732c9826a54e04ac2ea2b68f3ae2c959ccbbec0c7f5f595003fb89
2025-02-08 04:04:33.400 DEBUG [src.node.docker_mananger] Container started with ID 7c1034f5a173. Setting up logs at ./log/docker/node2_2025-02-08_04-04-31__4bac47cc-f1cc-4893-95c0-ae05a3570f87__wakuorg_nwaku:latest.log
2025-02-08 04:04:33.400 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 60349
2025-02-08 04:04:33.400 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-08 04:04:34.401 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:60349/health" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:04:34.406 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-08 04:04:34.409 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-08 04:04:34.410 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:60349/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:04:34.414 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.92.128/tcp/60350/p2p/16Uiu2HAmDyp9gk4yh532DoogBiZ1ayL7aqWAGCQ9rgySnK4NzPkF","/ip4/172.18.92.128/tcp/60351/ws/p2p/16Uiu2HAmDyp9gk4yh532DoogBiZ1ayL7aqWAGCQ9rgySnK4NzPkF"],"enrUri":"enr:-L24QAvuPe1dHAJAmcCc_ZVl4rM4IO_ikwB9xMwVQclI1qJrVdY3h3fQ9Wx7hgRAkQOrxMfWRtgN3aP1uUiIFopr__UCgmlkgnY0gmlwhKwSXICKbXVsdGlhZGRyc5YACASsElyABuu-AAoErBJcgAbrv90DgnJzhQADAQAAiXNlY3AyNTZrMaEDE64wZWPbzoPh3NVDlfgkJwjNoB6IU40dG6n2YI6fhvyDdGNwguu-g3VkcILrwIV3YWt1MgE"}'
2025-02-08 04:04:34.415 INFO [src.node.waku_node] REST service is ready !!
2025-02-08 04:04:34.415 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:60349/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.139.4/tcp/10688/p2p/16Uiu2HAm7ug7WYc4HrHfea4TVR4WHo8DKxpF9Asr1mynYyUDgZni"]'
2025-02-08 04:04:34.421 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:04:34.421 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-08 04:04:34.421 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:10687/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-08 04:04:34.425 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:04:34.426 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:60349/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-08 04:04:34.431 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:04:34.432 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:10687/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-08 04:04:34.437 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:04:34.437 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-08 04:04:34.537 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-08 04:04:34.538 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10687/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:04:34.540 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738987474431902976,"ephemeral":false}]'
2025-02-08 04:04:34.541 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-08 04:04:34.541 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:60349/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:04:34.544 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738987474431902976,"ephemeral":false}]'
2025-02-08 04:04:34.545 INFO [src.steps.relay] WARM UP successful!!
2025-02-08 04:04:34.546 DEBUG [tests.relay.test_publish] Running test with Ephemeral True
2025-02-08 04:04:34.546 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:10687/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)', "ephemeral": true}'
2025-02-08 04:04:34.551 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:04:34.551 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-08 04:04:34.651 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-08 04:04:34.652 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10687/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:04:34.654 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738987474546514176,"ephemeral":true}]'
2025-02-08 04:04:34.655 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-08 04:04:34.655 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:60349/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:04:34.658 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738987474546514176,"ephemeral":true}]'
2025-02-08 04:04:34.660 DEBUG [tests.relay.test_publish] Running test with Ephemeral False
2025-02-08 04:04:34.660 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:10687/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)', "ephemeral": false}'
2025-02-08 04:04:34.665 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:04:34.665 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-08 04:04:34.765 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-08 04:04:34.765 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10687/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:04:34.767 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738987474660240896,"ephemeral":false}]'
2025-02-08 04:04:34.769 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-08 04:04:34.769 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:60349/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:04:34.771 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738987474660240896,"ephemeral":false}]'
2025-02-08 04:04:34.774 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-08 04:04:34.775 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-08 04:04:34.775 DEBUG [src.node.waku_node] Stopping container with id 7246d475f60f
2025-02-08 04:04:35.573 DEBUG [src.node.waku_node] Container stopped.
2025-02-08 04:04:35.574 DEBUG [src.node.waku_node] Stopping container with id 7c1034f5a173
2025-02-08 04:04:36.385 ERROR [src.node.docker_mananger] Max retries reached for container 7246d475f60f. Exiting log stream.
2025-02-08 04:04:37.073 DEBUG [src.node.waku_node] Container stopped.
2025-02-08 04:04:37.075 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-08 04:04:37.082 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-08 04:04:37.087 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
