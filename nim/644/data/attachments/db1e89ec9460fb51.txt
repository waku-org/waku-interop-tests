2025-02-08 04:03:40.307 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-08 04:03:40.307 DEBUG [tests.conftest] Running test: test_metrics_after_store_get with id: 2025-02-08_04-03-40__4accdcf8-c194-46cc-872c-60e5613fbfa9
2025-02-08 04:03:40.308 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-08 04:03:40.308 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-08 04:03:40.308 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-08 04:03:40.308 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-08 04:03:40.309 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-08 04:03:40.309 DEBUG [src.steps.store] Running fixture setup: node_setup
2025-02-08 04:03:40.315 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-08 04:03:40.315 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/publishing_node1_2025-02-08_04-03-40__4accdcf8-c194-46cc-872c-60e5613fbfa9__wakuorg_nwaku:latest.log
2025-02-08 04:03:40.315 DEBUG [src.node.waku_node] Starting Node...
2025-02-08 04:03:40.315 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-08 04:03:40.316 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-08 04:03:40.316 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.197.243
2025-02-08 04:03:40.317 DEBUG [src.node.docker_mananger] Generated ports ['3030', '3031', '3032', '3033', '3034']
2025-02-08 04:03:40.317 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-08 04:03:40.317 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-08 04:03:40.317 DEBUG [src.node.waku_node] Using volumes []
2025-02-08 04:03:40.317 DEBUG [src.node.docker_mananger] docker run -i -t -p 3030:3030 -p 3031:3031 -p 3032:3032 -p 3033:3033 -p 3034:3034 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=3032 --rest-port=3030 --tcp-port=3031 --discv5-udp-port=3033 --rest-address=0.0.0.0 --nat=extip:172.18.197.243 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=adc1de5da8e5b6bafcfc875fd80c3cffcef8f5a6589b4991d8f0029aa1acd3a0 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=3034 --metrics-logging=true --store=true --relay=true
2025-02-08 04:03:40.539 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.197.243 waku d80270b7c66e632aeffdb5379c12d0fbc9111bf7662bcf283eaaa9de3319cf6b
2025-02-08 04:03:40.585 DEBUG [src.node.docker_mananger] Container started with ID d80270b7c66e. Setting up logs at ./log/docker/publishing_node1_2025-02-08_04-03-40__4accdcf8-c194-46cc-872c-60e5613fbfa9__wakuorg_nwaku:latest.log
2025-02-08 04:03:40.587 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 3030
2025-02-08 04:03:40.587 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-08 04:03:41.056 ERROR [src.node.docker_mananger] Max retries reached for container 39125e565bba. Exiting log stream.
2025-02-08 04:03:41.587 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:3030/health" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:03:41.590 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-08 04:03:41.590 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-08 04:03:41.590 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:3030/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:03:41.592 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.197.243/tcp/3031/p2p/16Uiu2HAmBvFuv3N1bH51c4rMRdXwtq6RheCD2k98RuA8gyTaYNpC","/ip4/172.18.197.243/tcp/3032/ws/p2p/16Uiu2HAmBvFuv3N1bH51c4rMRdXwtq6RheCD2k98RuA8gyTaYNpC"],"enrUri":"enr:-L24QNjB984CYaGSWxbamgAcBxL4p-ii9bL5uSYsAdn1gvjCX8v6EwBg0W8_dDQ7CkXAEBmgHEWtkXj8mR3yDqBOjakCgmlkgnY0gmlwhKwSxfOKbXVsdGlhZGRyc5YACASsEsXzBgvXAAoErBLF8wYL2N0DgnJzhQADAQAAiXNlY3AyNTZrMaEC9Q2fLdVn1p85bEpQr9kF7aTS44G6ew3DY_r9frzA802DdGNwggvXg3VkcIIL2YV3YWt1MgM"}'
2025-02-08 04:03:41.593 INFO [src.node.waku_node] REST service is ready !!
2025-02-08 04:03:41.599 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-08 04:03:41.599 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/store_node1_2025-02-08_04-03-40__4accdcf8-c194-46cc-872c-60e5613fbfa9__wakuorg_nwaku:latest.log
2025-02-08 04:03:41.599 DEBUG [src.node.waku_node] Starting Node...
2025-02-08 04:03:41.600 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-08 04:03:41.601 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-08 04:03:41.601 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.87.159
2025-02-08 04:03:41.601 DEBUG [src.node.docker_mananger] Generated ports ['44362', '44363', '44364', '44365', '44366']
2025-02-08 04:03:41.601 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-08 04:03:41.601 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-08 04:03:41.602 DEBUG [src.node.waku_node] Using volumes []
2025-02-08 04:03:41.602 DEBUG [src.node.docker_mananger] docker run -i -t -p 44362:44362 -p 44363:44363 -p 44364:44364 -p 44365:44365 -p 44366:44366 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=44364 --rest-port=44362 --tcp-port=44363 --discv5-udp-port=44365 --rest-address=0.0.0.0 --nat=extip:172.18.87.159 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=4a6ecbaa3f15aeebced0ee2bcd9ce4cdecefef4d5dc81b9872cea1eb62de8d7c --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=44366 --metrics-logging=true --discv5-bootstrap-node=enr:-L24QNjB984CYaGSWxbamgAcBxL4p-ii9bL5uSYsAdn1gvjCX8v6EwBg0W8_dDQ7CkXAEBmgHEWtkXj8mR3yDqBOjakCgmlkgnY0gmlwhKwSxfOKbXVsdGlhZGRyc5YACASsEsXzBgvXAAoErBLF8wYL2N0DgnJzhQADAQAAiXNlY3AyNTZrMaEC9Q2fLdVn1p85bEpQr9kF7aTS44G6ew3DY_r9frzA802DdGNwggvXg3VkcIIL2YV3YWt1MgM --storenode=/ip4/172.18.197.243/tcp/3031/p2p/16Uiu2HAmBvFuv3N1bH51c4rMRdXwtq6RheCD2k98RuA8gyTaYNpC --store=true --relay=true
2025-02-08 04:03:41.824 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.87.159 waku 9813d25a3677b3b86351e52a9a76a4737dced9f7f130bf1532e04e936226acfd
2025-02-08 04:03:41.871 DEBUG [src.node.docker_mananger] Container started with ID 9813d25a3677. Setting up logs at ./log/docker/store_node1_2025-02-08_04-03-40__4accdcf8-c194-46cc-872c-60e5613fbfa9__wakuorg_nwaku:latest.log
2025-02-08 04:03:41.872 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 44362
2025-02-08 04:03:41.873 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-08 04:03:42.874 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:44362/health" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:03:42.876 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-08 04:03:42.876 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-08 04:03:42.877 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:44362/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:03:42.879 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.87.159/tcp/44363/p2p/16Uiu2HAmNmkv6TYSwPss7CG8NKEDyJJkEH4yLKPHvVohaQALtwF7","/ip4/172.18.87.159/tcp/44364/ws/p2p/16Uiu2HAmNmkv6TYSwPss7CG8NKEDyJJkEH4yLKPHvVohaQALtwF7"],"enrUri":"enr:-L24QIQFd7nJTqCQKZkAnKLMNDNf9vvqUoTnvU2Kj2WK1QMIA2pZQmDLo91lPx3UIvp4t2qEVJKNAPWzVfPVZjX7g7ICgmlkgnY0gmlwhKwSV5-KbXVsdGlhZGRyc5YACASsElefBq1LAAoErBJXnwatTN0DgnJzhQADAQAAiXNlY3AyNTZrMaEDllC-npNLaNwDSlnep6_h1Y2_ocsFMqyaDg4yRb7-z9KDdGNwgq1Lg3VkcIKtTYV3YWt1MgM"}'
2025-02-08 04:03:42.879 INFO [src.node.waku_node] REST service is ready !!
2025-02-08 04:03:42.879 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:44362/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.197.243/tcp/3031/p2p/16Uiu2HAmBvFuv3N1bH51c4rMRdXwtq6RheCD2k98RuA8gyTaYNpC"]'
2025-02-08 04:03:42.882 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:03:42.882 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3030/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-08 04:03:42.886 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:03:42.886 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:44362/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-08 04:03:42.892 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:03:42.894 DEBUG [src.steps.store] Relaying message
2025-02-08 04:03:42.895 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3030/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-08 04:03:42.901 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-08 04:03:42.901 DEBUG [src.libs.common] Sleeping for 0.2 seconds
2025-02-08 04:03:43.102 DEBUG [src.steps.store] Checking that peer wakuorg/nwaku:latest can find the stored messages
2025-02-08 04:03:43.102 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:3030/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F1&pageSize=50&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:03:43.106 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"","statusCode":200,"statusDesc":"OK","messages":[{"messageHash":"0xbd519401cf224ee376e1f3a766a2739fdf04f0d8bb0d0f1599274035432f3b84"}]}'
2025-02-08 04:03:43.107 DEBUG [src.steps.store] Checking that peer wakuorg/nwaku:latest can find the stored messages
2025-02-08 04:03:43.107 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:44362/store/v3/messages?pubsubTopic=%2Fwaku%2F2%2Frs%2F3%2F1&pageSize=50&ascending=true" -H "Content-Type: application/json" -d 'None'
2025-02-08 04:03:43.110 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"","statusCode":200,"statusDesc":"OK","messages":[{"messageHash":"0xbd519401cf224ee376e1f3a766a2739fdf04f0d8bb0d0f1599274035432f3b84"}]}'
2025-02-08 04:03:43.110 DEBUG [src.libs.common] Sleeping for 5 seconds
2025-02-08 04:03:48.111 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-08 04:03:48.115 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-08 04:03:48.115 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-08 04:03:48.118 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-08 04:03:48.118 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-08 04:03:48.121 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-08 04:03:48.121 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-08 04:03:48.124 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-08 04:03:48.124 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-08 04:03:48.127 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-08 04:03:48.128 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-08 04:03:48.131 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 1.0
2025-02-08 04:03:48.131 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-08 04:03:48.134 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 1.0
2025-02-08 04:03:48.134 DEBUG [src.steps.metrics] Checking metric: waku_service_peers{protocol="/vac/waku/store/2.0.0-beta4",peerId="/ip4/172.18.197.243/tcp/3031"} has 1
2025-02-08 04:03:48.137 DEBUG [src.steps.metrics] Found metric: waku_service_peers{protocol="/vac/waku/store/2.0.0-beta4",peerId="/ip4/172.18.197.243/tcp/3031"} with value 1.0
2025-02-08 04:03:48.138 DEBUG [src.steps.metrics] Checking metric: waku_service_peers{protocol="/vac/waku/store-query/3.0.0",peerId="/ip4/172.18.197.243/tcp/3031"} has 1
2025-02-08 04:03:48.141 DEBUG [src.steps.metrics] Found metric: waku_service_peers{protocol="/vac/waku/store-query/3.0.0",peerId="/ip4/172.18.197.243/tcp/3031"} with value 1.0
2025-02-08 04:03:48.141 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-08 04:03:48.144 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-08 04:03:48.144 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-08 04:03:48.147 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-08 04:03:48.147 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-08 04:03:48.150 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-08 04:03:48.150 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-08 04:03:48.153 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-08 04:03:48.153 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-08 04:03:48.156 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-08 04:03:48.157 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-08 04:03:48.159 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 1.0
2025-02-08 04:03:48.160 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-08 04:03:48.163 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 1.0
2025-02-08 04:03:48.165 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-08 04:03:48.165 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-08 04:03:48.166 DEBUG [src.node.waku_node] Stopping container with id d80270b7c66e
2025-02-08 04:03:49.656 DEBUG [src.node.waku_node] Container stopped.
2025-02-08 04:03:49.656 DEBUG [src.node.waku_node] Stopping container with id 9813d25a3677
2025-02-08 04:03:50.468 ERROR [src.node.docker_mananger] Max retries reached for container d80270b7c66e. Exiting log stream.
2025-02-08 04:03:50.832 DEBUG [src.node.waku_node] Container stopped.
2025-02-08 04:03:50.833 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-08 04:03:50.839 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-08 04:03:50.844 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
