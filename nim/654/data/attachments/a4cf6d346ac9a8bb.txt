2025-02-17 04:07:31.151 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-17 04:07:31.151 DEBUG [tests.conftest] Running test: test_publish_after_node2_restarts with id: 2025-02-17_04-07-31__a2a0ff77-81ed-4c01-98d4-e0be18c777de
2025-02-17 04:07:31.151 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-17 04:07:31.152 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-17 04:07:31.152 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-17 04:07:31.161 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-17 04:07:31.162 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-17_04-07-31__a2a0ff77-81ed-4c01-98d4-e0be18c777de__wakuorg_nwaku:latest.log
2025-02-17 04:07:31.162 DEBUG [src.node.waku_node] Starting Node...
2025-02-17 04:07:31.162 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-17 04:07:31.163 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-17 04:07:31.164 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.144.233
2025-02-17 04:07:31.164 DEBUG [src.node.docker_mananger] Generated ports ['17791', '17792', '17793', '17794', '17795']
2025-02-17 04:07:31.164 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-17 04:07:31.164 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-17 04:07:31.164 DEBUG [src.node.waku_node] Using volumes []
2025-02-17 04:07:31.164 DEBUG [src.node.docker_mananger] docker run -i -t -p 17791:17791 -p 17792:17792 -p 17793:17793 -p 17794:17794 -p 17795:17795 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=17793 --rest-port=17791 --tcp-port=17792 --discv5-udp-port=17794 --rest-address=0.0.0.0 --nat=extip:172.18.144.233 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=d2facaa3bd626feb504caeb38bafd3c18b19c1adbb8b1b97c7bf2f1b5808ea8e --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=17795 --metrics-logging=true --relay=true
2025-02-17 04:07:31.429 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.144.233 waku 6d709a2ed4e997c30ca9119b5dd0db64c1d300f4738e84540fb0c1fc8bf2ecf2
2025-02-17 04:07:31.484 DEBUG [src.node.docker_mananger] Container started with ID 6d709a2ed4e9. Setting up logs at ./log/docker/node1_2025-02-17_04-07-31__a2a0ff77-81ed-4c01-98d4-e0be18c777de__wakuorg_nwaku:latest.log
2025-02-17 04:07:31.485 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 17791
2025-02-17 04:07:31.485 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-17 04:07:31.850 ERROR [src.node.docker_mananger] Max retries reached for container 7a005d9ed690. Exiting log stream.
2025-02-17 04:07:32.485 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:17791/health" -H "Content-Type: application/json" -d 'None'
2025-02-17 04:07:32.488 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-17 04:07:32.488 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-17 04:07:32.489 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:17791/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-17 04:07:32.491 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.144.233/tcp/17792/p2p/16Uiu2HAmCQBmutQhdhu5B7ADhsT1P22YEVQGBEaBNzJ6dapbShBS","/ip4/172.18.144.233/tcp/17793/ws/p2p/16Uiu2HAmCQBmutQhdhu5B7ADhsT1P22YEVQGBEaBNzJ6dapbShBS"],"enrUri":"enr:-L24QGPq_rxIHD0LL8vSWmG4N7LOisF3z9cq2IEbopJvrv6ECqoEqtXkzGhFIkDMxgdQXRjalZ923n45XQta9YVnmC4CgmlkgnY0gmlwhKwSkOmKbXVsdGlhZGRyc5YACASsEpDpBkWAAAoErBKQ6QZFgd0DgnJzhQADAQAAiXNlY3AyNTZrMaEC_DU0o6E43s9SZqk3W8v4oSEYl-tRw1vnULE0NPdzxaWDdGNwgkWAg3VkcIJFgoV3YWt1MgE"}'
2025-02-17 04:07:32.491 INFO [src.node.waku_node] REST service is ready !!
2025-02-17 04:07:32.497 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-17 04:07:32.498 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-17_04-07-31__a2a0ff77-81ed-4c01-98d4-e0be18c777de__wakuorg_nwaku:latest.log
2025-02-17 04:07:32.498 DEBUG [src.node.waku_node] Starting Node...
2025-02-17 04:07:32.498 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-17 04:07:32.499 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-17 04:07:32.499 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.133.3
2025-02-17 04:07:32.500 DEBUG [src.node.docker_mananger] Generated ports ['33947', '33948', '33949', '33950', '33951']
2025-02-17 04:07:32.500 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-17 04:07:32.500 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-17 04:07:32.500 DEBUG [src.node.waku_node] Using volumes []
2025-02-17 04:07:32.500 DEBUG [src.node.docker_mananger] docker run -i -t -p 33947:33947 -p 33948:33948 -p 33949:33949 -p 33950:33950 -p 33951:33951 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=33949 --rest-port=33947 --tcp-port=33948 --discv5-udp-port=33950 --rest-address=0.0.0.0 --nat=extip:172.18.133.3 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=bad31318fba1daac50c09bab85e862ea3aa907f07bcd8b0c4ca1ff5ea7e0fd4a --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=33951 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QGPq_rxIHD0LL8vSWmG4N7LOisF3z9cq2IEbopJvrv6ECqoEqtXkzGhFIkDMxgdQXRjalZ923n45XQta9YVnmC4CgmlkgnY0gmlwhKwSkOmKbXVsdGlhZGRyc5YACASsEpDpBkWAAAoErBKQ6QZFgd0DgnJzhQADAQAAiXNlY3AyNTZrMaEC_DU0o6E43s9SZqk3W8v4oSEYl-tRw1vnULE0NPdzxaWDdGNwgkWAg3VkcIJFgoV3YWt1MgE
2025-02-17 04:07:32.735 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.133.3 waku b700dc70b943558a9fc394052cc982e2206f2facebcbf404e7821269d09a3dbb
2025-02-17 04:07:32.793 DEBUG [src.node.docker_mananger] Container started with ID b700dc70b943. Setting up logs at ./log/docker/node2_2025-02-17_04-07-31__a2a0ff77-81ed-4c01-98d4-e0be18c777de__wakuorg_nwaku:latest.log
2025-02-17 04:07:32.793 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 33947
2025-02-17 04:07:32.793 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-17 04:07:33.794 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33947/health" -H "Content-Type: application/json" -d 'None'
2025-02-17 04:07:33.799 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-17 04:07:33.801 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-17 04:07:33.802 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33947/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-17 04:07:33.805 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.133.3/tcp/33948/p2p/16Uiu2HAmUJAx3pJAb5LQhgB3w2LaPA3VvLoPwaca76rGa25xj22Q","/ip4/172.18.133.3/tcp/33949/ws/p2p/16Uiu2HAmUJAx3pJAb5LQhgB3w2LaPA3VvLoPwaca76rGa25xj22Q"],"enrUri":"enr:-L24QO4y6oGHD-4_wD2YYYtNwGxzYBudooNvmh2J0W2asEaLTCx_lnKSIIzbILn6RPbM_1Rsq_7jjmQNzqkbvAp6ca0CgmlkgnY0gmlwhKwShQOKbXVsdGlhZGRyc5YACASsEoUDBoScAAoErBKFAwaEnd0DgnJzhQADAQAAiXNlY3AyNTZrMaED6GXHS7xpGzUZsinS6B3poDpuRZ-U_ke36rs7OGQkWrWDdGNwgoScg3VkcIKEnoV3YWt1MgE"}'
2025-02-17 04:07:33.805 INFO [src.node.waku_node] REST service is ready !!
2025-02-17 04:07:33.806 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:33947/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.144.233/tcp/17792/p2p/16Uiu2HAmCQBmutQhdhu5B7ADhsT1P22YEVQGBEaBNzJ6dapbShBS"]'
2025-02-17 04:07:33.808 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-17 04:07:33.809 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-17 04:07:33.809 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:17791/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-17 04:07:33.813 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-17 04:07:33.813 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:33947/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-17 04:07:33.819 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-17 04:07:33.821 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:17791/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-17 04:07:33.826 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-17 04:07:33.826 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-17 04:07:33.926 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-17 04:07:33.927 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:17791/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-17 04:07:33.929 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739765253820918272,"ephemeral":false,"proof":""}]'
2025-02-17 04:07:33.931 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-17 04:07:33.931 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33947/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-17 04:07:33.934 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739765253820918272,"ephemeral":false,"proof":""}]'
2025-02-17 04:07:33.935 INFO [src.steps.relay] WARM UP successful!!
2025-02-17 04:07:33.936 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:17791/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-17 04:07:33.941 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-17 04:07:33.941 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-17 04:07:34.042 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-17 04:07:34.042 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:17791/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-17 04:07:34.045 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739765253936599552,"ephemeral":false,"proof":""}]'
2025-02-17 04:07:34.046 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-17 04:07:34.047 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33947/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-17 04:07:34.049 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739765253936599552,"ephemeral":false,"proof":""}]'
2025-02-17 04:07:34.050 DEBUG [src.node.waku_node] Restarting container with id b700dc70b943
2025-02-17 04:07:35.529 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33947/health" -H "Content-Type: application/json" -d 'None'
2025-02-17 04:07:35.631 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33947/health" -H "Content-Type: application/json" -d 'None'
2025-02-17 04:07:35.634 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-17 04:07:35.634 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-17 04:07:35.634 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33947/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-17 04:07:35.636 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.133.3/tcp/33948/p2p/16Uiu2HAmUJAx3pJAb5LQhgB3w2LaPA3VvLoPwaca76rGa25xj22Q","/ip4/172.18.133.3/tcp/33949/ws/p2p/16Uiu2HAmUJAx3pJAb5LQhgB3w2LaPA3VvLoPwaca76rGa25xj22Q"],"enrUri":"enr:-L24QO4y6oGHD-4_wD2YYYtNwGxzYBudooNvmh2J0W2asEaLTCx_lnKSIIzbILn6RPbM_1Rsq_7jjmQNzqkbvAp6ca0CgmlkgnY0gmlwhKwShQOKbXVsdGlhZGRyc5YACASsEoUDBoScAAoErBKFAwaEnd0DgnJzhQADAQAAiXNlY3AyNTZrMaED6GXHS7xpGzUZsinS6B3poDpuRZ-U_ke36rs7OGQkWrWDdGNwgoScg3VkcIKEnoV3YWt1MgE"}'
2025-02-17 04:07:35.637 INFO [src.node.waku_node] REST service is ready !!
2025-02-17 04:07:35.637 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:17791/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-17 04:07:35.639 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-17 04:07:35.640 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:33947/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-17 04:07:35.658 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-17 04:07:35.659 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:17791/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-17 04:07:35.662 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-17 04:07:35.662 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-17 04:07:35.762 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-17 04:07:35.763 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:17791/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-17 04:07:35.766 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739765255659025408,"ephemeral":false,"proof":""}]'
2025-02-17 04:07:35.767 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-17 04:07:35.767 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33947/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-17 04:07:35.770 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[]'
2025-02-17 04:07:36.770 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:17791/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-17 04:07:36.776 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-17 04:07:36.776 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-17 04:07:36.877 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-17 04:07:36.877 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:17791/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-17 04:07:36.880 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739765256770682624,"ephemeral":false,"proof":""}]'
2025-02-17 04:07:36.882 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-17 04:07:36.882 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:33947/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-17 04:07:36.885 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739765256770682624,"ephemeral":false,"proof":""}]'
2025-02-17 04:07:36.888 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-17 04:07:36.889 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-17 04:07:36.889 DEBUG [src.node.waku_node] Stopping container with id 6d709a2ed4e9
2025-02-17 04:07:37.994 DEBUG [src.node.waku_node] Container stopped.
2025-02-17 04:07:37.994 DEBUG [src.node.waku_node] Stopping container with id b700dc70b943
2025-02-17 04:07:38.808 ERROR [src.node.docker_mananger] Max retries reached for container 6d709a2ed4e9. Exiting log stream.
2025-02-17 04:07:39.531 DEBUG [src.node.waku_node] Container stopped.
2025-02-17 04:07:39.532 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-17 04:07:39.543 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-17 04:07:39.564 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
