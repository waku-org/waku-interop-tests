2025-02-04 17:12:27.513 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-04 17:12:27.513 DEBUG [tests.conftest] Running test: test_publish_with_ephemeral with id: 2025-02-04_17-12-27__ad4c4c0e-e0d6-4ab5-aaf8-d02a6fc4fff1
2025-02-04 17:12:27.514 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-04 17:12:27.514 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-04 17:12:27.514 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-04 17:12:27.520 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-04 17:12:27.520 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-04_17-12-27__ad4c4c0e-e0d6-4ab5-aaf8-d02a6fc4fff1__wakuorg_nwaku:latest.log
2025-02-04 17:12:27.520 DEBUG [src.node.waku_node] Starting Node...
2025-02-04 17:12:27.520 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-04 17:12:27.522 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-04 17:12:27.522 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.55.5
2025-02-04 17:12:27.522 DEBUG [src.node.docker_mananger] Generated ports ['3583', '3584', '3585', '3586', '3587']
2025-02-04 17:12:27.522 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-04 17:12:27.522 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-04 17:12:27.522 DEBUG [src.node.waku_node] Using volumes []
2025-02-04 17:12:27.522 DEBUG [src.node.docker_mananger] docker run -i -t -p 3583:3583 -p 3584:3584 -p 3585:3585 -p 3586:3586 -p 3587:3587 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=3585 --rest-port=3583 --tcp-port=3584 --discv5-udp-port=3586 --rest-address=0.0.0.0 --nat=extip:172.18.55.5 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=41cf10edfdadf05ac2fe55ee3de5e107fedf405598dff4ddcfeedb1e1854dce0 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=3587 --metrics-logging=true --relay=true
2025-02-04 17:12:27.753 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.55.5 waku 7195ac483b19b60f4b327327b30326d1799cfb35a2170fd37ed168acfd05beda
2025-02-04 17:12:27.800 DEBUG [src.node.docker_mananger] Container started with ID 7195ac483b19. Setting up logs at ./log/docker/node1_2025-02-04_17-12-27__ad4c4c0e-e0d6-4ab5-aaf8-d02a6fc4fff1__wakuorg_nwaku:latest.log
2025-02-04 17:12:27.802 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 3583
2025-02-04 17:12:27.802 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-04 17:12:28.320 ERROR [src.node.docker_mananger] Max retries reached for container ab2983c391b1. Exiting log stream.
2025-02-04 17:12:28.803 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:3583/health" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:28.805 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-04 17:12:28.806 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-04 17:12:28.806 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:3583/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:28.808 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.55.5/tcp/3584/p2p/16Uiu2HAkySRVnTWVFCfEgPgDgYRzpqrYDHjSWhj1naQwCbMhokLu","/ip4/172.18.55.5/tcp/3585/ws/p2p/16Uiu2HAkySRVnTWVFCfEgPgDgYRzpqrYDHjSWhj1naQwCbMhokLu"],"enrUri":"enr:-L24QL1anT77q6JxlPqh0hju4a6Azhb4ABwJF1fEKW0tYkGEFl99TGbg9RNdA-Tcl7aDyZlIl5X9AMkFM47UNV8q3O0CgmlkgnY0gmlwhKwSNwWKbXVsdGlhZGRyc5YACASsEjcFBg4AAAoErBI3BQYOAd0DgnJzhQADAQAAiXNlY3AyNTZrMaECO5_z37iMKIFdspFh6M11CItLaGfBst-pWzEUvCUFp76DdGNwgg4Ag3VkcIIOAoV3YWt1MgE"}'
2025-02-04 17:12:28.808 INFO [src.node.waku_node] REST service is ready !!
2025-02-04 17:12:28.814 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-04 17:12:28.815 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-04_17-12-27__ad4c4c0e-e0d6-4ab5-aaf8-d02a6fc4fff1__wakuorg_nwaku:latest.log
2025-02-04 17:12:28.815 DEBUG [src.node.waku_node] Starting Node...
2025-02-04 17:12:28.815 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-04 17:12:28.816 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-04 17:12:28.816 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.150.125
2025-02-04 17:12:28.816 DEBUG [src.node.docker_mananger] Generated ports ['43813', '43814', '43815', '43816', '43817']
2025-02-04 17:12:28.817 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-04 17:12:28.817 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-04 17:12:28.817 DEBUG [src.node.waku_node] Using volumes []
2025-02-04 17:12:28.817 DEBUG [src.node.docker_mananger] docker run -i -t -p 43813:43813 -p 43814:43814 -p 43815:43815 -p 43816:43816 -p 43817:43817 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=43815 --rest-port=43813 --tcp-port=43814 --discv5-udp-port=43816 --rest-address=0.0.0.0 --nat=extip:172.18.150.125 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=a60a24fead4427a5bafc7ff286fb083d3dd965b7cff63c921913ffa8d2cea326 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=43817 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QL1anT77q6JxlPqh0hju4a6Azhb4ABwJF1fEKW0tYkGEFl99TGbg9RNdA-Tcl7aDyZlIl5X9AMkFM47UNV8q3O0CgmlkgnY0gmlwhKwSNwWKbXVsdGlhZGRyc5YACASsEjcFBg4AAAoErBI3BQYOAd0DgnJzhQADAQAAiXNlY3AyNTZrMaECO5_z37iMKIFdspFh6M11CItLaGfBst-pWzEUvCUFp76DdGNwgg4Ag3VkcIIOAoV3YWt1MgE
2025-02-04 17:12:29.050 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.150.125 waku c8e001dcffdd7da6210c621199eed74a42b9ea671826e6a7815c7c3a4a993cef
2025-02-04 17:12:29.099 DEBUG [src.node.docker_mananger] Container started with ID c8e001dcffdd. Setting up logs at ./log/docker/node2_2025-02-04_17-12-27__ad4c4c0e-e0d6-4ab5-aaf8-d02a6fc4fff1__wakuorg_nwaku:latest.log
2025-02-04 17:12:29.099 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 43813
2025-02-04 17:12:29.100 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-04 17:12:30.100 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:43813/health" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:30.106 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-04 17:12:30.106 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-04 17:12:30.107 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:43813/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:30.111 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.150.125/tcp/43814/p2p/16Uiu2HAmNCcTmMs2NXxXrP5kxned2N5BKKFVo8hLtB7kdDHqPWKZ","/ip4/172.18.150.125/tcp/43815/ws/p2p/16Uiu2HAmNCcTmMs2NXxXrP5kxned2N5BKKFVo8hLtB7kdDHqPWKZ"],"enrUri":"enr:-L24QLz-Q90nJqDjj9M4UGSB759esBdMp_OXI-Oo4HptAauNW20x4UEQt_CXo-Zshb1Uf-CBrk3GRwA231xUo6EVs2gCgmlkgnY0gmlwhKwSln2KbXVsdGlhZGRyc5YACASsEpZ9BqsmAAoErBKWfQarJ90DgnJzhQADAQAAiXNlY3AyNTZrMaEDjdME3LIYO4UiU2a9HMU2S0IblxbCHxDC3FjYM0fTybiDdGNwgqsmg3VkcIKrKIV3YWt1MgE"}'
2025-02-04 17:12:30.111 INFO [src.node.waku_node] REST service is ready !!
2025-02-04 17:12:30.112 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:43813/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.55.5/tcp/3584/p2p/16Uiu2HAkySRVnTWVFCfEgPgDgYRzpqrYDHjSWhj1naQwCbMhokLu"]'
2025-02-04 17:12:30.115 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:30.116 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-04 17:12:30.116 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3583/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-04 17:12:30.119 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:30.120 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:43813/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-04 17:12:30.125 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:30.126 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3583/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-04 17:12:30.132 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:30.133 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-04 17:12:30.233 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-04 17:12:30.233 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:3583/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:30.236 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738689150126719232,"ephemeral":false}]'
2025-02-04 17:12:30.237 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-04 17:12:30.237 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:43813/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:30.240 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738689150126719232,"ephemeral":false}]'
2025-02-04 17:12:30.241 INFO [src.steps.relay] WARM UP successful!!
2025-02-04 17:12:30.242 DEBUG [tests.relay.test_publish] Running test with Ephemeral True
2025-02-04 17:12:30.242 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3583/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)', "ephemeral": true}'
2025-02-04 17:12:30.246 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:30.247 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-04 17:12:30.347 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-04 17:12:30.348 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:3583/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:30.350 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738689150242459136,"ephemeral":true}]'
2025-02-04 17:12:30.352 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-04 17:12:30.352 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:43813/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:30.354 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738689150242459136,"ephemeral":true}]'
2025-02-04 17:12:30.355 DEBUG [tests.relay.test_publish] Running test with Ephemeral False
2025-02-04 17:12:30.356 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:3583/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)', "ephemeral": false}'
2025-02-04 17:12:30.361 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:30.361 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-04 17:12:30.462 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-04 17:12:30.462 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:3583/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:30.464 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738689150356048896,"ephemeral":false}]'
2025-02-04 17:12:30.465 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-04 17:12:30.466 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:43813/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:30.468 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738689150356048896,"ephemeral":false}]'
2025-02-04 17:12:30.472 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-04 17:12:30.473 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-04 17:12:30.473 DEBUG [src.node.waku_node] Stopping container with id 7195ac483b19
2025-02-04 17:12:31.305 DEBUG [src.node.waku_node] Container stopped.
2025-02-04 17:12:31.307 DEBUG [src.node.waku_node] Stopping container with id c8e001dcffdd
2025-02-04 17:12:32.133 ERROR [src.node.docker_mananger] Max retries reached for container 7195ac483b19. Exiting log stream.
2025-02-04 17:12:32.792 DEBUG [src.node.waku_node] Container stopped.
2025-02-04 17:12:32.793 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-04 17:12:32.802 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-04 17:12:32.808 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
