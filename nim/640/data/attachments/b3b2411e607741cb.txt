2025-02-04 17:09:11.085 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-04 17:09:11.085 DEBUG [tests.conftest] Running test: test_metrics_after_relay_publish with id: 2025-02-04_17-09-11__98931afc-897c-4789-97be-588b7b90a4d4
2025-02-04 17:09:11.086 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-04 17:09:11.086 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-04 17:09:11.086 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2025-02-04 17:09:11.086 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-04 17:09:11.086 DEBUG [src.steps.store] Running fixture setup: store_setup
2025-02-04 17:09:11.087 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-04 17:09:11.093 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-04 17:09:11.093 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-04_17-09-11__98931afc-897c-4789-97be-588b7b90a4d4__wakuorg_nwaku:latest.log
2025-02-04 17:09:11.093 DEBUG [src.node.waku_node] Starting Node...
2025-02-04 17:09:11.093 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-04 17:09:11.095 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-04 17:09:11.095 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.186.2
2025-02-04 17:09:11.095 DEBUG [src.node.docker_mananger] Generated ports ['10466', '10467', '10468', '10469', '10470']
2025-02-04 17:09:11.095 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-04 17:09:11.095 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-04 17:09:11.095 DEBUG [src.node.waku_node] Using volumes []
2025-02-04 17:09:11.095 DEBUG [src.node.docker_mananger] docker run -i -t -p 10466:10466 -p 10467:10467 -p 10468:10468 -p 10469:10469 -p 10470:10470 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=10468 --rest-port=10466 --tcp-port=10467 --discv5-udp-port=10469 --rest-address=0.0.0.0 --nat=extip:172.18.186.2 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=e4d7c954b29e52a66b04cadbdf5b2ba6e9f9a2658e6cdbafbfcc85d2b9ecee57 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=10470 --metrics-logging=true --relay=true
2025-02-04 17:09:11.333 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.186.2 waku c44f3e08db174ee18ef81d12deb3481604a4065dd76f210ed02f4c8640ed4ccb
2025-02-04 17:09:11.382 DEBUG [src.node.docker_mananger] Container started with ID c44f3e08db17. Setting up logs at ./log/docker/node1_2025-02-04_17-09-11__98931afc-897c-4789-97be-588b7b90a4d4__wakuorg_nwaku:latest.log
2025-02-04 17:09:11.384 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 10466
2025-02-04 17:09:11.384 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-04 17:09:11.892 ERROR [src.node.docker_mananger] Max retries reached for container b99853083a2f. Exiting log stream.
2025-02-04 17:09:12.384 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10466/health" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:09:12.387 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-04 17:09:12.387 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-04 17:09:12.388 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10466/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:09:12.390 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.186.2/tcp/10467/p2p/16Uiu2HAkx4MoKYujccXN7WEyeDDCQuj1QkdGdr912K8F75F8fKVk","/ip4/172.18.186.2/tcp/10468/ws/p2p/16Uiu2HAkx4MoKYujccXN7WEyeDDCQuj1QkdGdr912K8F75F8fKVk"],"enrUri":"enr:-L24QM_EUWWln005D57cnD4Lk3-f5N9snFPwyqyQA1mx5URbMwKugk0VbaE78F6bIuYNatDPRHwxhML33PAu-vjRyVMCgmlkgnY0gmlwhKwSugKKbXVsdGlhZGRyc5YACASsEroCBijjAAoErBK6AgYo5N0DgnJzhQADAQAAiXNlY3AyNTZrMaECJx1OlK2IfxNLiuDyZN184hQvQ6OtzDXB7m9gLhLlayuDdGNwgijjg3VkcIIo5YV3YWt1MgE"}'
2025-02-04 17:09:12.390 INFO [src.node.waku_node] REST service is ready !!
2025-02-04 17:09:12.396 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-04 17:09:12.396 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-04_17-09-11__98931afc-897c-4789-97be-588b7b90a4d4__wakuorg_nwaku:latest.log
2025-02-04 17:09:12.396 DEBUG [src.node.waku_node] Starting Node...
2025-02-04 17:09:12.397 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-04 17:09:12.398 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-04 17:09:12.398 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.201.125
2025-02-04 17:09:12.398 DEBUG [src.node.docker_mananger] Generated ports ['46300', '46301', '46302', '46303', '46304']
2025-02-04 17:09:12.398 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-04 17:09:12.398 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-04 17:09:12.399 DEBUG [src.node.waku_node] Using volumes []
2025-02-04 17:09:12.399 DEBUG [src.node.docker_mananger] docker run -i -t -p 46300:46300 -p 46301:46301 -p 46302:46302 -p 46303:46303 -p 46304:46304 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=46302 --rest-port=46300 --tcp-port=46301 --discv5-udp-port=46303 --rest-address=0.0.0.0 --nat=extip:172.18.201.125 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=c369425a2fade46d7d4c2f8b39cceb980acf399986b92f12b0a0fdfaa4d74f2e --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=46304 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QM_EUWWln005D57cnD4Lk3-f5N9snFPwyqyQA1mx5URbMwKugk0VbaE78F6bIuYNatDPRHwxhML33PAu-vjRyVMCgmlkgnY0gmlwhKwSugKKbXVsdGlhZGRyc5YACASsEroCBijjAAoErBK6AgYo5N0DgnJzhQADAQAAiXNlY3AyNTZrMaECJx1OlK2IfxNLiuDyZN184hQvQ6OtzDXB7m9gLhLlayuDdGNwgijjg3VkcIIo5YV3YWt1MgE
2025-02-04 17:09:12.628 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.201.125 waku 2df45b8cd3c85a524ba5082250a51feec1aebf74bb362937753893e992554275
2025-02-04 17:09:12.675 DEBUG [src.node.docker_mananger] Container started with ID 2df45b8cd3c8. Setting up logs at ./log/docker/node2_2025-02-04_17-09-11__98931afc-897c-4789-97be-588b7b90a4d4__wakuorg_nwaku:latest.log
2025-02-04 17:09:12.676 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 46300
2025-02-04 17:09:12.676 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-04 17:09:13.677 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46300/health" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:09:13.682 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-04 17:09:13.684 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-04 17:09:13.684 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46300/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:09:13.692 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.201.125/tcp/46301/p2p/16Uiu2HAmDtXEV1WQW2f2z1kxjes2H2SQxCZETzn67zDuUrBDfzWt","/ip4/172.18.201.125/tcp/46302/ws/p2p/16Uiu2HAmDtXEV1WQW2f2z1kxjes2H2SQxCZETzn67zDuUrBDfzWt"],"enrUri":"enr:-L24QJSHFr0ZM7rfi7Fv2h0VamlpVv97u6cuSnXOShYLxrVsVI_8MWTgtiWirOsV1w8jA_k17rngsbpVADt_T_VbrfkCgmlkgnY0gmlwhKwSyX2KbXVsdGlhZGRyc5YACASsEsl9BrTdAAoErBLJfQa03t0DgnJzhQADAQAAiXNlY3AyNTZrMaEDElMoFQg6n8rdd7DwNlnjB-M92_TbAPzXSxXIBy7vKHmDdGNwgrTdg3VkcIK034V3YWt1MgE"}'
2025-02-04 17:09:13.692 INFO [src.node.waku_node] REST service is ready !!
2025-02-04 17:09:13.692 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46300/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.186.2/tcp/10467/p2p/16Uiu2HAkx4MoKYujccXN7WEyeDDCQuj1QkdGdr912K8F75F8fKVk"]'
2025-02-04 17:09:13.695 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:09:13.695 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-04 17:09:13.696 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:10466/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-04 17:09:13.700 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:09:13.700 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:46300/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-04 17:09:13.706 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:09:13.707 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:10466/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-04 17:09:13.713 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:09:13.714 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-04 17:09:13.814 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-04 17:09:13.814 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:10466/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:09:13.817 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738688953707011584,"ephemeral":false}]'
2025-02-04 17:09:13.819 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-04 17:09:13.819 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46300/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:09:13.822 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738688953707011584,"ephemeral":false}]'
2025-02-04 17:09:13.823 INFO [src.steps.relay] WARM UP successful!!
2025-02-04 17:09:13.824 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:10466/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-04 17:09:13.828 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:09:13.829 DEBUG [src.libs.common] Sleeping for 0.5 seconds
2025-02-04 17:09:14.329 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:46300/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:09:14.332 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1738688953824290304,"ephemeral":false}]'
2025-02-04 17:09:14.332 DEBUG [src.libs.common] Sleeping for 5 seconds
2025-02-04 17:09:19.333 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-04 17:09:19.337 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-04 17:09:19.337 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-04 17:09:19.340 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-04 17:09:19.341 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-04 17:09:19.344 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-04 17:09:19.344 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-04 17:09:19.347 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-04 17:09:19.347 DEBUG [src.steps.metrics] Checking metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} has 1
2025-02-04 17:09:19.350 DEBUG [src.steps.metrics] Found metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} with value 2.0
2025-02-04 17:09:19.351 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-04 17:09:19.354 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-04 17:09:19.354 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-04 17:09:19.357 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 2.0
2025-02-04 17:09:19.357 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-04 17:09:19.360 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 2.0
2025-02-04 17:09:19.360 DEBUG [src.steps.metrics] Checking metric: libp2p_peers has 1
2025-02-04 17:09:19.364 DEBUG [src.steps.metrics] Found metric: libp2p_peers with value 1.0
2025-02-04 17:09:19.364 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_peers has 1
2025-02-04 17:09:19.367 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_peers with value 1.0
2025-02-04 17:09:19.367 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_topics has 1
2025-02-04 17:09:19.370 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_topics with value 2.0
2025-02-04 17:09:19.371 DEBUG [src.steps.metrics] Checking metric: libp2p_pubsub_subscriptions_total has 1
2025-02-04 17:09:19.373 DEBUG [src.steps.metrics] Found metric: libp2p_pubsub_subscriptions_total with value 2.0
2025-02-04 17:09:19.374 DEBUG [src.steps.metrics] Checking metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} has 1
2025-02-04 17:09:19.377 DEBUG [src.steps.metrics] Found metric: libp2p_gossipsub_peers_per_topic_mesh{topic="other"} with value 2.0
2025-02-04 17:09:19.377 DEBUG [src.steps.metrics] Checking metric: waku_peer_store_size has 1
2025-02-04 17:09:19.380 DEBUG [src.steps.metrics] Found metric: waku_peer_store_size with value 1.0
2025-02-04 17:09:19.380 DEBUG [src.steps.metrics] Checking metric: waku_histogram_message_size_count has 1
2025-02-04 17:09:19.383 DEBUG [src.steps.metrics] Found metric: waku_histogram_message_size_count with value 2.0
2025-02-04 17:09:19.383 DEBUG [src.steps.metrics] Checking metric: waku_node_messages_total{type="relay"} has 1
2025-02-04 17:09:19.386 DEBUG [src.steps.metrics] Found metric: waku_node_messages_total{type="relay"} with value 2.0
2025-02-04 17:09:19.389 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-04 17:09:19.390 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-04 17:09:19.390 DEBUG [src.node.waku_node] Stopping container with id c44f3e08db17
2025-02-04 17:09:20.902 DEBUG [src.node.waku_node] Container stopped.
2025-02-04 17:09:20.903 DEBUG [src.node.waku_node] Stopping container with id 2df45b8cd3c8
2025-02-04 17:09:21.715 ERROR [src.node.docker_mananger] Max retries reached for container c44f3e08db17. Exiting log stream.
2025-02-04 17:09:22.392 DEBUG [src.node.waku_node] Container stopped.
2025-02-04 17:09:22.393 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-04 17:09:22.398 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-04 17:09:22.404 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
