2025-02-04 17:12:53.507 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-04 17:12:53.508 DEBUG [tests.conftest] Running test: test_node_uses_both_auto_and_regular_apis with id: 2025-02-04_17-12-53__d0b8f58d-334f-408d-8375-8ae9398def89
2025-02-04 17:12:53.508 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-04 17:12:53.509 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-04 17:12:53.509 DEBUG [src.steps.sharding] Running fixture setup: sharding_setup
2025-02-04 17:12:53.518 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-04 17:12:53.518 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-04_17-12-53__d0b8f58d-334f-408d-8375-8ae9398def89__wakuorg_nwaku:latest.log
2025-02-04 17:12:53.518 DEBUG [src.node.waku_node] Starting Node...
2025-02-04 17:12:53.519 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-04 17:12:53.522 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-04 17:12:53.522 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.67.210
2025-02-04 17:12:53.522 DEBUG [src.node.docker_mananger] Generated ports ['42916', '42917', '42918', '42919', '42920']
2025-02-04 17:12:53.522 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-04 17:12:53.522 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-04 17:12:53.523 DEBUG [src.node.waku_node] Using volumes []
2025-02-04 17:12:53.523 DEBUG [src.node.docker_mananger] docker run -i -t -p 42916:42916 -p 42917:42917 -p 42918:42918 -p 42919:42919 -p 42920:42920 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=42918 --rest-port=42916 --tcp-port=42917 --discv5-udp-port=42919 --rest-address=0.0.0.0 --nat=extip:172.18.67.210 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=e1aad8061c8c4ad15f9ee97386ebb1bd1d8fd55ba3c34eea819aa9f7ddadf7d7 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=42920 --metrics-logging=true --relay=true --filter=true --pubsub-topic=/waku/2/rs/2/0
2025-02-04 17:12:53.744 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.67.210 waku 0c7bf34d3a45ad80ebce35dc272f2093e67cde3693f9c469802201fc234e02f9
2025-02-04 17:12:53.795 DEBUG [src.node.docker_mananger] Container started with ID 0c7bf34d3a45. Setting up logs at ./log/docker/node1_2025-02-04_17-12-53__d0b8f58d-334f-408d-8375-8ae9398def89__wakuorg_nwaku:latest.log
2025-02-04 17:12:53.796 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 42916
2025-02-04 17:12:53.796 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-04 17:12:54.340 ERROR [src.node.docker_mananger] Max retries reached for container 2969c5bbc4b7. Exiting log stream.
2025-02-04 17:12:54.797 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:42916/health" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:54.800 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-04 17:12:54.800 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-04 17:12:54.801 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:42916/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:54.803 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.67.210/tcp/42917/p2p/16Uiu2HAm6EP1Ez76zHwGUQxJG7gXJXN1reBjNubBxnd6nZKDAyvN","/ip4/172.18.67.210/tcp/42918/ws/p2p/16Uiu2HAm6EP1Ez76zHwGUQxJG7gXJXN1reBjNubBxnd6nZKDAyvN"],"enrUri":"enr:-L24QCZUEdeVtD0E0svkHI7C2CEEFEYYnhaCBuxKWEHlOkKkJuT2tDegcR87RrgOvk5tEopqlSg42nKPpiOuuSDLhBECgmlkgnY0gmlwhKwSQ9KKbXVsdGlhZGRyc5YACASsEkPSBqelAAoErBJD0ganpt0DgnJzhQACAQAAiXNlY3AyNTZrMaECoIv5O5VF3h_wFT2p9jUjpM0Ptq9Rp08UIHXzfIfTct-DdGNwgqelg3VkcIKnp4V3YWt1MgU"}'
2025-02-04 17:12:54.803 INFO [src.node.waku_node] REST service is ready !!
2025-02-04 17:12:54.809 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-04 17:12:54.810 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-04_17-12-53__d0b8f58d-334f-408d-8375-8ae9398def89__wakuorg_nwaku:latest.log
2025-02-04 17:12:54.810 DEBUG [src.node.waku_node] Starting Node...
2025-02-04 17:12:54.810 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-04 17:12:54.811 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-04 17:12:54.811 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.222.224
2025-02-04 17:12:54.811 DEBUG [src.node.docker_mananger] Generated ports ['38833', '38834', '38835', '38836', '38837']
2025-02-04 17:12:54.811 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-04 17:12:54.812 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-04 17:12:54.812 DEBUG [src.node.waku_node] Using volumes []
2025-02-04 17:12:54.812 DEBUG [src.node.docker_mananger] docker run -i -t -p 38833:38833 -p 38834:38834 -p 38835:38835 -p 38836:38836 -p 38837:38837 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=38835 --rest-port=38833 --tcp-port=38834 --discv5-udp-port=38836 --rest-address=0.0.0.0 --nat=extip:172.18.222.224 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=51a3a8bdddfb324def1f060efb2be0feebba637ae6ba7ffc3f76ac7efae84bbb --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=38837 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QCZUEdeVtD0E0svkHI7C2CEEFEYYnhaCBuxKWEHlOkKkJuT2tDegcR87RrgOvk5tEopqlSg42nKPpiOuuSDLhBECgmlkgnY0gmlwhKwSQ9KKbXVsdGlhZGRyc5YACASsEkPSBqelAAoErBJD0ganpt0DgnJzhQACAQAAiXNlY3AyNTZrMaECoIv5O5VF3h_wFT2p9jUjpM0Ptq9Rp08UIHXzfIfTct-DdGNwgqelg3VkcIKnp4V3YWt1MgU --pubsub-topic=/waku/2/rs/2/0
2025-02-04 17:12:55.035 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.222.224 waku f3c610367bc36d91b6e5c3bcd21add77cdff6022c9e8d8165f488bd00c2c7f3d
2025-02-04 17:12:55.081 DEBUG [src.node.docker_mananger] Container started with ID f3c610367bc3. Setting up logs at ./log/docker/node2_2025-02-04_17-12-53__d0b8f58d-334f-408d-8375-8ae9398def89__wakuorg_nwaku:latest.log
2025-02-04 17:12:55.081 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 38833
2025-02-04 17:12:55.081 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-04 17:12:56.083 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:38833/health" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:56.094 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-04 17:12:56.094 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-04 17:12:56.094 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:38833/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:56.102 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.222.224/tcp/38834/p2p/16Uiu2HAmGzAkyMagWF1PBDmCoWm9iuYQfNY4HLRSFHt6fRF2BYhX","/ip4/172.18.222.224/tcp/38835/ws/p2p/16Uiu2HAmGzAkyMagWF1PBDmCoWm9iuYQfNY4HLRSFHt6fRF2BYhX"],"enrUri":"enr:-L24QPENpdZPDniD9sFuDKfbum1cDRE8l9H7SHm7UkRz-ubAakQgFG1NSFr32k6AH18oq1s0-kYy99wlEI8WcZszW0ECgmlkgnY0gmlwhKwS3uCKbXVsdGlhZGRyc5YACASsEt7gBpeyAAoErBLe4AaXs90DgnJzhQACAQAAiXNlY3AyNTZrMaEDQFiNQvd8BEnQn18QdT8qTb6uSc5YBehD1CjPedP5GeqDdGNwgpeyg3VkcIKXtIV3YWt1MgE"}'
2025-02-04 17:12:56.103 INFO [src.node.waku_node] REST service is ready !!
2025-02-04 17:12:56.104 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:38833/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.67.210/tcp/42917/p2p/16Uiu2HAm6EP1Ez76zHwGUQxJG7gXJXN1reBjNubBxnd6nZKDAyvN"]'
2025-02-04 17:12:56.108 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:56.109 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:42916/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2025-02-04 17:12:56.114 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:56.115 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:38833/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2025-02-04 17:12:56.119 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:56.120 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:42916/relay/v1/auto/messages" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/toychat/2/huilong/proto", "timestamp": '$(date +%s%N)'}'
2025-02-04 17:12:56.126 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:56.127 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-04 17:12:56.228 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-04 17:12:56.228 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:42916/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:56.230 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1738689176120586752,"ephemeral":false}]'
2025-02-04 17:12:56.231 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-04 17:12:56.232 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:38833/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:56.234 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1738689176120586752,"ephemeral":false}]'
2025-02-04 17:12:56.235 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:42916/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2025-02-04 17:12:56.238 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:56.238 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:38833/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2025-02-04 17:12:56.240 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:56.240 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:42916/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2025-02-04 17:12:56.245 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:56.246 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-04 17:12:56.346 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-04 17:12:56.347 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:42916/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:56.349 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1738689176240753664,"ephemeral":false}]'
2025-02-04 17:12:56.350 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-04 17:12:56.351 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:38833/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:56.353 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1738689176240753664,"ephemeral":false}]'
2025-02-04 17:12:56.355 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-04 17:12:56.356 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-04 17:12:56.356 DEBUG [src.node.waku_node] Stopping container with id 0c7bf34d3a45
2025-02-04 17:12:57.268 DEBUG [src.node.waku_node] Container stopped.
2025-02-04 17:12:57.269 DEBUG [src.node.waku_node] Stopping container with id f3c610367bc3
2025-02-04 17:12:58.096 ERROR [src.node.docker_mananger] Max retries reached for container 0c7bf34d3a45. Exiting log stream.
2025-02-04 17:12:58.783 DEBUG [src.node.waku_node] Container stopped.
2025-02-04 17:12:58.785 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-04 17:12:58.794 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-04 17:12:58.800 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
