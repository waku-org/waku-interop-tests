2025-02-04 17:12:37.074 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-04 17:12:37.074 DEBUG [tests.conftest] Running test: test_filter_get_message_with_ephemeral with id: 2025-02-04_17-12-37__7e2ef60f-e735-4624-b7cd-e3af53a51907
2025-02-04 17:12:37.074 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-04 17:12:37.075 DEBUG [src.steps.filter] Running fixture setup: filter_setup
2025-02-04 17:12:37.075 DEBUG [src.steps.filter] Running fixture setup: setup_main_relay_node
2025-02-04 17:12:37.081 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-04 17:12:37.081 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-04_17-12-37__7e2ef60f-e735-4624-b7cd-e3af53a51907__wakuorg_nwaku:latest.log
2025-02-04 17:12:37.082 DEBUG [src.node.waku_node] Starting Node...
2025-02-04 17:12:37.082 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-04 17:12:37.083 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-04 17:12:37.083 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.134.196
2025-02-04 17:12:37.083 DEBUG [src.node.docker_mananger] Generated ports ['31646', '31647', '31648', '31649', '31650']
2025-02-04 17:12:37.084 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-04 17:12:37.084 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-04 17:12:37.084 DEBUG [src.node.waku_node] Using volumes []
2025-02-04 17:12:37.084 DEBUG [src.node.docker_mananger] docker run -i -t -p 31646:31646 -p 31647:31647 -p 31648:31648 -p 31649:31649 -p 31650:31650 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=31648 --rest-port=31646 --tcp-port=31647 --discv5-udp-port=31649 --rest-address=0.0.0.0 --nat=extip:172.18.134.196 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=f0ab6b785f4fa17cdeb12bfc327ea554c0a52611eb93dac0bf8d4dcf0e5250ff --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=31650 --metrics-logging=true --relay=true --filter=true
2025-02-04 17:12:37.320 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.134.196 waku 6bfd1e3dea6a97f40f8ee1d1d006ec343e9d9140b686981d24f4f8390f426df7
2025-02-04 17:12:37.369 DEBUG [src.node.docker_mananger] Container started with ID 6bfd1e3dea6a. Setting up logs at ./log/docker/node1_2025-02-04_17-12-37__7e2ef60f-e735-4624-b7cd-e3af53a51907__wakuorg_nwaku:latest.log
2025-02-04 17:12:37.370 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 31646
2025-02-04 17:12:37.371 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-04 17:12:37.526 ERROR [src.node.docker_mananger] Max retries reached for container c5e8f8bb2967. Exiting log stream.
2025-02-04 17:12:38.371 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31646/health" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:38.375 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-04 17:12:38.375 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-04 17:12:38.375 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:31646/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:38.377 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.134.196/tcp/31647/p2p/16Uiu2HAmBaCfkUQbsmnyUTgBzsbTBn9UKrKGMuMN9nrZtatDRHz8","/ip4/172.18.134.196/tcp/31648/ws/p2p/16Uiu2HAmBaCfkUQbsmnyUTgBzsbTBn9UKrKGMuMN9nrZtatDRHz8"],"enrUri":"enr:-L24QDgta32H45vg_c0cZe7okSM7u6Pl6g0Tly80McJcWmU_evPiO0ez2FA32vN8cTVTfUFa7xaoBh-Anl_2yAOheWcCgmlkgnY0gmlwhKwShsSKbXVsdGlhZGRyc5YACASsEobEBnufAAoErBKGxAZ7oN0DgnJzhQADAQAAiXNlY3AyNTZrMaEC7-pWXPtpb4Vwn6x0KvD_PF5EtfWwiHwaVolRdykYYlGDdGNwgnufg3VkcIJ7oYV3YWt1MgU"}'
2025-02-04 17:12:38.378 INFO [src.node.waku_node] REST service is ready !!
2025-02-04 17:12:38.378 DEBUG [src.steps.filter] Running fixture setup: setup_main_filter_node
2025-02-04 17:12:38.385 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-04 17:12:38.385 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-04_17-12-37__7e2ef60f-e735-4624-b7cd-e3af53a51907__wakuorg_nwaku:latest.log
2025-02-04 17:12:38.385 DEBUG [src.node.waku_node] Starting Node...
2025-02-04 17:12:38.385 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-04 17:12:38.387 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-04 17:12:38.387 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.220.249
2025-02-04 17:12:38.387 DEBUG [src.node.docker_mananger] Generated ports ['12199', '12200', '12201', '12202', '12203']
2025-02-04 17:12:38.387 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-04 17:12:38.387 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-04 17:12:38.387 DEBUG [src.node.waku_node] Using volumes []
2025-02-04 17:12:38.388 DEBUG [src.node.docker_mananger] docker run -i -t -p 12199:12199 -p 12200:12200 -p 12201:12201 -p 12202:12202 -p 12203:12203 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=12201 --rest-port=12199 --tcp-port=12200 --discv5-udp-port=12202 --rest-address=0.0.0.0 --nat=extip:172.18.220.249 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=7b8c3cd75fc3fb22ceb9c500d973955faf7c36d307f603aac223c5253bbc8ad6 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=12203 --metrics-logging=true --relay=false --discv5-bootstrap-node=enr:-L24QDgta32H45vg_c0cZe7okSM7u6Pl6g0Tly80McJcWmU_evPiO0ez2FA32vN8cTVTfUFa7xaoBh-Anl_2yAOheWcCgmlkgnY0gmlwhKwShsSKbXVsdGlhZGRyc5YACASsEobEBnufAAoErBKGxAZ7oN0DgnJzhQADAQAAiXNlY3AyNTZrMaEC7-pWXPtpb4Vwn6x0KvD_PF5EtfWwiHwaVolRdykYYlGDdGNwgnufg3VkcIJ7oYV3YWt1MgU --filternode=/ip4/172.18.134.196/tcp/31647/p2p/16Uiu2HAmBaCfkUQbsmnyUTgBzsbTBn9UKrKGMuMN9nrZtatDRHz8
2025-02-04 17:12:38.633 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.220.249 waku 77c33ce5710cd544a0eff3e02fab62f4bca9b2c4a7be33ca829f17c10a392f40
2025-02-04 17:12:38.684 DEBUG [src.node.docker_mananger] Container started with ID 77c33ce5710c. Setting up logs at ./log/docker/node2_2025-02-04_17-12-37__7e2ef60f-e735-4624-b7cd-e3af53a51907__wakuorg_nwaku:latest.log
2025-02-04 17:12:38.684 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 12199
2025-02-04 17:12:38.685 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-04 17:12:39.686 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:12199/health" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:39.689 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-04 17:12:39.690 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-04 17:12:39.690 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:12199/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:39.692 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.220.249/tcp/12200/p2p/16Uiu2HAm1qrkGHv4vTjmcHYDeYy9E2HA5uV6hbUBTsVdMvbQe4Qu","/ip4/172.18.220.249/tcp/12201/ws/p2p/16Uiu2HAm1qrkGHv4vTjmcHYDeYy9E2HA5uV6hbUBTsVdMvbQe4Qu"],"enrUri":"enr:-L24QLb74rh7knArDan0f7lbTacH779NJLpmk6WCOUrXr65uGcIQDIVvYRf27QmOJIZm4PWkH-coisLf8HODAjhl4EACgmlkgnY0gmlwhKwS3PmKbXVsdGlhZGRyc5YACASsEtz5Bi-oAAoErBLc-QYvqd0DgnJzhQADAQAAiXNlY3AyNTZrMaECX1g8JuAtt2duF71HoaqHbtlBSH2NWfRWhiTtD1mKUY6DdGNwgi-og3VkcIIvqoV3YWt1MgA"}'
2025-02-04 17:12:39.692 INFO [src.node.waku_node] REST service is ready !!
2025-02-04 17:12:39.693 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:12199/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.134.196/tcp/31647/p2p/16Uiu2HAmBaCfkUQbsmnyUTgBzsbTBn9UKrKGMuMN9nrZtatDRHz8"]'
2025-02-04 17:12:39.729 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:39.731 DEBUG [src.steps.filter] Running fixture setup: subscribe_main_nodes
2025-02-04 17:12:39.731 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31646/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-04 17:12:39.752 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:39.754 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:12199/filter/v2/subscriptions" -H "Content-Type: application/json" -d '{"requestId": "b2943176-23e5-4bbc-9a51-699840c7a402", "contentFilters": ["/test/1/waku-filter/proto"], "pubsubTopic": "/waku/2/rs/3/1"}'
2025-02-04 17:12:39.767 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"b2943176-23e5-4bbc-9a51-699840c7a402","statusDesc":"OK"}'
2025-02-04 17:12:39.768 DEBUG [tests.filter.test_get_messages] Running test with Ephemeral True
2025-02-04 17:12:39.769 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31646/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "RmlsdGVyIHdvcmtzISE=", "contentTopic": "/test/1/waku-filter/proto", "timestamp": '$(date +%s%N)', "ephemeral": true}'
2025-02-04 17:12:39.776 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:39.776 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-04 17:12:39.877 DEBUG [src.steps.filter] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-04 17:12:39.877 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:12199/filter/v2/messages/%2Ftest%2F1%2Fwaku-filter%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:39.881 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"RmlsdGVyIHdvcmtzISE=","contentTopic":"/test/1/waku-filter/proto","version":0,"timestamp":1738689159769048320,"ephemeral":true}]'
2025-02-04 17:12:39.882 DEBUG [tests.filter.test_get_messages] Running test with Ephemeral False
2025-02-04 17:12:39.882 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:31646/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "RmlsdGVyIHdvcmtzISE=", "contentTopic": "/test/1/waku-filter/proto", "timestamp": '$(date +%s%N)', "ephemeral": false}'
2025-02-04 17:12:39.887 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-04 17:12:39.887 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-04 17:12:39.987 DEBUG [src.steps.filter] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-04 17:12:39.988 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:12199/filter/v2/messages/%2Ftest%2F1%2Fwaku-filter%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-04 17:12:39.991 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"RmlsdGVyIHdvcmtzISE=","contentTopic":"/test/1/waku-filter/proto","version":0,"timestamp":1738689159882800640,"ephemeral":false}]'
2025-02-04 17:12:39.994 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-04 17:12:39.995 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-04 17:12:39.995 DEBUG [src.node.waku_node] Stopping container with id 6bfd1e3dea6a
2025-02-04 17:12:40.859 DEBUG [src.node.waku_node] Container stopped.
2025-02-04 17:12:40.859 DEBUG [src.node.waku_node] Stopping container with id 77c33ce5710c
2025-02-04 17:12:41.664 DEBUG [src.node.waku_node] Container stopped.
2025-02-04 17:12:41.666 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-04 17:12:41.671 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-04 17:12:41.676 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-04 17:12:41.677 ERROR [src.node.docker_mananger] Max retries reached for container 6bfd1e3dea6a. Exiting log stream.
