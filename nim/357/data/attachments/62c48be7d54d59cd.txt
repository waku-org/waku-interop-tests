[35mDEBUG   [0m tests.conftest:conftest.py:51 Running fixture setup: test_id
[35mDEBUG   [0m tests.conftest:conftest.py:57 Running test: test_metrics_after_filter_get with id: 2024-09-12_04-24-12__7c542dce-47dc-4f00-b968-e87e71b17cf6
[35mDEBUG   [0m src.steps.common:common.py:17 Running fixture setup: common_setup
[35mDEBUG   [0m src.steps.filter:filter.py:28 Running fixture setup: filter_setup
[35mDEBUG   [0m src.steps.light_push:light_push.py:27 Running fixture setup: light_push_setup
[35mDEBUG   [0m src.steps.relay:relay.py:28 Running fixture setup: relay_setup
[35mDEBUG   [0m src.steps.store:store.py:28 Running fixture setup: store_setup
[35mDEBUG   [0m src.steps.filter:filter.py:34 Running fixture setup: setup_main_relay_node
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:18 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:85 WakuNode instance initialized with log path ./log/docker/node1_2024-09-12_04-24-12__7c542dce-47dc-4f00-b968-e87e71b17cf6__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:21 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:24 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:81 Generated random external IP 172.18.237.199
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:74 Generated ports ['14033', '14034', '14035', '14036', '14037']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:434 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:163 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:165 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:48 docker run -i -t -p 14033:14033 -p 14034:14034 -p 14035:14035 -p 14036:14036 -p 14037:14037 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=14035 --rest-port=14033 --tcp-port=14034 --discv5-udp-port=14036 --rest-address=0.0.0.0 --nat=extip:172.18.237.199 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=8cbfbf9cfabd8f7d0e6aab87fe0eacab7671cace153fb208e001fa9af68d62d7 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=14037 --metrics-logging=true --relay=true --filter=true
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:54 docker network connect --ip 172.18.237.199 waku 06c1dd52bd716cbc739c528dff081c28acf8906d4810a7a57082e219c79710e9
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:57 Container started with ID 06c1dd52bd71. Setting up logs at ./log/docker/node1_2024-09-12_04-24-12__7c542dce-47dc-4f00-b968-e87e71b17cf6__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:177 Started container from image wakuorg/nwaku:latest. REST: 14033
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:14033/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:277 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:14033/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.237.199/tcp/14034/p2p/16Uiu2HAmQd2dG2fnRzW9qbhuZd7xTJgrXnKFEb9h4wM8MbUR59Hx","/ip4/172.18.237.199/tcp/14035/ws/p2p/16Uiu2HAmQd2dG2fnRzW9qbhuZd7xTJgrXnKFEb9h4wM8MbUR59Hx"],"enrUri":"enr:-LO4QHvWm1dfVjT8Ly82ahS1xXBs40-Ynhs2o9aUCkRBqeWsACO7lU2QzSs6q5F4uH7XRQTof0ZjB4LbB9uy0oDfhxkBgmlkgnY0gmlwhKwS7ceKbXVsdGlhZGRyc4wACgSsEu3HBjbT3QOCcnOFAAMBAACJc2VjcDI1NmsxoQOxy6d8QkWCJm8g9x5NswvTlC5kZG6IWzjyicSEDiYcd4N0Y3CCNtKDdWRwgjbUhXdha3UyBQ"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:282 REST service is ready !!
[35mDEBUG   [0m src.steps.filter:filter.py:39 Running fixture setup: setup_main_filter_node
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:18 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:85 WakuNode instance initialized with log path ./log/docker/node2_2024-09-12_04-24-12__7c542dce-47dc-4f00-b968-e87e71b17cf6__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:21 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:24 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:81 Generated random external IP 172.18.125.42
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:74 Generated ports ['35775', '35776', '35777', '35778', '35779']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:434 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:163 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:165 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:48 docker run -i -t -p 35775:35775 -p 35776:35776 -p 35777:35777 -p 35778:35778 -p 35779:35779 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=35777 --rest-port=35775 --tcp-port=35776 --discv5-udp-port=35778 --rest-address=0.0.0.0 --nat=extip:172.18.125.42 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=2a37cdf64cbbd5d97eccb2fe2b1e5ea01f4f7fdbdeec39c54fbacca0c6fbf7d5 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=35779 --metrics-logging=true --relay=false --discv5-bootstrap-node=enr:-LO4QHvWm1dfVjT8Ly82ahS1xXBs40-Ynhs2o9aUCkRBqeWsACO7lU2QzSs6q5F4uH7XRQTof0ZjB4LbB9uy0oDfhxkBgmlkgnY0gmlwhKwS7ceKbXVsdGlhZGRyc4wACgSsEu3HBjbT3QOCcnOFAAMBAACJc2VjcDI1NmsxoQOxy6d8QkWCJm8g9x5NswvTlC5kZG6IWzjyicSEDiYcd4N0Y3CCNtKDdWRwgjbUhXdha3UyBQ --filternode=/ip4/172.18.237.199/tcp/14034/p2p/16Uiu2HAmQd2dG2fnRzW9qbhuZd7xTJgrXnKFEb9h4wM8MbUR59Hx
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:54 docker network connect --ip 172.18.125.42 waku 46c1bd6aa87f7c0c212b767a3b98fe3d2949a68a65cd0d268f80892fa2954b49
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:57 Container started with ID 46c1bd6aa87f. Setting up logs at ./log/docker/node2_2024-09-12_04-24-12__7c542dce-47dc-4f00-b968-e87e71b17cf6__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:177 Started container from image wakuorg/nwaku:latest. REST: 35775
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:35775/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:277 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:35775/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.125.42/tcp/35776/p2p/16Uiu2HAkwMLuPFoQ7fezahRFNGknK63FNefGLaybeVVLqErLzC53","/ip4/172.18.125.42/tcp/35777/ws/p2p/16Uiu2HAkwMLuPFoQ7fezahRFNGknK63FNefGLaybeVVLqErLzC53"],"enrUri":"enr:-LO4QH3fpAp8o1xdnrPVYAFoRPCpcM_QxWh2GY3EnWaBxYHtfqwoz7-58dPjK3PZyaOrMQibq70CP11eCwIpsGATEuQBgmlkgnY0gmlwhKwSfSqKbXVsdGlhZGRyc4wACgSsEn0qBovB3QOCcnOFAAMBAACJc2VjcDI1NmsxoQIcm3s2KEhotRf6ImZ17Kp00_H0UwfxyM3BinXXok4sboN0Y3CCi8CDdWRwgovChXdha3UyAA"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:282 REST service is ready !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:35775/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.237.199/tcp/14034/p2p/16Uiu2HAmQd2dG2fnRzW9qbhuZd7xTJgrXnKFEb9h4wM8MbUR59Hx"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.steps.filter:filter.py:47 Running fixture setup: subscribe_main_nodes
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:14033/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:35775/filter/v2/subscriptions" -H "Content-Type: application/json" -d '{"requestId": "cabacc2c-6bf1-459d-9352-12fdeb53d179", "contentFilters": ["/test/1/waku-relay/proto"], "pubsubTopic": "/waku/2/rs/3/1"}'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"requestId":"cabacc2c-6bf1-459d-9352-12fdeb53d179","statusDesc":"OK"}'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:14033/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 0.5 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:35775/filter/v2/messages/%2Ftest%2F1%2Fwaku-relay%2Fproto" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1726115056644921856,"ephemeral":false}]'
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 5 seconds
[35mDEBUG   [0m src.steps.metrics:metrics.py:15 Checking metric: libp2p_peers has 1
[35mDEBUG   [0m src.steps.metrics:metrics.py:27 Found metric: libp2p_peers with value 1.0
[35mDEBUG   [0m src.steps.metrics:metrics.py:15 Checking metric: libp2p_pubsub_peers has 1
[35mDEBUG   [0m src.steps.metrics:metrics.py:27 Found metric: libp2p_pubsub_peers with value 1.0
[35mDEBUG   [0m src.steps.metrics:metrics.py:15 Checking metric: libp2p_pubsub_topics has 1
[35mDEBUG   [0m src.steps.metrics:metrics.py:27 Found metric: libp2p_pubsub_topics with value 2.0
[35mDEBUG   [0m src.steps.metrics:metrics.py:15 Checking metric: libp2p_pubsub_subscriptions_total has 1
[35mDEBUG   [0m src.steps.metrics:metrics.py:27 Found metric: libp2p_pubsub_subscriptions_total with value 2.0
[35mDEBUG   [0m src.steps.metrics:metrics.py:15 Checking metric: waku_peer_store_size has 1
[35mDEBUG   [0m src.steps.metrics:metrics.py:27 Found metric: waku_peer_store_size with value 1.0
[35mDEBUG   [0m src.steps.metrics:metrics.py:15 Checking metric: waku_histogram_message_size_count has 1
[35mDEBUG   [0m src.steps.metrics:metrics.py:27 Found metric: waku_histogram_message_size_count with value 1.0
[35mDEBUG   [0m src.steps.metrics:metrics.py:15 Checking metric: waku_node_messages_total{type="relay"} has 1
[35mDEBUG   [0m src.steps.metrics:metrics.py:27 Found metric: waku_node_messages_total{type="relay"} with value 1.0
[35mDEBUG   [0m src.steps.metrics:metrics.py:15 Checking metric: waku_filter_requests{type="SUBSCRIBE"} has 1
[35mDEBUG   [0m src.steps.metrics:metrics.py:27 Found metric: waku_filter_requests{type="SUBSCRIBE"} with value 1.0
[35mDEBUG   [0m src.steps.metrics:metrics.py:15 Checking metric: waku_service_peers{protocol="/vac/waku/filter-subscribe/2.0.0-beta1",peerId="/ip4/172.18.237.199/tcp/14034"} has 1
[35mDEBUG   [0m src.steps.metrics:metrics.py:27 Found metric: waku_service_peers{protocol="/vac/waku/filter-subscribe/2.0.0-beta1",peerId="/ip4/172.18.237.199/tcp/14034"} with value 1.0
[35mDEBUG   [0m src.steps.metrics:metrics.py:15 Checking metric: libp2p_peers has 1
[35mDEBUG   [0m src.steps.metrics:metrics.py:27 Found metric: libp2p_peers with value 1.0
[35mDEBUG   [0m src.steps.metrics:metrics.py:15 Checking metric: libp2p_total_dial_attempts_total has 1
[35mDEBUG   [0m src.steps.metrics:metrics.py:27 Found metric: libp2p_total_dial_attempts_total with value 1.0
[35mDEBUG   [0m src.steps.metrics:metrics.py:15 Checking metric: waku_peer_store_size has 1
[35mDEBUG   [0m src.steps.metrics:metrics.py:27 Found metric: waku_peer_store_size with value 1.0
[35mDEBUG   [0m tests.conftest:conftest.py:59 Running fixture teardown: test_setup
[35mDEBUG   [0m tests.conftest:conftest.py:83 Running fixture teardown: close_open_nodes
[35mDEBUG   [0m src.node.waku_node:waku_node.py:221 Stopping container with id 06c1dd52bd71
[35mDEBUG   [0m src.node.waku_node:waku_node.py:228 Container stopped.
[35mDEBUG   [0m src.node.waku_node:waku_node.py:221 Stopping container with id 46c1bd6aa87f
[35mDEBUG   [0m src.node.waku_node:waku_node.py:228 Container stopped.
[35mDEBUG   [0m tests.conftest:conftest.py:98 Running fixture teardown: check_waku_log_errors
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:117 No errors found in the waku logs.
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:117 No errors found in the waku logs.