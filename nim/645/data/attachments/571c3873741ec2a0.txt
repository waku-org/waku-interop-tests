2025-02-09 04:06:44.720 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-09 04:06:44.720 DEBUG [tests.conftest] Running test: test_node_uses_both_auto_and_regular_apis with id: 2025-02-09_04-06-44__cb8271d7-b867-42ff-95ce-95e6564d59f7
2025-02-09 04:06:44.721 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-09 04:06:44.721 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-09 04:06:44.721 DEBUG [src.steps.sharding] Running fixture setup: sharding_setup
2025-02-09 04:06:44.728 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-09 04:06:44.728 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-09_04-06-44__cb8271d7-b867-42ff-95ce-95e6564d59f7__wakuorg_nwaku:latest.log
2025-02-09 04:06:44.728 DEBUG [src.node.waku_node] Starting Node...
2025-02-09 04:06:44.728 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-09 04:06:44.730 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-09 04:06:44.730 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.98.77
2025-02-09 04:06:44.730 DEBUG [src.node.docker_mananger] Generated ports ['47764', '47765', '47766', '47767', '47768']
2025-02-09 04:06:44.731 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-09 04:06:44.731 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-09 04:06:44.731 DEBUG [src.node.waku_node] Using volumes []
2025-02-09 04:06:44.731 DEBUG [src.node.docker_mananger] docker run -i -t -p 47764:47764 -p 47765:47765 -p 47766:47766 -p 47767:47767 -p 47768:47768 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=47766 --rest-port=47764 --tcp-port=47765 --discv5-udp-port=47767 --rest-address=0.0.0.0 --nat=extip:172.18.98.77 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=60268cb0461872d89e8a0bbe5f6d54ab9bd7f140dd7bcab1d94ea8dccdb7caae --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=47768 --metrics-logging=true --relay=true --filter=true --pubsub-topic=/waku/2/rs/2/0
2025-02-09 04:06:44.963 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.98.77 waku 829b2259e20942a4f887483663c5c3d925f57525b1f86d87957e1f861d241fca
2025-02-09 04:06:45.011 DEBUG [src.node.docker_mananger] Container started with ID 829b2259e209. Setting up logs at ./log/docker/node1_2025-02-09_04-06-44__cb8271d7-b867-42ff-95ce-95e6564d59f7__wakuorg_nwaku:latest.log
2025-02-09 04:06:45.012 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 47764
2025-02-09 04:06:45.012 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-09 04:06:45.523 ERROR [src.node.docker_mananger] Max retries reached for container 8377993886b1. Exiting log stream.
2025-02-09 04:06:46.013 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:47764/health" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:06:46.017 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-09 04:06:46.017 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-09 04:06:46.017 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:47764/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:06:46.019 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.98.77/tcp/47765/p2p/16Uiu2HAmEJFRuK5fE6j936pg8iCXx4QDreMxjNipkb6jUgXsVgrJ","/ip4/172.18.98.77/tcp/47766/ws/p2p/16Uiu2HAmEJFRuK5fE6j936pg8iCXx4QDreMxjNipkb6jUgXsVgrJ"],"enrUri":"enr:-L24QMf0U8n3uqnMhJWhXlnfr0B75mpdPoedPR3HK-cEwSTUPO5zgkMBan4lu_BHLEOCPScD9XY8AuvYMPWy4eeidKECgmlkgnY0gmlwhKwSYk2KbXVsdGlhZGRyc5YACASsEmJNBrqVAAoErBJiTQa6lt0DgnJzhQACAQAAiXNlY3AyNTZrMaEDGGc6My97XQ3MEAYABe9Le1WY5gwXpOcp3JZMdkLDaSeDdGNwgrqVg3VkcIK6l4V3YWt1MgU"}'
2025-02-09 04:06:46.019 INFO [src.node.waku_node] REST service is ready !!
2025-02-09 04:06:46.026 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-09 04:06:46.026 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-09_04-06-44__cb8271d7-b867-42ff-95ce-95e6564d59f7__wakuorg_nwaku:latest.log
2025-02-09 04:06:46.027 DEBUG [src.node.waku_node] Starting Node...
2025-02-09 04:06:46.027 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-09 04:06:46.028 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-09 04:06:46.028 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.44.233
2025-02-09 04:06:46.028 DEBUG [src.node.docker_mananger] Generated ports ['22824', '22825', '22826', '22827', '22828']
2025-02-09 04:06:46.029 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-09 04:06:46.029 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-09 04:06:46.029 DEBUG [src.node.waku_node] Using volumes []
2025-02-09 04:06:46.029 DEBUG [src.node.docker_mananger] docker run -i -t -p 22824:22824 -p 22825:22825 -p 22826:22826 -p 22827:22827 -p 22828:22828 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=22826 --rest-port=22824 --tcp-port=22825 --discv5-udp-port=22827 --rest-address=0.0.0.0 --nat=extip:172.18.44.233 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=faaee5a4bc95fbdbfcc3add48e7eeefa92be6f9dee4f3ca2efc3b49e94c57dfc --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=22828 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QMf0U8n3uqnMhJWhXlnfr0B75mpdPoedPR3HK-cEwSTUPO5zgkMBan4lu_BHLEOCPScD9XY8AuvYMPWy4eeidKECgmlkgnY0gmlwhKwSYk2KbXVsdGlhZGRyc5YACASsEmJNBrqVAAoErBJiTQa6lt0DgnJzhQACAQAAiXNlY3AyNTZrMaEDGGc6My97XQ3MEAYABe9Le1WY5gwXpOcp3JZMdkLDaSeDdGNwgrqVg3VkcIK6l4V3YWt1MgU --pubsub-topic=/waku/2/rs/2/0
2025-02-09 04:06:46.255 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.44.233 waku 6585f5f12c5e3bea94512ebc87dc829db4b29de30b571416188bd0199749c12c
2025-02-09 04:06:46.306 DEBUG [src.node.docker_mananger] Container started with ID 6585f5f12c5e. Setting up logs at ./log/docker/node2_2025-02-09_04-06-44__cb8271d7-b867-42ff-95ce-95e6564d59f7__wakuorg_nwaku:latest.log
2025-02-09 04:06:46.307 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 22824
2025-02-09 04:06:46.307 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-09 04:06:47.307 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22824/health" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:06:47.318 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-09 04:06:47.318 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-09 04:06:47.320 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22824/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:06:47.327 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.44.233/tcp/22825/p2p/16Uiu2HAm7B6VN86CXMMMoDRUqfuciyzTS2EmzNZvyorRCGV23nge","/ip4/172.18.44.233/tcp/22826/ws/p2p/16Uiu2HAm7B6VN86CXMMMoDRUqfuciyzTS2EmzNZvyorRCGV23nge"],"enrUri":"enr:-L24QF76VxG3T2kb978IBIc2ZVRsecEt4XuJ4S2lZD3MdXEUX0ai_qhnSLlyp_4wAdZj0UH9L8Wyr9fQysnrOILY0ooCgmlkgnY0gmlwhKwSLOmKbXVsdGlhZGRyc5YACASsEizpBlkpAAoErBIs6QZZKt0DgnJzhQACAQAAiXNlY3AyNTZrMaECrpA-jlRhf34GCEDuHhgOfpdEL10X4R38OB0nk2ovIm-DdGNwglkpg3VkcIJZK4V3YWt1MgE"}'
2025-02-09 04:06:47.327 INFO [src.node.waku_node] REST service is ready !!
2025-02-09 04:06:47.328 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:22824/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.98.77/tcp/47765/p2p/16Uiu2HAmEJFRuK5fE6j936pg8iCXx4QDreMxjNipkb6jUgXsVgrJ"]'
2025-02-09 04:06:47.331 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:06:47.331 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:47764/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2025-02-09 04:06:47.335 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:06:47.336 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:22824/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2025-02-09 04:06:47.340 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:06:47.341 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:47764/relay/v1/auto/messages" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/toychat/2/huilong/proto", "timestamp": '$(date +%s%N)'}'
2025-02-09 04:06:47.347 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:06:47.348 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-09 04:06:47.448 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-09 04:06:47.449 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:47764/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:06:47.452 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1739074007341446144,"ephemeral":false}]'
2025-02-09 04:06:47.453 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-09 04:06:47.454 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22824/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:06:47.456 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1739074007341446144,"ephemeral":false}]'
2025-02-09 04:06:47.458 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:47764/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2025-02-09 04:06:47.460 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:06:47.460 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:22824/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2025-02-09 04:06:47.462 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:06:47.463 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:47764/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2025-02-09 04:06:47.467 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:06:47.468 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-09 04:06:47.568 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-09 04:06:47.569 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:47764/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:06:47.571 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1739074007463346944,"ephemeral":false}]'
2025-02-09 04:06:47.573 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-09 04:06:47.573 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:22824/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:06:47.576 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1739074007463346944,"ephemeral":false}]'
2025-02-09 04:06:47.578 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-09 04:06:47.579 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-09 04:06:47.579 DEBUG [src.node.waku_node] Stopping container with id 829b2259e209
2025-02-09 04:06:48.187 DEBUG [src.node.waku_node] Container stopped.
2025-02-09 04:06:48.187 DEBUG [src.node.waku_node] Stopping container with id 6585f5f12c5e
2025-02-09 04:06:49.018 ERROR [src.node.docker_mananger] Max retries reached for container 829b2259e209. Exiting log stream.
2025-02-09 04:06:49.317 DEBUG [src.node.waku_node] Container stopped.
2025-02-09 04:06:49.319 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-09 04:06:49.328 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-09 04:06:49.333 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
