2025-02-09 04:04:35.350 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-09 04:04:35.350 DEBUG [tests.conftest] Running test: test_publish_with_ephemeral with id: 2025-02-09_04-04-35__36468e35-818f-4591-a2ce-36fdf8c284ee
2025-02-09 04:04:35.350 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-09 04:04:35.351 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-09 04:04:35.351 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-09 04:04:35.357 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-09 04:04:35.357 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-09_04-04-35__36468e35-818f-4591-a2ce-36fdf8c284ee__wakuorg_nwaku:latest.log
2025-02-09 04:04:35.357 DEBUG [src.node.waku_node] Starting Node...
2025-02-09 04:04:35.358 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-09 04:04:35.359 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-09 04:04:35.359 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.224.142
2025-02-09 04:04:35.359 DEBUG [src.node.docker_mananger] Generated ports ['9835', '9836', '9837', '9838', '9839']
2025-02-09 04:04:35.360 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-09 04:04:35.360 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-09 04:04:35.360 DEBUG [src.node.waku_node] Using volumes []
2025-02-09 04:04:35.360 DEBUG [src.node.docker_mananger] docker run -i -t -p 9835:9835 -p 9836:9836 -p 9837:9837 -p 9838:9838 -p 9839:9839 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=9837 --rest-port=9835 --tcp-port=9836 --discv5-udp-port=9838 --rest-address=0.0.0.0 --nat=extip:172.18.224.142 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=31fbbf462d3c1cfc24be4e7ef9a282e43d0cc4e5a7563be2bef76a01efb4c4ff --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=9839 --metrics-logging=true --relay=true
2025-02-09 04:04:35.590 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.224.142 waku 2f138eece9c71b997a79bea30fc16c0eab209d723a695d5430684aca0697b541
2025-02-09 04:04:35.639 DEBUG [src.node.docker_mananger] Container started with ID 2f138eece9c7. Setting up logs at ./log/docker/node1_2025-02-09_04-04-35__36468e35-818f-4591-a2ce-36fdf8c284ee__wakuorg_nwaku:latest.log
2025-02-09 04:04:35.640 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 9835
2025-02-09 04:04:35.640 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-09 04:04:36.157 ERROR [src.node.docker_mananger] Max retries reached for container 2d1044847c06. Exiting log stream.
2025-02-09 04:04:36.641 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9835/health" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:04:36.644 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-09 04:04:36.644 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-09 04:04:36.644 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9835/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:04:36.646 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.224.142/tcp/9836/p2p/16Uiu2HAkvLmMRqAHEU24SgZFSADSVaq8oRxHC3Zm9dhjvbERgLZt","/ip4/172.18.224.142/tcp/9837/ws/p2p/16Uiu2HAkvLmMRqAHEU24SgZFSADSVaq8oRxHC3Zm9dhjvbERgLZt"],"enrUri":"enr:-L24QMbmDlyYkntZC-euJcPde9ARWDxljw0wEpMmMoSRvg2jDzg4Zu1sMm8QqBIfOM2PoOjYhFFEeQLoeJEjCeQfOiUCgmlkgnY0gmlwhKwS4I6KbXVsdGlhZGRyc5YACASsEuCOBiZsAAoErBLgjgYmbd0DgnJzhQADAQAAiXNlY3AyNTZrMaECDZnbsZztA4ikxkInuFU-ty5LH_2immPGf-uMLCD5-teDdGNwgiZsg3VkcIImboV3YWt1MgE"}'
2025-02-09 04:04:36.647 INFO [src.node.waku_node] REST service is ready !!
2025-02-09 04:04:36.653 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-09 04:04:36.653 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-09_04-04-35__36468e35-818f-4591-a2ce-36fdf8c284ee__wakuorg_nwaku:latest.log
2025-02-09 04:04:36.653 DEBUG [src.node.waku_node] Starting Node...
2025-02-09 04:04:36.653 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-09 04:04:36.655 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-09 04:04:36.655 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.232.231
2025-02-09 04:04:36.655 DEBUG [src.node.docker_mananger] Generated ports ['49617', '49618', '49619', '49620', '49621']
2025-02-09 04:04:36.655 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-09 04:04:36.655 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-09 04:04:36.655 DEBUG [src.node.waku_node] Using volumes []
2025-02-09 04:04:36.656 DEBUG [src.node.docker_mananger] docker run -i -t -p 49617:49617 -p 49618:49618 -p 49619:49619 -p 49620:49620 -p 49621:49621 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=49619 --rest-port=49617 --tcp-port=49618 --discv5-udp-port=49620 --rest-address=0.0.0.0 --nat=extip:172.18.232.231 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=b49709379e5da00e325bdb2feb6bd4cc9ed5fbd7c460ebe69a00ee0e47cafe8a --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=49621 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QMbmDlyYkntZC-euJcPde9ARWDxljw0wEpMmMoSRvg2jDzg4Zu1sMm8QqBIfOM2PoOjYhFFEeQLoeJEjCeQfOiUCgmlkgnY0gmlwhKwS4I6KbXVsdGlhZGRyc5YACASsEuCOBiZsAAoErBLgjgYmbd0DgnJzhQADAQAAiXNlY3AyNTZrMaECDZnbsZztA4ikxkInuFU-ty5LH_2immPGf-uMLCD5-teDdGNwgiZsg3VkcIImboV3YWt1MgE
2025-02-09 04:04:36.880 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.232.231 waku 8b15fb86b26cc1ce071674b51a2168570bc29c6126b03dddb5016880412fad9f
2025-02-09 04:04:36.926 DEBUG [src.node.docker_mananger] Container started with ID 8b15fb86b26c. Setting up logs at ./log/docker/node2_2025-02-09_04-04-35__36468e35-818f-4591-a2ce-36fdf8c284ee__wakuorg_nwaku:latest.log
2025-02-09 04:04:36.927 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 49617
2025-02-09 04:04:36.928 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-09 04:04:37.930 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49617/health" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:04:37.935 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-09 04:04:37.937 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-09 04:04:37.938 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49617/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:04:37.942 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.232.231/tcp/49618/p2p/16Uiu2HAm1q4yEr1ayNsMPkFkoY6mfGk4gH4yTyu9skTpRHXg7ndj","/ip4/172.18.232.231/tcp/49619/ws/p2p/16Uiu2HAm1q4yEr1ayNsMPkFkoY6mfGk4gH4yTyu9skTpRHXg7ndj"],"enrUri":"enr:-L24QKdwKzdPEc2CYkYwmojhzqScURhIqTgSppuhfX8JaUMYZfYShonSoNolSV4IRhe6bea_b0x4ulNj-6J5zkderPsCgmlkgnY0gmlwhKwS6OeKbXVsdGlhZGRyc5YACASsEujnBsHSAAoErBLo5wbB090DgnJzhQADAQAAiXNlY3AyNTZrMaECXyR5vaAWlb6SoWudpAiHtBhDosJg4c7mNtIPYQT1icaDdGNwgsHSg3VkcILB1IV3YWt1MgE"}'
2025-02-09 04:04:37.942 INFO [src.node.waku_node] REST service is ready !!
2025-02-09 04:04:37.942 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:49617/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.224.142/tcp/9836/p2p/16Uiu2HAkvLmMRqAHEU24SgZFSADSVaq8oRxHC3Zm9dhjvbERgLZt"]'
2025-02-09 04:04:37.945 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:04:37.946 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-09 04:04:37.946 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9835/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-09 04:04:37.950 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:04:37.951 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:49617/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-09 04:04:37.957 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:04:37.957 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9835/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-09 04:04:37.963 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:04:37.964 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-09 04:04:38.065 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-09 04:04:38.065 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9835/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:04:38.067 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739073877957718016,"ephemeral":false}]'
2025-02-09 04:04:38.069 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-09 04:04:38.069 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49617/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:04:38.072 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739073877957718016,"ephemeral":false}]'
2025-02-09 04:04:38.073 INFO [src.steps.relay] WARM UP successful!!
2025-02-09 04:04:38.074 DEBUG [tests.relay.test_publish] Running test with Ephemeral True
2025-02-09 04:04:38.075 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9835/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)', "ephemeral": true}'
2025-02-09 04:04:38.079 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:04:38.079 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-09 04:04:38.180 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-09 04:04:38.180 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9835/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:04:38.183 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739073878074912768,"ephemeral":true}]'
2025-02-09 04:04:38.185 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-09 04:04:38.185 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49617/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:04:38.187 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739073878074912768,"ephemeral":true}]'
2025-02-09 04:04:38.188 DEBUG [tests.relay.test_publish] Running test with Ephemeral False
2025-02-09 04:04:38.189 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:9835/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)', "ephemeral": false}'
2025-02-09 04:04:38.194 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:04:38.194 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-09 04:04:38.294 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-09 04:04:38.295 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:9835/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:04:38.297 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739073878189200896,"ephemeral":false}]'
2025-02-09 04:04:38.299 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-09 04:04:38.299 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:49617/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:04:38.301 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739073878189200896,"ephemeral":false}]'
2025-02-09 04:04:38.305 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-09 04:04:38.306 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-09 04:04:38.306 DEBUG [src.node.waku_node] Stopping container with id 2f138eece9c7
2025-02-09 04:04:39.112 DEBUG [src.node.waku_node] Container stopped.
2025-02-09 04:04:39.112 DEBUG [src.node.waku_node] Stopping container with id 8b15fb86b26c
2025-02-09 04:04:39.925 ERROR [src.node.docker_mananger] Max retries reached for container 2f138eece9c7. Exiting log stream.
2025-02-09 04:04:40.631 DEBUG [src.node.waku_node] Container stopped.
2025-02-09 04:04:40.631 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-09 04:04:40.636 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-09 04:04:40.642 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
