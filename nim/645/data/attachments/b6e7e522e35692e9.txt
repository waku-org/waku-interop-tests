2025-02-09 04:07:59.055 DEBUG [tests.conftest] Running fixture setup: test_id
2025-02-09 04:07:59.056 DEBUG [tests.conftest] Running test: test_publish_after_node2_restarts with id: 2025-02-09_04-07-59__d3983539-9396-433c-80aa-ab60e97a1d5b
2025-02-09 04:07:59.056 DEBUG [src.steps.common] Running fixture setup: common_setup
2025-02-09 04:07:59.056 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2025-02-09 04:07:59.057 DEBUG [src.steps.relay] Running fixture setup: setup_main_relay_nodes
2025-02-09 04:07:59.063 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-09 04:07:59.064 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2025-02-09_04-07-59__d3983539-9396-433c-80aa-ab60e97a1d5b__wakuorg_nwaku:latest.log
2025-02-09 04:07:59.064 DEBUG [src.node.waku_node] Starting Node...
2025-02-09 04:07:59.064 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-09 04:07:59.065 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-09 04:07:59.065 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.168.9
2025-02-09 04:07:59.065 DEBUG [src.node.docker_mananger] Generated ports ['37344', '37345', '37346', '37347', '37348']
2025-02-09 04:07:59.066 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-09 04:07:59.066 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-09 04:07:59.066 DEBUG [src.node.waku_node] Using volumes []
2025-02-09 04:07:59.066 DEBUG [src.node.docker_mananger] docker run -i -t -p 37344:37344 -p 37345:37345 -p 37346:37346 -p 37347:37347 -p 37348:37348 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=37346 --rest-port=37344 --tcp-port=37345 --discv5-udp-port=37347 --rest-address=0.0.0.0 --nat=extip:172.18.168.9 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=4dcddf9acdd8cfceaf6f5f5cffaf7bad2e77a53e42defed50f9aeffda43ed86f --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=37348 --metrics-logging=true --relay=true
2025-02-09 04:07:59.326 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.168.9 waku a635dc4d1a50f4294984c3c887f01228e6c5eebdd0e809e2d81337264b3fedca
2025-02-09 04:07:59.376 DEBUG [src.node.docker_mananger] Container started with ID a635dc4d1a50. Setting up logs at ./log/docker/node1_2025-02-09_04-07-59__d3983539-9396-433c-80aa-ab60e97a1d5b__wakuorg_nwaku:latest.log
2025-02-09 04:07:59.376 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 37344
2025-02-09 04:07:59.376 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-09 04:07:59.749 ERROR [src.node.docker_mananger] Max retries reached for container 3ce8f3219cbc. Exiting log stream.
2025-02-09 04:08:00.377 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:37344/health" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:08:00.379 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-09 04:08:00.380 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-09 04:08:00.380 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:37344/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:08:00.382 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.168.9/tcp/37345/p2p/16Uiu2HAmAfAXscwcjmDker4gbUXDo37tPaJ58KpqoYLmqjyL4HTj","/ip4/172.18.168.9/tcp/37346/ws/p2p/16Uiu2HAmAfAXscwcjmDker4gbUXDo37tPaJ58KpqoYLmqjyL4HTj"],"enrUri":"enr:-L24QEzgJieFJdIaenHo65HMqxH0jEezW4lnhmuHOVDnQxXTLE-TqMLt2fspcaZYq4lCnN6Cm8ABY8KHUCx4Xkl0Md0CgmlkgnY0gmlwhKwSqAmKbXVsdGlhZGRyc5YACASsEqgJBpHhAAoErBKoCQaR4t0DgnJzhQADAQAAiXNlY3AyNTZrMaEC4lQjtwLlPsgyaTitftYz9kce1rYASXHFei2gKzESvnaDdGNwgpHhg3VkcIKR44V3YWt1MgE"}'
2025-02-09 04:08:00.382 INFO [src.node.waku_node] REST service is ready !!
2025-02-09 04:08:00.388 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2025-02-09 04:08:00.389 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2025-02-09_04-07-59__d3983539-9396-433c-80aa-ab60e97a1d5b__wakuorg_nwaku:latest.log
2025-02-09 04:08:00.389 DEBUG [src.node.waku_node] Starting Node...
2025-02-09 04:08:00.389 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2025-02-09 04:08:00.390 DEBUG [src.node.docker_mananger] Network waku already exists
2025-02-09 04:08:00.390 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.238.248
2025-02-09 04:08:00.390 DEBUG [src.node.docker_mananger] Generated ports ['19107', '19108', '19109', '19110', '19111']
2025-02-09 04:08:00.391 DEBUG [src.node.waku_node] RLN credentials were not set
2025-02-09 04:08:00.391 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2025-02-09 04:08:00.391 DEBUG [src.node.waku_node] Using volumes []
2025-02-09 04:08:00.391 DEBUG [src.node.docker_mananger] docker run -i -t -p 19107:19107 -p 19108:19108 -p 19109:19109 -p 19110:19110 -p 19111:19111 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=19109 --rest-port=19107 --tcp-port=19108 --discv5-udp-port=19110 --rest-address=0.0.0.0 --nat=extip:172.18.238.248 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=606cbcab7d52286ee6ceab3f0fcb1bf1ec72cb3fbb6d68ceca4ffcbb6fdccbbd --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=19111 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QEzgJieFJdIaenHo65HMqxH0jEezW4lnhmuHOVDnQxXTLE-TqMLt2fspcaZYq4lCnN6Cm8ABY8KHUCx4Xkl0Md0CgmlkgnY0gmlwhKwSqAmKbXVsdGlhZGRyc5YACASsEqgJBpHhAAoErBKoCQaR4t0DgnJzhQADAQAAiXNlY3AyNTZrMaEC4lQjtwLlPsgyaTitftYz9kce1rYASXHFei2gKzESvnaDdGNwgpHhg3VkcIKR44V3YWt1MgE
2025-02-09 04:08:00.619 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.238.248 waku 3e77b6fbcbadcaebf211b377e08938370eaa08bb50281410caeaaf08382ef3e7
2025-02-09 04:08:00.669 DEBUG [src.node.docker_mananger] Container started with ID 3e77b6fbcbad. Setting up logs at ./log/docker/node2_2025-02-09_04-07-59__d3983539-9396-433c-80aa-ab60e97a1d5b__wakuorg_nwaku:latest.log
2025-02-09 04:08:00.670 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 19107
2025-02-09 04:08:00.670 DEBUG [src.libs.common] Sleeping for 1 seconds
2025-02-09 04:08:01.672 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:19107/health" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:08:01.677 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-09 04:08:01.678 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-09 04:08:01.678 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:19107/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:08:01.681 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.238.248/tcp/19108/p2p/16Uiu2HAm3cLiHgFQCgbYpdwfF8EgC1FKorv82xE9z5zPH7d5qygo","/ip4/172.18.238.248/tcp/19109/ws/p2p/16Uiu2HAm3cLiHgFQCgbYpdwfF8EgC1FKorv82xE9z5zPH7d5qygo"],"enrUri":"enr:-L24QBNGND6p7tLdh9ZjU44AqPNBeAfBjrjEez5Fr7VS9fbNQnD4fx4MbDfapPyNP1ImO6quXGHceuh27P3TuwJelD4CgmlkgnY0gmlwhKwS7viKbXVsdGlhZGRyc5YACASsEu74BkqkAAoErBLu-AZKpd0DgnJzhQADAQAAiXNlY3AyNTZrMaECeZkZQnkVug--pytLALglUVWuFORecD6xDT5jd9Qb9KSDdGNwgkqkg3VkcIJKpoV3YWt1MgE"}'
2025-02-09 04:08:01.681 INFO [src.node.waku_node] REST service is ready !!
2025-02-09 04:08:01.682 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:19107/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.168.9/tcp/37345/p2p/16Uiu2HAmAfAXscwcjmDker4gbUXDo37tPaJ58KpqoYLmqjyL4HTj"]'
2025-02-09 04:08:01.684 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:08:01.684 DEBUG [src.steps.relay] Running fixture setup: subscribe_main_relay_nodes
2025-02-09 04:08:01.685 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37344/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-09 04:08:01.689 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:08:01.689 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:19107/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-09 04:08:01.693 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:08:01.694 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37344/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-09 04:08:01.701 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:08:01.702 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-09 04:08:01.802 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-09 04:08:01.802 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:37344/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:08:01.805 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739074081694452224,"ephemeral":false}]'
2025-02-09 04:08:01.807 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-09 04:08:01.807 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:19107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:08:01.809 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739074081694452224,"ephemeral":false}]'
2025-02-09 04:08:01.811 INFO [src.steps.relay] WARM UP successful!!
2025-02-09 04:08:01.812 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37344/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-09 04:08:01.816 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:08:01.817 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-09 04:08:01.917 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-09 04:08:01.918 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:37344/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:08:01.920 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739074081811950080,"ephemeral":false}]'
2025-02-09 04:08:01.922 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-09 04:08:01.922 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:19107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:08:01.924 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739074081811950080,"ephemeral":false}]'
2025-02-09 04:08:01.925 DEBUG [src.node.waku_node] Restarting container with id 3e77b6fbcbad
2025-02-09 04:08:03.382 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:19107/health" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:08:03.486 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:19107/health" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:08:03.489 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
2025-02-09 04:08:03.489 INFO [src.node.waku_node] Node protocols are initialized !!
2025-02-09 04:08:03.489 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:19107/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:08:03.491 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.238.248/tcp/19108/p2p/16Uiu2HAm3cLiHgFQCgbYpdwfF8EgC1FKorv82xE9z5zPH7d5qygo","/ip4/172.18.238.248/tcp/19109/ws/p2p/16Uiu2HAm3cLiHgFQCgbYpdwfF8EgC1FKorv82xE9z5zPH7d5qygo"],"enrUri":"enr:-L24QBNGND6p7tLdh9ZjU44AqPNBeAfBjrjEez5Fr7VS9fbNQnD4fx4MbDfapPyNP1ImO6quXGHceuh27P3TuwJelD4CgmlkgnY0gmlwhKwS7viKbXVsdGlhZGRyc5YACASsEu74BkqkAAoErBLu-AZKpd0DgnJzhQADAQAAiXNlY3AyNTZrMaECeZkZQnkVug--pytLALglUVWuFORecD6xDT5jd9Qb9KSDdGNwgkqkg3VkcIJKpoV3YWt1MgE"}'
2025-02-09 04:08:03.492 INFO [src.node.waku_node] REST service is ready !!
2025-02-09 04:08:03.492 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37344/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-09 04:08:03.494 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:08:03.495 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:19107/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/1"]'
2025-02-09 04:08:03.510 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:08:03.511 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37344/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-09 04:08:03.514 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:08:03.514 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-09 04:08:03.614 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-09 04:08:03.615 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:37344/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:08:03.617 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739074083511079936,"ephemeral":false}]'
2025-02-09 04:08:03.619 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-09 04:08:03.619 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:19107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:08:03.622 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[]'
2025-02-09 04:08:04.623 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:37344/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d '{"payload": "UmVsYXkgd29ya3MhIQ==", "contentTopic": "/test/1/waku-relay/proto", "timestamp": '$(date +%s%N)'}'
2025-02-09 04:08:04.628 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2025-02-09 04:08:04.629 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2025-02-09 04:08:04.730 DEBUG [src.steps.relay] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2025-02-09 04:08:04.730 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:37344/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:08:04.733 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739074084622920192,"ephemeral":false}]'
2025-02-09 04:08:04.734 DEBUG [src.steps.relay] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2025-02-09 04:08:04.734 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:19107/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F1" -H "Content-Type: application/json" -d 'None'
2025-02-09 04:08:04.737 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"UmVsYXkgd29ya3MhIQ==","contentTopic":"/test/1/waku-relay/proto","version":0,"timestamp":1739074084622920192,"ephemeral":false}]'
2025-02-09 04:08:04.740 DEBUG [tests.conftest] Running fixture teardown: test_setup
2025-02-09 04:08:04.741 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2025-02-09 04:08:04.741 DEBUG [src.node.waku_node] Stopping container with id a635dc4d1a50
2025-02-09 04:08:05.874 DEBUG [src.node.waku_node] Container stopped.
2025-02-09 04:08:05.875 DEBUG [src.node.waku_node] Stopping container with id 3e77b6fbcbad
2025-02-09 04:08:06.717 ERROR [src.node.docker_mananger] Max retries reached for container a635dc4d1a50. Exiting log stream.
2025-02-09 04:08:07.380 DEBUG [src.node.waku_node] Container stopped.
2025-02-09 04:08:07.381 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2025-02-09 04:08:07.400 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2025-02-09 04:08:07.418 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
