[35mDEBUG   [0m tests.conftest:conftest.py:51 Running fixture setup: test_id
[35mDEBUG   [0m tests.conftest:conftest.py:57 Running test: test_light_push_and_retrieve_duplicate_message with id: 2024-10-30_04-11-01__4215689e-f2b2-4fd0-9671-67e9ec51c0b3
[35mDEBUG   [0m src.steps.common:common.py:18 Running fixture setup: common_setup
[35mDEBUG   [0m src.steps.light_push:light_push.py:27 Running fixture setup: light_push_setup
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:19 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:85 WakuNode instance initialized with log path ./log/docker/receiving_node1_2024-10-30_04-11-01__4215689e-f2b2-4fd0-9671-67e9ec51c0b3__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:22 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:25 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:108 Generated random external IP 172.18.109.127
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:101 Generated ports ['13105', '13106', '13107', '13108', '13109']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:434 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:163 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:165 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:49 docker run -i -t -p 13105:13105 -p 13106:13106 -p 13107:13107 -p 13108:13108 -p 13109:13109 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=13107 --rest-port=13105 --tcp-port=13106 --discv5-udp-port=13108 --rest-address=0.0.0.0 --nat=extip:172.18.109.127 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=abec5f9c19c7df29fcd6a0eeb5b1fd6de853b86e1dadfe44cfeb00df9818b97f --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=13109 --metrics-logging=true --lightpush=true --relay=true
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:55 docker network connect --ip 172.18.109.127 waku 5752fd146f4a521f57d2e58bef43c95c5a2e79bac03da87ec82469344399e0f7
[1m[31mERROR   [0m src.node.docker_mananger:docker_mananger.py:89 Max retries reached for container 5e6ae539f5d9. Exiting log stream.
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:58 Container started with ID 5752fd146f4a. Setting up logs at ./log/docker/receiving_node1_2024-10-30_04-11-01__4215689e-f2b2-4fd0-9671-67e9ec51c0b3__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:177 Started container from image wakuorg/nwaku:latest. REST: 13105
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:13105/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:277 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:13105/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.109.127/tcp/13106/p2p/16Uiu2HAmMx5cG38WEx9PuSyzL86dTZUacMqVrJvk49x8TWbaka1S","/ip4/172.18.109.127/tcp/13107/ws/p2p/16Uiu2HAmMx5cG38WEx9PuSyzL86dTZUacMqVrJvk49x8TWbaka1S"],"enrUri":"enr:-L24QFJ9LXdDD98LhJiEbus8ZnE_JBNh2Bbfyk-qht6kRQpkZlij6jMN1kOb1AOkc4vTJ0q5lz4wQ8u142-0N7eAYYYCgmlkgnY0gmlwhKwSbX-KbXVsdGlhZGRyc5YACASsEm1_BjMyAAoErBJtfwYzM90DgnJzhQADAQAAiXNlY3AyNTZrMaEDihoAXyRfVnnKsIk6fIJh6eQSDEM9G2mJpnPBOh3ukAWDdGNwgjMyg3VkcIIzNIV3YWt1Mgk"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:282 REST service is ready !!
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:19 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:85 WakuNode instance initialized with log path ./log/docker/receiving_node2_2024-10-30_04-11-01__4215689e-f2b2-4fd0-9671-67e9ec51c0b3__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:22 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:25 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:108 Generated random external IP 172.18.27.244
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:101 Generated ports ['39364', '39365', '39366', '39367', '39368']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:434 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:163 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:165 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:49 docker run -i -t -p 39364:39364 -p 39365:39365 -p 39366:39366 -p 39367:39367 -p 39368:39368 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=39366 --rest-port=39364 --tcp-port=39365 --discv5-udp-port=39367 --rest-address=0.0.0.0 --nat=extip:172.18.27.244 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=f87ef922ddcfe0bac88a3b7baf7d280bcb22e7cbcb3e24a6aeea9937ccd1af5a --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=39368 --metrics-logging=true --lightpush=false --relay=true
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:55 docker network connect --ip 172.18.27.244 waku e438dd557f2b9f6bc0e36d3247623c3f4cd49f82c2c117218eac5efd61fe856a
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:58 Container started with ID e438dd557f2b. Setting up logs at ./log/docker/receiving_node2_2024-10-30_04-11-01__4215689e-f2b2-4fd0-9671-67e9ec51c0b3__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:177 Started container from image wakuorg/nwaku:latest. REST: 39364
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:39364/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:277 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:39364/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.27.244/tcp/39365/p2p/16Uiu2HAky5eETFPfNnoxDhSWrhdzuF9CcHq8CE5Ran9NKCpKMmaZ","/ip4/172.18.27.244/tcp/39366/ws/p2p/16Uiu2HAky5eETFPfNnoxDhSWrhdzuF9CcHq8CE5Ran9NKCpKMmaZ"],"enrUri":"enr:-L24QFlEi2D29B97oX0ohxzSM6xFnBiraDPI63jemxyMqgdjBRP2AKOOgJqVKXyUA_mqA8qWZINJtxFW5mXtZZZvxrACgmlkgnY0gmlwhKwSG_SKbXVsdGlhZGRyc5YACASsEhv0BpnFAAoErBIb9AaZxt0DgnJzhQADAQAAiXNlY3AyNTZrMaECNk0n6aWbel3veNxPXKlKcc-yVeDztYegN5WIyZvPOyqDdGNwgpnFg3VkcIKZx4V3YWt1MgE"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:282 REST service is ready !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:39364/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.109.127/tcp/13106/p2p/16Uiu2HAmMx5cG38WEx9PuSyzL86dTZUacMqVrJvk49x8TWbaka1S"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:19 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:85 WakuNode instance initialized with log path ./log/docker/lightpush_node1_2024-10-30_04-11-01__4215689e-f2b2-4fd0-9671-67e9ec51c0b3__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:22 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:25 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:108 Generated random external IP 172.18.17.62
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:101 Generated ports ['14592', '14593', '14594', '14595', '14596']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:434 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:163 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:165 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:49 docker run -i -t -p 14592:14592 -p 14593:14593 -p 14594:14594 -p 14595:14595 -p 14596:14596 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=14594 --rest-port=14592 --tcp-port=14593 --discv5-udp-port=14595 --rest-address=0.0.0.0 --nat=extip:172.18.17.62 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=bdd4d2f0579df6d5d1f3e4995dcf70b7081321a2c0e5169bb7a824e853dc7ecf --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=14596 --metrics-logging=true --discv5-bootstrap-node=enr:-L24QFJ9LXdDD98LhJiEbus8ZnE_JBNh2Bbfyk-qht6kRQpkZlij6jMN1kOb1AOkc4vTJ0q5lz4wQ8u142-0N7eAYYYCgmlkgnY0gmlwhKwSbX-KbXVsdGlhZGRyc5YACASsEm1_BjMyAAoErBJtfwYzM90DgnJzhQADAQAAiXNlY3AyNTZrMaEDihoAXyRfVnnKsIk6fIJh6eQSDEM9G2mJpnPBOh3ukAWDdGNwgjMyg3VkcIIzNIV3YWt1Mgk --lightpushnode=/ip4/172.18.109.127/tcp/13106/p2p/16Uiu2HAmMx5cG38WEx9PuSyzL86dTZUacMqVrJvk49x8TWbaka1S --lightpush=true --relay=false
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:55 docker network connect --ip 172.18.17.62 waku d75459d95b64956c12f16a95f32e8ccf1d40db29a5bdc16859ab697b098f0f0e
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:58 Container started with ID d75459d95b64. Setting up logs at ./log/docker/lightpush_node1_2024-10-30_04-11-01__4215689e-f2b2-4fd0-9671-67e9ec51c0b3__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:177 Started container from image wakuorg/nwaku:latest. REST: 14592
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:14592/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:277 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:14592/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.17.62/tcp/14593/p2p/16Uiu2HAky4kBynK3DWwbYBp9otrEmYFRAAWMogUrQh1ohWmwi3og","/ip4/172.18.17.62/tcp/14594/ws/p2p/16Uiu2HAky4kBynK3DWwbYBp9otrEmYFRAAWMogUrQh1ohWmwi3og"],"enrUri":"enr:-L24QAIiWNS4c7KCUMPYQQYW5zxKN5HTNcdIZ7czEO0ZcYe5Fv1dSiPGzMKbGqLTEw0bCK5YuOlTSjyE3pYkvscWVcMCgmlkgnY0gmlwhKwSET6KbXVsdGlhZGRyc5YACASsEhE-BjkBAAoErBIRPgY5At0DgnJzhQADAQAAiXNlY3AyNTZrMaECNhJPpDhsAzH2mMaYUQbKrm6IGLSnCWdGlPB3qJcGvWODdGNwgjkBg3VkcII5A4V3YWt1Mgg"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:282 REST service is ready !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:14592/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.109.127/tcp/13106/p2p/16Uiu2HAmMx5cG38WEx9PuSyzL86dTZUacMqVrJvk49x8TWbaka1S"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:14592/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.27.244/tcp/39365/p2p/16Uiu2HAky5eETFPfNnoxDhSWrhdzuF9CcHq8CE5Ran9NKCpKMmaZ"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:13105/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:39364/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.steps.light_push:light_push.py:120 Lightpushing message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:14592/lightpush/v1/message" -H "Content-Type: application/json" -d '{"pubsubTopic": "/waku/2/rs/3/0", "message": {"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": 1730261467338788864}}'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 0.1 seconds
[35mDEBUG   [0m src.steps.light_push:light_push.py:124 Checking that peer NODE_1:wakuorg/nwaku:latest can find the lightpushed message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:13105/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1730261467338788864,"ephemeral":false}]'
[35mDEBUG   [0m src.steps.light_push:light_push.py:124 Checking that peer NODE_2:wakuorg/nwaku:latest can find the lightpushed message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:39364/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1730261467338788864,"ephemeral":false}]'
[35mDEBUG   [0m src.steps.light_push:light_push.py:120 Lightpushing message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:14592/lightpush/v1/message" -H "Content-Type: application/json" -d '{"pubsubTopic": "/waku/2/rs/3/0", "message": {"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": 1730261467338788864}}'
[1m[31mERROR   [0m src.node.api_clients.base_client:base_client.py:16 HTTP error occurred: 503 Server Error: Service Unavailable for url: http://127.0.0.1:14592/lightpush/v1/message. Response content: b'Failed to request a message push: not_published_to_any_peer'
[35mDEBUG   [0m tests.conftest:conftest.py:59 Running fixture teardown: test_setup
[35mDEBUG   [0m tests.conftest:conftest.py:83 Running fixture teardown: close_open_nodes
[35mDEBUG   [0m src.node.waku_node:waku_node.py:221 Stopping container with id 5752fd146f4a
[35mDEBUG   [0m src.node.waku_node:waku_node.py:228 Container stopped.
[35mDEBUG   [0m src.node.waku_node:waku_node.py:221 Stopping container with id e438dd557f2b
[1m[31mERROR   [0m src.node.docker_mananger:docker_mananger.py:89 Max retries reached for container 5752fd146f4a. Exiting log stream.
[35mDEBUG   [0m src.node.waku_node:waku_node.py:228 Container stopped.
[35mDEBUG   [0m src.node.waku_node:waku_node.py:221 Stopping container with id d75459d95b64
[1m[31mERROR   [0m src.node.docker_mananger:docker_mananger.py:89 Max retries reached for container e438dd557f2b. Exiting log stream.
[35mDEBUG   [0m src.node.waku_node:waku_node.py:228 Container stopped.
[35mDEBUG   [0m tests.conftest:conftest.py:98 Running fixture teardown: check_waku_log_errors
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:144 No errors found in the waku logs.
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:144 No errors found in the waku logs.
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:144 No errors found in the waku logs.