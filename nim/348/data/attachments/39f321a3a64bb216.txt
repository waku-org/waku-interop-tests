[35mDEBUG   [0m tests.conftest:conftest.py:51 Running fixture setup: test_id
[35mDEBUG   [0m tests.conftest:conftest.py:57 Running test: test_light_push_and_retrieve_duplicate_message with id: 2024-09-06_11-55-04__bb7f094b-f989-42eb-90b9-97b3c491fdf4
[35mDEBUG   [0m src.steps.common:common.py:17 Running fixture setup: common_setup
[35mDEBUG   [0m src.steps.light_push:light_push.py:27 Running fixture setup: light_push_setup
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:18 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:85 WakuNode instance initialized with log path ./log/docker/receiving_node1_2024-09-06_11-55-04__bb7f094b-f989-42eb-90b9-97b3c491fdf4__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:21 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:24 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:81 Generated random external IP 172.18.18.13
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:74 Generated ports ['4048', '4049', '4050', '4051', '4052']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:434 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:163 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:165 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:48 docker run -i -t -p 4048:4048 -p 4049:4049 -p 4050:4050 -p 4051:4051 -p 4052:4052 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=4050 --rest-port=4048 --tcp-port=4049 --discv5-udp-port=4051 --rest-address=0.0.0.0 --nat=extip:172.18.18.13 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=d5afb7d44ef9b5ec20dbcaf42ecd0635ece10820da0bd883cef5b2bc1fafcaaa --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=4052 --metrics-logging=true --lightpush=true --relay=true
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:54 docker network connect --ip 172.18.18.13 waku 8e8904a9d2a9ac873ce43e7f987bd134ee09489d2d875fc40a30bc62eb85adc3
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:57 Container started with ID 8e8904a9d2a9. Setting up logs at ./log/docker/receiving_node1_2024-09-06_11-55-04__bb7f094b-f989-42eb-90b9-97b3c491fdf4__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:177 Started container from image wakuorg/nwaku:latest. REST: 4048
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:4048/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:277 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:4048/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.18.13/tcp/4049/p2p/16Uiu2HAmDumZMRsnxXnPATukTQ5nznDQBZ44Txuz2EeWsnZS1G26","/ip4/172.18.18.13/tcp/4050/ws/p2p/16Uiu2HAmDumZMRsnxXnPATukTQ5nznDQBZ44Txuz2EeWsnZS1G26"],"enrUri":"enr:-LO4QLXpYS8aD1V9cmMG1cy0Go-pfTYyGTTO4jMl1w95JLS3MNIX3hB0xShM07PtyLL7c4gAHa6qIF9wk4WRtinhcXUBgmlkgnY0gmlwhKwSEg2KbXVsdGlhZGRyc4wACgSsEhINBg_S3QOCcnOFAAMBAACJc2VjcDI1NmsxoQMSpO9hxcpERly1CT-OV1UhduDxrlZwhMJAONl9ItuRK4N0Y3CCD9GDdWRwgg_ThXdha3UyCQ"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:282 REST service is ready !!
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:18 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:85 WakuNode instance initialized with log path ./log/docker/receiving_node2_2024-09-06_11-55-04__bb7f094b-f989-42eb-90b9-97b3c491fdf4__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:21 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:24 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:81 Generated random external IP 172.18.125.228
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:74 Generated ports ['63943', '63944', '63945', '63946', '63947']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:434 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:163 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:165 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:48 docker run -i -t -p 63943:63943 -p 63944:63944 -p 63945:63945 -p 63946:63946 -p 63947:63947 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=63945 --rest-port=63943 --tcp-port=63944 --discv5-udp-port=63946 --rest-address=0.0.0.0 --nat=extip:172.18.125.228 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=0eeaec218effbb0e9fb15f1c4f33b196dfebf05d34e9fd1cc909a65a5ec1e31f --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=63947 --metrics-logging=true --lightpush=false --relay=true
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:54 docker network connect --ip 172.18.125.228 waku bb0e129b9667b0b7cf9e20e2be3a42624fc7ae9742b3b6757721f4cf28e7810e
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:57 Container started with ID bb0e129b9667. Setting up logs at ./log/docker/receiving_node2_2024-09-06_11-55-04__bb7f094b-f989-42eb-90b9-97b3c491fdf4__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:177 Started container from image wakuorg/nwaku:latest. REST: 63943
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:63943/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:277 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:63943/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.125.228/tcp/63944/p2p/16Uiu2HAm6x4V1onpszc1LtBdFabgDwozAYBVZNoN2CbHaoKxenKh","/ip4/172.18.125.228/tcp/63945/ws/p2p/16Uiu2HAm6x4V1onpszc1LtBdFabgDwozAYBVZNoN2CbHaoKxenKh"],"enrUri":"enr:-LO4QN0SBnwBW-j_3MS14u7M8XAwg1G4MnrJilgE0DFCAqH2PPzUX-ybGaKELVI9lkHtrKQbGT7Jl-CYwPignucQjNIBgmlkgnY0gmlwhKwSfeSKbXVsdGlhZGRyc4wACgSsEn3kBvnJ3QOCcnOFAAMBAACJc2VjcDI1NmsxoQKrOWz0fjm54lanaxbstGwvubBAwtkrL4lq4JI8m6wRCIN0Y3CC-ciDdWRwgvnKhXdha3UyAQ"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:282 REST service is ready !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:63943/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.18.13/tcp/4049/p2p/16Uiu2HAmDumZMRsnxXnPATukTQ5nznDQBZ44Txuz2EeWsnZS1G26"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:18 Docker client initialized with image wakuorg/nwaku:latest
[35mDEBUG   [0m src.node.waku_node:waku_node.py:85 WakuNode instance initialized with log path ./log/docker/lightpush_node1_2024-09-06_11-55-04__bb7f094b-f989-42eb-90b9-97b3c491fdf4__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:89 Starting Node...
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:21 Attempting to create or retrieve network waku
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:24 Network waku already exists
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:81 Generated random external IP 172.18.247.209
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:74 Generated ports ['59794', '59795', '59796', '59797', '59798']
[35mDEBUG   [0m src.node.waku_node:waku_node.py:434 RLN credentials were not set
[32mINFO    [0m src.node.waku_node:waku_node.py:163 RLN credentials not set or credential store not available, starting without RLN
[35mDEBUG   [0m src.node.waku_node:waku_node.py:165 Using volumes []
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:48 docker run -i -t -p 59794:59794 -p 59795:59795 -p 59796:59796 -p 59797:59797 -p 59798:59798 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=59796 --rest-port=59794 --tcp-port=59795 --discv5-udp-port=59797 --rest-address=0.0.0.0 --nat=extip:172.18.247.209 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=c1abeaded5c2efdc1fbf2d9f1ec8aa3da0bc9dea978dd81ac8bfeeb1b8fe7fb7 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=59798 --metrics-logging=true --discv5-bootstrap-node=enr:-LO4QLXpYS8aD1V9cmMG1cy0Go-pfTYyGTTO4jMl1w95JLS3MNIX3hB0xShM07PtyLL7c4gAHa6qIF9wk4WRtinhcXUBgmlkgnY0gmlwhKwSEg2KbXVsdGlhZGRyc4wACgSsEhINBg_S3QOCcnOFAAMBAACJc2VjcDI1NmsxoQMSpO9hxcpERly1CT-OV1UhduDxrlZwhMJAONl9ItuRK4N0Y3CCD9GDdWRwgg_ThXdha3UyCQ --lightpushnode=/ip4/172.18.18.13/tcp/4049/p2p/16Uiu2HAmDumZMRsnxXnPATukTQ5nznDQBZ44Txuz2EeWsnZS1G26 --lightpush=true --relay=false
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:54 docker network connect --ip 172.18.247.209 waku 6634147ca5f0ff656c7a3b19322f027703e8388a2c60c2c2db772943ef375632
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:57 Container started with ID 6634147ca5f0. Setting up logs at ./log/docker/lightpush_node1_2024-09-06_11-55-04__bb7f094b-f989-42eb-90b9-97b3c491fdf4__wakuorg_nwaku:latest.log
[35mDEBUG   [0m src.node.waku_node:waku_node.py:177 Started container from image wakuorg/nwaku:latest. REST: 59794
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 1 seconds
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:59794/health" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"nodeHealth":"Ready","protocolsHealth":[]}'
[32mINFO    [0m src.node.waku_node:waku_node.py:277 Node protocols are initialized !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:59794/debug/v1/info" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.247.209/tcp/59795/p2p/16Uiu2HAmDroFfeYQbDHwBJRXdMYFWWWdhuujnqT5SwVLJS1USeBV","/ip4/172.18.247.209/tcp/59796/ws/p2p/16Uiu2HAmDroFfeYQbDHwBJRXdMYFWWWdhuujnqT5SwVLJS1USeBV"],"enrUri":"enr:-LO4QA7O8gIuvggoovRG3Rtew2EkdgHzF8PAl8NLCb9LgXaQW3tYCawAlNtAnPSj4nruW78pqqzYrkK0bzsKKgdMP8kBgmlkgnY0gmlwhKwS99GKbXVsdGlhZGRyc4wACgSsEvfRBumU3QOCcnOFAAMBAACJc2VjcDI1NmsxoQMR4hv52XFM6nsvdQD4rr5chMLaO0t6nF9k_uZxXZNw7IN0Y3CC6ZODdWRwgumVhXdha3UyCA"}'
[32mINFO    [0m src.node.waku_node:waku_node.py:282 REST service is ready !!
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:59794/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.18.13/tcp/4049/p2p/16Uiu2HAmDumZMRsnxXnPATukTQ5nznDQBZ44Txuz2EeWsnZS1G26"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:59794/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.125.228/tcp/63944/p2p/16Uiu2HAm6x4V1onpszc1LtBdFabgDwozAYBVZNoN2CbHaoKxenKh"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:4048/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:63943/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.steps.light_push:light_push.py:120 Lightpushing message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:59794/lightpush/v1/message" -H "Content-Type: application/json" -d '{"pubsubTopic": "/waku/2/rs/3/0", "message": {"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": 1725623709525207296}}'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'OK'
[35mDEBUG   [0m src.libs.common:common.py:35 Sleeping for 0.1 seconds
[35mDEBUG   [0m src.steps.light_push:light_push.py:124 Checking that peer NODE_1:wakuorg/nwaku:latest can find the lightpushed message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:4048/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1725623709525207296,"ephemeral":false}]'
[35mDEBUG   [0m src.steps.light_push:light_push.py:124 Checking that peer NODE_2:wakuorg/nwaku:latest can find the lightpushed message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X GET "http://127.0.0.1:63943/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:22 Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1725623709525207296,"ephemeral":false}]'
[35mDEBUG   [0m src.steps.light_push:light_push.py:120 Lightpushing message
[32mINFO    [0m src.node.api_clients.base_client:base_client.py:37 curl -v -X POST "http://127.0.0.1:59794/lightpush/v1/message" -H "Content-Type: application/json" -d '{"pubsubTopic": "/waku/2/rs/3/0", "message": {"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": 1725623709525207296}}'
[1m[31mERROR   [0m src.node.api_clients.base_client:base_client.py:16 HTTP error occurred: 503 Server Error: Service Unavailable for url: http://127.0.0.1:59794/lightpush/v1/message. Response content: b'Failed to request a message push: Lightpush request has not been published to any peers. msg_hash: 0x23de4cff835afe092a6d9e0ad710ed580e61e4bc80a245f3bb3b208c6f210681'
[35mDEBUG   [0m tests.conftest:conftest.py:59 Running fixture teardown: test_setup
[35mDEBUG   [0m tests.conftest:conftest.py:83 Running fixture teardown: close_open_nodes
[35mDEBUG   [0m src.node.waku_node:waku_node.py:221 Stopping container with id 8e8904a9d2a9
[35mDEBUG   [0m src.node.waku_node:waku_node.py:228 Container stopped.
[35mDEBUG   [0m src.node.waku_node:waku_node.py:221 Stopping container with id bb0e129b9667
[35mDEBUG   [0m src.node.waku_node:waku_node.py:228 Container stopped.
[35mDEBUG   [0m src.node.waku_node:waku_node.py:221 Stopping container with id 6634147ca5f0
[35mDEBUG   [0m src.node.waku_node:waku_node.py:228 Container stopped.
[35mDEBUG   [0m tests.conftest:conftest.py:98 Running fixture teardown: check_waku_log_errors
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:117 No errors found in the waku logs.
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:117 No errors found in the waku logs.
[35mDEBUG   [0m src.node.docker_mananger:docker_mananger.py:117 No errors found in the waku logs.